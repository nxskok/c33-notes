% Options for packages loaded elsewhere
\PassOptionsToPackage{unicode}{hyperref}
\PassOptionsToPackage{hyphens}{url}
%
\documentclass[
  ignorenonframetext,
]{beamer}
\usepackage{pgfpages}
\setbeamertemplate{caption}[numbered]
\setbeamertemplate{caption label separator}{: }
\setbeamercolor{caption name}{fg=normal text.fg}
\beamertemplatenavigationsymbolsempty
% Prevent slide breaks in the middle of a paragraph
\widowpenalties 1 10000
\raggedbottom
\setbeamertemplate{part page}{
  \centering
  \begin{beamercolorbox}[sep=16pt,center]{part title}
    \usebeamerfont{part title}\insertpart\par
  \end{beamercolorbox}
}
\setbeamertemplate{section page}{
  \centering
  \begin{beamercolorbox}[sep=12pt,center]{part title}
    \usebeamerfont{section title}\insertsection\par
  \end{beamercolorbox}
}
\setbeamertemplate{subsection page}{
  \centering
  \begin{beamercolorbox}[sep=8pt,center]{part title}
    \usebeamerfont{subsection title}\insertsubsection\par
  \end{beamercolorbox}
}
\AtBeginPart{
  \frame{\partpage}
}
\AtBeginSection{
  \ifbibliography
  \else
    \frame{\sectionpage}
  \fi
}
\AtBeginSubsection{
  \frame{\subsectionpage}
}
\usepackage{lmodern}
\usepackage{amssymb,amsmath}
\usepackage{ifxetex,ifluatex}
\ifnum 0\ifxetex 1\fi\ifluatex 1\fi=0 % if pdftex
  \usepackage[T1]{fontenc}
  \usepackage[utf8]{inputenc}
  \usepackage{textcomp} % provide euro and other symbols
\else % if luatex or xetex
  \usepackage{unicode-math}
  \defaultfontfeatures{Scale=MatchLowercase}
  \defaultfontfeatures[\rmfamily]{Ligatures=TeX,Scale=1}
\fi
\usetheme[]{AnnArbor}
\usecolortheme{dove}
% Use upquote if available, for straight quotes in verbatim environments
\IfFileExists{upquote.sty}{\usepackage{upquote}}{}
\IfFileExists{microtype.sty}{% use microtype if available
  \usepackage[]{microtype}
  \UseMicrotypeSet[protrusion]{basicmath} % disable protrusion for tt fonts
}{}
\makeatletter
\@ifundefined{KOMAClassName}{% if non-KOMA class
  \IfFileExists{parskip.sty}{%
    \usepackage{parskip}
  }{% else
    \setlength{\parindent}{0pt}
    \setlength{\parskip}{6pt plus 2pt minus 1pt}}
}{% if KOMA class
  \KOMAoptions{parskip=half}}
\makeatother
\usepackage{xcolor}
\IfFileExists{xurl.sty}{\usepackage{xurl}}{} % add URL line breaks if available
\IfFileExists{bookmark.sty}{\usepackage{bookmark}}{\usepackage{hyperref}}
\hypersetup{
  pdftitle={STAC33: Introduction to Applied Statistics},
  pdfauthor={Lecture notes},
  hidelinks,
  pdfcreator={LaTeX via pandoc}}
\urlstyle{same} % disable monospaced font for URLs
\newif\ifbibliography
\usepackage{color}
\usepackage{fancyvrb}
\newcommand{\VerbBar}{|}
\newcommand{\VERB}{\Verb[commandchars=\\\{\}]}
\DefineVerbatimEnvironment{Highlighting}{Verbatim}{commandchars=\\\{\}}
% Add ',fontsize=\small' for more characters per line
\usepackage{framed}
\definecolor{shadecolor}{RGB}{248,248,248}
\newenvironment{Shaded}{\begin{snugshade}}{\end{snugshade}}
\newcommand{\AlertTok}[1]{\textcolor[rgb]{0.94,0.16,0.16}{#1}}
\newcommand{\AnnotationTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\newcommand{\AttributeTok}[1]{\textcolor[rgb]{0.77,0.63,0.00}{#1}}
\newcommand{\BaseNTok}[1]{\textcolor[rgb]{0.00,0.00,0.81}{#1}}
\newcommand{\BuiltInTok}[1]{#1}
\newcommand{\CharTok}[1]{\textcolor[rgb]{0.31,0.60,0.02}{#1}}
\newcommand{\CommentTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textit{#1}}}
\newcommand{\CommentVarTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\newcommand{\ConstantTok}[1]{\textcolor[rgb]{0.00,0.00,0.00}{#1}}
\newcommand{\ControlFlowTok}[1]{\textcolor[rgb]{0.13,0.29,0.53}{\textbf{#1}}}
\newcommand{\DataTypeTok}[1]{\textcolor[rgb]{0.13,0.29,0.53}{#1}}
\newcommand{\DecValTok}[1]{\textcolor[rgb]{0.00,0.00,0.81}{#1}}
\newcommand{\DocumentationTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\newcommand{\ErrorTok}[1]{\textcolor[rgb]{0.64,0.00,0.00}{\textbf{#1}}}
\newcommand{\ExtensionTok}[1]{#1}
\newcommand{\FloatTok}[1]{\textcolor[rgb]{0.00,0.00,0.81}{#1}}
\newcommand{\FunctionTok}[1]{\textcolor[rgb]{0.00,0.00,0.00}{#1}}
\newcommand{\ImportTok}[1]{#1}
\newcommand{\InformationTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\newcommand{\KeywordTok}[1]{\textcolor[rgb]{0.13,0.29,0.53}{\textbf{#1}}}
\newcommand{\NormalTok}[1]{#1}
\newcommand{\OperatorTok}[1]{\textcolor[rgb]{0.81,0.36,0.00}{\textbf{#1}}}
\newcommand{\OtherTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{#1}}
\newcommand{\PreprocessorTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textit{#1}}}
\newcommand{\RegionMarkerTok}[1]{#1}
\newcommand{\SpecialCharTok}[1]{\textcolor[rgb]{0.00,0.00,0.00}{#1}}
\newcommand{\SpecialStringTok}[1]{\textcolor[rgb]{0.31,0.60,0.02}{#1}}
\newcommand{\StringTok}[1]{\textcolor[rgb]{0.31,0.60,0.02}{#1}}
\newcommand{\VariableTok}[1]{\textcolor[rgb]{0.00,0.00,0.00}{#1}}
\newcommand{\VerbatimStringTok}[1]{\textcolor[rgb]{0.31,0.60,0.02}{#1}}
\newcommand{\WarningTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\usepackage{graphicx,grffile}
\makeatletter
\def\maxwidth{\ifdim\Gin@nat@width>\linewidth\linewidth\else\Gin@nat@width\fi}
\def\maxheight{\ifdim\Gin@nat@height>\textheight\textheight\else\Gin@nat@height\fi}
\makeatother
% Scale images if necessary, so that they will not overflow the page
% margins by default, and it is still possible to overwrite the defaults
% using explicit options in \includegraphics[width, height, ...]{}
\setkeys{Gin}{width=\maxwidth,height=\maxheight,keepaspectratio}
% Set default figure placement to htbp
\makeatletter
\def\fps@figure{htbp}
\makeatother
\setlength{\emergencystretch}{3em} % prevent overfull lines
\providecommand{\tightlist}{%
  \setlength{\itemsep}{0pt}\setlength{\parskip}{0pt}}
\setcounter{secnumdepth}{-\maxdimen} % remove section numbering
\usepackage{multicol}

\title{STAC33: Introduction to Applied Statistics}
\author{Lecture notes}
\date{}

\begin{document}
\frame{\titlepage}

\hypertarget{course-outline}{%
\section{Course outline}\label{course-outline}}

\begin{frame}{In this course}
\protect\hypertarget{in-this-course}{}

\begin{itemize}
\tightlist
\item
  Data analysis: use mostly known (to you) statistical methods to gain
  insight about data.
\item
  Use two software packages, SAS and R --- I assume you know nothing
  about these.
\item
  Look at lots of examples.
\item
  ``Get your hands dirty''.
\item
  Writing reports.
\item
  Other tasks in R and SAS.
\end{itemize}

\end{frame}

\begin{frame}{Prerequisites}
\protect\hypertarget{prerequisites}{}

\begin{itemize}
\tightlist
\item
  You \emph{need} a second Statistics course that covers statistical
  inference from a mathematical viewpoint, one of these:

  \begin{itemize}
  \tightlist
  \item
    STAB57
  \item
    STA 248
  \item
    STA 261
  \end{itemize}
\item
  I check prerequisites.
\item
  You need STAB57 for the Statistics Minor/Major/Specialist programs.
\end{itemize}

\end{frame}

\begin{frame}{The instructor, lectures and tutorials}
\protect\hypertarget{the-instructor-lectures-and-tutorials}{}

\begin{itemize}
\tightlist
\item
  Ken Butler, office IC 471, e-mail:
  \url{mailto:butler@utsc.utoronto.ca}
\item
  Lectures (section LEC01): both of

  \begin{itemize}
  \tightlist
  \item
    Tuesday 12:00-13:00 in IC 220
  \item
    Thursday 14:00-15:00 in SW 128.
  \end{itemize}
\item
  Students in section LEC60 should watch the videotaped lectures (access
  from Quercus).
\item
  Tutorial: one of

  \begin{itemize}
  \tightlist
  \item
    Monday 09:00, 10:00, 11:00, 12:00, in BV 498 (1 hour each).
  \end{itemize}
\item
  Office hours: Tuesday 14:00-15:00, Thursday 15:00-16:30. Or by
  appointment (e-mail me, address above, to set one up).
\item
  course website \href{http://ritsokiguess.site/STAC33}{\textbf{here}}.
\item
  This course is on Quercus. Go
  \href{http://q.utoronto.ca}{\textbf{here}}, log in, and find this
  course among your courses. Assignment hand-in, grading and marks will
  be done through Quercus.
\item
  E-mail: Use only UTSC/UToronto e-mail address. I aim to respond within
  two working days. Non-simple questions: office hours/tutorial.
\end{itemize}

\end{frame}

\begin{frame}{Text(s)}
\protect\hypertarget{texts}{}

\begin{columns}
    \begin{column}{0.7\textwidth}
Recommended:
  \begin{itemize}
\item ``SAS Essentials: Mastering SAS for data analytics'' by Alan C.\
  Elliott and Wayne A.\ Woodward, publ.\ Wiley. ISBN 978-1-119-04216-7.
\item ``R for Data Science'' by Hadley Wickham and Garrett Grolemund,
  publ.\ O'Reilly, ISBN 978-1-491-91039-9. Also available (free)
  online at \url{http://r4ds.had.co.nz/}.
  \item ``Problems and Solutions in Applied Statistics'' by your instructor, free online at \url{ritsokiguess.site/pasias}
\end{itemize}
    \end{column}
    \begin{column}{0.3\textwidth}
      \includegraphics[width=1in]{Screenshot_2018-08-17_12-24-26.png}

      \includegraphics[width=1in]{r4ds}
    \end{column}
  \end{columns}

\end{frame}

\begin{frame}{Structure of course}
\protect\hypertarget{structure-of-course}{}

\begin{itemize}
\tightlist
\item
  3 hours/week of class time.
\item
  Of these, 1 hour in computer lab (``tutorial''):

  \begin{itemize}
  \tightlist
  \item
    practice what you learned from lecture
  \item
    you can work on your assignment or on the additional problems listed
    there.
  \item
    Get help if needed (instructor/TA available)
  \end{itemize}
\end{itemize}

\end{frame}

\begin{frame}{Course material (C33)}
\protect\hypertarget{course-material-c33}{}

\begin{columns}
  \begin{column}{0.6\textwidth}
    R:
    \begin{itemize}
\item Installation / connection
\item Reading data files (of different sorts)
\item Making graphs
\item Numerical summaries
\item Statistical inference
\item Reports
\item Tidying and organizing data
\item Case studies
\item Functions
\item Dates and times
\item Miscellaneous tasks
\item Bootstrap
\item Bayesian inference with \texttt{rstan}

    \end{itemize}
  \end{column}
  
  \begin{column}{0.4\textwidth}
  SAS:
  \begin{itemize}
  \item Connection 
\item Reading in data
\item Graphics
\item Basic inference
\item ANOVA
\item Regression 
  
  \end{itemize}
  \end{column}
\end{columns}

\end{frame}

\begin{frame}{Laptop use}
\protect\hypertarget{laptop-use}{}

\begin{itemize}
\tightlist
\item
  If you have a laptop, you may find it useful for following along with
  the use of the software or for taking notes.
\item
  Checking social media or other non-course-specific activity during
  class distracts from your learning. If you are going to get the most
  from this course, you need to pay full attention in class.
  Multi-tasking will not help you.
\item
  Using your laptop for non-course activity will also distract those
  around you and creates a worse learning experience for everybody. If
  somebody's inappropriate laptop use is distracting you, let me know. I
  will create laptop-free zones in class if necessary.
\end{itemize}

\end{frame}

\begin{frame}{Assessment}
\protect\hypertarget{assessment}{}

\begin{tabular}{p{3.5in}r}
    \hline
    Item & Weight\\
    \hline
    Assignments (most weeks after first). Can study with classmates, but what you hand in must
    be \textbf{entirely your own work}. Due Thursdays at 11:59pm. & 15\\
    \hline
    Midterm exam, 2 hours, open book (see over) & 30\\
    \hline
    Group data analysis report (1--5 people/group). Data analysis on data set of your choosing,
    using R/SAS/both, report written as described in class.
    Due last
    day of classes at 11:59pm. & 10 \\
    \hline
    Final exam, 3 hours, open book (see over). \textbf{You must pass
    the final exam to guarantee passing the course.} & 45\\
    \hline
    Total & 100\\
    \hline
  \end{tabular}

\end{frame}

\begin{frame}{Open book, defined}
\protect\hypertarget{open-book-defined}{}

``Open book'' means these are permissible, written/printed versions
only:

\begin{itemize}
\tightlist
\item
  the SAS text
\item
  the R text
\item
  my lecture notes
\item
  assignments, yours (graded) and mine (with solutions)
\item
  any other notes that you have made in this course.
\end{itemize}

Old exams are not permitted.

\end{frame}

\begin{frame}{Missed work and documentation}
\protect\hypertarget{missed-work-and-documentation}{}

\begin{itemize}
\tightlist
\item
  No make-up assignments or tests in this course.
\item
  Work handed in late may or may not be accepted (instructor's
  discretion; instructor's decision is final).
\item
  If you miss assessed work due to illness/injury, complete form
  \href{http://www.illnessverification.utoronto.ca/}{\textbf{here}} and
  submit to instructor within 10 working days of due date.
\item
  Weight of missed work with appropriate documentation transferred to
  other assessments of same type.
\end{itemize}

\end{frame}

\begin{frame}{Academic integrity}
\protect\hypertarget{academic-integrity}{}

\begin{itemize}
\tightlist
\item
  Read and understand
  \href{http://www.utoronto.ca/academicintegrity/}{\textbf{this}}.
\item
  Academic dishonesty devalues your degree and those of all other
  students.
\item
  Cheating and plagiarism taken very seriously.
\item
  Examples of academic offences:
\item
  Using someone else's words/ideas without acknowledgement.
\item
  Obtaining or providing unauthorized assistance on an assignment.
\item
  On test/exam, looking at someone else's answers or allowing someone
  else to look at yours.
\item
  Pretending to be someone else.
\item
  Falsifying or altering required documentation (eg. doctor's notes).
\end{itemize}

\end{frame}

\begin{frame}{Penalties}
\protect\hypertarget{penalties}{}

\begin{itemize}
\tightlist
\item
  Penalties include (depending on seriousness of offence) a mark of zero
  for the work concerned, a mark of zero for the entire course, or
  suspension/expulsion from the University.
\item
  Penalties are (much) more severe for those caught a second (or third)
  time.
\item
  ``Students who cheat and are not caught will be haunted by the memory
  of their misdeeds for the rest of their miserable lives.'' (From
  \href{https://philosophy.osu.edu/sites/philosophy.osu.edu/files/1100\%20Brown_2.pdf}{here}.)
\end{itemize}

\end{frame}

\begin{frame}[fragile]{Accessibility statement}
\protect\hypertarget{accessibility-statement}{}

\begin{quote}
Students with diverse learning styles and needs are welcome in this
course. In particular, if you have a disability/health consideration
that may require accommodations, please feel free to approach me and/or
the AccessAbility Services Office as soon as possible. I will work with
you and AccessAbility Services to ensure you can achieve your learning
goals in this course. Enquiries are confiden- tial. The UTSC
AccessAbility Services staff (located in S302) are available by
appointment to assess specific needs, provide referrals and arrange
appropriate accommodations: (416) 287-7560 or by e-mail at
\texttt{ability@utsc.utoronto.ca}.
\end{quote}

\end{frame}

\hypertarget{running-r}{%
\section{Running R}\label{running-r}}

\begin{frame}{Running R online}
\protect\hypertarget{running-r-online}{}

Go to \href{https://rstudio.cloud}{rstudio.cloud}.

\includegraphics{Screenshot_2018-06-29_15-01-16.png}

\begin{itemize}
\tightlist
\item
  Click Get Started (or Sign Up top right).
\end{itemize}

\end{frame}

\begin{frame}{Signing up}
\protect\hypertarget{signing-up}{}

\includegraphics[width=\textwidth,height=2.08333in]{Screenshot_2018-06-29_15-08-57.png}

\begin{itemize}
\tightlist
\item
  Fill out the top 4 boxes and click Sign Up. Or, log in with your
  Google or Github accounts, if you have either of those. (If you have
  GMail, that's a Google account.)
\end{itemize}

\end{frame}

\begin{frame}{Logging in}
\protect\hypertarget{logging-in}{}

\begin{itemize}
\tightlist
\item
  After you have signed up, you will be logged in.
\item
  If you close the rstudio.cloud browser tab and open it up again, you
  will probably get automatically logged in.
\item
  If not, you can click Log In on the opening screen, or click Get
  Started and pretend to sign up again, and you'll get logged in.
\item
  You can explicitly log out, in which case you'll need to log in again.
\item
  Use one of these ways to get back into R Studio Cloud next time.
\end{itemize}

\end{frame}

\begin{frame}{R Studio Cloud}
\protect\hypertarget{r-studio-cloud}{}

\includegraphics[width=\textwidth,height=2.08333in]{Screenshot_2018-06-29_15-24-21.png}

\begin{itemize}
\tightlist
\item
  Each user has a ``workspace'', which is a place where all your work is
  stored.
\item
  Within that workspace, you can have as many Projects as you like.
\item
  To create a new Project, click on the blue New Project button.
\end{itemize}

\end{frame}

\begin{frame}{In a new project}
\protect\hypertarget{in-a-new-project}{}

\begin{itemize}
\tightlist
\item
  R Studio starts a new (untitled) project:
\end{itemize}

\includegraphics[width=\textwidth,height=1.875in]{Screenshot_2018-06-29_15-32-48.png}

\begin{itemize}
\tightlist
\item
  In left-hand Console can type stuff and see output.
\item
  Click on Console, type \texttt{install.packages("tidyverse")} and let
  it do what it will. (This takes a few minutes.)
\end{itemize}

\end{frame}

\begin{frame}{R Notebooks}
\protect\hypertarget{r-notebooks}{}

\begin{itemize}
\tightlist
\item
  At left of previous view is Console, where you can enter R commands
  and see output.
\item
  A better way to work is via ``R Notebooks''. These allow you to
  combine narrative, code and output in one document.
\item
  Data analysis is always a story: not only what you did, but why you
  did it, with the ``why'' being more important.
\item
  To create a new notebook, select File, New File, R Notebook. This
  brings up an example notebook as over.
\item
  The first time, you will probably be asked to ``install some
  packages''. Click Yes to let it do that.
\end{itemize}

\end{frame}

\begin{frame}{The template R Notebook}
\protect\hypertarget{the-template-r-notebook}{}

\includegraphics{Screenshot_2018-06-29_16-40-36.png}

\end{frame}

\begin{frame}[fragile]{About this notebook}
\protect\hypertarget{about-this-notebook}{}

\begin{itemize}
\tightlist
\item
  The notebook begins with a title (that you can change).
\item
  Most of this notebook is text (narrative). The stuff with
  \texttt{*asterisks*} around it will come out in italics in the final
  document.
\item
  Pieces beginning with ```\texttt{\{r\}}, in grey, are called code
  chunks. They contain R code. ````` marks the end of a code chunk.
\item
  Run code chunks by clicking on the green ``play button'' at the top
  right of the chunk. This one makes a scatterplot. If you click the
  play button, the plot is made and placed under the code, as over.
\end{itemize}

\end{frame}

\begin{frame}{After running the code chunk}
\protect\hypertarget{after-running-the-code-chunk}{}

\includegraphics{Screenshot_2018-06-29_16-49-00.png}

\end{frame}

\begin{frame}[fragile]{Making our own notebook}
\protect\hypertarget{making-our-own-notebook}{}

\begin{itemize}
\tightlist
\item
  Create another new notebook. Delete the template text and change the
  title to ``Some random normal data''.
\item
  Type \texttt{\#\#\ Packages} and go down a couple of lines.
\item
  Make a new code chunk by clicking Insert (at the top of the notebook
  window) and selecting R. Inside that chunk, type
  \texttt{library(tidyverse)}.
\item
  Below that, type \texttt{\#\#\ Random\ normal\ data}.
\item
  Make another new code chunk below that, and insert two lines of code:
  \texttt{z=rnorm(100)} and then \texttt{z}.
\item
  Below that, type text \texttt{\#\#\ A\ histogram} and a code chunk
  containing
  \texttt{ggplot(tibble(z),aes(x=z))+geom\_histogram(bins=10)}.
\end{itemize}

\end{frame}

\begin{frame}{My R notebook}
\protect\hypertarget{my-r-notebook}{}

\includegraphics{Screenshot_2018-06-29_17-04-43.png}

\end{frame}

\begin{frame}{Run the chunks}
\protect\hypertarget{run-the-chunks}{}

\begin{itemize}
\tightlist
\item
  Now run each of the three chunks in order. You'll see output below
  each one, including a histogram below the last one.
\item
  When it works, add some narrative text before the code chunks
  explaining what is going to be done, and some text after describing
  what you see.
\item
  Save the notebook (File, Save As). You don't need a file extension.
\item
  Click Preview. This makes an HTML-formatted report. (The first may be
  gibberish: ignore that). Note what happened to the text.
\item
  If you want to edit anything, go back to the R Notebook, change it,
  save it, and run Preview again.
\end{itemize}

\end{frame}

\begin{frame}{The end of my report}
\protect\hypertarget{the-end-of-my-report}{}

\includegraphics{Screenshot_2018-06-29_17-09-23.png}

\end{frame}

\begin{frame}{Installing R on your own computer}
\protect\hypertarget{installing-r-on-your-own-computer}{}

\begin{itemize}
\tightlist
\item
  Free, open-source. Download and run on own computer.
\item
  Two things: R itself (install first) and R Studio (front end).
\item
  Go to \url{https://www.r-project.org/}:
\end{itemize}

\includegraphics{r30.png}

\end{frame}

\begin{frame}{Click on Download}
\protect\hypertarget{click-on-download}{}

\begin{itemize}
\tightlist
\item
  R is stored on numerous ``mirrors'', sites around the world. The top
  one, ``0-Cloud'', picks one for you. Or you can choose one close to
  you (might be faster), eg. U of T:
\end{itemize}

\includegraphics{Screenshot_2018-08-17_11-09-02.png}

\ldots{}

\includegraphics{r39.png}

\end{frame}

\begin{frame}{Click your mirror}
\protect\hypertarget{click-your-mirror}{}

\begin{itemize}
\tightlist
\item
  Click 0-Cloud or U of T (or other mirror), get:
\end{itemize}

\includegraphics{r32.png}

\begin{itemize}
\tightlist
\item
  Click on your operating system, eg. Windows.
\end{itemize}

\end{frame}

\begin{frame}{Click on Base}
\protect\hypertarget{click-on-base}{}

\includegraphics{r33.png}

\begin{itemize}
\tightlist
\item
  Click on ``base'' here.
\end{itemize}

\end{frame}

\begin{frame}[fragile]{The actual download}
\protect\hypertarget{the-actual-download}{}

\begin{itemize}
\tightlist
\item
  Click the top link below:
\end{itemize}

\includegraphics{dlr35.png}

\begin{itemize}
\tightlist
\item
  Then install usual way.
\item
  Or, for Mac, download and install \texttt{R-3-5-1.pkg}.
\item
  Or, for Linux, click your distribution (eg. Ubuntu), then one of the
  cran35 links according to your version, then probably
  \texttt{r-base-core\_3.5.1-1bionic\_amd64.deb}.
\end{itemize}

\end{frame}

\begin{frame}{Now, R Studio}
\protect\hypertarget{now-r-studio}{}

\begin{itemize}
\tightlist
\item
  Go \href{https://www.rstudio.com/}{here}.
\item
  Find this, and click Download:
\end{itemize}

\includegraphics[width=\textwidth,height=2.08333in]{rst1.png}

\end{frame}

\begin{frame}{Scroll down\ldots{}}
\protect\hypertarget{scroll-down}{}

\begin{itemize}
\tightlist
\item
  to this:
\end{itemize}

\includegraphics{rstlic.png}

\begin{itemize}
\tightlist
\item
  Click left-side Download.
\end{itemize}

\end{frame}

\begin{frame}{Find the one for you}
\protect\hypertarget{find-the-one-for-you}{}

\begin{itemize}
\tightlist
\item
  Scroll down, and click the installer for your machine (Windows, Mac,
  several flavours of Linux). Install as usual.
\end{itemize}

\includegraphics{rr40.png}

\end{frame}

\begin{frame}{Running R}
\protect\hypertarget{running-r-1}{}

\begin{itemize}
\tightlist
\item
  All of above only done once.
\item
  To run R, run R Studio, which itself runs R.
\end{itemize}

\end{frame}

\begin{frame}[fragile]{How R Studio looks when you run it}
\protect\hypertarget{how-r-studio-looks-when-you-run-it}{}

\includegraphics[width=\textwidth,height=2.08333in]{rstudio-startup.png}

\begin{itemize}
\tightlist
\item
  First time you run R Studio, click on Console window, and, next to the
  \texttt{\textgreater{}}, type \texttt{install.packages("tidyverse")}.
  Let it do what it needs to.
\end{itemize}

\end{frame}

\begin{frame}{Projects}
\protect\hypertarget{projects}{}

\begin{itemize}
\tightlist
\item
  A project is a ``container'' for code and data that belong together.
\item
  Goes with a folder on some computer.
\item
  File, New Project. You have option to create the new project in a new
  folder, or in a folder that already exists.
\item
  Use a project for a collection of work that belongs together, eg. data
  files and notebooks for assignments. Putting everything in a project
  folder makes it easier to find.
\item
  Example: use a project for (all) assignments, a different notebook
  within that project for each one.
\end{itemize}

\end{frame}

\hypertarget{reading-in-data}{%
\section{Reading in data}\label{reading-in-data}}

\begin{frame}[fragile]{Introduction}
\protect\hypertarget{introduction}{}

\begin{itemize}
\tightlist
\item
  First thing we need to do is to read in data, so that we can use our
  software to analyze.
\item
  Consider these:

  \begin{itemize}
  \tightlist
  \item
    Spreadsheet data saved as \texttt{.csv} file.
  \item
    ``Delimited'' data such as values separated by spaces.
  \item
    Actual Excel spreadsheets.
  \end{itemize}
\end{itemize}

\end{frame}

\begin{frame}[fragile]{Packages for this section}
\protect\hypertarget{packages-for-this-section}{}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{library}\NormalTok{(tidyverse)}
\end{Highlighting}
\end{Shaded}

\end{frame}

\begin{frame}{A spreadsheet}
\protect\hypertarget{a-spreadsheet}{}

\includegraphics{spreadsheet.png}

\end{frame}

\begin{frame}[fragile]{Save as \texttt{.csv}}
\protect\hypertarget{save-as-.csv}{}

\begin{itemize}
\tightlist
\item
  \texttt{.csv} or ``comma-separated values'' is a way of turning
  spreadsheet values into plain text.
\item
  Easy to read into R (or SAS, later)
\item
  but does not preserve formulas. (This is a reason for doing all your
  calculations in your statistical software, and only having data in
  your spreadsheet.)
\item
  File, Save As Text CSV (or similar).
\item
  used name \texttt{test1.csv}.
\end{itemize}

\end{frame}

\begin{frame}[fragile]{The \texttt{.csv} file}
\protect\hypertarget{the-.csv-file}{}

\begin{verbatim}
id,x,y,group
p1,10,21,upper
p2,11,20,lower
p3,13,25,upper
p4,15,27,lower
p5,16,30,upper
p6,17,31,lower
\end{verbatim}

To read this in:

\begin{itemize}
\tightlist
\item
  Fire up rstudio.cloud.
\item
  Upload this .csv file. (Bottom right, next to New Folder, Upload.)
  Click Choose File, find the file, click Open. Click OK. See the file
  appear bottom right.
\end{itemize}

\end{frame}

\begin{frame}[fragile]{Make a new notebook}
\protect\hypertarget{make-a-new-notebook}{}

\begin{itemize}
\tightlist
\item
  \ldots and get rid of the template document (leaving the first four
  lines).
\item
  Make a code chunk and in it put this. Run it.
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{library}\NormalTok{(tidyverse)}
\end{Highlighting}
\end{Shaded}

\end{frame}

\begin{frame}[fragile]{Reading in the file}
\protect\hypertarget{reading-in-the-file}{}

\begin{itemize}
\tightlist
\item
  Use \texttt{read\_csv} with the name of the file, in quotes. Save the
  read-in file in something, here called \texttt{mydata}. Make a new
  code chunk for this:
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{mydata <-}\StringTok{ }\KeywordTok{read_csv}\NormalTok{(}\StringTok{"test1.csv"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Parsed with column specification:
## cols(
##   id = col_character(),
##   x = col_double(),
##   y = col_double(),
##   group = col_character()
## )
\end{verbatim}

\end{frame}

\begin{frame}{More on the above}
\protect\hypertarget{more-on-the-above}{}

\begin{itemize}
\tightlist
\item
  read\_csv guesses what kind of thing is in each column. Here it
  correctly guesses that:
\item
  id and group are text (categorical variables). id is actually
  ``identifier variable'': identifies individuals.
\item
  x and y are ``double'': numbers that might have a decimal point in
  them.
\end{itemize}

\end{frame}

\begin{frame}[fragile]{R Studio on your own computer}
\protect\hypertarget{r-studio-on-your-own-computer}{}

\begin{itemize}
\tightlist
\item
  Put the .csv file in the same folder as your project. Then read it in
  as above like \texttt{read\_csv("test1.csv")}.
\item
  Or, use \texttt{f=file.choose()} which brings up a file selector (as
  if you were going to find a file to load or save it). Find your
  \texttt{.csv} file, the address of which will be saved in \texttt{f},
  and then:
\end{itemize}

\begin{verbatim}
mydata=read_csv(f)
\end{verbatim}

\begin{itemize}
\tightlist
\item
  When you have selected the file, comment out the \texttt{file.choose}
  line by putting a \# on the front of it. That will save you having to
  find the file again by mistake. (Keyboard shortcut: go to the line,
  type control-shift-C or Mac equivalent with Cmd.)
\end{itemize}

\end{frame}

\begin{frame}[fragile]{Looking at what we read in}
\protect\hypertarget{looking-at-what-we-read-in}{}

\begin{itemize}
\tightlist
\item
  Again, type the name of the thing to display it:
\end{itemize}

\scriptsize

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{mydata}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 6 x 4
##   id        x     y group
##   <chr> <dbl> <dbl> <chr>
## 1 p1       10    21 upper
## 2 p2       11    20 lower
## 3 p3       13    25 upper
## 4 p4       15    27 lower
## 5 p5       16    30 upper
## 6 p6       17    31 lower
\end{verbatim}

\normalsize

\begin{itemize}
\tightlist
\item
  This is a ``tibble'' or data frame, the standard way of storing a data
  set in R.
\item
  Tibbles print as much as will display on the screen. If there are more
  rows or columns, it will say so.
\item
  You will see navigation keys to display more rows or columns (if there
  are more).
\end{itemize}

\end{frame}

\begin{frame}[fragile]{\texttt{View}-ing your data frame}
\protect\hypertarget{view-ing-your-data-frame}{}

\begin{itemize}
\tightlist
\item
  Another way to examine your data frame is to View it, like this:
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{View}\NormalTok{(mydata)}
\end{Highlighting}
\end{Shaded}

\ldots or find your data frame in the Global Environment top right and
click it. - This pops up a ``data frame viewer'' top left:

\includegraphics[width=\textwidth,height=1.875in]{viewview.png}

\end{frame}

\begin{frame}{This View}
\protect\hypertarget{this-view}{}

\begin{itemize}
\tightlist
\item
  Read-only: cannot edit data
\item
  Can display data satisfying conditions: click on Filter, then:

  \begin{itemize}
  \tightlist
  \item
    for a categorical variable, type name of category you want
  \item
    for a quantitative variable, use slider to describe values you want.
  \end{itemize}
\item
  Can sort a column into ascending or descending order (click little
  arrows next to column name).
\item
  Clicking the symbol with arrow on it left of Filter ``pops out'' View
  into separate (bigger) window.
\end{itemize}

\end{frame}

\begin{frame}[fragile]{Summarizing what we read in}
\protect\hypertarget{summarizing-what-we-read-in}{}

\begin{itemize}
\tightlist
\item
  It is always a good idea to look at your data after you have read it
  in, to make sure you have believable numbers (and the right number of
  individuals and variables).
\item
  Quick check for errors: these often show up as values too high or too
  low, so the min and/or max will be unreasonable.
\item
  Five-number summary:
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{summary}\NormalTok{(mydata)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##       id                  x               y        
##  Length:6           Min.   :10.00   Min.   :20.00  
##  Class :character   1st Qu.:11.50   1st Qu.:22.00  
##  Mode  :character   Median :14.00   Median :26.00  
##                     Mean   :13.67   Mean   :25.67  
##                     3rd Qu.:15.75   3rd Qu.:29.25  
##                     Max.   :17.00   Max.   :31.00  
##     group          
##  Length:6          
##  Class :character  
##  Mode  :character  
##                    
##                    
## 
\end{verbatim}

\begin{itemize}
\tightlist
\item
  Quantitative, five-number summary plus mean.
\item
  Categorical, how many rows.
\end{itemize}

\end{frame}

\begin{frame}[fragile]{Reading from a URL}
\protect\hypertarget{reading-from-a-url}{}

\begin{itemize}
\tightlist
\item
  Any data file on the Web can be read directly.
\item
  \href{http://www.utsc.utoronto.ca/~butler/c32/global.csv}{Example data
  link:}
\item
  Use URL instead of filename.
\item
  I like to save the URL in a variable first (because URLs tend to be
  long), and then put that variable in the \texttt{read\_} function:
\end{itemize}

\small

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{my_url <-}\StringTok{ "http://www.utsc.utoronto.ca/~butler/c32/global.csv"}
\NormalTok{global <-}\StringTok{ }\KeywordTok{read_csv}\NormalTok{(my_url)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Parsed with column specification:
## cols(
##   warehouse = col_character(),
##   size = col_double(),
##   cost = col_double()
## )
\end{verbatim}

\normalsize

\end{frame}

\begin{frame}[fragile]{The data}
\protect\hypertarget{the-data}{}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{global}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 10 x 3
##    warehouse  size  cost
##    <chr>     <dbl> <dbl>
##  1 A           225 12.0 
##  2 B           350 14.1 
##  3 A           150  8.93
##  4 A           200 11.0 
##  5 A           175 10.0 
##  6 A           180 10.1 
##  7 B           325 13.8 
##  8 B           290 13.3 
##  9 B           400 15   
## 10 A           125  7.97
\end{verbatim}

\end{frame}

\begin{frame}[fragile]{Space-delimited files}
\protect\hypertarget{space-delimited-files}{}

\begin{itemize}
\tightlist
\item
  Another common format for data is a text file with the values
  separated by spaces. Top of some other data:
\end{itemize}

\begin{verbatim}
cup tempdiff            
Starbucks 13            
Starbucks 7        
Starbucks 7        
Starbucks 17.5     
Starbucks 10       
Starbucks 15.5     
Starbucks 6        
Starbucks 6        
SIGG 12            
SIGG 16            
SIGG 9             
SIGG 23            
SIGG 11            
SIGG 20.5          
SIGG 12.5      
SIGG 20.5      
SIGG 24.5      
CUPPS 6    
CUPPS 6    
CUPPS 18.5 
CUPPS 10   
\end{verbatim}

\end{frame}

\begin{frame}[fragile]{Reading the coffee data}
\protect\hypertarget{reading-the-coffee-data}{}

\begin{itemize}
\tightlist
\item
  This file was on my computer so I uploaded it to
  \url{http://rstudio.cloud} first.
\item
  This time, \texttt{read\_delim}, and we also have to say what the
  thing is separating the values:
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{coffee <-}\StringTok{ }\KeywordTok{read_delim}\NormalTok{(}\StringTok{"coffee.txt"}\NormalTok{, }\StringTok{" "}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Parsed with column specification:
## cols(
##   cup = col_character(),
##   tempdiff = col_double()
## )
\end{verbatim}

\begin{itemize}
\tightlist
\item
  Name of the cup, text, and tempdiff, a decimal number.
\end{itemize}

\end{frame}

\begin{frame}[fragile]{Looking at the values (some)}
\protect\hypertarget{looking-at-the-values-some}{}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{coffee}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 32 x 2
##    cup       tempdiff
##    <chr>        <dbl>
##  1 Starbucks     13  
##  2 Starbucks      7  
##  3 Starbucks      7  
##  4 Starbucks     17.5
##  5 Starbucks     10  
##  6 Starbucks     15.5
##  7 Starbucks      6  
##  8 Starbucks      6  
##  9 SIGG          12  
## 10 SIGG          16  
## # … with 22 more rows
\end{verbatim}

These were four brands of travel mug (in cup), and for each, how much
the temperature of the coffee in the mug decreased over 30 minutes.

\end{frame}

\begin{frame}[fragile]{Reading from the Web; the soap data}
\protect\hypertarget{reading-from-the-web-the-soap-data}{}

\begin{itemize}
\tightlist
\item
  Use the URL in place of the filename.
\item
  Save the URL in a variable first:
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{url <-}\StringTok{ "http://www.utsc.utoronto.ca/~butler/c32/soap.txt"}
\NormalTok{soap <-}\StringTok{ }\KeywordTok{read_delim}\NormalTok{(url, }\StringTok{" "}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Parsed with column specification:
## cols(
##   case = col_double(),
##   scrap = col_double(),
##   speed = col_double(),
##   line = col_character()
## )
\end{verbatim}

\end{frame}

\begin{frame}[fragile]{The soap data (some)}
\protect\hypertarget{the-soap-data-some}{}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{soap}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 27 x 4
##     case scrap speed line 
##    <dbl> <dbl> <dbl> <chr>
##  1     1   218   100 a    
##  2     2   248   125 a    
##  3     3   360   220 a    
##  4     4   351   205 a    
##  5     5   470   300 a    
##  6     6   394   255 a    
##  7     7   332   225 a    
##  8     8   321   175 a    
##  9     9   410   270 a    
## 10    10   260   170 a    
## # … with 17 more rows
\end{verbatim}

\end{frame}

\begin{frame}[fragile]{Data aligned in columns}
\protect\hypertarget{data-aligned-in-columns}{}

\begin{itemize}
\tightlist
\item
  Sometimes you see data aligned in columns, thus:
\end{itemize}

\includegraphics[width=\textwidth,height=1.875in]{Screenshot_2019-04-24_20-16-24.png}

\begin{itemize}
\tightlist
\item
  \texttt{read\_delim} will not work: values separated by more than one
  space.
\item
  The number of spaces between values is not constant, because there is
  one fewer space before the 10.
\item
  \texttt{read\_table} works for this.
\end{itemize}

\end{frame}

\begin{frame}[fragile]{Reading in column-aligned data}
\protect\hypertarget{reading-in-column-aligned-data}{}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{drugs <-}\StringTok{ }\KeywordTok{read_table}\NormalTok{(}\StringTok{"migraine.txt"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Parsed with column specification:
## cols(
##   DrugA = col_double(),
##   DrugB = col_double(),
##   DrugC = col_double()
## )
\end{verbatim}

\end{frame}

\begin{frame}[fragile]{The data}
\protect\hypertarget{the-data-1}{}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{drugs}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 9 x 3
##   DrugA DrugB DrugC
##   <dbl> <dbl> <dbl>
## 1     4     6     6
## 2     5     8     7
## 3     4     4     6
## 4     3     5     6
## 5     2     4     7
## 6     4     6     5
## 7     3     5     6
## 8     4    10     5
## 9     4     6     5
\end{verbatim}

\end{frame}

\begin{frame}[fragile]{Reading an Excel sheet directly}
\protect\hypertarget{reading-an-excel-sheet-directly}{}

\begin{itemize}
\tightlist
\item
  Here is my spreadsheet from before, but tarted up a bit:
\end{itemize}

\includegraphics[width=\textwidth,height=1.875in]{excel.png}

\begin{itemize}
\tightlist
\item
  It is now a workbook with a second sheet called ``notes'' (that we
  don't want).
\item
  Install package \texttt{readxl} first.
\end{itemize}

\end{frame}

\begin{frame}[fragile]{Reading it in}
\protect\hypertarget{reading-it-in}{}

\begin{itemize}
\tightlist
\item
  Read into R, saying that we only want the sheet ``data''. Upload
  spreadsheet first.
\item
  Excel spreadsheets must be ``local'': cannot read one in from a URL.
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{library}\NormalTok{(readxl)}
\NormalTok{mydata2 <-}\StringTok{ }\KeywordTok{read_excel}\NormalTok{(}\StringTok{"test2.xlsx"}\NormalTok{, }\DataTypeTok{sheet =} \StringTok{"data"}\NormalTok{)}
\NormalTok{mydata2}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 6 x 4
##   id        x     y group
##   <chr> <dbl> <dbl> <chr>
## 1 p1       10    21 upper
## 2 p2       11    20 lower
## 3 p3       13    25 upper
## 4 p4       15    27 lower
## 5 p5       16    30 upper
## 6 p6       17    31 lower
\end{verbatim}

\end{frame}

\hypertarget{making-graphs}{%
\section{Making graphs}\label{making-graphs}}

\begin{frame}{Our data}
\protect\hypertarget{our-data}{}

\begin{itemize}
\tightlist
\item
  To illustrate making graphs, we need some data.
\item
  Data on 202 male and female athletes at the Australian Institute of
  Sport.
\item
  Variables:

  \begin{itemize}
  \tightlist
  \item
    categorical: Sex of athlete, sport they play
  \item
    quantitative: height (cm), weight (kg), lean body mass, red and
    white blood cell counts, haematocrit and haemoglobin (blood),
    ferritin concentration, body mass index, percent body fat.
  \end{itemize}
\item
  Values separated by tabs (which impacts reading in).
\end{itemize}

\end{frame}

\begin{frame}[fragile]{Packages for this section}
\protect\hypertarget{packages-for-this-section-1}{}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{library}\NormalTok{(tidyverse)}
\end{Highlighting}
\end{Shaded}

\end{frame}

\begin{frame}[fragile]{Reading data into R}
\protect\hypertarget{reading-data-into-r}{}

\begin{itemize}
\tightlist
\item
  Use \texttt{read\_tsv} (``tab-separated values''), like
  \texttt{read\_csv}.
\item
  Data in \texttt{ais.txt}:
\end{itemize}

\scriptsize

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{my_url <-}\StringTok{ "http://www.utsc.utoronto.ca/~butler/c32/ais.txt"}
\NormalTok{athletes <-}\StringTok{ }\KeywordTok{read_tsv}\NormalTok{(my_url)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Parsed with column specification:
## cols(
##   Sex = col_character(),
##   Sport = col_character(),
##   RCC = col_double(),
##   WCC = col_double(),
##   Hc = col_double(),
##   Hg = col_double(),
##   Ferr = col_double(),
##   BMI = col_double(),
##   SSF = col_double(),
##   `%Bfat` = col_double(),
##   LBM = col_double(),
##   Ht = col_double(),
##   Wt = col_double()
## )
\end{verbatim}

\normalsize

\end{frame}

\begin{frame}[fragile]{The data (some)}
\protect\hypertarget{the-data-some}{}

\footnotesize

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{athletes}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 202 x 13
##    Sex    Sport    RCC   WCC    Hc    Hg  Ferr   BMI
##    <chr>  <chr>  <dbl> <dbl> <dbl> <dbl> <dbl> <dbl>
##  1 female Netba…  4.56  13.3  42.2  13.6    20  19.2
##  2 female Netba…  4.15   6    38    12.7    59  21.2
##  3 female Netba…  4.16   7.6  37.5  12.3    22  21.4
##  4 female Netba…  4.32   6.4  37.7  12.3    30  21.0
##  5 female Netba…  4.06   5.8  38.7  12.8    78  21.8
##  6 female Netba…  4.12   6.1  36.6  11.8    21  21.4
##  7 female Netba…  4.17   5    37.4  12.7   109  21.5
##  8 female Netba…  3.8    6.6  36.5  12.4   102  24.4
##  9 female Netba…  3.96   5.5  36.3  12.4    71  22.6
## 10 female Netba…  4.44   9.7  41.4  14.1    64  22.8
## # … with 192 more rows, and 5 more variables:
## #   SSF <dbl>, `%Bfat` <dbl>, LBM <dbl>, Ht <dbl>,
## #   Wt <dbl>
\end{verbatim}

\normalsize

\end{frame}

\begin{frame}[fragile]{Types of graph}
\protect\hypertarget{types-of-graph}{}

Depends on number and type of variables:

\begin{tabular}{ccp{0.5\textwidth}}
    Categorical & Quantitative & Graph\\
    \hline
    1 & 0 & bar chart\\
    0 & 1 & histogram\\
    2 & 0 & grouped bar charts\\
    1 & 1 & side-by-side boxplots\\
    0 & 2 & scatterplot\\
    2 & 1 & grouped boxplots\\
    1 & 2 & scatterplot with points identified by group (eg.\ by colour)\\
    \hline
  \end{tabular}

With more variables, might want \emph{separate plots by groups}. This is
called \texttt{facetting} in R.

\end{frame}

\begin{frame}{\texttt{ggplot}}
\protect\hypertarget{ggplot}{}

\begin{itemize}
\tightlist
\item
  R has a standard graphing procedure ggplot, that we use for all our
  graphs.
\item
  Use in different ways to get precise graph we want.
\item
  Let's start with bar chart of the sports played by the athletes.
\end{itemize}

\end{frame}

\begin{frame}[fragile]{Bar chart}
\protect\hypertarget{bar-chart}{}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{ggplot}\NormalTok{(athletes, }\KeywordTok{aes}\NormalTok{(}\DataTypeTok{x =}\NormalTok{ Sport)) }\OperatorTok{+}\StringTok{ }\KeywordTok{geom_bar}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{figure}
\centering
\includegraphics{figure/unnamed-chunk-38-1.pdf}
\caption{plot of chunk unnamed-chunk-38}
\end{figure}

\end{frame}

\begin{frame}[fragile]{Histogram of body mass index}
\protect\hypertarget{histogram-of-body-mass-index}{}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{ggplot}\NormalTok{(athletes, }\KeywordTok{aes}\NormalTok{(}\DataTypeTok{x =}\NormalTok{ BMI)) }\OperatorTok{+}\StringTok{ }\KeywordTok{geom_histogram}\NormalTok{(}\DataTypeTok{bins =} \DecValTok{10}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{figure}
\centering
\includegraphics{figure/unnamed-chunk-39-1.pdf}
\caption{plot of chunk unnamed-chunk-39}
\end{figure}

\end{frame}

\begin{frame}[fragile]{Which sports are played by males and females?}
\protect\hypertarget{which-sports-are-played-by-males-and-females}{}

Grouped bar chart:

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{ggplot}\NormalTok{(athletes, }\KeywordTok{aes}\NormalTok{(}\DataTypeTok{x =}\NormalTok{ Sport, }\DataTypeTok{fill =}\NormalTok{ Sex)) }\OperatorTok{+}
\StringTok{  }\KeywordTok{geom_bar}\NormalTok{(}\DataTypeTok{position =} \StringTok{"dodge"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{figure}
\centering
\includegraphics{figure/unnamed-chunk-40-1.pdf}
\caption{plot of chunk unnamed-chunk-40}
\end{figure}

\end{frame}

\begin{frame}[fragile]{BMI by gender}
\protect\hypertarget{bmi-by-gender}{}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{ggplot}\NormalTok{(athletes, }\KeywordTok{aes}\NormalTok{(}\DataTypeTok{x =}\NormalTok{ Sex, }\DataTypeTok{y =}\NormalTok{ BMI)) }\OperatorTok{+}\StringTok{ }\KeywordTok{geom_boxplot}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{figure}
\centering
\includegraphics{figure/unnamed-chunk-41-1.pdf}
\caption{plot of chunk unnamed-chunk-41}
\end{figure}

\end{frame}

\begin{frame}[fragile]{Height vs.~weight}
\protect\hypertarget{height-vs.-weight}{}

Scatterplot:

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{ggplot}\NormalTok{(athletes, }\KeywordTok{aes}\NormalTok{(}\DataTypeTok{x =}\NormalTok{ Ht, }\DataTypeTok{y =}\NormalTok{ Wt)) }\OperatorTok{+}\StringTok{ }\KeywordTok{geom_point}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{figure}
\centering
\includegraphics{figure/unnamed-chunk-42-1.pdf}
\caption{plot of chunk unnamed-chunk-42}
\end{figure}

\end{frame}

\begin{frame}[fragile]{With regression line}
\protect\hypertarget{with-regression-line}{}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{ggplot}\NormalTok{(athletes, }\KeywordTok{aes}\NormalTok{(}\DataTypeTok{x =}\NormalTok{ Ht, }\DataTypeTok{y =}\NormalTok{ Wt)) }\OperatorTok{+}
\StringTok{  }\KeywordTok{geom_point}\NormalTok{() }\OperatorTok{+}\StringTok{ }\KeywordTok{geom_smooth}\NormalTok{(}\DataTypeTok{method =} \StringTok{"lm"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{figure}
\centering
\includegraphics{figure/unnamed-chunk-43-1.pdf}
\caption{plot of chunk unnamed-chunk-43}
\end{figure}

\end{frame}

\begin{frame}[fragile]{BMI by sport and gender}
\protect\hypertarget{bmi-by-sport-and-gender}{}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{ggplot}\NormalTok{(athletes, }\KeywordTok{aes}\NormalTok{(}\DataTypeTok{x =}\NormalTok{ Sport, }\DataTypeTok{y =}\NormalTok{ BMI, }\DataTypeTok{colour =}\NormalTok{ Sex)) }\OperatorTok{+}
\StringTok{  }\KeywordTok{geom_boxplot}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{figure}
\centering
\includegraphics{figure/unnamed-chunk-44-1.pdf}
\caption{plot of chunk unnamed-chunk-44}
\end{figure}

\end{frame}

\begin{frame}[fragile]{Height and weight by gender}
\protect\hypertarget{height-and-weight-by-gender}{}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{ggplot}\NormalTok{(athletes, }\KeywordTok{aes}\NormalTok{(}\DataTypeTok{x =}\NormalTok{ Ht, }\DataTypeTok{y =}\NormalTok{ Wt, }\DataTypeTok{colour =}\NormalTok{ Sex)) }\OperatorTok{+}
\StringTok{  }\KeywordTok{geom_point}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{figure}
\centering
\includegraphics{figure/unnamed-chunk-45-1.pdf}
\caption{plot of chunk unnamed-chunk-45}
\end{figure}

\end{frame}

\begin{frame}[fragile]{Height by weight for each sport, with facets}
\protect\hypertarget{height-by-weight-for-each-sport-with-facets}{}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{ggplot}\NormalTok{(athletes, }\KeywordTok{aes}\NormalTok{(}\DataTypeTok{x =}\NormalTok{ Ht, }\DataTypeTok{y =}\NormalTok{ Wt, }\DataTypeTok{colour =}\NormalTok{ Sex)) }\OperatorTok{+}
\StringTok{  }\KeywordTok{geom_point}\NormalTok{() }\OperatorTok{+}\StringTok{ }\KeywordTok{facet_wrap}\NormalTok{(}\OperatorTok{~}\NormalTok{Sport)}
\end{Highlighting}
\end{Shaded}

\begin{figure}
\centering
\includegraphics{figure/unnamed-chunk-46-1.pdf}
\caption{plot of chunk unnamed-chunk-46}
\end{figure}

\end{frame}

\begin{frame}[fragile]{Filling each facet}
\protect\hypertarget{filling-each-facet}{}

Default uses same scale for each facet. To use different scales for each
facet, this:

\small

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{ggplot}\NormalTok{(athletes, }\KeywordTok{aes}\NormalTok{(}\DataTypeTok{x =}\NormalTok{ Ht, }\DataTypeTok{y =}\NormalTok{ Wt, }\DataTypeTok{colour =}\NormalTok{ Sex)) }\OperatorTok{+}
\StringTok{  }\KeywordTok{geom_point}\NormalTok{() }\OperatorTok{+}\StringTok{ }\KeywordTok{facet_wrap}\NormalTok{(}\OperatorTok{~}\NormalTok{Sport, }\DataTypeTok{scales =} \StringTok{"free"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\includegraphics{figure/unnamed-chunk-47-1.pdf} \normalsize

\end{frame}

\hypertarget{numerical-summaries-more-detailed}{%
\section{Numerical summaries: more
detailed}\label{numerical-summaries-more-detailed}}

\begin{frame}[fragile]{Summarizing data in R}
\protect\hypertarget{summarizing-data-in-r}{}

\begin{itemize}
\tightlist
\item
  Have seen \texttt{summary} (5-number summary of each column). But what
  if we want:

  \begin{itemize}
  \tightlist
  \item
    a summary or two of just one column
  \item
    a count of observations in each category of a categorical variable
  \item
    summaries by group
  \item
    a different summary of all columns (eg. SD)
  \end{itemize}
\item
  To do this, meet pipe operator \texttt{\%\textgreater{}\%}. This takes
  input data frame, does something to it, and outputs result. (Learn:
  \texttt{Ctrl-Shift-M}.)
\item
  Output from a pipe can be used as input to something else, so can have
  a sequence of pipes.
\item
  Summaries include: mean, median, min, max, sd, IQR, quantile (for
  obtaining quartiles or any percentile), n (for counting observations).
\item
  Use our Australian athletes data again.
\end{itemize}

\end{frame}

\begin{frame}[fragile]{Packages for this section}
\protect\hypertarget{packages-for-this-section-2}{}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{library}\NormalTok{(tidyverse)}
\end{Highlighting}
\end{Shaded}

\end{frame}

\begin{frame}[fragile]{Summarizing one column}
\protect\hypertarget{summarizing-one-column}{}

\begin{itemize}
\tightlist
\item
  Mean height:
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{athletes }\OperatorTok{%>%}\StringTok{ }\KeywordTok{summarize}\NormalTok{(}\DataTypeTok{m=}\KeywordTok{mean}\NormalTok{(Ht))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 1 x 1
##       m
##   <dbl>
## 1  180.
\end{verbatim}

or to get mean and SD of BMI:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{athletes }\OperatorTok{%>%}\StringTok{ }\KeywordTok{summarize}\NormalTok{(}\DataTypeTok{m=}\KeywordTok{mean}\NormalTok{(BMI),}\DataTypeTok{s=}\KeywordTok{sd}\NormalTok{(BMI))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 1 x 2
##       m     s
##   <dbl> <dbl>
## 1  23.0  2.86
\end{verbatim}

\end{frame}

\begin{frame}[fragile]{Quartiles}
\protect\hypertarget{quartiles}{}

\begin{itemize}
\tightlist
\item
  \texttt{quantile} calculates percentiles (``fractiles''), so we want
  the 25th and 75th percentiles:
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{athletes }\OperatorTok{%>%}\StringTok{ }\KeywordTok{summarize}\NormalTok{( }\DataTypeTok{Q1=}\KeywordTok{quantile}\NormalTok{(Wt, }\FloatTok{0.25}\NormalTok{),}
                        \DataTypeTok{Q3=}\KeywordTok{quantile}\NormalTok{(Wt, }\FloatTok{0.75}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 1 x 2
##      Q1    Q3
##   <dbl> <dbl>
## 1  66.5  84.1
\end{verbatim}

\end{frame}

\begin{frame}[fragile]{Creating new columns}
\protect\hypertarget{creating-new-columns}{}

\begin{itemize}
\tightlist
\item
  These weights are in kilograms. Maybe we want to summarize the weights
  in pounds.
\item
  Convert kg to lb by multiplying by 2.2.
\item
  Create new column and summarize that:
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{athletes }\OperatorTok{%>%}\StringTok{ }\KeywordTok{mutate}\NormalTok{(}\DataTypeTok{wt_lb=}\NormalTok{Wt}\OperatorTok{*}\FloatTok{2.2}\NormalTok{) }\OperatorTok{%>%}
\StringTok{  }\KeywordTok{summarize}\NormalTok{(}\DataTypeTok{Q1_lb=}\KeywordTok{quantile}\NormalTok{(wt_lb, }\FloatTok{0.25}\NormalTok{),}
            \DataTypeTok{Q3_lb=}\KeywordTok{quantile}\NormalTok{(wt_lb, }\FloatTok{0.75}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 1 x 2
##   Q1_lb Q3_lb
##   <dbl> <dbl>
## 1  146.  185.
\end{verbatim}

\end{frame}

\begin{frame}[fragile]{Counting how many}
\protect\hypertarget{counting-how-many}{}

for example, number of athletes in each sport:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{athletes }\OperatorTok{%>%}\StringTok{ }\KeywordTok{count}\NormalTok{(Sport)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 10 x 2
##    Sport       n
##    <chr>   <int>
##  1 BBall      25
##  2 Field      19
##  3 Gym         4
##  4 Netball    23
##  5 Row        37
##  6 Swim       22
##  7 T400m      29
##  8 Tennis     11
##  9 TSprnt     15
## 10 WPolo      17
\end{verbatim}

\end{frame}

\begin{frame}[fragile]{Counting how many, variation 2:}
\protect\hypertarget{counting-how-many-variation-2}{}

Another way (which will make sense in a moment):

\small

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{athletes }\OperatorTok{%>%}\StringTok{ }\KeywordTok{group_by}\NormalTok{(Sport) }\OperatorTok{%>%}
\StringTok{  }\KeywordTok{summarize}\NormalTok{(}\DataTypeTok{count=}\KeywordTok{n}\NormalTok{())}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 10 x 2
##    Sport   count
##    <chr>   <int>
##  1 BBall      25
##  2 Field      19
##  3 Gym         4
##  4 Netball    23
##  5 Row        37
##  6 Swim       22
##  7 T400m      29
##  8 Tennis     11
##  9 TSprnt     15
## 10 WPolo      17
\end{verbatim}

\normalsize

\end{frame}

\begin{frame}[fragile]{Summaries by group}
\protect\hypertarget{summaries-by-group}{}

\begin{itemize}
\tightlist
\item
  Might want separate summaries for each ``group'', eg. mean and SD of
  height for males and females. Strategy is \texttt{group\_by} (to
  define the groups) and then \texttt{summarize}:
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{athletes }\OperatorTok{%>%}\StringTok{ }\KeywordTok{group_by}\NormalTok{(Sex) }\OperatorTok{%>%}\StringTok{ }
\StringTok{  }\KeywordTok{summarize}\NormalTok{(}\DataTypeTok{m=}\KeywordTok{mean}\NormalTok{(Ht), }\DataTypeTok{s=}\KeywordTok{sd}\NormalTok{(Ht))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 2 x 3
##   Sex        m     s
##   <chr>  <dbl> <dbl>
## 1 female  175.  8.24
## 2 male    186.  7.90
\end{verbatim}

\begin{itemize}
\tightlist
\item
  This explains second variation on counting within group: ``within each
  sport, how many athletes were there?''
\end{itemize}

\end{frame}

\begin{frame}[fragile]{Summarizing several columns}
\protect\hypertarget{summarizing-several-columns}{}

\begin{itemize}
\tightlist
\item
  Standard deviation of each (numeric) column:
\end{itemize}

\small

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{athletes }\OperatorTok{%>%}\StringTok{ }\KeywordTok{summarize_if}\NormalTok{(is.numeric, sd)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 1 x 11
##     RCC   WCC    Hc    Hg  Ferr   BMI   SSF `%Bfat`
##   <dbl> <dbl> <dbl> <dbl> <dbl> <dbl> <dbl>   <dbl>
## 1 0.458  1.80  3.66  1.36  47.5  2.86  32.6    6.19
## # … with 3 more variables: LBM <dbl>, Ht <dbl>,
## #   Wt <dbl>
\end{verbatim}

\normalsize

\begin{itemize}
\tightlist
\item
  Median and IQR of all columns whose name starts with H:
\end{itemize}

\small

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{athletes }\OperatorTok{%>%}\StringTok{ }\KeywordTok{summarize_at}\NormalTok{(}\KeywordTok{vars}\NormalTok{(}\KeywordTok{starts_with}\NormalTok{(}\StringTok{"H"}\NormalTok{)),}
                          \KeywordTok{list}\NormalTok{(}\DataTypeTok{med=}\NormalTok{median, }\DataTypeTok{iqr=}\NormalTok{IQR))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 1 x 6
##   Hc_med Hg_med Ht_med Hc_iqr Hg_iqr Ht_iqr
##    <dbl>  <dbl>  <dbl>  <dbl>  <dbl>  <dbl>
## 1   43.5   14.7   180.   4.98   2.07   12.2
\end{verbatim}

\normalsize

\end{frame}

\hypertarget{statistical-inference}{%
\section{Statistical Inference}\label{statistical-inference}}

\begin{frame}{Statistical Inference and Science}
\protect\hypertarget{statistical-inference-and-science}{}

\begin{itemize}
\tightlist
\item
  Previously: descriptive statistics. ``Here are data; what do they
  say?''.
\item
  May need to take some action based on information in data.
\item
  Or want to generalize beyond data (sample) to larger world
  (population).
\item
  Science: first guess about how world works.
\item
  Then collect data, by sampling.
\item
  Is guess correct (based on data) for whole world, or not?
\end{itemize}

\end{frame}

\begin{frame}{Sample data are imperfect}
\protect\hypertarget{sample-data-are-imperfect}{}

\begin{itemize}
\tightlist
\item
  Sample data never entirely represent what you're observing.
\item
  There is always random error present.
\item
  Thus you can never be entirely certain about your conclusions.
\item
  The Toronto Blue Jays' average home attendance in part of 2015 season
  was 25,070 (up to May 27 2015, from baseball-reference.com).
\item
  Does that mean the attendance at every game was exactly 25,070?
  Certainly not. Actual attendance depends on many things, eg.:

  \begin{itemize}
  \tightlist
  \item
    how well the Jays are playing
  \item
    the opposition
  \item
    day of week
  \item
    weather
  \item
    random chance
  \end{itemize}
\end{itemize}

\end{frame}

\begin{frame}[fragile]{Packages for this section}
\protect\hypertarget{packages-for-this-section-3}{}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{library}\NormalTok{(tidyverse)}
\KeywordTok{library}\NormalTok{(smmr)}
\KeywordTok{library}\NormalTok{(PMCMRplus)}
\end{Highlighting}
\end{Shaded}

\end{frame}

\begin{frame}[fragile]{Reading the attendances}
\protect\hypertarget{reading-the-attendances}{}

\ldots as a \texttt{.csv} file:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{jays =}\StringTok{ }\KeywordTok{read_csv}\NormalTok{(}\StringTok{"jays15-home.csv"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Parsed with column specification:
## cols(
##   .default = col_character(),
##   row = col_double(),
##   game = col_double(),
##   venue = col_logical(),
##   runs = col_double(),
##   Oppruns = col_double(),
##   innings = col_double(),
##   position = col_double(),
##   `game time` = col_time(format = ""),
##   attendance = col_double()
## )
\end{verbatim}

\begin{verbatim}
## See spec(...) for full column specifications.
\end{verbatim}

\end{frame}

\begin{frame}[fragile]{Taking a look}
\protect\hypertarget{taking-a-look}{}

\scriptsize

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{jays}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 25 x 21
##      row  game date   box   team  venue opp   result
##    <dbl> <dbl> <chr>  <chr> <chr> <lgl> <chr> <chr> 
##  1    82     7 Monda… boxs… TOR   NA    TBR   L     
##  2    83     8 Tuesd… boxs… TOR   NA    TBR   L     
##  3    84     9 Wedne… boxs… TOR   NA    TBR   W     
##  4    85    10 Thurs… boxs… TOR   NA    TBR   L     
##  5    86    11 Frida… boxs… TOR   NA    ATL   L     
##  6    87    12 Satur… boxs… TOR   NA    ATL   W-wo  
##  7    88    13 Sunda… boxs… TOR   NA    ATL   L     
##  8    89    14 Tuesd… boxs… TOR   NA    BAL   W     
##  9    90    15 Wedne… boxs… TOR   NA    BAL   W     
## 10    91    16 Thurs… boxs… TOR   NA    BAL   W     
## # … with 15 more rows, and 13 more variables:
## #   runs <dbl>, Oppruns <dbl>, innings <dbl>,
## #   wl <chr>, position <dbl>, gb <chr>,
## #   winner <chr>, loser <chr>, save <chr>, `game
## #   time` <time>, Daynight <chr>, attendance <dbl>,
## #   streak <chr>
\end{verbatim}

\normalsize

\end{frame}

\begin{frame}[fragile]{Another way}
\protect\hypertarget{another-way}{}

\tiny

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{glimpse}\NormalTok{(jays)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Observations: 25
## Variables: 21
## $ row         <dbl> 82, 83, 84, 85, 86, 87, 88, 8…
## $ game        <dbl> 7, 8, 9, 10, 11, 12, 13, 14, …
## $ date        <chr> "Monday, Apr 13", "Tuesday, A…
## $ box         <chr> "boxscore", "boxscore", "boxs…
## $ team        <chr> "TOR", "TOR", "TOR", "TOR", "…
## $ venue       <lgl> NA, NA, NA, NA, NA, NA, NA, N…
## $ opp         <chr> "TBR", "TBR", "TBR", "TBR", "…
## $ result      <chr> "L", "L", "W", "L", "L", "W-w…
## $ runs        <dbl> 1, 2, 12, 2, 7, 6, 2, 13, 4, …
## $ Oppruns     <dbl> 2, 3, 7, 4, 8, 5, 5, 6, 2, 6,…
## $ innings     <dbl> NA, NA, NA, NA, NA, 10, NA, N…
## $ wl          <chr> "4-3", "4-4", "5-4", "5-5", "…
## $ position    <dbl> 2, 3, 2, 4, 4, 3, 4, 2, 2, 1,…
## $ gb          <chr> "1", "2", "1", "1.5", "2.5", …
## $ winner      <chr> "Odorizzi", "Geltz", "Buehrle…
## $ loser       <chr> "Dickey", "Castro", "Ramirez"…
## $ save        <chr> "Boxberger", "Jepsen", NA, "B…
## $ `game time` <time> 02:30:00, 03:06:00, 03:02:00…
## $ Daynight    <chr> "N", "N", "N", "N", "N", "D",…
## $ attendance  <dbl> 48414, 17264, 15086, 14433, 2…
## $ streak      <chr> "-", "--", "+", "-", "--", "+…
\end{verbatim}

\normalsize

\end{frame}

\begin{frame}[fragile]{Attendance histogram}
\protect\hypertarget{attendance-histogram}{}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{ggplot}\NormalTok{(jays, }\KeywordTok{aes}\NormalTok{(}\DataTypeTok{x =}\NormalTok{ attendance)) }\OperatorTok{+}\StringTok{ }\KeywordTok{geom_histogram}\NormalTok{(}\DataTypeTok{bins =} \DecValTok{10}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{figure}
\centering
\includegraphics{figure/unnamed-chunk-63-1.pdf}
\caption{plot of chunk unnamed-chunk-63}
\end{figure}

\end{frame}

\begin{frame}{Comments}
\protect\hypertarget{comments}{}

\begin{itemize}
\tightlist
\item
  Attendances have substantial variability, ranging from just over
  10,000 to around 50,000.
\item
  Distribution somewhat skewed to right (but no outliers).
\item
  These are a sample of ``all possible games'' (or maybe ``all possible
  games played in April and May''). What can we say about mean
  attendance in all possible games based on this evidence?
\item
  Think about:

  \begin{itemize}
  \tightlist
  \item
    Confidence interval
  \item
    Hypothesis test.
  \end{itemize}
\end{itemize}

\end{frame}

\begin{frame}[fragile]{Getting CI for mean attendance}
\protect\hypertarget{getting-ci-for-mean-attendance}{}

\begin{itemize}
\tightlist
\item
  \texttt{t.test} function does CI and test. Look at CI first:
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{t.test}\NormalTok{(jays}\OperatorTok{$}\NormalTok{attendance)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## 
##  One Sample t-test
## 
## data:  jays$attendance
## t = 11.389, df = 24, p-value = 3.661e-11
## alternative hypothesis: true mean is not equal to 0
## 95 percent confidence interval:
##  20526.82 29613.50
## sample estimates:
## mean of x 
##  25070.16
\end{verbatim}

\begin{itemize}
\tightlist
\item
  From 20,500 to 29,600.
\end{itemize}

\end{frame}

\begin{frame}[fragile]{Or, 90\% CI}
\protect\hypertarget{or-90-ci}{}

\begin{itemize}
\tightlist
\item
  by including a value for conf.level:
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{t.test}\NormalTok{(jays}\OperatorTok{$}\NormalTok{attendance, }\DataTypeTok{conf.level =} \FloatTok{0.90}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## 
##  One Sample t-test
## 
## data:  jays$attendance
## t = 11.389, df = 24, p-value = 3.661e-11
## alternative hypothesis: true mean is not equal to 0
## 90 percent confidence interval:
##  21303.93 28836.39
## sample estimates:
## mean of x 
##  25070.16
\end{verbatim}

\begin{itemize}
\tightlist
\item
  From 21,300 to 28,800. (Shorter, as it should be.)
\end{itemize}

\end{frame}

\begin{frame}[fragile]{Comments}
\protect\hypertarget{comments-1}{}

\begin{itemize}
\tightlist
\item
  Need to say ``column attendance within data frame \texttt{jays}''
  using \$.
\item
  95\% CI from about 20,000 to about 30,000.
\item
  Not estimating mean attendance well at all!
\item
  Generally want confidence interval to be shorter, which happens if:

  \begin{itemize}
  \tightlist
  \item
    SD smaller
  \item
    sample size bigger
  \item
    confidence level smaller
  \end{itemize}
\item
  Last one is a cheat, really, since reducing confidence level increases
  chance that interval won't contain pop. mean at all!
\end{itemize}

\end{frame}

\begin{frame}[fragile]{Another way to access data frame columns}
\protect\hypertarget{another-way-to-access-data-frame-columns}{}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{with}\NormalTok{(jays, }\KeywordTok{t.test}\NormalTok{(attendance))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## 
##  One Sample t-test
## 
## data:  attendance
## t = 11.389, df = 24, p-value = 3.661e-11
## alternative hypothesis: true mean is not equal to 0
## 95 percent confidence interval:
##  20526.82 29613.50
## sample estimates:
## mean of x 
##  25070.16
\end{verbatim}

\end{frame}

\begin{frame}{Hypothesis test}
\protect\hypertarget{hypothesis-test}{}

\begin{itemize}
\tightlist
\item
  CI answers question ``what is the mean?''
\item
  Might have a value \(\mu\) in mind for the mean, and question ``Is the
  mean equal to \(\mu\), or not?''
\item
  For example, 2014 average attendance was 29,327.
\item
  ``Is the mean this?'' answered by \textbf{hypothesis test}.
\item
  Value being assessed goes in \textbf{null hypothesis}: here,
  \(H_0 : \mu = 29327\).
\item
  \textbf{Alternative hypothesis} says how null might be wrong, eg.
  \(H_a : \mu \ne 29327\).
\item
  Assess evidence against null. If that evidence strong enough,
  \emph{reject null hypothesis;} if not, \emph{fail to reject null
  hypothesis} (sometimes \emph{retain null}).
\item
  Note asymmetry between null and alternative, and utter absence of word
  ``accept''.
\end{itemize}

\end{frame}

\begin{frame}{\(\alpha\) and errors}
\protect\hypertarget{alpha-and-errors}{}

\begin{itemize}
\tightlist
\item
  Hypothesis test ends with decision:

  \begin{itemize}
  \tightlist
  \item
    reject null hypothesis
  \item
    do not reject null hypothesis.
  \end{itemize}
\item
  but decision may be wrong:
\end{itemize}

\begin{center}
  
  
\begin{tabular}{|l|cc|}
\hline
  & \multicolumn{2}{c|}{Decision}\\
Truth & Do not reject & Reject null\\
\hline
Null true & Correct & Type I error\\
Null false & Type II error & Correct\\
\hline
\end{tabular}
\end{center}

\begin{itemize}
\tightlist
\item
  Either type of error is bad, but for now focus on controlling Type I
  error: write \(\alpha\) = P(type I error), and devise test so that
  \(\alpha\) small, typically 0.05.
\item
  That is, \textbf{if null hypothesis true}, have only small chance to
  reject it (which would be a mistake).
\item
  Worry about type II errors later (when we consider power of test).
\end{itemize}

\end{frame}

\begin{frame}{Why 0.05? This man.}
\protect\hypertarget{why-0.05-this-man.}{}

\begin{columns}
  \begin{column}{0.3\textwidth}
      \includegraphics[width=\textwidth]{fisher}
  \end{column}
  \begin{column}{0.7\textwidth}
    Responsible for:
  
  \begin{itemize}
  \item analysis of variance
  \item Fisher information
  \item Linear discriminant analysis
  \item Fisher's $z$-transformation
  \item Fisher-Yates shuffle
  \item Behrens-Fisher problem
  \end{itemize}
  
   Sir Ronald A. Fisher, 1890--1962.

  \end{column}
\end{columns}

\end{frame}

\begin{frame}{Why 0.05? (2)}
\protect\hypertarget{why-0.05-2}{}

\begin{itemize}
\tightlist
\item
  From The Arrangement of Field Experiments (1926):
\end{itemize}

\includegraphics[width=4.16667in,height=\textheight]{fisher1.png}

\begin{itemize}
\tightlist
\item
  and
\end{itemize}

\includegraphics[width=4.16667in,height=\textheight]{fisher2.png}

\end{frame}

\begin{frame}{Three steps:}
\protect\hypertarget{three-steps}{}

\begin{itemize}
\tightlist
\item
  from data to test statistic

  \begin{itemize}
  \tightlist
  \item
    how far are data from null hypothesis
  \end{itemize}
\item
  from test statistic to P-value

  \begin{itemize}
  \tightlist
  \item
    how likely are you to see ``data like this'' \textbf{if the null
    hypothesis is true}
  \end{itemize}
\item
  from P-value to decision

  \begin{itemize}
  \tightlist
  \item
    reject null hypothesis if P-value small enough, fail to reject it
    otherwise
  \end{itemize}
\end{itemize}

\end{frame}

\begin{frame}[fragile]{Using \texttt{t.test}:}
\protect\hypertarget{using-t.test}{}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{t.test}\NormalTok{(jays}\OperatorTok{$}\NormalTok{attendance, }\DataTypeTok{mu=}\DecValTok{29327}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## 
##  One Sample t-test
## 
## data:  jays$attendance
## t = -1.9338, df = 24, p-value = 0.06502
## alternative hypothesis: true mean is not equal to 29327
## 95 percent confidence interval:
##  20526.82 29613.50
## sample estimates:
## mean of x 
##  25070.16
\end{verbatim}

\begin{itemize}
\tightlist
\item
  See test statistic \(-1.93\), P-value 0.065.
\item
  Do not reject null at \(\alpha=0.05\): no evidence that mean
  attendance has changed.
\end{itemize}

\end{frame}

\begin{frame}{Assumptions}
\protect\hypertarget{assumptions}{}

\begin{itemize}
\tightlist
\item
  Theory for \(t\)-test: assumes normally-distributed data.
\item
  What actually matters is sampling distribution of sample mean: if this
  is approximately normal, \(t\)-test is OK, even if data distribution
  is not normal.
\item
  Central limit theorem: if sample size large, sampling distribution
  approx. normal even if data distribution somewhat non-normal.
\item
  So look at shape of data distribution, and make a call about whether
  it is normal enough, given the sample size.
\end{itemize}

\end{frame}

\begin{frame}[fragile]{Blue Jays attendances again:}
\protect\hypertarget{blue-jays-attendances-again}{}

\begin{itemize}
\tightlist
\item
  You might say that this is not normal enough for a sample size of
  \(n = 25\), in which case you don't trust the \(t\)-test result:
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{ggplot}\NormalTok{(jays, }\KeywordTok{aes}\NormalTok{(}\DataTypeTok{x =}\NormalTok{ attendance)) }\OperatorTok{+}\StringTok{ }\KeywordTok{geom_histogram}\NormalTok{(}\DataTypeTok{bins =} \DecValTok{10}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{figure}
\centering
\includegraphics{figure/unnamed-chunk-68-1.pdf}
\caption{plot of chunk unnamed-chunk-68}
\end{figure}

\end{frame}

\begin{frame}{Another example: learning to read}
\protect\hypertarget{another-example-learning-to-read}{}

\begin{itemize}
\tightlist
\item
  You devised new method for teaching children to read.
\item
  Guess it will be more effective than current methods.
\item
  To support this guess, collect data.
\item
  Want to generalize to ``all children in Canada''.
\item
  So take random sample of all children in Canada.
\item
  Or, argue that sample you actually have is ``typical'' of all children
  in Canada.
\item
  Randomization (1): whether or not a child in sample or not has nothing
  to do with anything else about that child.
\item
  Randomization (2): randomly choose whether each child gets new reading
  method (t) or standard one (c).
\end{itemize}

\end{frame}

\begin{frame}[fragile]{Reading in data}
\protect\hypertarget{reading-in-data-1}{}

\begin{itemize}
\tightlist
\item
  File at \url{http://www.utsc.utoronto.ca/~butler/c32/drp.txt}.
\item
  Proper reading-in function is \texttt{read\_delim} (check file to see)
\item
  Read in thus:
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{my_url=}\StringTok{"http://www.utsc.utoronto.ca/~butler/c32/drp.txt"}
\NormalTok{kids=}\KeywordTok{read_delim}\NormalTok{(my_url,}\StringTok{" "}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Parsed with column specification:
## cols(
##   group = col_character(),
##   score = col_double()
## )
\end{verbatim}

\end{frame}

\begin{frame}[fragile]{The data (some)}
\protect\hypertarget{the-data-some-1}{}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{kids}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 44 x 2
##    group score
##    <chr> <dbl>
##  1 t        24
##  2 t        61
##  3 t        59
##  4 t        46
##  5 t        43
##  6 t        44
##  7 t        52
##  8 t        43
##  9 t        58
## 10 t        67
## # … with 34 more rows
\end{verbatim}

\end{frame}

\begin{frame}[fragile]{Boxplots}
\protect\hypertarget{boxplots}{}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{ggplot}\NormalTok{(kids, }\KeywordTok{aes}\NormalTok{(}\DataTypeTok{x =}\NormalTok{ group, }\DataTypeTok{y =}\NormalTok{ score)) }\OperatorTok{+}\StringTok{ }\KeywordTok{geom_boxplot}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{figure}
\centering
\includegraphics{figure/unnamed-chunk-71-1.pdf}
\caption{plot of chunk unnamed-chunk-71}
\end{figure}

\end{frame}

\begin{frame}{Two kinds of two-sample t-test}
\protect\hypertarget{two-kinds-of-two-sample-t-test}{}

\begin{itemize}
\tightlist
\item
  Do the two groups have same spread (SD, variance)?
\item
  If yes (shaky assumption here), can use pooled t-test.
\end{itemize}

\[ t = {\bar{x}_1 - \bar{x}_2 \over s_p \sqrt{ {1\over n_1} + {1 \over n_2}}} \]

\begin{itemize}
\tightlist
\item
  If not, use Welch-Satterthwaite t-test (safe).
\end{itemize}

\[ t = {\bar{x}_1 - \bar{x}_2 \over \sqrt{ {s_1^2 \over n_1} + {s_2^2 \over n_2}}} \]
- Pooled test derived in STAB57 (easier to derive). -
Welch-Satterthwaite is test used in STAB22 and is generally safe. -
Assess (approx) equality of spreads using boxplot.

\end{frame}

\begin{frame}{The (Welch-Satterthwaite) t-test}
\protect\hypertarget{the-welch-satterthwaite-t-test}{}

\begin{itemize}
\tightlist
\item
  c (control) before t (treatment) alphabetically, so proper alternative
  is ``less''.
\item
  R does Welch-Satterthwaite test by default
\item
  new reading program really helps?
\item
  (in a moment) how to get R to do pooled test?
\end{itemize}

\end{frame}

\begin{frame}[fragile]{Welch-Satterthwaite}
\protect\hypertarget{welch-satterthwaite}{}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{t.test}\NormalTok{(score }\OperatorTok{~}\StringTok{ }\NormalTok{group, }\DataTypeTok{data =}\NormalTok{ kids, }\DataTypeTok{alternative =} \StringTok{"less"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## 
##  Welch Two Sample t-test
## 
## data:  score by group
## t = -2.3109, df = 37.855, p-value = 0.01319
## alternative hypothesis: true difference in means is less than 0
## 95 percent confidence interval:
##       -Inf -2.691293
## sample estimates:
## mean in group c mean in group t 
##        41.52174        51.47619
\end{verbatim}

\end{frame}

\begin{frame}[fragile]{The pooled t-test}
\protect\hypertarget{the-pooled-t-test}{}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{t.test}\NormalTok{(score }\OperatorTok{~}\StringTok{ }\NormalTok{group, }\DataTypeTok{data =}\NormalTok{ kids, }
       \DataTypeTok{alternative =} \StringTok{"less"}\NormalTok{, }\DataTypeTok{var.equal =}\NormalTok{ T)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## 
##  Two Sample t-test
## 
## data:  score by group
## t = -2.2666, df = 42, p-value = 0.01431
## alternative hypothesis: true difference in means is less than 0
## 95 percent confidence interval:
##       -Inf -2.567497
## sample estimates:
## mean in group c mean in group t 
##        41.52174        51.47619
\end{verbatim}

\end{frame}

\begin{frame}[fragile]{Two-sided test; CI}
\protect\hypertarget{two-sided-test-ci}{}

\begin{itemize}
\tightlist
\item
  To do 2-sided test, leave out \texttt{alternative}:
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{t.test}\NormalTok{(score }\OperatorTok{~}\StringTok{ }\NormalTok{group, }\DataTypeTok{data =}\NormalTok{ kids)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## 
##  Welch Two Sample t-test
## 
## data:  score by group
## t = -2.3109, df = 37.855, p-value = 0.02638
## alternative hypothesis: true difference in means is not equal to 0
## 95 percent confidence interval:
##  -18.67588  -1.23302
## sample estimates:
## mean in group c mean in group t 
##        41.52174        51.47619
\end{verbatim}

\end{frame}

\begin{frame}{Comments:}
\protect\hypertarget{comments-2}{}

\begin{itemize}
\tightlist
\item
  P-values for pooled and Welch-Satterthwaite tests very similar (even
  though the pooled test seemed inferior): 0.013 vs.~0.014.
\item
  Two-sided test also gives CI: new reading program increases average
  scores by somewhere between about 1 and 19 points.
\item
  Confidence intervals inherently two-sided, so do 2-sided test to get
  them.
\end{itemize}

\end{frame}

\begin{frame}{Jargon for testing}
\protect\hypertarget{jargon-for-testing}{}

\begin{itemize}
\tightlist
\item
  Alternative hypothesis: what we are trying to prove (new reading
  program is effective).
\item
  Null hypothesis: ``there is no difference'' (new reading program no
  better than current program). Must contain ``equals''.
\item
  One-sided alternative: trying to prove better (as with reading
  program).
\item
  Two-sided alternative: trying to prove different.
\item
  Test statistic: something expressing difference between data and null
  (eg. difference in sample means, \(t\) statistic).
\item
  P-value: probability of observing test statistic value as extreme or
  more extreme, if null is true.
\item
  Decision: either reject null hypothesis or do not reject null
  hypothesis. \textbf{Never ``accept''}.
\end{itemize}

\end{frame}

\begin{frame}{Logic of testing}
\protect\hypertarget{logic-of-testing}{}

\begin{itemize}
\tightlist
\item
  Work out what would happen if null hypothesis were true.
\item
  Compare to what actually did happen.
\item
  If these are too far apart, conclude that null hypothesis is not true
  after all. (Be guided by P-value.)
\item
  As applied to our reading programs:

  \begin{itemize}
  \tightlist
  \item
    If reading programs equally good, expect to see a difference in
    means close to 0.
  \item
    Mean reading score was 10 higher for new program.
  \item
    Difference of 10 was unusually big (P-value small from t-test). So
    conclude that new reading program is effective.
  \end{itemize}
\item
  Nothing here about what happens if null hypothesis is false. This is
  power and type II error probability.
\end{itemize}

\end{frame}

\begin{frame}{Errors in testing}
\protect\hypertarget{errors-in-testing}{}

What can happen:

\begin{center}
\begin{tabular}{|l|cc|}
\hline
  & \multicolumn{2}{c|}{Decision}\\
Truth & Do not reject & Reject null\\
\hline
Null true & Correct & Type I error\\
Null false & Type II error & Correct\\
\hline
\end{tabular}  
\end{center}

Tension between truth and decision about truth (imperfect).

\begin{itemize}
\tightlist
\item
  Prob. of type I error denoted \(\alpha\). Usually fix \(\alpha\), eg.
  \(\alpha = 0.05\).
\item
  Prob. of type II error denoted \(\beta\). Determined by the planned
  experiment. Low \(\beta\) good.
\item
  Prob. of not making type II error called \textbf{power} (=
  \(1 - \beta\)). \emph{High} power good.
\end{itemize}

\end{frame}

\begin{frame}{Power}
\protect\hypertarget{power}{}

\begin{itemize}
\tightlist
\item
  Suppose \(H_0 : \theta = 10\), \(H a : \theta \ne 10\) for some
  parameter \(\theta\).
\item
  Suppose \(H_0\) wrong. What does that say about \(\theta\)?
\item
  Not much. Could have \(\theta = 11\) or \(\theta = 8\) or
  \(\theta = 496\). In each case, \(H_0\) wrong.
\item
  How likely a type II error is depends on what \(\theta\) is:

  \begin{itemize}
  \tightlist
  \item
    If \(\theta = 496\), should be able to reject \(H_0 : \theta = 10\)
    even for small sample, so \(\beta\) should be small (power large).
  \item
    If \(\theta = 11\), might have hard time rejecting \(H_0\) even with
    large sample, so \(\beta\) would be larger (power smaller).
  \end{itemize}
\item
  Power depends on true parameter value, and on sample size.
\item
  So we play ``what if'': ``if \(\theta\) were 11 (or 8 or 496), what
  would power be?''.
\end{itemize}

\end{frame}

\begin{frame}{Figuring out power}
\protect\hypertarget{figuring-out-power}{}

\begin{itemize}
\tightlist
\item
  Time to figure out power is before you collect any data, as part of
  planning process.
\item
  Need to have idea of what kind of departure from null hypothesis of
  interest to you, eg. average improvement of 5 points on reading test
  scores. (Subject-matter decision, not statistical one.)
\item
  Then, either:

  \begin{itemize}
  \tightlist
  \item
    ``I have this big a sample and this big a departure I want to
    detect. What is my power for detecting it?''
  \item
    ``I want to detect this big a departure with this much power. How
    big a sample size do I need?''
  \end{itemize}
\end{itemize}

\end{frame}

\begin{frame}{How to understand/estimate power?}
\protect\hypertarget{how-to-understandestimate-power}{}

\begin{itemize}
\tightlist
\item
  Suppose we test \(H_0 : \mu = 10\) against \(H_a : \mu \ne 10\), where
  \(\mu\) is population mean.
\item
  Suppose in actual fact, \(\mu = 8\), so \(H_0\) is wrong. We want to
  reject it. How likely is that to happen?
\item
  Need population SD (take \(\sigma = 4\)) and sample size (take
  \(n = 15\)). In practice, get \(\sigma\) from pilot/previous study,
  and take the \(n\) we plan to use.
\item
  Idea: draw a random sample from the true distribution, test whether
  its mean is 10 or not.
\item
  Repeat previous step ``many'' times.
\item
  ``Simulation''.
\end{itemize}

\end{frame}

\begin{frame}[fragile]{Making it go}
\protect\hypertarget{making-it-go}{}

\begin{itemize}
\tightlist
\item
  Random sample of 15 normal observations with mean 8 and SD 4:
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{x =}\StringTok{ }\KeywordTok{rnorm}\NormalTok{(}\DecValTok{15}\NormalTok{, }\DecValTok{8}\NormalTok{, }\DecValTok{4}\NormalTok{)}
\NormalTok{x}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##  [1] 14.487469  5.014611  6.924277  5.201860
##  [5]  8.852952 10.835874  3.686684 11.165242
##  [9]  8.016188 12.383518  1.378099  3.172503
## [13] 13.074996 11.353573  5.015575
\end{verbatim}

\begin{itemize}
\tightlist
\item
  Test whether \texttt{x} from population with mean 10 or not (over):
\end{itemize}

\end{frame}

\begin{frame}[fragile]{\ldots continued}
\protect\hypertarget{continued}{}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{t.test}\NormalTok{(x, }\DataTypeTok{mu =} \DecValTok{10}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## 
##  One Sample t-test
## 
## data:  x
## t = -1.8767, df = 14, p-value = 0.08157
## alternative hypothesis: true mean is not equal to 10
## 95 percent confidence interval:
##   5.794735 10.280387
## sample estimates:
## mean of x 
##  8.037561
\end{verbatim}

\begin{itemize}
\tightlist
\item
  Fail to reject the mean being 10 (a Type II error).
\end{itemize}

\end{frame}

\begin{frame}[fragile]{or get just P-value}
\protect\hypertarget{or-get-just-p-value}{}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{t.test}\NormalTok{(x, }\DataTypeTok{mu =} \DecValTok{10}\NormalTok{)}\OperatorTok{$}\NormalTok{p.value}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 0.0815652
\end{verbatim}

\end{frame}

\begin{frame}[fragile]{Run this lots of times}
\protect\hypertarget{run-this-lots-of-times}{}

\begin{itemize}
\tightlist
\item
  Two steps:

  \begin{itemize}
  \tightlist
  \item
    Generate a bunch of random samples
  \item
    extract the P-value for the t-test from each
  \end{itemize}
\item
  without a loop!
\item
  Use \texttt{rerun} to generate the random samples
\item
  Use \texttt{map} to run the test on each random sample
\item
  Use \texttt{map\_dbl} to pull out the P-value for each test
\item
  Count up how many of the P-values are 0.05 or less.
\end{itemize}

\end{frame}

\begin{frame}[fragile]{In code}
\protect\hypertarget{in-code}{}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{rerun}\NormalTok{(}\DecValTok{1000}\NormalTok{, }\KeywordTok{rnorm}\NormalTok{(}\DecValTok{15}\NormalTok{, }\DecValTok{8}\NormalTok{, }\DecValTok{4}\NormalTok{)) }\OperatorTok{%>%}
\StringTok{  }\KeywordTok{map}\NormalTok{( }\OperatorTok{~}\StringTok{ }\KeywordTok{t.test}\NormalTok{(., }\DataTypeTok{mu =} \DecValTok{10}\NormalTok{)) }\OperatorTok{%>%}
\StringTok{  }\KeywordTok{map_dbl}\NormalTok{(}\StringTok{"p.value"}\NormalTok{) ->}
\StringTok{  }\NormalTok{pvals}
\KeywordTok{tibble}\NormalTok{(pvals) }\OperatorTok{%>%}\StringTok{ }\KeywordTok{count}\NormalTok{(pvals }\OperatorTok{<=}\StringTok{ }\FloatTok{0.05}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 2 x 2
##   `pvals <= 0.05`     n
##   <lgl>           <int>
## 1 FALSE             578
## 2 TRUE              422
\end{verbatim}

We correctly rejected 422 times out of 1000, so the estimated power is
0.422.

\end{frame}

\begin{frame}[fragile]{Calculating power}
\protect\hypertarget{calculating-power}{}

\begin{itemize}
\tightlist
\item
  Simulation approach very flexible: will work for any test. But answer
  different each time because of randomness.
\item
  In some cases, for example 1-sample and 2-sample t-tests, power can be
  calculated.
\item
  \texttt{power.t.test}. delta difference between null and true mean:
\end{itemize}

\small

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{power.t.test}\NormalTok{(}\DataTypeTok{n =} \DecValTok{15}\NormalTok{, }\DataTypeTok{delta =} \DecValTok{10-8}\NormalTok{, }\DataTypeTok{sd =} \DecValTok{4}\NormalTok{, }\DataTypeTok{type =} \StringTok{"one.sample"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## 
##      One-sample t test power calculation 
## 
##               n = 15
##           delta = 2
##              sd = 4
##       sig.level = 0.05
##           power = 0.4378466
##     alternative = two.sided
\end{verbatim}

\normalsize

\end{frame}

\begin{frame}{Comparison of results}
\protect\hypertarget{comparison-of-results}{}

\begin{center}
  \begin{tabular}{lr}
    Method & Power\\
    \hline
    Simulation & 0.422\\
    \texttt{power.t.test} & 0.4378\\
    \hline
  \end{tabular}
    
  \end{center}

\begin{itemize}
\tightlist
\item
  Simulation power is similar to calculated power; to get more accurate
  value, repeat more times (eg. 10,000 instead of 1,000), which takes
  longer.
\item
  CI for power based on simulation approx. \(0.42 \pm 0.03\).
\item
  With this small a sample size, the power is not great. With a bigger
  sample, the sample mean should be closer to 8 most of the time, so
  would reject \(H_0 : \mu = 10\) more often.
\end{itemize}

\end{frame}

\begin{frame}{Calculating required sample size}
\protect\hypertarget{calculating-required-sample-size}{}

\begin{itemize}
\tightlist
\item
  Often, when planning a study, we do not have a particular sample size
  in mind. Rather, we want to know how big a sample to take. This can be
  done by asking how big a sample is needed to achieve a certain power.
\item
  The simulation approach does not work naturally with this, since you
  have to supply a sample size.
\item
  For the power-calculation method, you supply a value for the power,
  but leave the sample size missing.
\item
  Re-use the same problem: \(H_0 : \mu = 10\) against 2-sided
  alternative, true \(\mu = 8\), \(\sigma = 4\), but now aim for power
  0.80.
\end{itemize}

\end{frame}

\begin{frame}[fragile]{Using power.t.test}
\protect\hypertarget{using-power.t.test}{}

\begin{itemize}
\tightlist
\item
  No \texttt{n=}, replaced by a \texttt{power=}:
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{power.t.test}\NormalTok{(}\DataTypeTok{power=}\FloatTok{0.80}\NormalTok{, }\DataTypeTok{delta=}\DecValTok{10-8}\NormalTok{, }\DataTypeTok{sd=}\DecValTok{4}\NormalTok{, }\DataTypeTok{type=}\StringTok{"one.sample"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## 
##      One-sample t test power calculation 
## 
##               n = 33.3672
##           delta = 2
##              sd = 4
##       sig.level = 0.05
##           power = 0.8
##     alternative = two.sided
\end{verbatim}

\begin{itemize}
\tightlist
\item
  Sample size must be a whole number, so round up to 34 (to get at least
  as much power as you want).
\end{itemize}

\end{frame}

\begin{frame}{Power curves}
\protect\hypertarget{power-curves}{}

\begin{itemize}
\tightlist
\item
  Rather than calculating power for one sample size, or sample size for
  one power, might want a picture of relationship between sample size
  and power.
\item
  Or, likewise, picture of relationship between difference between true
  and null-hypothesis means and power.
\item
  Called power curve.
\item
  Build and plot it yourself.
\end{itemize}

\end{frame}

\begin{frame}[fragile]{Building it}
\protect\hypertarget{building-it}{}

\begin{itemize}
\tightlist
\item
  If you feed power.t.test a collection (``vector'') of values, it will
  do calculation for each one.
\item
  Do power for variety of sample sizes, from 10 to 100 in steps of 10:
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{ns=}\KeywordTok{seq}\NormalTok{(}\DecValTok{10}\NormalTok{,}\DecValTok{100}\NormalTok{,}\DecValTok{10}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{itemize}
\tightlist
\item
  Calculate powers:
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{ans=}\KeywordTok{power.t.test}\NormalTok{(}\DataTypeTok{n=}\NormalTok{ns, }\DataTypeTok{delta=}\DecValTok{10-8}\NormalTok{, }\DataTypeTok{sd=}\DecValTok{4}\NormalTok{, }\DataTypeTok{type=}\StringTok{"one.sample"}\NormalTok{)}
\NormalTok{ans}\OperatorTok{$}\NormalTok{power}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##  [1] 0.2928286 0.5644829 0.7539627 0.8693979
##  [5] 0.9338976 0.9677886 0.9847848 0.9929987
##  [9] 0.9968496 0.9986097
\end{verbatim}

\end{frame}

\begin{frame}[fragile]{Building a plot}
\protect\hypertarget{building-a-plot}{}

\begin{itemize}
\tightlist
\item
  Make a data frame out of the values to plot:
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{d=}\KeywordTok{tibble}\NormalTok{(}\DataTypeTok{n=}\NormalTok{ns, }\DataTypeTok{power=}\NormalTok{ans}\OperatorTok{$}\NormalTok{power)}
\end{Highlighting}
\end{Shaded}

\begin{itemize}
\tightlist
\item
  Plot these as points joined by lines, and add horizontal line at 1
  (maximum power):
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{g =}\StringTok{ }\KeywordTok{ggplot}\NormalTok{(d, }\KeywordTok{aes}\NormalTok{(}\DataTypeTok{x =}\NormalTok{ n, }\DataTypeTok{y =}\NormalTok{ power)) }\OperatorTok{+}\StringTok{ }\KeywordTok{geom_point}\NormalTok{() }\OperatorTok{+}\StringTok{ }
\StringTok{  }\KeywordTok{geom_line}\NormalTok{() }\OperatorTok{+}\StringTok{ }
\StringTok{  }\KeywordTok{geom_hline}\NormalTok{(}\DataTypeTok{yintercept =} \DecValTok{1}\NormalTok{, }\DataTypeTok{linetype =} \StringTok{"dashed"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\end{frame}

\begin{frame}[fragile]{The power curve}
\protect\hypertarget{the-power-curve}{}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{g}
\end{Highlighting}
\end{Shaded}

\begin{figure}
\centering
\includegraphics{figure/unnamed-chunk-86-1.pdf}
\caption{plot of chunk unnamed-chunk-86}
\end{figure}

\end{frame}

\begin{frame}[fragile]{Power curves for means}
\protect\hypertarget{power-curves-for-means}{}

\begin{itemize}
\tightlist
\item
  Can also investigate power as it depends on what the true mean is (the
  farther from null mean 10, the higher the power will be).
\item
  Investigate for two different sample sizes, 15 and 30.
\item
  First make all combos of mean and sample size:
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{means=}\KeywordTok{seq}\NormalTok{(}\DecValTok{6}\NormalTok{,}\DecValTok{10}\NormalTok{,}\FloatTok{0.5}\NormalTok{)}
\NormalTok{means}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1]  6.0  6.5  7.0  7.5  8.0  8.5  9.0  9.5 10.0
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{ns=}\KeywordTok{c}\NormalTok{(}\DecValTok{15}\NormalTok{,}\DecValTok{30}\NormalTok{)}
\NormalTok{ns}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 15 30
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{combos=}\KeywordTok{crossing}\NormalTok{(}\DataTypeTok{mean=}\NormalTok{means, }\DataTypeTok{n=}\NormalTok{ns)}
\end{Highlighting}
\end{Shaded}

\end{frame}

\begin{frame}[fragile]{The combos}
\protect\hypertarget{the-combos}{}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{combos}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 18 x 2
##     mean     n
##    <dbl> <dbl>
##  1   6      15
##  2   6      30
##  3   6.5    15
##  4   6.5    30
##  5   7      15
##  6   7      30
##  7   7.5    15
##  8   7.5    30
##  9   8      15
## 10   8      30
## 11   8.5    15
## 12   8.5    30
## 13   9      15
## 14   9      30
## 15   9.5    15
## 16   9.5    30
## 17  10      15
## 18  10      30
\end{verbatim}

\end{frame}

\begin{frame}[fragile]{Calculate and plot}
\protect\hypertarget{calculate-and-plot}{}

\begin{itemize}
\tightlist
\item
  Calculate the powers, carefully:
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{ans=}\KeywordTok{with}\NormalTok{(combos, }\KeywordTok{power.t.test}\NormalTok{(}\DataTypeTok{n=}\NormalTok{n, }\DataTypeTok{delta=}\NormalTok{mean}\DecValTok{-10}\NormalTok{, }\DataTypeTok{sd=}\DecValTok{4}\NormalTok{, }
                              \DataTypeTok{type=}\StringTok{"one.sample"}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\begin{itemize}
\tightlist
\item
  Make a data frame to plot, pulling things from the right places:
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{d=}\KeywordTok{tibble}\NormalTok{(}\DataTypeTok{n=}\KeywordTok{factor}\NormalTok{(combos}\OperatorTok{$}\NormalTok{n), }\DataTypeTok{mean=}\NormalTok{combos}\OperatorTok{$}\NormalTok{mean, }
         \DataTypeTok{power=}\NormalTok{ans}\OperatorTok{$}\NormalTok{power)}
\end{Highlighting}
\end{Shaded}

\begin{itemize}
\tightlist
\item
  then make the plot:
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{g =}\StringTok{ }\KeywordTok{ggplot}\NormalTok{(d, }\KeywordTok{aes}\NormalTok{(}\DataTypeTok{x =}\NormalTok{ mean, }\DataTypeTok{y =}\NormalTok{ power, }\DataTypeTok{colour =}\NormalTok{ n)) }\OperatorTok{+}
\StringTok{  }\KeywordTok{geom_point}\NormalTok{() }\OperatorTok{+}\StringTok{ }\KeywordTok{geom_line}\NormalTok{() }\OperatorTok{+}
\StringTok{  }\KeywordTok{geom_hline}\NormalTok{(}\DataTypeTok{yintercept =} \DecValTok{1}\NormalTok{, }\DataTypeTok{linetype =} \StringTok{"dashed"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\end{frame}

\begin{frame}[fragile]{The power curves}
\protect\hypertarget{the-power-curves}{}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{g}
\end{Highlighting}
\end{Shaded}

\begin{figure}
\centering
\includegraphics{figure/unnamed-chunk-92-1.pdf}
\caption{plot of chunk unnamed-chunk-92}
\end{figure}

\end{frame}

\begin{frame}[fragile]{Comments}
\protect\hypertarget{comments-3}{}

\begin{itemize}
\tightlist
\item
  When \texttt{mean=10}, that is, the true mean equals the null mean,
  \(H_0\) is actually true, and the probability of rejecting it then is
  \(\alpha = 0.05\).
\item
  As the null gets more wrong (mean decreases), it becomes easier to
  correctly reject it.
\item
  The blue power curve is above the red one for any mean \textless{} 10,
  meaning that no matter how wrong \(H_0\) is, you always have a greater
  chance of correctly rejecting it with a larger sample size.
\item
  Previously, we had \(H_0 : \mu = 10\) and a true \(\mu = 8\), so a
  mean of 8 produces power 0.42 and 0.80 as shown on the graph.
\item
  With \(n = 30\), a true mean that is less than about 7 is almost
  certain to be correctly rejected. (With \(n = 15\), the true mean
  needs to be less than 6.)
\end{itemize}

\end{frame}

\begin{frame}[fragile]{Power by sample size for means 7 and 8}
\protect\hypertarget{power-by-sample-size-for-means-7-and-8}{}

Similar procedure to before:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{means=}\KeywordTok{c}\NormalTok{(}\DecValTok{7}\NormalTok{, }\DecValTok{8}\NormalTok{)}
\NormalTok{ns=}\KeywordTok{seq}\NormalTok{(}\DecValTok{10}\NormalTok{, }\DecValTok{40}\NormalTok{, }\DecValTok{5}\NormalTok{)}
\NormalTok{combos=}\KeywordTok{crossing}\NormalTok{(}\DataTypeTok{mean=}\NormalTok{means, }\DataTypeTok{n=}\NormalTok{ns)}
\NormalTok{ans=}\KeywordTok{with}\NormalTok{(combos, }\KeywordTok{power.t.test}\NormalTok{(}\DataTypeTok{n=}\NormalTok{n, }\DataTypeTok{delta=}\DecValTok{10}\OperatorTok{-}\NormalTok{mean, }\DataTypeTok{sd=}\DecValTok{4}\NormalTok{, }
                              \DataTypeTok{type=}\StringTok{"one.sample"}\NormalTok{))}
\NormalTok{d=}\KeywordTok{tibble}\NormalTok{(}\DataTypeTok{mean=}\KeywordTok{factor}\NormalTok{(combos}\OperatorTok{$}\NormalTok{mean), }\DataTypeTok{n=}\NormalTok{combos}\OperatorTok{$}\NormalTok{n, }
         \DataTypeTok{power=}\NormalTok{ans}\OperatorTok{$}\NormalTok{power)}
\NormalTok{g=}\KeywordTok{ggplot}\NormalTok{(d, }\KeywordTok{aes}\NormalTok{(}\DataTypeTok{x=}\NormalTok{n, }\DataTypeTok{y=}\NormalTok{power, }\DataTypeTok{colour=}\NormalTok{mean)) }\OperatorTok{+}\StringTok{ }
\StringTok{  }\KeywordTok{geom_point}\NormalTok{() }\OperatorTok{+}\StringTok{ }\KeywordTok{geom_line}\NormalTok{() }\OperatorTok{+}
\StringTok{  }\KeywordTok{geom_hline}\NormalTok{(}\DataTypeTok{yintercept=}\DecValTok{1}\NormalTok{,}\DataTypeTok{linetype=}\StringTok{"dashed"}\NormalTok{)  }
\end{Highlighting}
\end{Shaded}

\end{frame}

\begin{frame}[fragile]{The power curves}
\protect\hypertarget{the-power-curves-1}{}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{g}
\end{Highlighting}
\end{Shaded}

\begin{figure}
\centering
\includegraphics{figure/unnamed-chunk-94-1.pdf}
\caption{plot of chunk unnamed-chunk-94}
\end{figure}

\end{frame}

\begin{frame}[fragile]{Two-sample power}
\protect\hypertarget{two-sample-power}{}

\begin{itemize}
\tightlist
\item
  For kids learning to read, had sample sizes of 22 (approx) in each
  group
\item
  and these group SDs:
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{kids }\OperatorTok{%>%}\StringTok{ }\KeywordTok{group_by}\NormalTok{(group) }\OperatorTok{%>%}\StringTok{ }
\StringTok{  }\KeywordTok{summarize}\NormalTok{(}\DataTypeTok{n=}\KeywordTok{n}\NormalTok{(), }\DataTypeTok{s=}\KeywordTok{sd}\NormalTok{(score))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 2 x 3
##   group     n     s
##   <chr> <int> <dbl>
## 1 c        23  17.1
## 2 t        21  11.0
\end{verbatim}

\end{frame}

\begin{frame}[fragile]{Setting up}
\protect\hypertarget{setting-up}{}

\begin{itemize}
\tightlist
\item
  suppose a 5-point improvement in reading score was considered
  important (on this scale)
\item
  in a 2-sample test, null (difference of) mean is zero, so
  \texttt{delta} is true difference in means
\item
  what is power for these sample sizes, and what sample size would be
  needed to get power up to 0.80?
\end{itemize}

\end{frame}

\begin{frame}[fragile]{Calculating power for sample size 22 (per group)}
\protect\hypertarget{calculating-power-for-sample-size-22-per-group}{}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{power.t.test}\NormalTok{(}\DataTypeTok{n=}\DecValTok{22}\NormalTok{, }\DataTypeTok{delta=}\DecValTok{5}\NormalTok{, }\DataTypeTok{sd=}\DecValTok{14}\NormalTok{, }\DataTypeTok{type=}\StringTok{"two.sample"}\NormalTok{, }
             \DataTypeTok{alternative=}\StringTok{"one.sided"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## 
##      Two-sample t test power calculation 
## 
##               n = 22
##           delta = 5
##              sd = 14
##       sig.level = 0.05
##           power = 0.3158199
##     alternative = one.sided
## 
## NOTE: n is number in *each* group
\end{verbatim}

\end{frame}

\begin{frame}[fragile]{sample size for power 0.8}
\protect\hypertarget{sample-size-for-power-0.8}{}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{power.t.test}\NormalTok{(}\DataTypeTok{power=}\FloatTok{0.80}\NormalTok{, }\DataTypeTok{delta=}\DecValTok{5}\NormalTok{, }\DataTypeTok{sd=}\DecValTok{14}\NormalTok{, }\DataTypeTok{type=}\StringTok{"two.sample"}\NormalTok{, }
             \DataTypeTok{alternative=}\StringTok{"one.sided"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## 
##      Two-sample t test power calculation 
## 
##               n = 97.62598
##           delta = 5
##              sd = 14
##       sig.level = 0.05
##           power = 0.8
##     alternative = one.sided
## 
## NOTE: n is number in *each* group
\end{verbatim}

\end{frame}

\begin{frame}{Comments}
\protect\hypertarget{comments-4}{}

\begin{itemize}
\tightlist
\item
  The power for the sample sizes we have is very small (to detect a
  5-point increase).
\item
  To get power 0.80, we need 98 kids in \emph{each} group!
\end{itemize}

\end{frame}

\begin{frame}[fragile]{Duality between confidence intervals and
hypothesis tests}
\protect\hypertarget{duality-between-confidence-intervals-and-hypothesis-tests}{}

\begin{itemize}
\tightlist
\item
  Tests and CIs really do the same thing, if you look at them the right
  way. They are both telling you something about a parameter, and they
  use same things about data.
\item
  To illustrate, some data (two groups):
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{my_url=}\StringTok{"http://www.utsc.utoronto.ca/~butler/c32/duality.txt"}
\NormalTok{twogroups=}\KeywordTok{read_delim}\NormalTok{(my_url,}\StringTok{" "}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Parsed with column specification:
## cols(
##   y = col_double(),
##   group = col_double()
## )
\end{verbatim}

\end{frame}

\begin{frame}[fragile]{The data}
\protect\hypertarget{the-data-2}{}

\footnotesize

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{twogroups}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 15 x 2
##        y group
##    <dbl> <dbl>
##  1    10     1
##  2    11     1
##  3    11     1
##  4    13     1
##  5    13     1
##  6    14     1
##  7    14     1
##  8    15     1
##  9    16     1
## 10    13     2
## 11    13     2
## 12    14     2
## 13    17     2
## 14    18     2
## 15    19     2
\end{verbatim}

\normalsize

\end{frame}

\begin{frame}[fragile]{95\% CI (default)}
\protect\hypertarget{ci-default}{}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{t.test}\NormalTok{(y }\OperatorTok{~}\StringTok{ }\NormalTok{group, }\DataTypeTok{data =}\NormalTok{ twogroups)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## 
##  Welch Two Sample t-test
## 
## data:  y by group
## t = -2.0937, df = 8.7104, p-value = 0.0668
## alternative hypothesis: true difference in means is not equal to 0
## 95 percent confidence interval:
##  -5.5625675  0.2292342
## sample estimates:
## mean in group 1 mean in group 2 
##        13.00000        15.66667
\end{verbatim}

\end{frame}

\begin{frame}[fragile]{90\% CI}
\protect\hypertarget{ci}{}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{t.test}\NormalTok{(y }\OperatorTok{~}\StringTok{ }\NormalTok{group, }\DataTypeTok{data =}\NormalTok{ twogroups, }\DataTypeTok{conf.level =} \FloatTok{0.90}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## 
##  Welch Two Sample t-test
## 
## data:  y by group
## t = -2.0937, df = 8.7104, p-value = 0.0668
## alternative hypothesis: true difference in means is not equal to 0
## 90 percent confidence interval:
##  -5.010308 -0.323025
## sample estimates:
## mean in group 1 mean in group 2 
##        13.00000        15.66667
\end{verbatim}

\end{frame}

\begin{frame}{Comparing results}
\protect\hypertarget{comparing-results}{}

Recall null here is \(H_0 : \mu_1 - \mu_2 = 0\). P-value 0.0668.

\begin{itemize}
\tightlist
\item
  95\% CI from \(-5.6\) to 0.2, contains 0.
\item
  90\% CI from \(-5.0\) to \(-0.3\), does not contain 0.
\item
  At \(\alpha = 0.05\), would not reject \(H_0\) since P-value
  \textgreater{} 0.05.
\item
  At \(\alpha = 0.10\), would reject \(H_0\) since P-value \textless{}
  0.10.
\end{itemize}

Not just coincidence. Let \(C = 100(1 - \alpha)\), so C\% gives
corresponding CI to level-\(\alpha\) test. Then following always true.
(\(\iff\) means ``if and only if''.)

\begin{tabular}{|rcl|}
  \hline
  Reject $H_0$ at level $\alpha$ & $\iff$ & $C\%$ CI does not contain $H_0$ value\\
  Do not reject $H_0$ at level $\alpha$ & $\iff$ & $C\%$ CI contains $H_0$ value\\
  \hline
\end{tabular}

Idea: ``Plausible'' parameter value inside CI, not rejected;
``Implausible'' parameter value outside CI, rejected.

\end{frame}

\begin{frame}{The value of this}
\protect\hypertarget{the-value-of-this}{}

\begin{itemize}
\tightlist
\item
  If you have a test procedure but no corresponding CI:
\item
  you make a CI by including all the parameter values that would not be
  rejected by your test.
\item
  Use:

  \begin{itemize}
  \tightlist
  \item
    \(\alpha = 0.01\) for a 99\% CI,
  \item
    \(\alpha = 0.05\) for a 95\% CI,
  \item
    \(\alpha = 0.10\) for a 90\% CI, and so on.
  \end{itemize}
\end{itemize}

\end{frame}

\begin{frame}{Testing for non-normal data}
\protect\hypertarget{testing-for-non-normal-data}{}

\begin{itemize}
\tightlist
\item
  The IRS (``Internal Revenue Service'') is the US authority that deals
  with taxes (like Revenue Canada).
\item
  One of their forms is supposed to take no more than 160 minutes to
  complete. A citizen's organization claims that it takes people longer
  than that on average.
\item
  Sample of 30 people; time to complete form recorded.
\item
  Read in data, and do \(t\)-test of \(H_0 : \mu = 160\)
  vs.~\(H_a : \mu > 160\).
\item
  For reading in, there is only one column, so can pretend it is
  delimited by anything.
\end{itemize}

\end{frame}

\begin{frame}[fragile]{Read in data}
\protect\hypertarget{read-in-data}{}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{my_url=}\StringTok{"http://www.utsc.utoronto.ca/~butler/c32/irs.txt"}
\NormalTok{irs =}\StringTok{ }\KeywordTok{read_csv}\NormalTok{(my_url)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Parsed with column specification:
## cols(
##   Time = col_double()
## )
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{irs }\OperatorTok{%>%}\StringTok{ }\KeywordTok{glimpse}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Observations: 30
## Variables: 1
## $ Time <dbl> 91, 64, 243, 167, 123, 65, 71, 204, …
\end{verbatim}

\end{frame}

\begin{frame}[fragile]{Test whether mean is 160 or greater}
\protect\hypertarget{test-whether-mean-is-160-or-greater}{}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{t.test}\NormalTok{(irs}\OperatorTok{$}\NormalTok{Time, }\DataTypeTok{mu =} \DecValTok{160}\NormalTok{, }\DataTypeTok{alternative =} \StringTok{"greater"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## 
##  One Sample t-test
## 
## data:  irs$Time
## t = 1.8244, df = 29, p-value = 0.03921
## alternative hypothesis: true mean is greater than 160
## 95 percent confidence interval:
##  162.8305      Inf
## sample estimates:
## mean of x 
##  201.2333
\end{verbatim}

Reject null; mean greater than 160.

\end{frame}

\begin{frame}[fragile]{But, look at a graph}
\protect\hypertarget{but-look-at-a-graph}{}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{ggplot}\NormalTok{(irs, }\KeywordTok{aes}\NormalTok{(}\DataTypeTok{x =}\NormalTok{ Time)) }\OperatorTok{+}\StringTok{ }\KeywordTok{geom_histogram}\NormalTok{(}\DataTypeTok{bins =} \DecValTok{10}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{figure}
\centering
\includegraphics{figure/unnamed-chunk-102-1.pdf}
\caption{plot of chunk unnamed-chunk-102}
\end{figure}

\end{frame}

\begin{frame}{Comments}
\protect\hypertarget{comments-5}{}

\begin{itemize}
\tightlist
\item
  Skewed to right.
\item
  Should look at \emph{median}, not mean.
\end{itemize}

\end{frame}

\begin{frame}{The sign test}
\protect\hypertarget{the-sign-test}{}

\begin{itemize}
\tightlist
\item
  But how to test whether the median is greater than 160?
\item
  Idea: if the median really is 160 (\(H_0\) true), the sampled values
  from the population are equally likely to be above or below 160.
\item
  If the population median is greater than 160, there will be a lot of
  sample values greater than 160, not so many less. Idea: test statistic
  is number of sample values greater than hypothesized median.
\item
  How to decide whether ``unusually many'' sample values are greater
  than 160? Need a sampling distribution.
\item
  If \(H_0\) true, pop. median is 160, then each sample value
  independently equally likely to be above or below 160.
\item
  So number of observed values above 160 has binomial distribution with
  \(n = 30\) (number of data values) and \(p = 0.5\) (160 is
  hypothesized to be \emph{median}).
\end{itemize}

\end{frame}

\begin{frame}[fragile]{Obtaining P-value for sign test 1/2}
\protect\hypertarget{obtaining-p-value-for-sign-test-12}{}

\begin{itemize}
\tightlist
\item
  Count values above/below 160:
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{irs }\OperatorTok{%>%}\StringTok{ }\KeywordTok{count}\NormalTok{(Time }\OperatorTok{>}\StringTok{ }\DecValTok{160}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 2 x 2
##   `Time > 160`     n
##   <lgl>        <int>
## 1 FALSE           13
## 2 TRUE            17
\end{verbatim}

\begin{itemize}
\tightlist
\item
  17 above, 13 below. How unusual is that? Need a \emph{binomial table}.
\end{itemize}

\end{frame}

\begin{frame}[fragile]{Obtaining P-value for sign test 2/2}
\protect\hypertarget{obtaining-p-value-for-sign-test-22}{}

\begin{itemize}
\tightlist
\item
  R function \texttt{dbinom} gives the probability of eg. exactly 17
  successes in a binomial with \(n = 30\) and \(p = 0.5\):
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{dbinom}\NormalTok{(}\DecValTok{17}\NormalTok{, }\DecValTok{30}\NormalTok{, }\FloatTok{0.5}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 0.1115351
\end{verbatim}

\begin{itemize}
\tightlist
\item
  but we want probability of 17 \emph{or more}, so get all of those,
  find probability of each, and add them up:
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{tibble}\NormalTok{(}\DataTypeTok{x=}\DecValTok{17}\OperatorTok{:}\DecValTok{30}\NormalTok{) }\OperatorTok{%>%}\StringTok{ }
\StringTok{  }\KeywordTok{mutate}\NormalTok{(}\DataTypeTok{prob=}\KeywordTok{dbinom}\NormalTok{(x, }\DecValTok{30}\NormalTok{, }\FloatTok{0.5}\NormalTok{)) }\OperatorTok{%>%}\StringTok{ }
\StringTok{  }\KeywordTok{summarize}\NormalTok{(}\DataTypeTok{total=}\KeywordTok{sum}\NormalTok{(prob))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 1 x 1
##   total
##   <dbl>
## 1 0.292
\end{verbatim}

\end{frame}

\begin{frame}[fragile]{Using my package \texttt{smmr}}
\protect\hypertarget{using-my-package-smmr}{}

\begin{itemize}
\tightlist
\item
  I wrote a package \texttt{smmr} to do the sign test (and some other
  things). Installation is a bit fiddly:

  \begin{itemize}
  \tightlist
  \item
    Install devtools with \texttt{install.packages("devtools")}
  \item
    then install smmr:
  \end{itemize}
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{library}\NormalTok{(devtools)}
\KeywordTok{install_github}\NormalTok{(}\StringTok{"nxskok/smmr"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{itemize}
\tightlist
\item
  Then load it:
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{library}\NormalTok{(smmr)}
\end{Highlighting}
\end{Shaded}

\end{frame}

\begin{frame}[fragile]{\texttt{smmr} for sign test}
\protect\hypertarget{smmr-for-sign-test}{}

\begin{itemize}
\tightlist
\item
  \texttt{smmr}'s function \texttt{sign\_test} needs three inputs: a
  data frame, a column and a null median:
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{sign_test}\NormalTok{(irs, Time, }\DecValTok{160}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## $above_below
## below above 
##    13    17 
## 
## $p_values
##   alternative   p_value
## 1       lower 0.8192027
## 2       upper 0.2923324
## 3   two-sided 0.5846647
\end{verbatim}

\end{frame}

\begin{frame}{Comments (1/3)}
\protect\hypertarget{comments-13}{}

\begin{itemize}
\tightlist
\item
  Testing whether population median \emph{greater than} 160, so want
  \emph{upper-tail} P-value 0.2923. Same as before.
\item
  Also get table of values above and below; this too as we got.
\end{itemize}

\end{frame}

\begin{frame}[fragile]{Comments (2/3)}
\protect\hypertarget{comments-23}{}

\begin{itemize}
\tightlist
\item
  P-values are:

  \begin{center}
    \begin{tabular}{lr}
      Test & P-value\\
      \hline
      $t$ & 0.0392\\
      Sign & 0.2923\\
      \hline
    \end{tabular}

    \end{center}
\item
  These are very different: we reject a mean of 160 (in favour of the
  mean being bigger), but clearly \emph{fail} to reject a median of 160
  in favour of a bigger one.
\item
  Why is that? Obtain mean and median:
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{irs }\OperatorTok{%>%}\StringTok{ }\KeywordTok{summarize}\NormalTok{(}\DataTypeTok{mean =} \KeywordTok{mean}\NormalTok{(Time), }\DataTypeTok{median =} \KeywordTok{median}\NormalTok{(Time))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 1 x 2
##    mean median
##   <dbl>  <dbl>
## 1  201.   172.
\end{verbatim}

\end{frame}

\begin{frame}{Comments (3/3)}
\protect\hypertarget{comments-33}{}

\begin{itemize}
\tightlist
\item
  The mean is pulled a long way up by the right skew, and is a fair bit
  bigger than 160.
\item
  The median is quite close to 160.
\item
  We ought to be trusting the sign test and not the t-test here (median
  and not mean), and therefore there is no evidence that the ``typical''
  time to complete the form is longer than 160 minutes.
\item
  Having said that, there are clearly some people who take a lot longer
  than 160 minutes to complete the form, and the IRS could focus on
  simplifying its form for these people.
\item
  In this example, looking at any kind of average is not really helpful;
  a better question might be ``do an unacceptably large fraction of
  people take longer than (say) 300 minutes to complete the form?'':
  that is, thinking about worst-case rather than average-case.
\end{itemize}

\end{frame}

\begin{frame}{Confidence interval for the median}
\protect\hypertarget{confidence-interval-for-the-median}{}

\begin{itemize}
\tightlist
\item
  The sign test does not naturally come with a confidence interval for
  the median.
\item
  So we use the ``duality'' between test and confidence interval to say:
  the (95\%) confidence interval for the median contains exactly those
  values of the null median that would not be rejected by the two-sided
  sign test (at \(\alpha = 0.05\)).
\end{itemize}

\end{frame}

\begin{frame}[fragile]{For our data}
\protect\hypertarget{for-our-data}{}

\begin{itemize}
\tightlist
\item
  The procedure is to try some values for the null median and see which
  ones are inside and which outside our CI.
\item
  smmr has pval\_sign that gets just the 2-sided P-value:
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{pval_sign}\NormalTok{(}\DecValTok{160}\NormalTok{, irs, Time)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 0.5846647
\end{verbatim}

\begin{itemize}
\tightlist
\item
  Try a couple of null medians:
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{pval_sign}\NormalTok{(}\DecValTok{200}\NormalTok{, irs, Time)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 0.3615946
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{pval_sign}\NormalTok{(}\DecValTok{300}\NormalTok{, irs, Time)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 0.001430906
\end{verbatim}

\begin{itemize}
\tightlist
\item
  So 200 inside the 95\% CI and 300 outside.
\end{itemize}

\end{frame}

\begin{frame}[fragile]{Doing a whole bunch}
\protect\hypertarget{doing-a-whole-bunch}{}

\begin{itemize}
\tightlist
\item
  Choose our null medians first:
\end{itemize}

\small

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(}\DataTypeTok{d=}\KeywordTok{tibble}\NormalTok{(}\DataTypeTok{null_median=}\KeywordTok{seq}\NormalTok{(}\DecValTok{100}\NormalTok{,}\DecValTok{300}\NormalTok{,}\DecValTok{20}\NormalTok{)))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 11 x 1
##    null_median
##          <dbl>
##  1         100
##  2         120
##  3         140
##  4         160
##  5         180
##  6         200
##  7         220
##  8         240
##  9         260
## 10         280
## 11         300
\end{verbatim}

\normalsize

\end{frame}

\begin{frame}[fragile]{\ldots{} and then}
\protect\hypertarget{and-then}{}

``for each null median, run the function \texttt{pval\_sign} for that
null median and get the P-value'':

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{d }\OperatorTok{%>%}\StringTok{ }\KeywordTok{mutate}\NormalTok{(}\DataTypeTok{p_value =} \KeywordTok{map_dbl}\NormalTok{(null_median, }
                               \OperatorTok{~}\StringTok{ }\KeywordTok{pval_sign}\NormalTok{(., irs, Time)))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 11 x 2
##    null_median  p_value
##          <dbl>    <dbl>
##  1         100 0.000325
##  2         120 0.0987  
##  3         140 0.200   
##  4         160 0.585   
##  5         180 0.856   
##  6         200 0.362   
##  7         220 0.0428  
##  8         240 0.0161  
##  9         260 0.00522 
## 10         280 0.00143 
## 11         300 0.00143
\end{verbatim}

\end{frame}

\begin{frame}[fragile]{Make it easier for ourselves}
\protect\hypertarget{make-it-easier-for-ourselves}{}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{d }\OperatorTok{%>%}\StringTok{ }
\StringTok{  }\KeywordTok{mutate}\NormalTok{(}\DataTypeTok{p_value =} \KeywordTok{map_dbl}\NormalTok{(null_median, }
                           \OperatorTok{~}\StringTok{ }\KeywordTok{pval_sign}\NormalTok{(., irs, Time))) }\OperatorTok{%>%}
\StringTok{  }\KeywordTok{mutate}\NormalTok{(}\DataTypeTok{in_out =} \KeywordTok{ifelse}\NormalTok{(p_value }\OperatorTok{>}\StringTok{ }\FloatTok{0.05}\NormalTok{, }\StringTok{"inside"}\NormalTok{, }\StringTok{"outside"}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 11 x 3
##    null_median  p_value in_out 
##          <dbl>    <dbl> <chr>  
##  1         100 0.000325 outside
##  2         120 0.0987   inside 
##  3         140 0.200    inside 
##  4         160 0.585    inside 
##  5         180 0.856    inside 
##  6         200 0.362    inside 
##  7         220 0.0428   outside
##  8         240 0.0161   outside
##  9         260 0.00522  outside
## 10         280 0.00143  outside
## 11         300 0.00143  outside
\end{verbatim}

\end{frame}

\begin{frame}{confidence interval for median?}
\protect\hypertarget{confidence-interval-for-median}{}

\begin{itemize}
\tightlist
\item
  95\% CI to this accuracy from 120 to 200.
\item
  Can get it more accurately by looking more closely in intervals from
  100 to 120, and from 200 to 220.
\end{itemize}

\end{frame}

\begin{frame}[fragile]{A more efficient way: bisection}
\protect\hypertarget{a-more-efficient-way-bisection}{}

\begin{itemize}
\tightlist
\item
  Know that top end of CI between 200 and 220:
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{lo=}\DecValTok{200} 
\NormalTok{hi=}\DecValTok{220}
\end{Highlighting}
\end{Shaded}

\begin{itemize}
\tightlist
\item
  Try the value halfway between: is it inside or outside?
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(}\DataTypeTok{try =}\NormalTok{ (lo }\OperatorTok{+}\StringTok{ }\NormalTok{hi) }\OperatorTok{/}\StringTok{ }\DecValTok{2}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 210
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{pval_sign}\NormalTok{(try,irs,Time)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 0.09873715
\end{verbatim}

\begin{itemize}
\tightlist
\item
  Inside, so upper end is between 210 and 220. Repeat (over):
\end{itemize}

\end{frame}

\begin{frame}[fragile]{\ldots{} bisection continued}
\protect\hypertarget{bisection-continued}{}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{lo =}\StringTok{ }\NormalTok{try}
\NormalTok{(}\DataTypeTok{try =}\NormalTok{ (lo }\OperatorTok{+}\StringTok{ }\NormalTok{hi) }\OperatorTok{/}\StringTok{ }\DecValTok{2}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 215
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{pval_sign}\NormalTok{(try, irs, Time)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 0.06142835
\end{verbatim}

\begin{itemize}
\tightlist
\item
  215 is inside too, so upper end between 215 and 220.
\item
  Continue until have as accurate a result as you want.
\end{itemize}

\end{frame}

\begin{frame}[fragile]{Bisection automatically}
\protect\hypertarget{bisection-automatically}{}

\begin{itemize}
\tightlist
\item
  A loop, but not a \texttt{for} since we don't know how many times
  we're going around. Keep going while a condition is true:
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{lo =}\StringTok{ }\DecValTok{200}
\NormalTok{hi =}\StringTok{ }\DecValTok{220}
\ControlFlowTok{while}\NormalTok{ (hi }\OperatorTok{-}\StringTok{ }\NormalTok{lo }\OperatorTok{>}\StringTok{ }\DecValTok{1}\NormalTok{) \{}
\NormalTok{  try =}\StringTok{ }\NormalTok{(hi }\OperatorTok{+}\StringTok{ }\NormalTok{lo) }\OperatorTok{/}\StringTok{ }\DecValTok{2}
\NormalTok{  ptry =}\StringTok{ }\KeywordTok{pval_sign}\NormalTok{(try, irs, Time)}
  \KeywordTok{print}\NormalTok{(}\KeywordTok{c}\NormalTok{(try, ptry))}
  \ControlFlowTok{if}\NormalTok{ (ptry }\OperatorTok{<=}\StringTok{ }\FloatTok{0.05}\NormalTok{)}
\NormalTok{    hi =}\StringTok{ }\NormalTok{try}
  \ControlFlowTok{else}
\NormalTok{    lo =}\StringTok{ }\NormalTok{try}
\NormalTok{\}}
\end{Highlighting}
\end{Shaded}

\end{frame}

\begin{frame}[fragile]{The output from this loop}
\protect\hypertarget{the-output-from-this-loop}{}

\begin{verbatim}
## [1] 210.00000000   0.09873715
## [1] 215.00000000   0.06142835
## [1] 217.50000000   0.04277395
## [1] 216.25000000   0.04277395
## [1] 215.62500000   0.04277395
\end{verbatim}

\begin{itemize}
\tightlist
\item
  215 inside, 215.625 outside. Upper end of interval to this accuracy is
  215.
\end{itemize}

\end{frame}

\begin{frame}[fragile]{Using smmr}
\protect\hypertarget{using-smmr}{}

\begin{itemize}
\tightlist
\item
  \texttt{smmr} has function \texttt{ci\_median} that does this (by
  default 95\% CI):
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{ci_median}\NormalTok{(irs,Time)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 119.0065 214.9955
\end{verbatim}

\begin{itemize}
\tightlist
\item
  Uses a more accurate bisection than we did.
\item
  Or get, say, 90\% CI for median:
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{ci_median}\NormalTok{(irs,Time,}\DataTypeTok{conf.level=}\FloatTok{0.90}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 123.0031 208.9960
\end{verbatim}

\begin{itemize}
\tightlist
\item
  90\% CI is shorter, as it should be.
\end{itemize}

\end{frame}

\begin{frame}{Matched pairs}
\protect\hypertarget{matched-pairs}{}

Some data:

\centering{
  \includegraphics[height=0.7\textheight]{Screenshot_2019-04-26_13-41-29}
}

\end{frame}

\begin{frame}{Matched pairs data}
\protect\hypertarget{matched-pairs-data}{}

\begin{itemize}
\tightlist
\item
  Data are comparison of 2 drugs for effectiveness at reducing pain.
\item
  12 subjects (cases) were arthritis sufferers
\item
  Response is \#hours of pain relief from each drug.
\item
  In reading example, each child tried only one reading method.
\item
  But here, each subject tried out both drugs, giving us two
  measurements.
\item
  Possible because, if you wait long enough, one drug has no influence
  over effect of other.
\item
  Advantage: focused comparison of drugs. Compare one drug with another
  on same person, removes a lot of variability due to differences
  between people.
\item
  Matched pairs, requires different analysis.
\item
  Design: randomly choose 6 of 12 subjects to get drug A first, other 6
  get drug B first.
\end{itemize}

\end{frame}

\begin{frame}[fragile]{Paired t test: reading the data}
\protect\hypertarget{paired-t-test-reading-the-data}{}

Values aligned in columns:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{my_url=}\StringTok{"http://www.utsc.utoronto.ca/~butler/c32/analgesic.txt"}
\NormalTok{pain=}\KeywordTok{read_table}\NormalTok{(my_url)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Parsed with column specification:
## cols(
##   subject = col_double(),
##   druga = col_double(),
##   drugb = col_double()
## )
\end{verbatim}

\end{frame}

\begin{frame}[fragile]{The data}
\protect\hypertarget{the-data-3}{}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{pain}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 12 x 3
##    subject druga drugb
##      <dbl> <dbl> <dbl>
##  1       1   2     3.5
##  2       2   3.6   5.7
##  3       3   2.6   2.9
##  4       4   2.6   2.4
##  5       5   7.3   9.9
##  6       6   3.4   3.3
##  7       7  14.9  16.7
##  8       8   6.6   6  
##  9       9   2.3   3.8
## 10      10   2     4  
## 11      11   6.8   9.1
## 12      12   8.5  20.9
\end{verbatim}

\end{frame}

\begin{frame}[fragile]{Paired \emph{t}-test}
\protect\hypertarget{paired-t-test}{}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{with}\NormalTok{(pain, }\KeywordTok{t.test}\NormalTok{(druga, drugb, }\DataTypeTok{paired =}\NormalTok{ T))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## 
##  Paired t-test
## 
## data:  druga and drugb
## t = -2.1677, df = 11, p-value = 0.05299
## alternative hypothesis: true difference in means is not equal to 0
## 95 percent confidence interval:
##  -4.29941513  0.03274847
## sample estimates:
## mean of the differences 
##               -2.133333
\end{verbatim}

P-value is 0.053. Likewise, you can calculate the differences yourself
and do a 1-sample t-test on them, over:

\end{frame}

\begin{frame}[fragile]{t-testing the differences}
\protect\hypertarget{t-testing-the-differences}{}

\begin{itemize}
\tightlist
\item
  First calculate a column of differences (in data frame):
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(pain }\OperatorTok{%>%}\StringTok{ }\KeywordTok{mutate}\NormalTok{(}\DataTypeTok{diff=}\NormalTok{druga}\OperatorTok{-}\NormalTok{drugb) ->}\StringTok{ }\NormalTok{pain)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 12 x 4
##    subject druga drugb    diff
##      <dbl> <dbl> <dbl>   <dbl>
##  1       1   2     3.5  -1.5  
##  2       2   3.6   5.7  -2.1  
##  3       3   2.6   2.9  -0.300
##  4       4   2.6   2.4   0.2  
##  5       5   7.3   9.9  -2.6  
##  6       6   3.4   3.3   0.1  
##  7       7  14.9  16.7  -1.80 
##  8       8   6.6   6     0.600
##  9       9   2.3   3.8  -1.5  
## 10      10   2     4    -2    
## 11      11   6.8   9.1  -2.3  
## 12      12   8.5  20.9 -12.4
\end{verbatim}

\end{frame}

\begin{frame}[fragile]{t-test on the differences}
\protect\hypertarget{t-test-on-the-differences}{}

\begin{itemize}
\tightlist
\item
  then throw them into t.test, testing that the mean is zero, with same
  result as before:
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{with}\NormalTok{(pain,}\KeywordTok{t.test}\NormalTok{(diff,}\DataTypeTok{mu=}\DecValTok{0}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## 
##  One Sample t-test
## 
## data:  diff
## t = -2.1677, df = 11, p-value = 0.05299
## alternative hypothesis: true mean is not equal to 0
## 95 percent confidence interval:
##  -4.29941513  0.03274847
## sample estimates:
## mean of x 
## -2.133333
\end{verbatim}

\end{frame}

\begin{frame}{Assessing normality}
\protect\hypertarget{assessing-normality}{}

\begin{itemize}
\tightlist
\item
  1-sample and 2-sample t-tests assume (each) group normally
  distributed.
\item
  Matched pairs analyses assume (theoretically) that differences
  normally distributed.
\item
  Though we know that t-tests generally behave well even without
  normality.
\item
  How to assess normality? A normal quantile plot.

  \begin{itemize}
  \tightlist
  \item
    Idea: scatter of points should follow the straight line, without
    curving.
  \item
    Outliers show up at bottom left or top right of plot as points off
    the line.
  \end{itemize}
\end{itemize}

\end{frame}

\begin{frame}[fragile]{The normal quantile plot}
\protect\hypertarget{the-normal-quantile-plot}{}

\begin{itemize}
\tightlist
\item
  of differences from matched pairs data
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{ggplot}\NormalTok{(pain,}\KeywordTok{aes}\NormalTok{(}\DataTypeTok{sample=}\NormalTok{diff))}\OperatorTok{+}\KeywordTok{stat_qq}\NormalTok{()}\OperatorTok{+}\KeywordTok{stat_qq_line}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{figure}
\centering
\includegraphics{figure/unnamed-chunk-127-1.pdf}
\caption{plot of chunk unnamed-chunk-127}
\end{figure}

\begin{itemize}
\tightlist
\item
  Points should follow the straight line. Bottom left one way off, so
  normality questionable here: outlier.
\end{itemize}

\end{frame}

\begin{frame}{More normal quantile plots}
\protect\hypertarget{more-normal-quantile-plots}{}

\begin{itemize}
\tightlist
\item
  How straight does a normal quantile plot have to be?
\item
  There is randomness in real data, so even a normal quantile plot from
  normal data won't look perfectly straight.
\item
  With a small sample, can look not very straight even from normal data.
\item
  Looking for systematic departure from a straight line; random wiggles
  ought not to concern us.
\item
  Look at some examples where we know the answer, so that we can see
  what to expect.
\end{itemize}

\end{frame}

\begin{frame}[fragile]{Normal data, large sample}
\protect\hypertarget{normal-data-large-sample}{}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{d=}\KeywordTok{tibble}\NormalTok{(}\DataTypeTok{x=}\KeywordTok{rnorm}\NormalTok{(}\DecValTok{200}\NormalTok{))}
\KeywordTok{ggplot}\NormalTok{(d,}\KeywordTok{aes}\NormalTok{(}\DataTypeTok{x=}\NormalTok{x))}\OperatorTok{+}\KeywordTok{geom_histogram}\NormalTok{(}\DataTypeTok{bins=}\DecValTok{10}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{figure}
\centering
\includegraphics{figure/unnamed-chunk-128-1.pdf}
\caption{plot of chunk unnamed-chunk-128}
\end{figure}

\end{frame}

\begin{frame}[fragile]{The normal quantile plot}
\protect\hypertarget{the-normal-quantile-plot-1}{}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{ggplot}\NormalTok{(d,}\KeywordTok{aes}\NormalTok{(}\DataTypeTok{sample=}\NormalTok{x))}\OperatorTok{+}\KeywordTok{stat_qq}\NormalTok{()}\OperatorTok{+}\KeywordTok{stat_qq_line}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{figure}
\centering
\includegraphics{figure/unnamed-chunk-129-1.pdf}
\caption{plot of chunk unnamed-chunk-129}
\end{figure}

\end{frame}

\begin{frame}[fragile]{Normal data, small sample}
\protect\hypertarget{normal-data-small-sample}{}

\begin{itemize}
\tightlist
\item
  Not so convincingly normal, but not obviously skewed:
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{d=}\KeywordTok{tibble}\NormalTok{(}\DataTypeTok{x=}\KeywordTok{rnorm}\NormalTok{(}\DecValTok{20}\NormalTok{))}
\KeywordTok{ggplot}\NormalTok{(d,}\KeywordTok{aes}\NormalTok{(}\DataTypeTok{x=}\NormalTok{x))}\OperatorTok{+}\KeywordTok{geom_histogram}\NormalTok{(}\DataTypeTok{bins=}\DecValTok{5}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{figure}
\centering
\includegraphics{figure/normal-small-1.pdf}
\caption{plot of chunk normal-small}
\end{figure}

\end{frame}

\begin{frame}[fragile]{The normal quantile plot}
\protect\hypertarget{the-normal-quantile-plot-2}{}

Good, apart from the highest and lowest points being slightly off. I'd
call this good:

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{ggplot}\NormalTok{(d,}\KeywordTok{aes}\NormalTok{(}\DataTypeTok{sample=}\NormalTok{x))}\OperatorTok{+}\KeywordTok{stat_qq}\NormalTok{()}\OperatorTok{+}\KeywordTok{stat_qq_line}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{figure}
\centering
\includegraphics{figure/unnamed-chunk-131-1.pdf}
\caption{plot of chunk unnamed-chunk-131}
\end{figure}

\end{frame}

\begin{frame}[fragile]{Chi-squared data, \emph{df} = 10}
\protect\hypertarget{chi-squared-data-df-10}{}

Somewhat skewed to right:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{d=}\KeywordTok{tibble}\NormalTok{(}\DataTypeTok{x=}\KeywordTok{rchisq}\NormalTok{(}\DecValTok{100}\NormalTok{,}\DecValTok{10}\NormalTok{))}
\KeywordTok{ggplot}\NormalTok{(d,}\KeywordTok{aes}\NormalTok{(}\DataTypeTok{x=}\NormalTok{x))}\OperatorTok{+}\KeywordTok{geom_histogram}\NormalTok{(}\DataTypeTok{bins=}\DecValTok{10}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{figure}
\centering
\includegraphics{figure/unnamed-chunk-132-1.pdf}
\caption{plot of chunk unnamed-chunk-132}
\end{figure}

\end{frame}

\begin{frame}[fragile]{The normal quantile plot}
\protect\hypertarget{the-normal-quantile-plot-3}{}

Somewhat opening-up curve:

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{ggplot}\NormalTok{(d,}\KeywordTok{aes}\NormalTok{(}\DataTypeTok{sample=}\NormalTok{x))}\OperatorTok{+}\KeywordTok{stat_qq}\NormalTok{()}\OperatorTok{+}\KeywordTok{stat_qq_line}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{figure}
\centering
\includegraphics{figure/unnamed-chunk-133-1.pdf}
\caption{plot of chunk unnamed-chunk-133}
\end{figure}

\end{frame}

\begin{frame}[fragile]{Chi-squared data, df = 3}
\protect\hypertarget{chi-squared-data-df-3}{}

Definitely skewed to right:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{d=}\KeywordTok{tibble}\NormalTok{(}\DataTypeTok{x=}\KeywordTok{rchisq}\NormalTok{(}\DecValTok{100}\NormalTok{,}\DecValTok{3}\NormalTok{))}
\KeywordTok{ggplot}\NormalTok{(d,}\KeywordTok{aes}\NormalTok{(}\DataTypeTok{x=}\NormalTok{x))}\OperatorTok{+}\KeywordTok{geom_histogram}\NormalTok{(}\DataTypeTok{bins=}\DecValTok{10}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{figure}
\centering
\includegraphics{figure/chisq-small-df-1.pdf}
\caption{plot of chunk chisq-small-df}
\end{figure}

\end{frame}

\begin{frame}[fragile]{The normal quantile plot}
\protect\hypertarget{the-normal-quantile-plot-4}{}

Clear upward-opening curve:

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{ggplot}\NormalTok{(d,}\KeywordTok{aes}\NormalTok{(}\DataTypeTok{sample=}\NormalTok{x))}\OperatorTok{+}\KeywordTok{stat_qq}\NormalTok{()}\OperatorTok{+}\KeywordTok{stat_qq_line}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{figure}
\centering
\includegraphics{figure/unnamed-chunk-134-1.pdf}
\caption{plot of chunk unnamed-chunk-134}
\end{figure}

\end{frame}

\begin{frame}[fragile]{t-distributed data, df = 3}
\protect\hypertarget{t-distributed-data-df-3}{}

Long tails (or a very sharp peak):

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{d=}\KeywordTok{tibble}\NormalTok{(}\DataTypeTok{x=}\KeywordTok{rt}\NormalTok{(}\DecValTok{300}\NormalTok{,}\DecValTok{3}\NormalTok{))}
\KeywordTok{ggplot}\NormalTok{(d,}\KeywordTok{aes}\NormalTok{(}\DataTypeTok{x=}\NormalTok{x))}\OperatorTok{+}\KeywordTok{geom_histogram}\NormalTok{(}\DataTypeTok{bins=}\DecValTok{10}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{figure}
\centering
\includegraphics{figure/t-small-1.pdf}
\caption{plot of chunk t-small}
\end{figure}

\end{frame}

\begin{frame}[fragile]{The normal quantile plot}
\protect\hypertarget{the-normal-quantile-plot-5}{}

Low values too low and high values too high for normal.

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{ggplot}\NormalTok{(d,}\KeywordTok{aes}\NormalTok{(}\DataTypeTok{sample=}\NormalTok{x))}\OperatorTok{+}\KeywordTok{stat_qq}\NormalTok{()}\OperatorTok{+}\KeywordTok{stat_qq_line}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{figure}
\centering
\includegraphics{figure/unnamed-chunk-135-1.pdf}
\caption{plot of chunk unnamed-chunk-135}
\end{figure}

\end{frame}

\begin{frame}[fragile]{Our pain-relief data}
\protect\hypertarget{our-pain-relief-data}{}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{ggplot}\NormalTok{(pain,}\KeywordTok{aes}\NormalTok{(}\DataTypeTok{sample=}\NormalTok{diff))}\OperatorTok{+}\KeywordTok{stat_qq}\NormalTok{()}\OperatorTok{+}\KeywordTok{stat_qq_line}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{figure}
\centering
\includegraphics{figure/pain-relief-qq-1.pdf}
\caption{plot of chunk pain-relief-qq}
\end{figure}

\end{frame}

\begin{frame}{Comments}
\protect\hypertarget{comments-6}{}

\begin{itemize}
\tightlist
\item
  Definitely not normal. What to do?
\item
  Sign test on differences, null median 0.
\end{itemize}

\end{frame}

\begin{frame}[fragile]{Sign test}
\protect\hypertarget{sign-test}{}

\begin{itemize}
\tightlist
\item
  Most easily: calculate differences in data frame, then use
  \texttt{smmr}.
\item
  Null median difference is 0:
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{pain }\OperatorTok{%>%}\StringTok{ }\KeywordTok{mutate}\NormalTok{(}\DataTypeTok{mydiff=}\NormalTok{druga}\OperatorTok{-}\NormalTok{drugb) }\OperatorTok{%>%}
\KeywordTok{sign_test}\NormalTok{(mydiff,}\DecValTok{0}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## $above_below
## below above 
##     9     3 
## 
## $p_values
##   alternative    p_value
## 1       lower 0.07299805
## 2       upper 0.98071289
## 3   two-sided 0.14599609
\end{verbatim}

\end{frame}

\begin{frame}[fragile]{Comments}
\protect\hypertarget{comments-7}{}

\begin{itemize}
\tightlist
\item
  P-value 0.1460. No evidence that the drugs are different.
\item
  Since we are working in a pipeline, input data frame to
  \texttt{sign\_test} is ``whatever came out of previous step''.
\end{itemize}

\end{frame}

\begin{frame}[fragile]{(Some of) the kids' reading data, again}
\protect\hypertarget{some-of-the-kids-reading-data-again}{}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{kids }\OperatorTok{%>%}\StringTok{ }\KeywordTok{sample_n}\NormalTok{(}\DecValTok{12}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 12 x 2
##    group score
##    <chr> <dbl>
##  1 t        49
##  2 c        48
##  3 c        46
##  4 c        17
##  5 t        43
##  6 t        44
##  7 c        26
##  8 t        59
##  9 c        55
## 10 t        62
## 11 t        43
## 12 c        10
\end{verbatim}

\end{frame}

\begin{frame}{Where we are at}
\protect\hypertarget{where-we-are-at}{}

\begin{itemize}
\item
  21 kids in ``treatment'', new reading method; 23 in ``control'',
  standard reading method.
\item
  Assessing assumptions:

  \begin{itemize}
  \tightlist
  \item
    We did two-sample t-test (Satterthwaite-Welch) before.
  \item
    Assumes approx. normal data within each group.
  \item
    Does not assume equal spread.
  \item
    (Pooled t-test \emph{does} assume equal spread).
  \item
    Assess each group separately.
  \end{itemize}
\end{itemize}

\end{frame}

\begin{frame}[fragile]{Boxplots for reading data}
\protect\hypertarget{boxplots-for-reading-data}{}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{ggplot}\NormalTok{(kids,}\KeywordTok{aes}\NormalTok{(}\DataTypeTok{x=}\NormalTok{group,}\DataTypeTok{y=}\NormalTok{score))}\OperatorTok{+}\KeywordTok{geom_boxplot}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{figure}
\centering
\includegraphics{figure/unnamed-chunk-138-1.pdf}
\caption{plot of chunk unnamed-chunk-138}
\end{figure}

\end{frame}

\begin{frame}[fragile]{Facetted normal quantile plots}
\protect\hypertarget{facetted-normal-quantile-plots}{}

Done this way:

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{ggplot}\NormalTok{(kids,}\KeywordTok{aes}\NormalTok{(}\DataTypeTok{sample=}\NormalTok{score))}\OperatorTok{+}\KeywordTok{stat_qq}\NormalTok{()}\OperatorTok{+}\KeywordTok{stat_qq_line}\NormalTok{()}\OperatorTok{+}
\KeywordTok{facet_wrap}\NormalTok{(}\OperatorTok{~}\NormalTok{group)}
\end{Highlighting}
\end{Shaded}

\begin{figure}
\centering
\includegraphics{figure/unnamed-chunk-139-1.pdf}
\caption{plot of chunk unnamed-chunk-139}
\end{figure}

\end{frame}

\begin{frame}{Comments}
\protect\hypertarget{comments-8}{}

\begin{itemize}
\tightlist
\item
  These plots show no problems with normality. Both groups are more or
  less symmetric/normal and there are no outliers.
\item
  Equal spreads questionable, but we don't need that.
\item
  Assess equal spreads by looking at \emph{slopes} of normal quantile
  plots.
\item
  We ought be happy with the (Welch) two-sample t-test (over)
\end{itemize}

\end{frame}

\begin{frame}[fragile]{Welch two-sample test}
\protect\hypertarget{welch-two-sample-test}{}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{t.test}\NormalTok{(score}\OperatorTok{~}\NormalTok{group,}\DataTypeTok{data=}\NormalTok{kids,}\DataTypeTok{alternative=}\StringTok{"less"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## 
##  Welch Two Sample t-test
## 
## data:  score by group
## t = -2.3109, df = 37.855, p-value = 0.01319
## alternative hypothesis: true difference in means is less than 0
## 95 percent confidence interval:
##       -Inf -2.691293
## sample estimates:
## mean in group c mean in group t 
##        41.52174        51.47619
\end{verbatim}

from which we concluded that the new reading method really does help.

\end{frame}

\begin{frame}{What to do if normality fails}
\protect\hypertarget{what-to-do-if-normality-fails}{}

\begin{itemize}
\tightlist
\item
  (On the previous page, the only indication of non-normality is the
  highest score in the control group, which is a little too high for
  normality.)
\item
  If normality fails (for one or both of the groups), what do we do
  then?
\item
  Again, can compare medians: use the thought process of the sign test,
  which does not depend on normality and is not damaged by outliers.
\item
  A suitable test called Mood's median test.
\item
  Before we get to that, a diversion.
\end{itemize}

\end{frame}

\begin{frame}[fragile]{The chi-squared test for independence}
\protect\hypertarget{the-chi-squared-test-for-independence}{}

Suppose we want to know whether people are in favour of having daylight
savings time all year round. We ask 20 males and 20 females whether they
each agree with having DST all year round (``yes'') or not (``no'').
Some of the data:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{my_url=}\StringTok{"http://www.utsc.utoronto.ca/~butler/c32/dst.txt"}
\NormalTok{dst=}\KeywordTok{read_delim}\NormalTok{(my_url,}\StringTok{" "}\NormalTok{)}
\NormalTok{dst }\OperatorTok{%>%}\StringTok{ }\KeywordTok{sample_n}\NormalTok{(}\DecValTok{5}\NormalTok{) }\CommentTok{# randomly sample 5 rows}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 5 x 2
##   gender agree
##   <chr>  <chr>
## 1 female no   
## 2 female no   
## 3 male   no   
## 4 male   yes  
## 5 female yes
\end{verbatim}

\end{frame}

\begin{frame}[fragile]{\ldots{} continued}
\protect\hypertarget{continued-1}{}

Count up individuals in each category combination, and arrange in
contingency table:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{tab=}\KeywordTok{with}\NormalTok{(dst,}\KeywordTok{table}\NormalTok{(gender,agree))}
\NormalTok{tab}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##         agree
## gender   no yes
##   female 11   9
##   male    3  17
\end{verbatim}

\begin{itemize}
\tightlist
\item
  Most of the males say ``yes'', but the females are about evenly split.
\item
  Looks like males more likely to say ``yes'', ie. an association
  between gender and agreement.
\item
  Test an \(H_0\) of ``no association'' (``independence'')
  vs.~alternative that there is really some association.
\item
  Done with \texttt{chisq.test}.
\end{itemize}

\end{frame}

\begin{frame}[fragile]{\ldots And finally}
\protect\hypertarget{and-finally}{}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{chisq.test}\NormalTok{(tab,}\DataTypeTok{correct=}\NormalTok{F)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## 
##  Pearson's Chi-squared test
## 
## data:  tab
## X-squared = 7.033, df = 1, p-value = 0.008002
\end{verbatim}

\begin{itemize}
\tightlist
\item
  Reject null hypothesis of no association
\item
  therefore there is a difference in rates of agreement between (all)
  males and females (or that gender and agreement are associated).
\item
  Without \texttt{correct=F} uses ``Yates correction''; this way, should
  give same answers as calculated by hand (if you know how).
\end{itemize}

\end{frame}

\begin{frame}{Mood's median test}
\protect\hypertarget{moods-median-test}{}

\begin{itemize}
\tightlist
\item
  Before our diversion, we wanted to compare medians of two groups.
\item
  Recall sign test: count number of values above and below something
  (there, hypothesized median).
\item
  Idea of Mood's median test:

  \begin{itemize}
  \tightlist
  \item
    Work out the median of all the data, regardless of group (``grand
    median'').
  \item
    Count how many data values in each group are above/below this grand
    median.
  \item
    Make contingency table of group vs.~above/below.
  \item
    Test for association.
  \end{itemize}
\item
  If group medians equal, each group should have about half its
  observations above/below grand median. If not, one group will be
  mostly above grand median and other below.
\end{itemize}

\end{frame}

\begin{frame}[fragile]{Mood's median test for reading data}
\protect\hypertarget{moods-median-test-for-reading-data}{}

\begin{itemize}
\tightlist
\item
  Find overall median score:
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(kids }\OperatorTok{%>%}\StringTok{ }\KeywordTok{summarize}\NormalTok{(}\DataTypeTok{med=}\KeywordTok{median}\NormalTok{(score)) }\OperatorTok{%>%}\StringTok{ }\KeywordTok{pull}\NormalTok{(med) ->}\StringTok{ }\NormalTok{m)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 47
\end{verbatim}

\begin{itemize}
\tightlist
\item
  Make table of above/below vs.~group:
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{tab=}\KeywordTok{with}\NormalTok{(kids,}\KeywordTok{table}\NormalTok{(group,score}\OperatorTok{>}\NormalTok{m))}
\NormalTok{tab}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##      
## group FALSE TRUE
##     c    15    8
##     t     7   14
\end{verbatim}

\begin{itemize}
\tightlist
\item
  Treatment group scores mostly above median, control group scores
  mostly below, as expected.
\end{itemize}

\end{frame}

\begin{frame}[fragile]{The test}
\protect\hypertarget{the-test}{}

\begin{itemize}
\tightlist
\item
  Do chi-squared test:
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{chisq.test}\NormalTok{(tab,}\DataTypeTok{correct=}\NormalTok{F)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## 
##  Pearson's Chi-squared test
## 
## data:  tab
## X-squared = 4.4638, df = 1, p-value = 0.03462
\end{verbatim}

\begin{itemize}
\tightlist
\item
  This test actually two-sided (tests for any association).
\item
  Here want to test that new reading method \emph{better} (one-sided).
\item
  Most of treatment children above overall median, so do 1-sided test by
  halving P-value to get 0.017.
\item
  This way too, children do better at learning to read using the new
  method.
\end{itemize}

\end{frame}

\begin{frame}[fragile]{Or by smmr}
\protect\hypertarget{or-by-smmr}{}

\begin{itemize}
\tightlist
\item
  \texttt{median\_test} does the whole thing:
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{median_test}\NormalTok{(kids,score,group)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## $table
##      above
## group above below
##     c     8    15
##     t    14     7
## 
## $test
##        what      value
## 1 statistic 4.46376812
## 2        df 1.00000000
## 3   P-value 0.03462105
\end{verbatim}

\begin{itemize}
\tightlist
\item
  P-value again two-sided.
\end{itemize}

\end{frame}

\begin{frame}{Comments}
\protect\hypertarget{comments-9}{}

\begin{itemize}
\tightlist
\item
  P-value 0.013 for (1-sided) t-test, 0.017 for (1-sided) Mood median
  test.
\item
  Like the sign test, Mood's median test doesn't use the data very
  efficiently (only, is each value above or below grand median).
\item
  Thus, if we can justify doing \emph{t}-test, we should do it. This is
  the case here.
\item
  The \emph{t}-test will usually give smaller P-value because it uses
  the data more efficiently.
\item
  The time to use Mood's median test is if we are definitely unhappy
  with the normality assumption (and thus the t-test P-value is not to
  be trusted).
\end{itemize}

\end{frame}

\begin{frame}{Jumping rats}
\protect\hypertarget{jumping-rats}{}

\begin{itemize}
\tightlist
\item
  Link between exercise and healthy bones (many studies).
\item
  Exercise stresses bones and causes them to get stronger.
\item
  Study (Purdue): effect of jumping on bone density of growing rats.
\item
  30 rats, randomly assigned to 1 of 3 treatments:

  \begin{itemize}
  \tightlist
  \item
    No jumping (control)
  \item
    Low-jump treatment (30 cm)
  \item
    High-jump treatment (60 cm)
  \end{itemize}
\item
  8 weeks, 10 jumps/day, 5 days/week.
\item
  Bone density of rats (mg/cm 3 ) measured at end.
\item
  See whether larger amount of exercise (jumping) went with higher bone
  density.
\item
  Random assignment: rats in each group similar in all important ways.
\item
  So entitled to draw conclusions about cause and effect.
\end{itemize}

\end{frame}

\begin{frame}[fragile]{Reading the data}
\protect\hypertarget{reading-the-data}{}

Values separated by spaces:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{my_url=}\StringTok{"http://www.utsc.utoronto.ca/~butler/c32/jumping.txt"}
\NormalTok{rats=}\KeywordTok{read_delim}\NormalTok{(my_url,}\StringTok{" "}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Parsed with column specification:
## cols(
##   group = col_character(),
##   density = col_double()
## )
\end{verbatim}

\end{frame}

\begin{frame}[fragile]{The data (some random rows)}
\protect\hypertarget{the-data-some-random-rows}{}

\small

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{rats }\OperatorTok{%>%}\StringTok{ }\KeywordTok{sample_n}\NormalTok{(}\DecValTok{12}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 12 x 2
##    group    density
##    <chr>      <dbl>
##  1 Highjump     650
##  2 Lowjump      599
##  3 Lowjump      588
##  4 Lowjump      632
##  5 Highjump     643
##  6 Lowjump      638
##  7 Highjump     643
##  8 Control      621
##  9 Highjump     626
## 10 Control      554
## 11 Lowjump      635
## 12 Lowjump      607
\end{verbatim}

\normalsize

\end{frame}

\begin{frame}[fragile]{Boxplots}
\protect\hypertarget{boxplots-1}{}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{ggplot}\NormalTok{(rats,}\KeywordTok{aes}\NormalTok{(}\DataTypeTok{y=}\NormalTok{density,}\DataTypeTok{x=}\NormalTok{group))}\OperatorTok{+}\KeywordTok{geom_boxplot}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{figure}
\centering
\includegraphics{figure/unnamed-chunk-150-1.pdf}
\caption{plot of chunk unnamed-chunk-150}
\end{figure}

\end{frame}

\begin{frame}[fragile]{Or, arranging groups in data (logical) order}
\protect\hypertarget{or-arranging-groups-in-data-logical-order}{}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{ggplot}\NormalTok{(rats,}\KeywordTok{aes}\NormalTok{(}\DataTypeTok{y=}\NormalTok{density,}\DataTypeTok{x=}\KeywordTok{fct_inorder}\NormalTok{(group)))}\OperatorTok{+}
\KeywordTok{geom_boxplot}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{figure}
\centering
\includegraphics{figure/unnamed-chunk-151-1.pdf}
\caption{plot of chunk unnamed-chunk-151}
\end{figure}

\end{frame}

\begin{frame}{Analysis of Variance}
\protect\hypertarget{analysis-of-variance}{}

\begin{itemize}
\tightlist
\item
  Comparing \textgreater{} 2 groups of independent observations (each
  rat only does one amount of jumping).
\item
  Standard procedure: analysis of variance (ANOVA).
\item
  Null hypothesis: all groups have same mean.
\item
  Alternative: ``not all means the same'', at least one is different
  from others.
\end{itemize}

\end{frame}

\begin{frame}[fragile]{Testing: ANOVA in R}
\protect\hypertarget{testing-anova-in-r}{}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{rats.aov=}\KeywordTok{aov}\NormalTok{(density}\OperatorTok{~}\NormalTok{group,}\DataTypeTok{data=}\NormalTok{rats)}
\KeywordTok{summary}\NormalTok{(rats.aov)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##             Df Sum Sq Mean Sq F value Pr(>F)   
## group        2   7434    3717   7.978 0.0019 **
## Residuals   27  12579     466                  
## ---
## Signif. codes:  
## 0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
\end{verbatim}

\begin{itemize}
\tightlist
\item
  Usual ANOVA table, small P-value: significant result.
\item
  Conclude that the mean bone densities are not all equal.
\item
  Reject null, but not very useful finding.
\end{itemize}

\end{frame}

\begin{frame}[fragile]{Which groups are different from which?}
\protect\hypertarget{which-groups-are-different-from-which}{}

\begin{itemize}
\tightlist
\item
  ANOVA really only answers half our questions: it says ``there are
  differences'', but doesn't tell us which groups different.
\item
  One possibility (not the best): compare all possible pairs of groups,
  via two-sample t.
\item
  First pick out each group:
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{rats }\OperatorTok{%>%}\StringTok{ }\KeywordTok{filter}\NormalTok{(group}\OperatorTok{==}\StringTok{"Control"}\NormalTok{) ->}\StringTok{ }\NormalTok{controls}
\NormalTok{rats }\OperatorTok{%>%}\StringTok{ }\KeywordTok{filter}\NormalTok{(group}\OperatorTok{==}\StringTok{"Lowjump"}\NormalTok{) ->}\StringTok{ }\NormalTok{lows}
\NormalTok{rats }\OperatorTok{%>%}\StringTok{ }\KeywordTok{filter}\NormalTok{(group}\OperatorTok{==}\StringTok{"Highjump"}\NormalTok{) ->}\StringTok{ }\NormalTok{highs}
\end{Highlighting}
\end{Shaded}

\end{frame}

\begin{frame}[fragile]{Control vs.~low}
\protect\hypertarget{control-vs.-low}{}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{t.test}\NormalTok{(controls}\OperatorTok{$}\NormalTok{density,lows}\OperatorTok{$}\NormalTok{density)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## 
##  Welch Two Sample t-test
## 
## data:  controls$density and lows$density
## t = -1.0761, df = 16.191, p-value = 0.2977
## alternative hypothesis: true difference in means is not equal to 0
## 95 percent confidence interval:
##  -33.83725  11.03725
## sample estimates:
## mean of x mean of y 
##     601.1     612.5
\end{verbatim}

No sig. difference here.

\end{frame}

\begin{frame}[fragile]{Control vs.~high}
\protect\hypertarget{control-vs.-high}{}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{t.test}\NormalTok{(controls}\OperatorTok{$}\NormalTok{density,highs}\OperatorTok{$}\NormalTok{density)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## 
##  Welch Two Sample t-test
## 
## data:  controls$density and highs$density
## t = -3.7155, df = 14.831, p-value = 0.002109
## alternative hypothesis: true difference in means is not equal to 0
## 95 percent confidence interval:
##  -59.19139 -16.00861
## sample estimates:
## mean of x mean of y 
##     601.1     638.7
\end{verbatim}

These are different.

\end{frame}

\begin{frame}[fragile]{Low vs.~high}
\protect\hypertarget{low-vs.-high}{}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{t.test}\NormalTok{(lows}\OperatorTok{$}\NormalTok{density,highs}\OperatorTok{$}\NormalTok{density)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## 
##  Welch Two Sample t-test
## 
## data:  lows$density and highs$density
## t = -3.2523, df = 17.597, p-value = 0.004525
## alternative hypothesis: true difference in means is not equal to 0
## 95 percent confidence interval:
##  -43.15242  -9.24758
## sample estimates:
## mean of x mean of y 
##     612.5     638.7
\end{verbatim}

These are different too.

\end{frame}

\begin{frame}{But\ldots{}}
\protect\hypertarget{but}{}

\begin{itemize}
\tightlist
\item
  We just did 3 tests instead of 1.
\item
  So we have given ourselves 3 chances to reject \(H_0:\) all means
  equal, instead of 1.
\item
  Thus \(\alpha\) for this combined test is not 0.05.
\end{itemize}

\end{frame}

\begin{frame}{John W. Tukey}
\protect\hypertarget{john-w.-tukey}{}

\begin{columns}
    \begin{column}{0.4\textwidth}
      \includegraphics[width=\textwidth]{John_Tukey}
    \end{column}
    \begin{column}{0.6\textwidth}
      \begin{itemize}
      \item American statistician, 1915--2000
      \item Big fan of exploratory data analysis
      \item Invented boxplot
      \item Invented "honestly significant differences"
      \item Invented jackknife estimation
      \item Coined computing term "bit"
      \item Co-inventor of Fast Fourier Transform
      \end{itemize}
    \end{column}
  \end{columns}

\end{frame}

\begin{frame}{Honestly Significant Differences}
\protect\hypertarget{honestly-significant-differences}{}

\begin{itemize}
\tightlist
\item
  Compare several groups with one test, telling you which groups differ
  from which.
\item
  Idea: if all population means equal, find distribution of highest
  sample mean minus lowest sample mean.
\item
  Any means unusually different compared to that declared significantly
  different.
\end{itemize}

\end{frame}

\begin{frame}[fragile]{Tukey on rat data}
\protect\hypertarget{tukey-on-rat-data}{}

\small

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{rats.aov=}\KeywordTok{aov}\NormalTok{(density}\OperatorTok{~}\NormalTok{group,}\DataTypeTok{data=}\NormalTok{rats)}
\KeywordTok{TukeyHSD}\NormalTok{(rats.aov)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##   Tukey multiple comparisons of means
##     95% family-wise confidence level
## 
## Fit: aov(formula = density ~ group, data = rats)
## 
## $group
##                   diff       lwr       upr     p adj
## Highjump-Control  37.6  13.66604 61.533957 0.0016388
## Lowjump-Control   11.4 -12.53396 35.333957 0.4744032
## Lowjump-Highjump -26.2 -50.13396 -2.266043 0.0297843
\end{verbatim}

\normalsize

\begin{itemize}
\tightlist
\item
  Again conclude that bone density for highjump group significantly
  higher than for other two groups.
\end{itemize}

\end{frame}

\begin{frame}[fragile]{Why Tukey's procedure better than all t-tests}
\protect\hypertarget{why-tukeys-procedure-better-than-all-t-tests}{}

Look at P-values for the two tests:

\begin{verbatim}
Comparison        Tukey    t-tests
----------------------------------
Highjump-Control 0.0016     0.0021
Lowjump-Control  0.4744     0.2977
Lowjump-Highjump 0.0298     0.0045
\end{verbatim}

\begin{itemize}
\tightlist
\item
  Tukey P-values (mostly) higher.
\item
  Proper adjustment for doing three t-tests at once, not just one in
  isolation.
\item
  \texttt{lowjump-highjump} comparison would no longer be significant at
  \(\alpha = 0.01\).
\end{itemize}

\end{frame}

\begin{frame}[fragile]{Checking assumptions}
\protect\hypertarget{checking-assumptions}{}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{ggplot}\NormalTok{(rats,}\KeywordTok{aes}\NormalTok{(}\DataTypeTok{y=}\NormalTok{density,}\DataTypeTok{x=}\KeywordTok{fct_inorder}\NormalTok{(group)))}\OperatorTok{+}
\KeywordTok{geom_boxplot}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{figure}
\centering
\includegraphics{figure/unnamed-chunk-160-1.pdf}
\caption{plot of chunk unnamed-chunk-160}
\end{figure}

Assumptions: - Normally distributed data within each group - with equal
group SDs.

\end{frame}

\begin{frame}[fragile]{Normal quantile plots by group}
\protect\hypertarget{normal-quantile-plots-by-group}{}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{ggplot}\NormalTok{(rats, }\KeywordTok{aes}\NormalTok{(}\DataTypeTok{sample =}\NormalTok{ density)) }\OperatorTok{+}\StringTok{ }\KeywordTok{stat_qq}\NormalTok{() }\OperatorTok{+}\StringTok{ }
\StringTok{  }\KeywordTok{stat_qq_line}\NormalTok{() }\OperatorTok{+}\StringTok{ }\KeywordTok{facet_wrap}\NormalTok{( }\OperatorTok{~}\StringTok{ }\NormalTok{group)}
\end{Highlighting}
\end{Shaded}

\begin{figure}
\centering
\includegraphics{figure/unnamed-chunk-161-1.pdf}
\caption{plot of chunk unnamed-chunk-161}
\end{figure}

\end{frame}

\begin{frame}{The assumptions}
\protect\hypertarget{the-assumptions}{}

\begin{itemize}
\tightlist
\item
  Normally-distributed data within each group
\item
  Equal group SDs. These are shaky here because:
\item
  control group has outliers
\item
  highjump group appears to have less spread than others. Possible
  remedies (in general):
\item
  Transformation of response (usually works best when SD increases with
  mean)
\item
  If normality OK but equal spreads not, can use Welch ANOVA. (Regular
  ANOVA like pooled t-test; Welch ANOVA like Welch-Satterthwaite
  t-test.)
\item
  Can also use Mood's Median Test (see over). This works for any number
  of groups.
\end{itemize}

\end{frame}

\begin{frame}[fragile]{Mood's median test 1/4}
\protect\hypertarget{moods-median-test-14}{}

\begin{itemize}
\tightlist
\item
  Find median of all bone densities, regardless of group:
\end{itemize}

\small

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(rats }\OperatorTok{%>%}\StringTok{ }\KeywordTok{summarize}\NormalTok{(}\DataTypeTok{med =} \KeywordTok{median}\NormalTok{(density)) }\OperatorTok{%>%}\StringTok{ }\KeywordTok{pull}\NormalTok{(med) ->}\StringTok{ }\NormalTok{m)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 621.5
\end{verbatim}

\normalsize

\begin{itemize}
\tightlist
\item
  Count up how many observations in each group above or below overall
  median:
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{tab =}\StringTok{ }\KeywordTok{with}\NormalTok{(rats, }\KeywordTok{table}\NormalTok{(group, density }\OperatorTok{>}\StringTok{ }\NormalTok{m))}
\NormalTok{tab}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##           
## group      FALSE TRUE
##   Control      9    1
##   Highjump     0   10
##   Lowjump      6    4
\end{verbatim}

\end{frame}

\begin{frame}[fragile]{Mood's median test 2/4}
\protect\hypertarget{moods-median-test-24}{}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{tab}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##           
## group      FALSE TRUE
##   Control      9    1
##   Highjump     0   10
##   Lowjump      6    4
\end{verbatim}

\begin{itemize}
\tightlist
\item
  All Highjump obs above overall median.
\item
  Most Control obs below overall median.
\item
  Suggests medians differ by group.
\end{itemize}

\end{frame}

\begin{frame}[fragile]{Mood's median test 3/4}
\protect\hypertarget{moods-median-test-34}{}

\begin{itemize}
\tightlist
\item
  Test whether association between group and being above/below overall
  median significant using chi-squared test for association:
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{chisq.test}\NormalTok{(tab,}\DataTypeTok{correct=}\NormalTok{F)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## 
##  Pearson's Chi-squared test
## 
## data:  tab
## X-squared = 16.8, df = 2, p-value = 0.0002249
\end{verbatim}

\begin{itemize}
\tightlist
\item
  Very small P-value says that being above/below overall median depends
  on group.
\item
  That is, groups do not all have same median.
\end{itemize}

\end{frame}

\begin{frame}[fragile]{Mood's median test 4/4}
\protect\hypertarget{moods-median-test-44}{}

Or with \texttt{median\_test} from \texttt{smmr}, same as before.

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{median_test}\NormalTok{(rats,density,group)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## $table
##           above
## group      above below
##   Control      1     9
##   Highjump    10     0
##   Lowjump      4     6
## 
## $test
##        what        value
## 1 statistic 1.680000e+01
## 2        df 2.000000e+00
## 3   P-value 2.248673e-04
\end{verbatim}

\end{frame}

\begin{frame}[fragile]{Comments}
\protect\hypertarget{comments-10}{}

\begin{itemize}
\tightlist
\item
  No doubt that medians differ between groups (not all same).
\item
  This test is equivalent of \(F\)-test, not of Tukey.
\item
  To determine which groups differ from which, can compare all possible
  pairs of groups via (2-sample) Mood's median tests, then adjust
  P-values by multiplying by number of 2-sample Mood tests done
  (Bonferroni):
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{pairwise_median_test}\NormalTok{(rats,density,group)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 3 x 4
##   g1       g2        p_value adj_p_value
##   <chr>    <chr>       <dbl>       <dbl>
## 1 Control  Highjump 0.000148    0.000443
## 2 Control  Lowjump  0.371       1       
## 3 Highjump Lowjump  0.371       1
\end{verbatim}

\begin{itemize}
\tightlist
\item
  Now, lowjump-highjump difference no longer significant.
\end{itemize}

\end{frame}

\begin{frame}[fragile]{Welch ANOVA}
\protect\hypertarget{welch-anova}{}

\begin{itemize}
\tightlist
\item
  For these data, Mood's median test probably best because we doubt both
  normality and equal spreads.
\item
  When normality OK but spreads differ, Welch ANOVA way to go.
\item
  Welch ANOVA done by \texttt{oneway.test} as shown (for illustration):
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{oneway.test}\NormalTok{(density}\OperatorTok{~}\NormalTok{group,}\DataTypeTok{data=}\NormalTok{rats)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## 
##  One-way analysis of means (not assuming
##  equal variances)
## 
## data:  density and group
## F = 8.8164, num df = 2.000, denom df =
## 17.405, p-value = 0.002268
\end{verbatim}

\begin{itemize}
\tightlist
\item
  P-value very similar, as expected.
\item
  Appropriate Tukey-equivalent here called Games-Howell.
\end{itemize}

\end{frame}

\begin{frame}[fragile]{Games-Howell}
\protect\hypertarget{games-howell}{}

\begin{itemize}
\tightlist
\item
  Lives in package \texttt{PMCMRplus} (also
  \texttt{userfriendlyscience}). Install first.
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{library}\NormalTok{(PMCMRplus)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{gamesHowellTest}\NormalTok{(density}\OperatorTok{~}\KeywordTok{factor}\NormalTok{(group),}\DataTypeTok{data=}\NormalTok{rats)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## 
##  Pairwise comparisons using Games-Howell test
\end{verbatim}

\begin{verbatim}
## data: density by factor(group)
\end{verbatim}

\begin{verbatim}
##          Control Highjump
## Highjump 0.0056  -       
## Lowjump  0.5417  0.0120
\end{verbatim}

\begin{verbatim}
## 
## P value adjustment method: none
\end{verbatim}

\begin{verbatim}
## alternative hypothesis: two.sided
\end{verbatim}

\end{frame}

\hypertarget{writing-reports}{%
\section{Writing reports}\label{writing-reports}}

\begin{frame}{Communicating your results}
\protect\hypertarget{communicating-your-results}{}

Being a statistician means being able to do several things:

\begin{enumerate}
\tightlist
\item
  Obtain and process the data for analysis
\item
  Do a suitable analysis
\item
  Check that the analysis was reasonable
\item
  Communicate your findings to the world
\end{enumerate}

The last part is perhaps the most important, because analyses do not
exist in isolation; you do an analysis to answer a question, and the
answer to the question is the most important thing.

This is true whether you are in the corporate world, answering to a
boss, or in graduate school, where you will eventually have to convince
your thesis committee (and, by extension, the academic world) that what
you have done is interesting, statistically sound and important.

\end{frame}

\begin{frame}{Reports}
\protect\hypertarget{reports}{}

\begin{itemize}
\tightlist
\item
  Final step of your process is to write a report. This is a sales job,
  because you have to convince your readers that what you have done is
  worth their time reading.
\item
  Writing a report requires good language skills. You cannot become a
  good statistician without that.
\item
  This is why so many of my questions end ``explain briefly''. You need
  to learn to provide a complete and concise explanation of what your
  results tell you and why.
\item
  Reports are usually structured in a similar way, as shown on next
  page.
\end{itemize}

\end{frame}

\begin{frame}{Report structure}
\protect\hypertarget{report-structure}{}

\emph{Introduction}: tell your readers about your problem and what you
hope to find out. You need to provide enough explanation for the reader
to know what you're trying to achieve. You might also want to refer to
what other people have done.

\emph{Methods}: Where the data came from, and how it was collected
(describing the technology that was used, if any). Scientific people
call this section ``Methods''. If you needed to do any work to get the
data into the right form, this is also the place to describe that.

\emph{Analysis and results}: It is not enough to give the analysis; you
have to explain what you are doing and what made you do it. The results
should be described in a matter-of-fact way (the opinions come in the
next section).

\emph{Conclusions}: What does the analysis tell you about your problem?
Place the results in context. Offer (supported) opinions about what the
results mean, to you and the world.

\end{frame}

\begin{frame}{A typical journal article}
\protect\hypertarget{a-typical-journal-article}{}

\url{http://jap.physiology.org/content/100/3/839}

\includegraphics[width=\textwidth]{titlebar}

Title and authors, with journal and page numbers, so that you have
everything you need to refer to it.

\end{frame}

\begin{frame}{Abstract}
\protect\hypertarget{abstract}{}

Journal articles typically begin with Abstract that summarizes question
and gives highlights of results and conclusion, and tells you whether
paper is worth your while to read.

\includegraphics[width=0.7\textwidth]{abstract}

\end{frame}

\begin{frame}{Introduction}
\protect\hypertarget{introduction-1}{}

\includegraphics[width=\textwidth]{intro}

Introduction begins with plain-English first sentence. The numbers in
brackets are references to what other people have said.

\end{frame}

\begin{frame}{Materials and methods}
\protect\hypertarget{materials-and-methods}{}

\includegraphics[width=0.75\textwidth]{matmeth}

The subjects. Experiments on humans require ``ethical approval''.

\end{frame}

\begin{frame}{Taking measurements}
\protect\hypertarget{taking-measurements}{}

\includegraphics[width=0.9\textwidth]{measurements}

\ldots{}

\includegraphics[width=0.9\textwidth]{measurementb}

\end{frame}

\begin{frame}{Results (a)}
\protect\hypertarget{results-a}{}

\includegraphics[width=\textwidth]{resultsa}

\ldots noting that the two groups were not significantly different
before the study, but changed in important respects over time. Results
also shown in table.

\end{frame}

\begin{frame}{Results (b)}
\protect\hypertarget{results-b}{}

\includegraphics[width=0.7\textwidth]{resultsb}

Graph showing that bone mass density has changed greatly as a result of
the jumping. (Graphs are always good.)

\end{frame}

\begin{frame}{Conclusions (selected) 1/2}
\protect\hypertarget{conclusions-selected-12}{}

\includegraphics[width=0.9\textwidth]{conc1}

\ldots{}

\includegraphics[width=0.9\textwidth]{conc2}

\end{frame}

\begin{frame}{Conclusions 2/2}
\protect\hypertarget{conclusions-22}{}

\includegraphics[width=0.9\textwidth]{conc3}

Note use of (relatively) plain English, description of most important
findings, comparisons to other work, and admission of limitations.

\end{frame}

\begin{frame}{References to other work (some)}
\protect\hypertarget{references-to-other-work-some}{}

\includegraphics[width=0.9\textwidth]{refs}

\end{frame}

\begin{frame}{Reproducibility}
\protect\hypertarget{reproducibility}{}

\begin{itemize}
\tightlist
\item
  The paper we just looked at contained a lot of information.
\item
  Partly, this was to show that the researchers followed proper
  procedure (important with human subjects).
\item
  Also allows anyone to do analysis on same data and get same results
  (reproducible).
\item
  Allows anyone to follow same procedure on own data and see if results
  same (replication).
\item
  As statisticians, we need our own reports to be reproducible, and to
  be able to replicate them on different data.
\item
  Strategy for this: write reports so that they include the code and a
  way of running it.
\item
  This can be done in R (R Markdown in R Notebook).
\end{itemize}

\end{frame}

\begin{frame}{Why this is better than copy-and-paste}
\protect\hypertarget{why-this-is-better-than-copy-and-paste}{}

\begin{itemize}
\tightlist
\item
  This seems like more trouble than copying-and-pasting the code and
  output into a Word document. Why should I do it?
\item
  You are guaranteed to get code and output that matches up. If you
  copy-and-paste, how do you know you remembered to copy the most recent
  run of your code? (When you change your code, you have to remember to
  run it again, and to re-copy the output.)
\item
  Anyone else, or you yourself later, can make the document again from
  the R Markdown file (and the data files), or run the same code on a
  new data file. This makes the analysis reproducible. Any procedure
  that depends on copy-pasting the right thing is not reproducible.
\item
  Bosses have a habit of asking for small changes to a document. You
  make those small changes in the R Markdown file, knit again, and you
  have your results with minimal fuss.
\end{itemize}

\end{frame}

\begin{frame}{Other output formats}
\protect\hypertarget{other-output-formats}{}

\begin{itemize}
\tightlist
\item
  The basic (and fastest) form of output is HTML. This is best for while
  you're writing the report, or if you want to put it on a web site.
\item
  Word .doc output: when you think you've finished writing (slow). If
  you want to make changes, edit the R Markdown, close the Word doc and
  re-knit.
\item
  PDF, via a LaTeX installation (R Studio Cloud has this).
\item
  Presentations of various flavours (makes suitable HTML/PDF out of the
  R Markdown).
\end{itemize}

\end{frame}

\begin{frame}{Writing your own report}
\protect\hypertarget{writing-your-own-report}{}

\begin{itemize}
\tightlist
\item
  A complete report of an analysis has (at least) three parts:

  \begin{itemize}
  \tightlist
  \item
    \textbf{Introduction}, where you talk about the context of your
    data, where it came from, and what you are hoping to learn

    \begin{itemize}
    \tightlist
    \item
      you might also have a Literature Review where you talk about work
      that other people have done
    \end{itemize}
  \item
    \textbf{Analysis}, where you describe the steps you took to get the
    data into shape for your analysis, what analysis you did \emph{and
    why}, and your assessment of the assumptions for your analysis.
  \item
    \textbf{Conclusions}, where you summarize what you learned about
    your data, and the implications for the world outside your data set.

    \begin{itemize}
    \tightlist
    \item
      if you have a Literature Review, you probably also want to discuss
      how your results are consistent (or inconsistent) with the
      literature.
    \end{itemize}
  \end{itemize}
\item
  Only a small part of this is actually doing Statistics. More of it is
  explanation, using your language skills. Much of the rest is typically
  getting the data into shape to do your chosen analysis.
\end{itemize}

\end{frame}

\hypertarget{tidying-and-organizing-data}{%
\section{Tidying and organizing
data}\label{tidying-and-organizing-data}}

\begin{frame}[fragile]{Tidying data}
\protect\hypertarget{tidying-data}{}

\begin{itemize}
\tightlist
\item
  Data rarely come to us as we want to use them.
\item
  Before we can do analysis, typically have organizing to do.
\item
  This is typical of ANOVA-type data, ``wide format'':
\end{itemize}

\begin{verbatim}
pig feed1 feed2 feed3 feed4
  1  60.8  68.7  92.6  87.9
  2  57.0  67.7  92.1  84.2
  3  65.0  74.0  90.2  83.1
  4  58.6  66.3  96.5  85.7
  5  61.7  69.8  99.1  90.3
\end{verbatim}

\begin{itemize}
\tightlist
\item
  20 pigs are randomly allocated to one of four feeds. At the end of the
  study, the weight of each pig is recorded, and we want to know whether
  there are any differences in mean weights among the feeds.
\item
  Problem: want the weights all in one column, with 2nd column labelling
  which feed each weight was from. Untidy!
\end{itemize}

\end{frame}

\begin{frame}[fragile]{Tidy and untidy data (Wickham)}
\protect\hypertarget{tidy-and-untidy-data-wickham}{}

\begin{itemize}
\tightlist
\item
  Data set easier to deal with if:

  \begin{itemize}
  \tightlist
  \item
    each observation is one row
  \item
    each variable is one column
  \item
    each type of observation unit is one table
  \end{itemize}
\item
  Data arranged this way called ``tidy''; otherwise called ``untidy''.
\item
  For the pig data:

  \begin{itemize}
  \tightlist
  \item
    response variable is weight, but scattered over 4 columns, which are
    levels of a factor \texttt{feed}.
  \item
    Want all the weights in one column, with a second column
    \texttt{feed} saying which feed that weight goes with.
  \item
    Then we can run \texttt{aov}.
  \end{itemize}
\end{itemize}

\end{frame}

\begin{frame}[fragile]{Packages for this section}
\protect\hypertarget{packages-for-this-section-4}{}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{library}\NormalTok{(tidyverse)}
\KeywordTok{library}\NormalTok{(readxl)}
\end{Highlighting}
\end{Shaded}

\end{frame}

\begin{frame}[fragile]{Reading in the pig data}
\protect\hypertarget{reading-in-the-pig-data}{}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{my_url <-}\StringTok{ "http://www.utsc.utoronto.ca/~butler/c32/pigs1.txt"}
\NormalTok{pigs1 <-}\StringTok{ }\KeywordTok{read_delim}\NormalTok{(my_url, }\StringTok{" "}\NormalTok{)}
\NormalTok{pigs1}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 5 x 4
##   feed1 feed2 feed3 feed4
##   <dbl> <dbl> <dbl> <dbl>
## 1  60.8  68.7  92.6  87.9
## 2  57    67.7  92.1  84.2
## 3  65    74    90.2  83.1
## 4  58.6  66.3  96.5  85.7
## 5  61.7  69.8  99.1  90.3
\end{verbatim}

\end{frame}

\begin{frame}[fragile]{Gathering up the columns (OLD)}
\protect\hypertarget{gathering-up-the-columns-old}{}

\begin{itemize}
\tightlist
\item
  This is a very common reorganization, and the magic ``verb'' is
  \texttt{gather}:
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{pigs1 }\OperatorTok{%>%}\StringTok{ }\KeywordTok{gather}\NormalTok{(feed, weight, feed1}\OperatorTok{:}\NormalTok{feed4) ->}\StringTok{ }\NormalTok{pigs2}
\end{Highlighting}
\end{Shaded}

\begin{itemize}
\tightlist
\item
  \texttt{pigs2} is now in ``long'' format, ready for analysis. See next
  page.
\item
  Anatomy of \texttt{gather}: what makes the columns different
  (different feeds), what makes them the same (all weights), which
  columns to combine.
\end{itemize}

\end{frame}

\begin{frame}[fragile]{Long format pigs}
\protect\hypertarget{long-format-pigs}{}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{pigs2}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 20 x 2
##    feed  weight
##    <chr>  <dbl>
##  1 feed1   60.8
##  2 feed1   57  
##  3 feed1   65  
##  4 feed1   58.6
##  5 feed1   61.7
##  6 feed2   68.7
##  7 feed2   67.7
##  8 feed2   74  
##  9 feed2   66.3
## 10 feed2   69.8
## 11 feed3   92.6
## 12 feed3   92.1
## 13 feed3   90.2
## 14 feed3   96.5
## 15 feed3   99.1
## 16 feed4   87.9
## 17 feed4   84.2
## 18 feed4   83.1
## 19 feed4   85.7
## 20 feed4   90.3
\end{verbatim}

\end{frame}

\begin{frame}[fragile]{Another way to do this: (NEW)}
\protect\hypertarget{another-way-to-do-this-new}{}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{pigs1 }\OperatorTok{%>%}\StringTok{ }
\StringTok{  }\KeywordTok{pivot_longer}\NormalTok{(feed1}\OperatorTok{:}\NormalTok{feed4, }\DataTypeTok{names_to =} \StringTok{"feed"}\NormalTok{, }
               \DataTypeTok{values_to=}\StringTok{"weight"}\NormalTok{) ->}\StringTok{ }\NormalTok{pigs2}
\NormalTok{pigs2}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 20 x 2
##    feed  weight
##    <chr>  <dbl>
##  1 feed1   60.8
##  2 feed2   68.7
##  3 feed3   92.6
##  4 feed4   87.9
##  5 feed1   57  
##  6 feed2   67.7
##  7 feed3   92.1
##  8 feed4   84.2
##  9 feed1   65  
## 10 feed2   74  
## 11 feed3   90.2
## 12 feed4   83.1
## 13 feed1   58.6
## 14 feed2   66.3
## 15 feed3   96.5
## 16 feed4   85.7
## 17 feed1   61.7
## 18 feed2   69.8
## 19 feed3   99.1
## 20 feed4   90.3
\end{verbatim}

\end{frame}

\begin{frame}[fragile]{\ldots and finally, the analysis}
\protect\hypertarget{and-finally-the-analysis}{}

\begin{itemize}
\tightlist
\item
  which is just what we saw before:
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{weight}\FloatTok{.1}\NormalTok{ <-}\StringTok{ }\KeywordTok{aov}\NormalTok{(weight }\OperatorTok{~}\StringTok{ }\NormalTok{feed, }\DataTypeTok{data =}\NormalTok{ pigs2)}
\KeywordTok{summary}\NormalTok{(weight}\FloatTok{.1}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##             Df Sum Sq Mean Sq F value   Pr(>F)    
## feed         3   3521  1173.5   119.1 3.72e-11 ***
## Residuals   16    158     9.8                     
## ---
## Signif. codes:  
## 0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
\end{verbatim}

\begin{itemize}
\tightlist
\item
  The mean weights of pigs on the different feeds are definitely not all
  equal.
\item
  So we run Tukey to see which ones differ (over).
\end{itemize}

\end{frame}

\begin{frame}[fragile]{Tukey}
\protect\hypertarget{tukey}{}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{TukeyHSD}\NormalTok{(weight}\FloatTok{.1}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##   Tukey multiple comparisons of means
##     95% family-wise confidence level
## 
## Fit: aov(formula = weight ~ feed, data = pigs2)
## 
## $feed
##              diff        lwr       upr     p adj
## feed2-feed1  8.68   3.001038 14.358962 0.0024000
## feed3-feed1 33.48  27.801038 39.158962 0.0000000
## feed4-feed1 25.62  19.941038 31.298962 0.0000000
## feed3-feed2 24.80  19.121038 30.478962 0.0000000
## feed4-feed2 16.94  11.261038 22.618962 0.0000013
## feed4-feed3 -7.86 -13.538962 -2.181038 0.0055599
\end{verbatim}

All of the feeds differ!

\end{frame}

\begin{frame}[fragile]{Mean weights by feed}
\protect\hypertarget{mean-weights-by-feed}{}

To find the best and worst, get mean weight by feed group. I borrowed an
idea from later to put the means in descending order:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{pigs2 }\OperatorTok{%>%}
\StringTok{  }\KeywordTok{group_by}\NormalTok{(feed) }\OperatorTok{%>%}
\StringTok{  }\KeywordTok{summarize}\NormalTok{(}\DataTypeTok{mean_weight =} \KeywordTok{mean}\NormalTok{(weight)) }\OperatorTok{%>%}
\StringTok{  }\KeywordTok{arrange}\NormalTok{(}\KeywordTok{desc}\NormalTok{(mean_weight))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 4 x 2
##   feed  mean_weight
##   <chr>       <dbl>
## 1 feed3        94.1
## 2 feed4        86.2
## 3 feed2        69.3
## 4 feed1        60.6
\end{verbatim}

Feed 3 is best, feed 1 worst.

\end{frame}

\begin{frame}[fragile]{Should we have any concerns about the ANOVA?}
\protect\hypertarget{should-we-have-any-concerns-about-the-anova}{}

Feed 2 has an outlier, but there are only 5 pigs in each group, and the
conclusion is so clear that I am OK with this.

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{ggplot}\NormalTok{(pigs2, }\KeywordTok{aes}\NormalTok{(}\DataTypeTok{x =}\NormalTok{ feed, }\DataTypeTok{y =}\NormalTok{ weight)) }\OperatorTok{+}\StringTok{ }\KeywordTok{geom_boxplot}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{figure}
\centering
\includegraphics{figure/unnamed-chunk-178-1.pdf}
\caption{plot of chunk unnamed-chunk-178}
\end{figure}

\end{frame}

\begin{frame}[fragile]{Tuberculosis}
\protect\hypertarget{tuberculosis}{}

\begin{itemize}
\tightlist
\item
  The World Health Organization keeps track of number of cases of
  various diseases, eg. tuberculosis.
\item
  Some data:
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{my_url <-}\StringTok{ "http://www.utsc.utoronto.ca/~butler/c32/tb.csv"}
\NormalTok{tb <-}\StringTok{ }\KeywordTok{read_csv}\NormalTok{(my_url)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Parsed with column specification:
## cols(
##   .default = col_double(),
##   iso2 = col_character()
## )
\end{verbatim}

\begin{verbatim}
## See spec(...) for full column specifications.
\end{verbatim}

\begin{itemize}
\tightlist
\item
  Variables (see over): country (abbreviated), year. Then number of
  cases for each gender and age group, eg. \texttt{m1524} is males aged
  15--24. Also \texttt{mu} and \texttt{fu}, where age is unknown.
\item
  Lots of missings. Want to get rid of.
\end{itemize}

\end{frame}

\begin{frame}[fragile]{The data}
\protect\hypertarget{the-data-4}{}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{tb}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 5,769 x 22
##    iso2   year   m04  m514  m014 m1524 m2534 m3544
##    <chr> <dbl> <dbl> <dbl> <dbl> <dbl> <dbl> <dbl>
##  1 AD     1989    NA    NA    NA    NA    NA    NA
##  2 AD     1990    NA    NA    NA    NA    NA    NA
##  3 AD     1991    NA    NA    NA    NA    NA    NA
##  4 AD     1992    NA    NA    NA    NA    NA    NA
##  5 AD     1993    NA    NA    NA    NA    NA    NA
##  6 AD     1994    NA    NA    NA    NA    NA    NA
##  7 AD     1996    NA    NA     0     0     0     4
##  8 AD     1997    NA    NA     0     0     1     2
##  9 AD     1998    NA    NA     0     0     0     1
## 10 AD     1999    NA    NA     0     0     0     1
## # … with 5,759 more rows, and 14 more variables:
## #   m4554 <dbl>, m5564 <dbl>, m65 <dbl>, mu <dbl>,
## #   f04 <dbl>, f514 <dbl>, f014 <dbl>, f1524 <dbl>,
## #   f2534 <dbl>, f3544 <dbl>, f4554 <dbl>,
## #   f5564 <dbl>, f65 <dbl>, fu <dbl>
\end{verbatim}

\end{frame}

\begin{frame}[fragile]{Gather the gender-age group columns}
\protect\hypertarget{gather-the-gender-age-group-columns}{}

OLD

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{tb }\OperatorTok{%>%}\StringTok{ }\KeywordTok{gather}\NormalTok{(genage, freq, m04}\OperatorTok{:}\NormalTok{fu, }\DataTypeTok{na.rm =}\NormalTok{ T) ->}\StringTok{ }\NormalTok{tb2}
\end{Highlighting}
\end{Shaded}

or

NEW

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{tb }\OperatorTok{%>%}\StringTok{ }
\StringTok{  }\KeywordTok{pivot_longer}\NormalTok{(m04}\OperatorTok{:}\NormalTok{fu, }\DataTypeTok{names_to =} \StringTok{"genage"}\NormalTok{, }
               \DataTypeTok{values_to =} \StringTok{"freq"}\NormalTok{, }\DataTypeTok{values_drop_na =}\NormalTok{ T) ->}\StringTok{ }\NormalTok{tb2}
\end{Highlighting}
\end{Shaded}

\begin{itemize}
\tightlist
\item
  columns to make longer
\item
  column to contain the names
\item
  column to contain the values
\item
  (optional) drop missings in the values
\end{itemize}

\end{frame}

\begin{frame}[fragile]{Results (some)}
\protect\hypertarget{results-some}{}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{tb2}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 35,750 x 4
##    iso2   year genage  freq
##    <chr> <dbl> <chr>  <dbl>
##  1 AD     1996 m014       0
##  2 AD     1996 m1524      0
##  3 AD     1996 m2534      0
##  4 AD     1996 m3544      4
##  5 AD     1996 m4554      1
##  6 AD     1996 m5564      0
##  7 AD     1996 m65        0
##  8 AD     1996 f014       0
##  9 AD     1996 f1524      1
## 10 AD     1996 f2534      1
## # … with 35,740 more rows
\end{verbatim}

\end{frame}

\begin{frame}[fragile]{Separating}
\protect\hypertarget{separating}{}

\begin{itemize}
\tightlist
\item
  4 columns, but 5 variables, since \texttt{genage} contains both gender
  and age group. Split that up using separate.
\item
  \texttt{separate} needs 3 things:

  \begin{itemize}
  \tightlist
  \item
    what to separate (no quotes needed),
  \item
    what to separate into (here you do need quotes),
  \item
    how to split.
  \end{itemize}
\item
  For ``how to split'', here ``after first character'':
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{tb2 }\OperatorTok{%>%}\StringTok{ }\KeywordTok{separate}\NormalTok{(genage, }\KeywordTok{c}\NormalTok{(}\StringTok{"gender"}\NormalTok{, }\StringTok{"age"}\NormalTok{), }\DecValTok{1}\NormalTok{) ->}\StringTok{ }\NormalTok{tb3}
\end{Highlighting}
\end{Shaded}

\end{frame}

\begin{frame}[fragile]{Tidied tuberculosis data (some)}
\protect\hypertarget{tidied-tuberculosis-data-some}{}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{tb3}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 35,750 x 5
##    iso2   year gender age    freq
##    <chr> <dbl> <chr>  <chr> <dbl>
##  1 AD     1996 m      014       0
##  2 AD     1996 m      1524      0
##  3 AD     1996 m      2534      0
##  4 AD     1996 m      3544      4
##  5 AD     1996 m      4554      1
##  6 AD     1996 m      5564      0
##  7 AD     1996 m      65        0
##  8 AD     1996 f      014       0
##  9 AD     1996 f      1524      1
## 10 AD     1996 f      2534      1
## # … with 35,740 more rows
\end{verbatim}

\end{frame}

\begin{frame}[fragile]{In practice\ldots{}}
\protect\hypertarget{in-practice}{}

\begin{itemize}
\tightlist
\item
  instead of doing the pipe one step at a time, you \emph{debug} it one
  step at a time, and when you have each step working, you use that
  step's output as input to the next step, thus:
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{tb }\OperatorTok{%>%}
\StringTok{  }\KeywordTok{pivot_longer}\NormalTok{(m04}\OperatorTok{:}\NormalTok{fu, }\DataTypeTok{names_to =} \StringTok{"genage"}\NormalTok{, }
               \DataTypeTok{values_to =} \StringTok{"freq"}\NormalTok{, }\DataTypeTok{values_drop_na =}\NormalTok{ T) }\OperatorTok{%>%}\StringTok{ }
\StringTok{  }\KeywordTok{separate}\NormalTok{(genage, }\KeywordTok{c}\NormalTok{(}\StringTok{"gender"}\NormalTok{, }\StringTok{"age"}\NormalTok{), }\DecValTok{1}\NormalTok{) ->}\StringTok{ }\NormalTok{tb3}
\end{Highlighting}
\end{Shaded}

\begin{itemize}
\tightlist
\item
  You can split the R code over as many lines as you like, as long as
  each line is incomplete, so that R knows more is to come.
\item
  I like to put the pipe symbol on the end of the line.
\end{itemize}

\end{frame}

\begin{frame}[fragile]{Total tuberculosis cases by year (some of the
years)}
\protect\hypertarget{total-tuberculosis-cases-by-year-some-of-the-years}{}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{tb3 }\OperatorTok{%>%}
\StringTok{  }\KeywordTok{filter}\NormalTok{(}\KeywordTok{between}\NormalTok{(year, }\DecValTok{1991}\NormalTok{, }\DecValTok{1998}\NormalTok{)) }\OperatorTok{%>%}\StringTok{ }
\StringTok{  }\KeywordTok{count}\NormalTok{(year, }\DataTypeTok{wt=}\NormalTok{freq) }
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 8 x 2
##    year      n
##   <dbl>  <dbl>
## 1  1991    544
## 2  1992    512
## 3  1993    492
## 4  1994    750
## 5  1995 513971
## 6  1996 635705
## 7  1997 733204
## 8  1998 840389
\end{verbatim}

\begin{itemize}
\tightlist
\item
  Something very interesting happened between 1994 and 1995.
\end{itemize}

\end{frame}

\begin{frame}[fragile]{To find out what}
\protect\hypertarget{to-find-out-what}{}

\begin{itemize}
\tightlist
\item
  try counting up total cases by country:
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{tb3 }\OperatorTok{%>%}\StringTok{ }
\StringTok{  }\KeywordTok{count}\NormalTok{(iso2, }\DataTypeTok{wt=}\NormalTok{freq) }\OperatorTok{%>%}\StringTok{ }
\StringTok{  }\KeywordTok{arrange}\NormalTok{(}\KeywordTok{desc}\NormalTok{(n))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 213 x 2
##    iso2        n
##    <chr>   <dbl>
##  1 CN    4065174
##  2 IN    3966169
##  3 ID    1129015
##  4 ZA     900349
##  5 BD     758008
##  6 VN     709695
##  7 CD     603095
##  8 PH     490040
##  9 BR     440609
## 10 KE     431523
## # … with 203 more rows
\end{verbatim}

\end{frame}

\begin{frame}[fragile]{what years do I have for China?}
\protect\hypertarget{what-years-do-i-have-for-china}{}

China started recording in 1995, which is at least part of the problem:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{tb3 }\OperatorTok{%>%}\StringTok{ }\KeywordTok{filter}\NormalTok{(iso2}\OperatorTok{==}\StringTok{"CN"}\NormalTok{) }\OperatorTok{%>%}\StringTok{ }
\StringTok{  }\KeywordTok{count}\NormalTok{(year, }\DataTypeTok{wt=}\NormalTok{freq)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 14 x 2
##     year      n
##    <dbl>  <dbl>
##  1  1995 131194
##  2  1996 168270
##  3  1997 195895
##  4  1998 214404
##  5  1999 212258
##  6  2000 213766
##  7  2001 212766
##  8  2002 194972
##  9  2003 267280
## 10  2004 384886
## 11  2005 472719
## 12  2006 468291
## 13  2007 465877
## 14  2008 462596
\end{verbatim}

\end{frame}

\begin{frame}[fragile]{first year of recording for each country?}
\protect\hypertarget{first-year-of-recording-for-each-country}{}

\begin{itemize}
\tightlist
\item
  A lot of countries started recording in about 1995:
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{tb3 }\OperatorTok{%>%}\StringTok{ }\KeywordTok{group_by}\NormalTok{(iso2) }\OperatorTok{%>%}\StringTok{ }
\StringTok{  }\KeywordTok{summarize}\NormalTok{(}\DataTypeTok{first_year=}\KeywordTok{min}\NormalTok{(year)) }\OperatorTok{%>%}\StringTok{ }
\StringTok{  }\KeywordTok{arrange}\NormalTok{(first_year)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 213 x 2
##    iso2  first_year
##    <chr>      <dbl>
##  1 CA          1980
##  2 CK          1980
##  3 FJ          1994
##  4 MN          1994
##  5 AL          1995
##  6 AM          1995
##  7 AO          1995
##  8 AT          1995
##  9 AZ          1995
## 10 BA          1995
## # … with 203 more rows
\end{verbatim}

\end{frame}

\begin{frame}[fragile]{Some Toronto weather data}
\protect\hypertarget{some-toronto-weather-data}{}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{my_url <-}\StringTok{ }
\StringTok{  "http://ritsokiguess.site/STAC32/toronto_weather.csv"}
\NormalTok{weather <-}\StringTok{ }\KeywordTok{read_csv}\NormalTok{(my_url)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Parsed with column specification:
## cols(
##   .default = col_double(),
##   station = col_character(),
##   Month = col_character(),
##   element = col_character()
## )
\end{verbatim}

\begin{verbatim}
## See spec(...) for full column specifications.
\end{verbatim}

\end{frame}

\begin{frame}[fragile]{The data (some)}
\protect\hypertarget{the-data-some-2}{}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{weather}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 24 x 35
##    station  Year Month element   d01   d02   d03
##    <chr>   <dbl> <chr> <chr>   <dbl> <dbl> <dbl>
##  1 TORONT…  2018 01    tmax     -7.9  -7.1  -5.3
##  2 TORONT…  2018 01    tmin    -18.6 -12.5 -11.2
##  3 TORONT…  2018 02    tmax      5.6  -8.6   0.4
##  4 TORONT…  2018 02    tmin     -8.9 -15    -9.7
##  5 TORONT…  2018 03    tmax     NA    NA    NA  
##  6 TORONT…  2018 03    tmin     NA    -0.5  NA  
##  7 TORONT…  2018 04    tmax      4.5   6.5   5  
##  8 TORONT…  2018 04    tmin     -2.6  -1.2   2.4
##  9 TORONT…  2018 05    tmax     23.5  26.3  23  
## 10 TORONT…  2018 05    tmin      8.5  14.4  11.4
## # … with 14 more rows, and 28 more variables:
## #   d04 <dbl>, d05 <dbl>, d06 <dbl>, d07 <dbl>,
## #   d08 <dbl>, d09 <dbl>, d10 <dbl>, d11 <dbl>,
## #   d12 <dbl>, d13 <dbl>, d14 <dbl>, d15 <dbl>,
## #   d16 <dbl>, d17 <dbl>, d18 <dbl>, d19 <dbl>,
## #   d20 <dbl>, d21 <dbl>, d22 <dbl>, d23 <dbl>,
## #   d24 <dbl>, d25 <dbl>, d26 <dbl>, d27 <dbl>,
## #   d28 <dbl>, d29 <dbl>, d30 <dbl>, d31 <dbl>
\end{verbatim}

\end{frame}

\begin{frame}[fragile]{The columns}
\protect\hypertarget{the-columns}{}

\begin{itemize}
\item
  Daily weather records for ``Toronto City'' weather station in 2018:

  \begin{itemize}
  \tightlist
  \item
    \emph{station}: identifier for this weather station (always same
    here)
  \item
    \emph{Year}, \emph{Month}: obvious
  \item
    \emph{element}: whether temperature given was daily max or daily min
  \item
    \emph{d01, d02},\ldots{} \emph{d31}: day of the month from 1st to
    31st.
  \end{itemize}
\item
  Numbers in data frame all temperatures (for different days of the
  month), so first step is
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{weather }\OperatorTok{%>%}\StringTok{ }
\StringTok{  }\KeywordTok{pivot_longer}\NormalTok{(d01}\OperatorTok{:}\NormalTok{d31, }\DataTypeTok{names_to=}\StringTok{"day"}\NormalTok{, }
               \DataTypeTok{values_to=}\StringTok{"temperature"}\NormalTok{, }
               \DataTypeTok{values_drop_na =}\NormalTok{ T) ->}\StringTok{ }\NormalTok{d}
\end{Highlighting}
\end{Shaded}

\end{frame}

\begin{frame}[fragile]{So far}
\protect\hypertarget{so-far}{}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{d}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 703 x 6
##    station      Year Month element day   temperature
##    <chr>       <dbl> <chr> <chr>   <chr>       <dbl>
##  1 TORONTO CI…  2018 01    tmax    d01          -7.9
##  2 TORONTO CI…  2018 01    tmax    d02          -7.1
##  3 TORONTO CI…  2018 01    tmax    d03          -5.3
##  4 TORONTO CI…  2018 01    tmax    d04          -7.7
##  5 TORONTO CI…  2018 01    tmax    d05         -14.7
##  6 TORONTO CI…  2018 01    tmax    d06         -15.4
##  7 TORONTO CI…  2018 01    tmax    d07          -1  
##  8 TORONTO CI…  2018 01    tmax    d08           3  
##  9 TORONTO CI…  2018 01    tmax    d09           1.6
## 10 TORONTO CI…  2018 01    tmax    d10           5.9
## # … with 693 more rows
\end{verbatim}

\end{frame}

\begin{frame}[fragile]{The days}
\protect\hypertarget{the-days}{}

\begin{itemize}
\tightlist
\item
  Column \texttt{element} contains names of two different variables,
  that should each be in separate column.
\item
  Distinct from eg. \texttt{m1524} in tuberculosis data, that contained
  levels of two different factors, handled by separate.
\item
  Untangling names of variables handled by \texttt{pivot\_wider}:
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{weather }\OperatorTok{%>%}
\StringTok{  }\KeywordTok{pivot_longer}\NormalTok{(d01}\OperatorTok{:}\NormalTok{d31, }\DataTypeTok{names_to=}\StringTok{"day"}\NormalTok{, }
               \DataTypeTok{values_to=}\StringTok{"temperature"}\NormalTok{, }
               \DataTypeTok{values_drop_na =}\NormalTok{ T) }\OperatorTok{%>%}\StringTok{ }
\StringTok{  }\KeywordTok{pivot_wider}\NormalTok{(}\DataTypeTok{names_from=}\NormalTok{element, }
                \DataTypeTok{values_from=}\NormalTok{temperature) ->}\StringTok{ }\NormalTok{d}
\end{Highlighting}
\end{Shaded}

\end{frame}

\begin{frame}[fragile]{So far}
\protect\hypertarget{so-far-1}{}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{d}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 355 x 6
##    station       Year Month day    tmax  tmin
##    <chr>        <dbl> <chr> <chr> <dbl> <dbl>
##  1 TORONTO CITY  2018 01    d01    -7.9 -18.6
##  2 TORONTO CITY  2018 01    d02    -7.1 -12.5
##  3 TORONTO CITY  2018 01    d03    -5.3 -11.2
##  4 TORONTO CITY  2018 01    d04    -7.7 -19.7
##  5 TORONTO CITY  2018 01    d05   -14.7 -20.6
##  6 TORONTO CITY  2018 01    d06   -15.4 -22.3
##  7 TORONTO CITY  2018 01    d07    -1   -17.5
##  8 TORONTO CITY  2018 01    d08     3    -1.7
##  9 TORONTO CITY  2018 01    d09     1.6  -0.6
## 10 TORONTO CITY  2018 01    d10     5.9  -1.3
## # … with 345 more rows
\end{verbatim}

\end{frame}

\begin{frame}[fragile]{Further improvements}
\protect\hypertarget{further-improvements}{}

\begin{itemize}
\tightlist
\item
  We have tidy data now, but can improve things further.
\item
  \texttt{mutate} creates new columns from old (or assign back to change
  a variable).
\item
  Would like numerical dates. \texttt{separate} works, or pull out
  number as below.
\item
  \texttt{select} keeps columns (or drops, with minus). Station name has
  no value to us:
\end{itemize}

\small

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{weather }\OperatorTok{%>%}
\StringTok{  }\KeywordTok{pivot_longer}\NormalTok{(d01}\OperatorTok{:}\NormalTok{d31, }\DataTypeTok{names_to=}\StringTok{"day"}\NormalTok{, }
               \DataTypeTok{values_to=}\StringTok{"temperature"}\NormalTok{, }\DataTypeTok{values_drop_na =}\NormalTok{ T) }\OperatorTok{%>%}\StringTok{ }
\StringTok{  }\KeywordTok{pivot_wider}\NormalTok{(}\DataTypeTok{names_from=}\NormalTok{element, }\DataTypeTok{values_from=}\NormalTok{temperature) }\OperatorTok{%>%}\StringTok{ }
\StringTok{  }\KeywordTok{mutate}\NormalTok{(}\DataTypeTok{Day =} \KeywordTok{parse_number}\NormalTok{(day)) }\OperatorTok{%>%}
\StringTok{  }\KeywordTok{select}\NormalTok{(}\OperatorTok{-}\NormalTok{station) ->}\StringTok{ }\NormalTok{d}
\end{Highlighting}
\end{Shaded}

\normalsize

\end{frame}

\begin{frame}[fragile]{So far}
\protect\hypertarget{so-far-2}{}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{d}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 355 x 6
##     Year Month day    tmax  tmin   Day
##    <dbl> <chr> <chr> <dbl> <dbl> <dbl>
##  1  2018 01    d01    -7.9 -18.6     1
##  2  2018 01    d02    -7.1 -12.5     2
##  3  2018 01    d03    -5.3 -11.2     3
##  4  2018 01    d04    -7.7 -19.7     4
##  5  2018 01    d05   -14.7 -20.6     5
##  6  2018 01    d06   -15.4 -22.3     6
##  7  2018 01    d07    -1   -17.5     7
##  8  2018 01    d08     3    -1.7     8
##  9  2018 01    d09     1.6  -0.6     9
## 10  2018 01    d10     5.9  -1.3    10
## # … with 345 more rows
\end{verbatim}

\end{frame}

\begin{frame}[fragile]{Final step(s)}
\protect\hypertarget{final-steps}{}

\begin{itemize}
\tightlist
\item
  Make year-month-day into proper date.
\item
  Keep only date, tmax, tmin: \small
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{weather }\OperatorTok{%>%}
\StringTok{  }\KeywordTok{pivot_longer}\NormalTok{(d01}\OperatorTok{:}\NormalTok{d31, }\DataTypeTok{names_to=}\StringTok{"day"}\NormalTok{, }
               \DataTypeTok{values_to=}\StringTok{"temperature"}\NormalTok{, }\DataTypeTok{values_drop_na =}\NormalTok{ T) }\OperatorTok{%>%}\StringTok{ }
\StringTok{  }\KeywordTok{pivot_wider}\NormalTok{(}\DataTypeTok{names_from=}\NormalTok{element, }\DataTypeTok{values_from=}\NormalTok{temperature) }\OperatorTok{%>%}\StringTok{ }
\StringTok{  }\KeywordTok{mutate}\NormalTok{(}\DataTypeTok{Day =} \KeywordTok{parse_number}\NormalTok{(day)) }\OperatorTok{%>%}
\StringTok{  }\KeywordTok{select}\NormalTok{(}\OperatorTok{-}\NormalTok{station) }\OperatorTok{%>%}\StringTok{ }
\StringTok{  }\KeywordTok{unite}\NormalTok{(datestr, }\KeywordTok{c}\NormalTok{(Year, Month, Day), }\DataTypeTok{sep =} \StringTok{"-"}\NormalTok{) }\OperatorTok{%>%}
\StringTok{  }\KeywordTok{mutate}\NormalTok{(}\DataTypeTok{date =} \KeywordTok{as.Date}\NormalTok{(datestr)) }\OperatorTok{%>%}
\StringTok{  }\KeywordTok{select}\NormalTok{(}\KeywordTok{c}\NormalTok{(date, tmax, tmin)) ->}\StringTok{ }\NormalTok{weather_tidy}
\end{Highlighting}
\end{Shaded}

\normalsize

\end{frame}

\begin{frame}[fragile]{Our tidy data frame}
\protect\hypertarget{our-tidy-data-frame}{}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{weather_tidy}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 355 x 3
##    date        tmax  tmin
##    <date>     <dbl> <dbl>
##  1 2018-01-01  -7.9 -18.6
##  2 2018-01-02  -7.1 -12.5
##  3 2018-01-03  -5.3 -11.2
##  4 2018-01-04  -7.7 -19.7
##  5 2018-01-05 -14.7 -20.6
##  6 2018-01-06 -15.4 -22.3
##  7 2018-01-07  -1   -17.5
##  8 2018-01-08   3    -1.7
##  9 2018-01-09   1.6  -0.6
## 10 2018-01-10   5.9  -1.3
## # … with 345 more rows
\end{verbatim}

\end{frame}

\begin{frame}[fragile]{Plotting the temperatures}
\protect\hypertarget{plotting-the-temperatures}{}

\begin{itemize}
\tightlist
\item
  Plot temperature against date joined by lines, but with separate lines
  for max and min. \texttt{ggplot} requires something like
\end{itemize}

\footnotesize

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{ggplot}\NormalTok{(..., }\KeywordTok{aes}\NormalTok{(}\DataTypeTok{x =}\NormalTok{ date, }\DataTypeTok{y =}\NormalTok{ temperature)) }\OperatorTok{+}\StringTok{ }\KeywordTok{geom_point}\NormalTok{() }\OperatorTok{+}\StringTok{ }
\StringTok{  }\KeywordTok{geom_line}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\normalsize

only we have two temperatures, one a max and one a min, that we want to
keep separate.

\begin{itemize}
\tightlist
\item
  The trick: combine \texttt{tmax} and \texttt{tmin} together into one
  column, keeping track of what kind of temp they are. (This actually
  same format as untidy \texttt{weather}.) Are making
  \texttt{weather\_tidy} untidy for purposes of drawing graph only.
\item
  Then can do something like
\end{itemize}

\footnotesize

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{ggplot}\NormalTok{(d, }\KeywordTok{aes}\NormalTok{(}\DataTypeTok{x =}\NormalTok{ date, }\DataTypeTok{y =}\NormalTok{ temperature, }\DataTypeTok{colour =}\NormalTok{ maxmin)) }
  \OperatorTok{+}\StringTok{ }\KeywordTok{geom_point}\NormalTok{() }\OperatorTok{+}\StringTok{ }\KeywordTok{geom_line}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\normalsize

to distinguish max and min on graph.

\end{frame}

\begin{frame}[fragile]{Setting up plot}
\protect\hypertarget{setting-up-plot}{}

\begin{itemize}
\tightlist
\item
  Since we only need data frame for plot, we can do the column-creation
  and plot in a pipeline.
\item
  For a \texttt{ggplot} in a pipeline, the initial data frame is
  omitted, because it is whatever came out of the previous step.
\item
  To make those ``one column''s: \texttt{pivot\_longer}. I save the
  graph to show overleaf:
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{weather_tidy }\OperatorTok{%>%}
\StringTok{  }\KeywordTok{pivot_longer}\NormalTok{(tmax}\OperatorTok{:}\NormalTok{tmin, }\DataTypeTok{names_to=}\StringTok{"maxmin"}\NormalTok{, }
               \DataTypeTok{values_to=}\StringTok{"temperature"}\NormalTok{) }\OperatorTok{%>%}
\StringTok{  }\KeywordTok{mutate}\NormalTok{(}\DataTypeTok{temperature =} \KeywordTok{as.numeric}\NormalTok{(temperature)) }\OperatorTok{%>%}
\StringTok{  }\KeywordTok{ggplot}\NormalTok{(}\KeywordTok{aes}\NormalTok{(}\DataTypeTok{x =}\NormalTok{ date, }\DataTypeTok{y =}\NormalTok{ temperature, }\DataTypeTok{colour =}\NormalTok{ maxmin)) }\OperatorTok{+}
\StringTok{  }\KeywordTok{geom_line}\NormalTok{() ->}\StringTok{ }\NormalTok{g}
\end{Highlighting}
\end{Shaded}

\end{frame}

\begin{frame}[fragile]{The plot}
\protect\hypertarget{the-plot}{}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{g}
\end{Highlighting}
\end{Shaded}

\begin{figure}
\centering
\includegraphics{figure/unnamed-chunk-204-1.pdf}
\caption{plot of chunk unnamed-chunk-204}
\end{figure}

\end{frame}

\begin{frame}{Summary of tidying ``verbs''}
\protect\hypertarget{summary-of-tidying-verbs}{}

\begin{tabular}{lp{0.55\textwidth}}
    Verb & Purpose\\
    \hline
    \texttt{pivot\_longer} (\texttt{gather}) & Combine columns that measure same thing into one\\
    \texttt{pivot\_wider} (\texttt{spread}) & Take column that measures one thing under
                     different conditions and put into multiple columns\\
    \texttt{separate} & Turn a column that encodes
                        several variables into
                        several columns\\
    \texttt{unite} & Combine several (related) variables into one
                     ``combination'' variable\\
    \hline
  \end{tabular}

\texttt{pivot\_longer} (\textt{gather}) and \texttt{pivot\_wider}
(\texttt{spread}) are opposites; \texttt{separate} and \texttt{unite}
are opposites.

\end{frame}

\begin{frame}[fragile]{Doing things with data frames}
\protect\hypertarget{doing-things-with-data-frames}{}

Let's go back to our Australian athletes:

\begin{verbatim}
## Parsed with column specification:
## cols(
##   Sex = col_character(),
##   Sport = col_character(),
##   RCC = col_double(),
##   WCC = col_double(),
##   Hc = col_double(),
##   Hg = col_double(),
##   Ferr = col_double(),
##   BMI = col_double(),
##   SSF = col_double(),
##   `%Bfat` = col_double(),
##   LBM = col_double(),
##   Ht = col_double(),
##   Wt = col_double()
## )
\end{verbatim}

\footnotesize

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{athletes}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 202 x 13
##    Sex    Sport    RCC   WCC    Hc    Hg  Ferr   BMI
##    <chr>  <chr>  <dbl> <dbl> <dbl> <dbl> <dbl> <dbl>
##  1 female Netba…  4.56  13.3  42.2  13.6    20  19.2
##  2 female Netba…  4.15   6    38    12.7    59  21.2
##  3 female Netba…  4.16   7.6  37.5  12.3    22  21.4
##  4 female Netba…  4.32   6.4  37.7  12.3    30  21.0
##  5 female Netba…  4.06   5.8  38.7  12.8    78  21.8
##  6 female Netba…  4.12   6.1  36.6  11.8    21  21.4
##  7 female Netba…  4.17   5    37.4  12.7   109  21.5
##  8 female Netba…  3.8    6.6  36.5  12.4   102  24.4
##  9 female Netba…  3.96   5.5  36.3  12.4    71  22.6
## 10 female Netba…  4.44   9.7  41.4  14.1    64  22.8
## # … with 192 more rows, and 5 more variables:
## #   SSF <dbl>, `%Bfat` <dbl>, LBM <dbl>, Ht <dbl>,
## #   Wt <dbl>
\end{verbatim}

\normalsize

\end{frame}

\begin{frame}[fragile]{Choosing a column}
\protect\hypertarget{choosing-a-column}{}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{athletes }\OperatorTok{%>%}\StringTok{ }\KeywordTok{select}\NormalTok{(Sport)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 202 x 1
##    Sport  
##    <chr>  
##  1 Netball
##  2 Netball
##  3 Netball
##  4 Netball
##  5 Netball
##  6 Netball
##  7 Netball
##  8 Netball
##  9 Netball
## 10 Netball
## # … with 192 more rows
\end{verbatim}

\end{frame}

\begin{frame}[fragile]{Choosing several columns}
\protect\hypertarget{choosing-several-columns}{}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{athletes }\OperatorTok{%>%}\StringTok{ }\KeywordTok{select}\NormalTok{(Sport, Hg, BMI)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 202 x 3
##    Sport      Hg   BMI
##    <chr>   <dbl> <dbl>
##  1 Netball  13.6  19.2
##  2 Netball  12.7  21.2
##  3 Netball  12.3  21.4
##  4 Netball  12.3  21.0
##  5 Netball  12.8  21.8
##  6 Netball  11.8  21.4
##  7 Netball  12.7  21.5
##  8 Netball  12.4  24.4
##  9 Netball  12.4  22.6
## 10 Netball  14.1  22.8
## # … with 192 more rows
\end{verbatim}

\end{frame}

\begin{frame}[fragile]{Choosing consecutive columns}
\protect\hypertarget{choosing-consecutive-columns}{}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{athletes }\OperatorTok{%>%}\StringTok{ }\KeywordTok{select}\NormalTok{(Sex}\OperatorTok{:}\NormalTok{WCC)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 202 x 4
##    Sex    Sport     RCC   WCC
##    <chr>  <chr>   <dbl> <dbl>
##  1 female Netball  4.56  13.3
##  2 female Netball  4.15   6  
##  3 female Netball  4.16   7.6
##  4 female Netball  4.32   6.4
##  5 female Netball  4.06   5.8
##  6 female Netball  4.12   6.1
##  7 female Netball  4.17   5  
##  8 female Netball  3.8    6.6
##  9 female Netball  3.96   5.5
## 10 female Netball  4.44   9.7
## # … with 192 more rows
\end{verbatim}

\end{frame}

\begin{frame}[fragile]{Choosing all-but some columns}
\protect\hypertarget{choosing-all-but-some-columns}{}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{athletes }\OperatorTok{%>%}\StringTok{ }\KeywordTok{select}\NormalTok{(}\OperatorTok{-}\NormalTok{(RCC}\OperatorTok{:}\NormalTok{LBM))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 202 x 4
##    Sex    Sport      Ht    Wt
##    <chr>  <chr>   <dbl> <dbl>
##  1 female Netball  177.  59.9
##  2 female Netball  173.  63  
##  3 female Netball  176   66.3
##  4 female Netball  170.  60.7
##  5 female Netball  183   72.9
##  6 female Netball  178.  67.9
##  7 female Netball  177.  67.5
##  8 female Netball  174.  74.1
##  9 female Netball  174.  68.2
## 10 female Netball  174.  68.8
## # … with 192 more rows
\end{verbatim}

\end{frame}

\begin{frame}[fragile]{Select-helpers}
\protect\hypertarget{select-helpers}{}

Other ways to select columns:

\begin{itemize}
\tightlist
\item
  \texttt{starts\_with} something
\item
  \texttt{ends\_with} something
\item
  \texttt{contains} something
\item
  \texttt{matches} a ``regular expression''
\item
  \texttt{num\_range} like x1 to x3
\item
  \texttt{everything()} all the columns
\end{itemize}

\end{frame}

\begin{frame}[fragile]{Columns whose names begin with S}
\protect\hypertarget{columns-whose-names-begin-with-s}{}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{athletes }\OperatorTok{%>%}\StringTok{ }\KeywordTok{select}\NormalTok{(}\KeywordTok{starts_with}\NormalTok{(}\StringTok{"S"}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 202 x 3
##    Sex    Sport     SSF
##    <chr>  <chr>   <dbl>
##  1 female Netball  49  
##  2 female Netball 110. 
##  3 female Netball  89  
##  4 female Netball  98.3
##  5 female Netball 122. 
##  6 female Netball  90.4
##  7 female Netball 107. 
##  8 female Netball 157. 
##  9 female Netball 101. 
## 10 female Netball 126. 
## # … with 192 more rows
\end{verbatim}

\end{frame}

\begin{frame}[fragile]{Columns whose names end with C}
\protect\hypertarget{columns-whose-names-end-with-c}{}

either uppercase or lowercase:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{athletes }\OperatorTok{%>%}\StringTok{ }\KeywordTok{select}\NormalTok{(}\KeywordTok{ends_with}\NormalTok{(}\StringTok{"c"}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 202 x 3
##      RCC   WCC    Hc
##    <dbl> <dbl> <dbl>
##  1  4.56  13.3  42.2
##  2  4.15   6    38  
##  3  4.16   7.6  37.5
##  4  4.32   6.4  37.7
##  5  4.06   5.8  38.7
##  6  4.12   6.1  36.6
##  7  4.17   5    37.4
##  8  3.8    6.6  36.5
##  9  3.96   5.5  36.3
## 10  4.44   9.7  41.4
## # … with 192 more rows
\end{verbatim}

\end{frame}

\begin{frame}[fragile]{Column names containing letter R}
\protect\hypertarget{column-names-containing-letter-r}{}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{athletes }\OperatorTok{%>%}\StringTok{ }\KeywordTok{select}\NormalTok{(}\KeywordTok{contains}\NormalTok{(}\StringTok{"r"}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 202 x 3
##    Sport     RCC  Ferr
##    <chr>   <dbl> <dbl>
##  1 Netball  4.56    20
##  2 Netball  4.15    59
##  3 Netball  4.16    22
##  4 Netball  4.32    30
##  5 Netball  4.06    78
##  6 Netball  4.12    21
##  7 Netball  4.17   109
##  8 Netball  3.8    102
##  9 Netball  3.96    71
## 10 Netball  4.44    64
## # … with 192 more rows
\end{verbatim}

\end{frame}

\begin{frame}[fragile]{Exactly two characters, ending with T}
\protect\hypertarget{exactly-two-characters-ending-with-t}{}

In regular expression terms, this is \texttt{\^{}.t\$}:

\begin{itemize}
\tightlist
\item
  \texttt{\^{}} means ``start of text''
\item
  \texttt{.} means ``exactly one character, but could be anything''
\item
  \texttt{\$} means ``end of text''.
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{athletes }\OperatorTok{%>%}\StringTok{ }\KeywordTok{select}\NormalTok{(}\KeywordTok{matches}\NormalTok{(}\StringTok{"^.t$"}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 202 x 2
##       Ht    Wt
##    <dbl> <dbl>
##  1  177.  59.9
##  2  173.  63  
##  3  176   66.3
##  4  170.  60.7
##  5  183   72.9
##  6  178.  67.9
##  7  177.  67.5
##  8  174.  74.1
##  9  174.  68.2
## 10  174.  68.8
## # … with 192 more rows
\end{verbatim}

\end{frame}

\begin{frame}[fragile]{Displaying some numbered columns}
\protect\hypertarget{displaying-some-numbered-columns}{}

Make up a data frame to illustrate. This \texttt{sample} generates 5
random values equally likely to be anything 0--9 (without replacement):

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(d <-}\StringTok{ }\KeywordTok{tibble}\NormalTok{(}
  \DataTypeTok{y =} \KeywordTok{sample}\NormalTok{(}\DecValTok{0}\OperatorTok{:}\DecValTok{9}\NormalTok{, }\DecValTok{5}\NormalTok{),}
  \DataTypeTok{x1 =} \KeywordTok{sample}\NormalTok{(}\DecValTok{0}\OperatorTok{:}\DecValTok{9}\NormalTok{, }\DecValTok{5}\NormalTok{),}
  \DataTypeTok{x2 =} \KeywordTok{sample}\NormalTok{(}\DecValTok{0}\OperatorTok{:}\DecValTok{9}\NormalTok{, }\DecValTok{5}\NormalTok{),}
  \DataTypeTok{x3 =} \KeywordTok{sample}\NormalTok{(}\DecValTok{0}\OperatorTok{:}\DecValTok{9}\NormalTok{, }\DecValTok{5}\NormalTok{)}
\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 5 x 4
##       y    x1    x2    x3
##   <int> <int> <int> <int>
## 1     6     3     2     0
## 2     3     7     1     8
## 3     5     9     6     7
## 4     9     0     3     2
## 5     4     2     4     6
\end{verbatim}

\end{frame}

\begin{frame}[fragile]{Just display x2 and x3:}
\protect\hypertarget{just-display-x2-and-x3}{}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{d }\OperatorTok{%>%}\StringTok{ }\KeywordTok{select}\NormalTok{(}\KeywordTok{num_range}\NormalTok{(}\StringTok{"x"}\NormalTok{, }\DecValTok{2}\OperatorTok{:}\DecValTok{3}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 5 x 2
##      x2    x3
##   <int> <int>
## 1     2     0
## 2     1     8
## 3     6     7
## 4     3     2
## 5     4     6
\end{verbatim}

\end{frame}

\begin{frame}[fragile]{Choosing rows by number}
\protect\hypertarget{choosing-rows-by-number}{}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{athletes }\OperatorTok{%>%}\StringTok{ }\KeywordTok{slice}\NormalTok{(}\DecValTok{16}\OperatorTok{:}\DecValTok{25}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 10 x 13
##    Sex    Sport    RCC   WCC    Hc    Hg  Ferr   BMI
##    <chr>  <chr>  <dbl> <dbl> <dbl> <dbl> <dbl> <dbl>
##  1 female Netba…  4.25  10.7  39.5  13.2   127  24.5
##  2 female Netba…  4.46  10.9  39.7  13.7   102  24.0
##  3 female Netba…  4.4    9.3  40.4  13.6    86  26.2
##  4 female Netba…  4.83   8.4  41.8  13.4    40  20.0
##  5 female Netba…  4.23   6.9  38.3  12.6    50  25.7
##  6 female Netba…  4.24   8.4  37.6  12.5    58  25.6
##  7 female Netba…  3.95   6.6  38.4  12.8    33  19.9
##  8 female Netba…  4.03   8.5  37.7  13      51  23.4
##  9 female BBall   3.96   7.5  37.5  12.3    60  20.6
## 10 female BBall   4.41   8.3  38.2  12.7    68  20.7
## # … with 5 more variables: SSF <dbl>,
## #   `%Bfat` <dbl>, LBM <dbl>, Ht <dbl>, Wt <dbl>
\end{verbatim}

\end{frame}

\begin{frame}[fragile]{Non-consecutive rows}
\protect\hypertarget{non-consecutive-rows}{}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{athletes }\OperatorTok{%>%}\StringTok{ }\KeywordTok{slice}\NormalTok{(}\KeywordTok{c}\NormalTok{(}\DecValTok{10}\NormalTok{, }\DecValTok{13}\NormalTok{, }\DecValTok{17}\NormalTok{, }\DecValTok{42}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 4 x 13
##   Sex    Sport     RCC   WCC    Hc    Hg  Ferr   BMI
##   <chr>  <chr>   <dbl> <dbl> <dbl> <dbl> <dbl> <dbl>
## 1 female Netball  4.44   9.7  41.4  14.1    64  22.8
## 2 female Netball  4.02   9.1  37.7  12.7   107  23.0
## 3 female Netball  4.46  10.9  39.7  13.7   102  24.0
## 4 female Row      4.37   8.1  41.8  14.3    53  23.5
## # … with 5 more variables: SSF <dbl>,
## #   `%Bfat` <dbl>, LBM <dbl>, Ht <dbl>, Wt <dbl>
\end{verbatim}

\end{frame}

\begin{frame}[fragile]{A random sample of rows}
\protect\hypertarget{a-random-sample-of-rows}{}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{athletes }\OperatorTok{%>%}\StringTok{ }\KeywordTok{sample_n}\NormalTok{(}\DecValTok{8}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 8 x 13
##   Sex    Sport     RCC   WCC    Hc    Hg  Ferr   BMI
##   <chr>  <chr>   <dbl> <dbl> <dbl> <dbl> <dbl> <dbl>
## 1 female Netball  4.02   9.1  37.7  12.7   107  23.0
## 2 male   T400m    4.5    6.1  42.2  14.7   139  19.6
## 3 female Row      4.87   7.3  44.1  14.8    13  22.6
## 4 male   T400m    5.49   5.9  47.7  15.9    66  22.3
## 5 female Swim     4.23   8.1  38.2  12.7    22  25.2
## 6 female Netball  4.4    9.3  40.4  13.6    86  26.2
## 7 female Netball  4.83   8.4  41.8  13.4    40  20.0
## 8 female BBall    4.71   5.3  41.4  14      38  25.8
## # … with 5 more variables: SSF <dbl>,
## #   `%Bfat` <dbl>, LBM <dbl>, Ht <dbl>, Wt <dbl>
\end{verbatim}

\end{frame}

\begin{frame}[fragile]{Rows for which something is true}
\protect\hypertarget{rows-for-which-something-is-true}{}

\footnotesize

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{athletes }\OperatorTok{%>%}\StringTok{ }\KeywordTok{filter}\NormalTok{(Sport }\OperatorTok{==}\StringTok{ "Tennis"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 11 x 13
##    Sex    Sport    RCC   WCC    Hc    Hg  Ferr   BMI
##    <chr>  <chr>  <dbl> <dbl> <dbl> <dbl> <dbl> <dbl>
##  1 female Tennis  4      4.2  36.6  12      57  25.4
##  2 female Tennis  4.4    4    40.8  13.9    73  22.1
##  3 female Tennis  4.38   7.9  39.8  13.5    88  21.2
##  4 female Tennis  4.08   6.6  37.8  12.1   182  20.5
##  5 female Tennis  4.98   6.4  44.8  14.8    80  17.1
##  6 female Tennis  5.16   7.2  44.3  14.5    88  18.3
##  7 female Tennis  4.66   6.4  40.9  13.9   109  18.4
##  8 male   Tennis  5.66   8.3  50.2  17.7    38  23.8
##  9 male   Tennis  5.03   6.4  42.7  14.3   122  22.0
## 10 male   Tennis  4.97   8.8  43    14.9   233  22.3
## 11 male   Tennis  5.38   6.3  46    15.7    32  21.1
## # … with 5 more variables: SSF <dbl>,
## #   `%Bfat` <dbl>, LBM <dbl>, Ht <dbl>, Wt <dbl>
\end{verbatim}

\normalsize

\end{frame}

\begin{frame}[fragile]{More complicated selections}
\protect\hypertarget{more-complicated-selections}{}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{athletes }\OperatorTok{%>%}\StringTok{ }\KeywordTok{filter}\NormalTok{(Sport }\OperatorTok{==}\StringTok{ "Tennis"}\NormalTok{, RCC }\OperatorTok{<}\StringTok{ }\DecValTok{5}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 7 x 13
##   Sex    Sport    RCC   WCC    Hc    Hg  Ferr   BMI
##   <chr>  <chr>  <dbl> <dbl> <dbl> <dbl> <dbl> <dbl>
## 1 female Tennis  4      4.2  36.6  12      57  25.4
## 2 female Tennis  4.4    4    40.8  13.9    73  22.1
## 3 female Tennis  4.38   7.9  39.8  13.5    88  21.2
## 4 female Tennis  4.08   6.6  37.8  12.1   182  20.5
## 5 female Tennis  4.98   6.4  44.8  14.8    80  17.1
## 6 female Tennis  4.66   6.4  40.9  13.9   109  18.4
## 7 male   Tennis  4.97   8.8  43    14.9   233  22.3
## # … with 5 more variables: SSF <dbl>,
## #   `%Bfat` <dbl>, LBM <dbl>, Ht <dbl>, Wt <dbl>
\end{verbatim}

\end{frame}

\begin{frame}[fragile]{Either/Or}
\protect\hypertarget{eitheror}{}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{athletes }\OperatorTok{%>%}\StringTok{ }\KeywordTok{filter}\NormalTok{(Sport }\OperatorTok{==}\StringTok{ "Tennis"} \OperatorTok{|}\StringTok{ }\NormalTok{RCC }\OperatorTok{>}\StringTok{ }\DecValTok{5}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 66 x 13
##    Sex    Sport    RCC   WCC    Hc    Hg  Ferr   BMI
##    <chr>  <chr>  <dbl> <dbl> <dbl> <dbl> <dbl> <dbl>
##  1 female Row     5.02   6.4  44.8  15.2    48  19.8
##  2 female T400m   5.31   9.5  47.1  15.9    29  21.4
##  3 female Field   5.33   9.3  47    15      62  25.3
##  4 female TSprnt  5.16   8.2  45.3  14.7    34  20.3
##  5 female Tennis  4      4.2  36.6  12      57  25.4
##  6 female Tennis  4.4    4    40.8  13.9    73  22.1
##  7 female Tennis  4.38   7.9  39.8  13.5    88  21.2
##  8 female Tennis  4.08   6.6  37.8  12.1   182  20.5
##  9 female Tennis  4.98   6.4  44.8  14.8    80  17.1
## 10 female Tennis  5.16   7.2  44.3  14.5    88  18.3
## # … with 56 more rows, and 5 more variables:
## #   SSF <dbl>, `%Bfat` <dbl>, LBM <dbl>, Ht <dbl>,
## #   Wt <dbl>
\end{verbatim}

\end{frame}

\begin{frame}[fragile]{Sorting into order}
\protect\hypertarget{sorting-into-order}{}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{athletes }\OperatorTok{%>%}\StringTok{ }\KeywordTok{arrange}\NormalTok{(RCC)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 202 x 13
##    Sex    Sport    RCC   WCC    Hc    Hg  Ferr   BMI
##    <chr>  <chr>  <dbl> <dbl> <dbl> <dbl> <dbl> <dbl>
##  1 female Netba…  3.8    6.6  36.5  12.4   102  24.4
##  2 female Netba…  3.9    6.3  35.9  12.1    78  20.1
##  3 female T400m   3.9    6    38.9  13.5    16  19.4
##  4 female Row     3.91   7.3  37.6  12.9    43  22.3
##  5 female Netba…  3.95   6.6  38.4  12.8    33  19.9
##  6 female Row     3.95   3.3  36.9  12.5    40  24.5
##  7 female Netba…  3.96   5.5  36.3  12.4    71  22.6
##  8 female BBall   3.96   7.5  37.5  12.3    60  20.6
##  9 female Tennis  4      4.2  36.6  12      57  25.4
## 10 female Netba…  4.02   9.1  37.7  12.7   107  23.0
## # … with 192 more rows, and 5 more variables:
## #   SSF <dbl>, `%Bfat` <dbl>, LBM <dbl>, Ht <dbl>,
## #   Wt <dbl>
\end{verbatim}

\end{frame}

\begin{frame}[fragile]{Breaking ties by another variable}
\protect\hypertarget{breaking-ties-by-another-variable}{}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{athletes }\OperatorTok{%>%}\StringTok{ }\KeywordTok{arrange}\NormalTok{(RCC, BMI)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 202 x 13
##    Sex    Sport    RCC   WCC    Hc    Hg  Ferr   BMI
##    <chr>  <chr>  <dbl> <dbl> <dbl> <dbl> <dbl> <dbl>
##  1 female Netba…  3.8    6.6  36.5  12.4   102  24.4
##  2 female T400m   3.9    6    38.9  13.5    16  19.4
##  3 female Netba…  3.9    6.3  35.9  12.1    78  20.1
##  4 female Row     3.91   7.3  37.6  12.9    43  22.3
##  5 female Netba…  3.95   6.6  38.4  12.8    33  19.9
##  6 female Row     3.95   3.3  36.9  12.5    40  24.5
##  7 female BBall   3.96   7.5  37.5  12.3    60  20.6
##  8 female Netba…  3.96   5.5  36.3  12.4    71  22.6
##  9 female Tennis  4      4.2  36.6  12      57  25.4
## 10 female Netba…  4.02   9.1  37.7  12.7   107  23.0
## # … with 192 more rows, and 5 more variables:
## #   SSF <dbl>, `%Bfat` <dbl>, LBM <dbl>, Ht <dbl>,
## #   Wt <dbl>
\end{verbatim}

\end{frame}

\begin{frame}[fragile]{Descending order}
\protect\hypertarget{descending-order}{}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{athletes }\OperatorTok{%>%}\StringTok{ }\KeywordTok{arrange}\NormalTok{(}\KeywordTok{desc}\NormalTok{(BMI))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 202 x 13
##    Sex    Sport   RCC   WCC    Hc    Hg  Ferr   BMI
##    <chr>  <chr> <dbl> <dbl> <dbl> <dbl> <dbl> <dbl>
##  1 male   Field  5.48   6.2  48.2  16.3    94  34.4
##  2 male   Field  4.96   8.3  45.3  15.7   141  33.7
##  3 male   Field  5.48   4.6  49.4  18     132  32.5
##  4 female Field  4.75   7.5  43.8  15.2    90  31.9
##  5 male   Field  5.01   8.9  46    15.9   212  30.2
##  6 male   Field  5.01   8.9  46    15.9   212  30.2
##  7 male   Field  5.09   8.9  46.3  15.4    44  30.0
##  8 female Field  4.58   5.8  42.1  14.7   164  28.6
##  9 female Field  4.51   9    39.7  14.3    36  28.1
## 10 male   WPolo  5.34   6.2  49.8  17.2   143  27.8
## # … with 192 more rows, and 5 more variables:
## #   SSF <dbl>, `%Bfat` <dbl>, LBM <dbl>, Ht <dbl>,
## #   Wt <dbl>
\end{verbatim}

\end{frame}

\begin{frame}[fragile]{``The top ones''}
\protect\hypertarget{the-top-ones}{}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{athletes }\OperatorTok{%>%}
\StringTok{  }\KeywordTok{arrange}\NormalTok{(}\KeywordTok{desc}\NormalTok{(Wt)) }\OperatorTok{%>%}
\StringTok{  }\KeywordTok{slice}\NormalTok{(}\DecValTok{1}\OperatorTok{:}\DecValTok{7}\NormalTok{) }\OperatorTok{%>%}
\StringTok{  }\KeywordTok{select}\NormalTok{(Sport, Wt)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 7 x 2
##   Sport    Wt
##   <chr> <dbl>
## 1 Field  123.
## 2 BBall  114.
## 3 Field  111.
## 4 Field  108.
## 5 Field  103.
## 6 WPolo  101 
## 7 BBall  100.
\end{verbatim}

\end{frame}

\begin{frame}[fragile]{Create new variables from old ones}
\protect\hypertarget{create-new-variables-from-old-ones}{}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{athletes }\OperatorTok{%>%}
\StringTok{  }\KeywordTok{mutate}\NormalTok{(}\DataTypeTok{wt_lb =}\NormalTok{ Wt }\OperatorTok{*}\StringTok{ }\FloatTok{2.2}\NormalTok{) }\OperatorTok{%>%}
\StringTok{  }\KeywordTok{select}\NormalTok{(Sport, Wt, wt_lb)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 202 x 3
##    Sport      Wt wt_lb
##    <chr>   <dbl> <dbl>
##  1 Netball  59.9  132.
##  2 Netball  63    139.
##  3 Netball  66.3  146.
##  4 Netball  60.7  134.
##  5 Netball  72.9  160.
##  6 Netball  67.9  149.
##  7 Netball  67.5  148.
##  8 Netball  74.1  163.
##  9 Netball  68.2  150.
## 10 Netball  68.8  151.
## # … with 192 more rows
\end{verbatim}

\end{frame}

\begin{frame}[fragile]{Turning the result into a number}
\protect\hypertarget{turning-the-result-into-a-number}{}

Output is always data frame unless you explicitly turn it into something
else, eg. the weight of the heaviest athlete, as a number:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{athletes }\OperatorTok{%>%}\StringTok{ }\KeywordTok{arrange}\NormalTok{(}\KeywordTok{desc}\NormalTok{(Wt)) }\OperatorTok{%>%}\StringTok{ }\KeywordTok{pluck}\NormalTok{(}\StringTok{"Wt"}\NormalTok{, }\DecValTok{1}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 123.2
\end{verbatim}

Or the 20 heaviest weights in descending order:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{athletes }\OperatorTok{%>%}
\StringTok{  }\KeywordTok{arrange}\NormalTok{(}\KeywordTok{desc}\NormalTok{(Wt)) }\OperatorTok{%>%}
\StringTok{  }\KeywordTok{slice}\NormalTok{(}\DecValTok{1}\OperatorTok{:}\DecValTok{20}\NormalTok{) }\OperatorTok{%>%}
\StringTok{  }\KeywordTok{pluck}\NormalTok{(}\StringTok{"Wt"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##  [1] 123.20 113.70 111.30 108.20 102.70 101.00
##  [7] 100.20  98.00  97.90  97.90  97.00  96.90
## [13]  96.30  94.80  94.80  94.70  94.70  94.60
## [19]  94.25  94.20
\end{verbatim}

\end{frame}

\begin{frame}[fragile]{Another way to do the last one}
\protect\hypertarget{another-way-to-do-the-last-one}{}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{athletes }\OperatorTok{%>%}
\StringTok{  }\KeywordTok{arrange}\NormalTok{(}\KeywordTok{desc}\NormalTok{(Wt)) }\OperatorTok{%>%}
\StringTok{  }\KeywordTok{slice}\NormalTok{(}\DecValTok{1}\OperatorTok{:}\DecValTok{20}\NormalTok{) }\OperatorTok{%>%}
\StringTok{  }\KeywordTok{pull}\NormalTok{(}\StringTok{"Wt"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##  [1] 123.20 113.70 111.30 108.20 102.70 101.00
##  [7] 100.20  98.00  97.90  97.90  97.00  96.90
## [13]  96.30  94.80  94.80  94.70  94.70  94.60
## [19]  94.25  94.20
\end{verbatim}

\texttt{pull} grabs the column you name \emph{as a vector} (of whatever
it contains).

\end{frame}

\begin{frame}[fragile]{To find the mean height of the women athletes}
\protect\hypertarget{to-find-the-mean-height-of-the-women-athletes}{}

Two ways:

\small

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{athletes }\OperatorTok{%>%}\StringTok{ }\KeywordTok{group_by}\NormalTok{(Sex) }\OperatorTok{%>%}\StringTok{ }\KeywordTok{summarize}\NormalTok{(}\DataTypeTok{m =} \KeywordTok{mean}\NormalTok{(Ht))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 2 x 2
##   Sex        m
##   <chr>  <dbl>
## 1 female  175.
## 2 male    186.
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{athletes }\OperatorTok{%>%}
\StringTok{  }\KeywordTok{filter}\NormalTok{(Sex }\OperatorTok{==}\StringTok{ "female"}\NormalTok{) }\OperatorTok{%>%}
\StringTok{  }\KeywordTok{summarize}\NormalTok{(}\DataTypeTok{m =} \KeywordTok{mean}\NormalTok{(Ht))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 1 x 1
##       m
##   <dbl>
## 1  175.
\end{verbatim}

\normalsize

\end{frame}

\begin{frame}{Summary of data selection/arrangement ``verbs''}
\protect\hypertarget{summary-of-data-selectionarrangement-verbs}{}

\begin{tabular}{lp{0.7\textwidth}}
    Verb & Purpose\\
    \hline
    \texttt{select} & Choose columns\\
    \texttt{print} & Display non-default \# of rows/columns \\
    \texttt{slice} & Choose rows by number\\
    \texttt{sample\_n} & Choose random rows\\ 
    \texttt{filter} & Choose rows satisfying conditions \\
    \texttt{arrange}& Sort in order by column(s) \\
    \texttt{mutate} & Create new variables\\
    \texttt{group\_by} & Create groups to summarize by\\
    \texttt{summarize} & Calculate summary statistics (by groups if defined)\\
    \texttt{pluck} & Extract items from data frame\\
    \texttt{pull} & Extract a single column from a data frame as a vector\\
    \hline
  \end{tabular}

\end{frame}

\begin{frame}[fragile]{Looking things up in another data frame}
\protect\hypertarget{looking-things-up-in-another-data-frame}{}

Recall the tuberculosis data set, tidied:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{tb3}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 35,750 x 5
##    iso2   year gender age    freq
##    <chr> <dbl> <chr>  <chr> <dbl>
##  1 AD     1996 m      014       0
##  2 AD     1996 m      1524      0
##  3 AD     1996 m      2534      0
##  4 AD     1996 m      3544      4
##  5 AD     1996 m      4554      1
##  6 AD     1996 m      5564      0
##  7 AD     1996 m      65        0
##  8 AD     1996 f      014       0
##  9 AD     1996 f      1524      1
## 10 AD     1996 f      2534      1
## # … with 35,740 more rows
\end{verbatim}

What are actual names of those countries in \texttt{iso2}?

\end{frame}

\begin{frame}[fragile]{Actual country names}
\protect\hypertarget{actual-country-names}{}

Found actual country names to go with those abbreviations, in
spreadsheet:

\footnotesize

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{my_url <-}\StringTok{ }
\StringTok{  "http://www.utsc.utoronto.ca/~butler/c32/ISOCountryCodes081507.xlsx"}
\end{Highlighting}
\end{Shaded}

\normalsize

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{f <-}\StringTok{ }\KeywordTok{tempfile}\NormalTok{()}
\KeywordTok{download.file}\NormalTok{(my_url, f)}
\NormalTok{country_names <-}\StringTok{ }\KeywordTok{read_excel}\NormalTok{(f)}
\end{Highlighting}
\end{Shaded}

\end{frame}

\begin{frame}[fragile]{The country names}
\protect\hypertarget{the-country-names}{}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{country_names}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 252 x 3
##    Code  Code_UC Country             
##    <chr> <chr>   <chr>               
##  1 ad    AD      Andorra             
##  2 ae    AE      United Arab Emirates
##  3 af    AF      Afghanistan         
##  4 ag    AG      Antigua and Barbuda 
##  5 ai    AI      Anguilla            
##  6 al    AL      Albania             
##  7 am    AM      Armenia             
##  8 an    AN      Netherlands Antilles
##  9 ao    AO      Angola              
## 10 aq    AQ      Antarctica          
## # … with 242 more rows
\end{verbatim}

\end{frame}

\begin{frame}[fragile]{Looking up country codes}
\protect\hypertarget{looking-up-country-codes}{}

Matching a variable in one data frame to one in another is called a
\textbf{join} (database terminology):

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{tb3 }\OperatorTok{%>%}\StringTok{ }\KeywordTok{left_join}\NormalTok{(country_names, }\DataTypeTok{by =} \KeywordTok{c}\NormalTok{(}\StringTok{"iso2"}\NormalTok{ =}\StringTok{ "Code_UC"}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 35,750 x 7
##    iso2   year gender age    freq Code  Country
##    <chr> <dbl> <chr>  <chr> <dbl> <chr> <chr>  
##  1 AD     1996 m      014       0 ad    Andorra
##  2 AD     1996 m      1524      0 ad    Andorra
##  3 AD     1996 m      2534      0 ad    Andorra
##  4 AD     1996 m      3544      4 ad    Andorra
##  5 AD     1996 m      4554      1 ad    Andorra
##  6 AD     1996 m      5564      0 ad    Andorra
##  7 AD     1996 m      65        0 ad    Andorra
##  8 AD     1996 f      014       0 ad    Andorra
##  9 AD     1996 f      1524      1 ad    Andorra
## 10 AD     1996 f      2534      1 ad    Andorra
## # … with 35,740 more rows
\end{verbatim}

\end{frame}

\begin{frame}[fragile]{Total cases by country}
\protect\hypertarget{total-cases-by-country}{}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{tb3 }\OperatorTok{%>%}
\StringTok{  }\KeywordTok{group_by}\NormalTok{(iso2) }\OperatorTok{%>%}
\StringTok{  }\KeywordTok{summarize}\NormalTok{(}\DataTypeTok{cases =} \KeywordTok{sum}\NormalTok{(freq)) }\OperatorTok{%>%}
\StringTok{  }\KeywordTok{left_join}\NormalTok{(country_names, }\DataTypeTok{by =} \KeywordTok{c}\NormalTok{(}\StringTok{"iso2"}\NormalTok{ =}\StringTok{ "Code_UC"}\NormalTok{)) }\OperatorTok{%>%}
\StringTok{  }\KeywordTok{select}\NormalTok{(Country, cases)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 213 x 2
##    Country               cases
##    <chr>                 <dbl>
##  1 Andorra                  64
##  2 United Arab Emirates    487
##  3 Afghanistan           80005
##  4 Antigua and Barbuda      21
##  5 Anguilla                  1
##  6 Albania                2467
##  7 Armenia                6757
##  8 Netherlands Antilles     81
##  9 Angola               195512
## 10 Argentina             64894
## # … with 203 more rows
\end{verbatim}

\end{frame}

\begin{frame}[fragile]{or even sorted in order}
\protect\hypertarget{or-even-sorted-in-order}{}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{tb3 }\OperatorTok{%>%}
\StringTok{  }\KeywordTok{group_by}\NormalTok{(iso2) }\OperatorTok{%>%}
\StringTok{  }\KeywordTok{summarize}\NormalTok{(}\DataTypeTok{cases =} \KeywordTok{sum}\NormalTok{(freq)) }\OperatorTok{%>%}
\StringTok{  }\KeywordTok{left_join}\NormalTok{(country_names, }\DataTypeTok{by =} \KeywordTok{c}\NormalTok{(}\StringTok{"iso2"}\NormalTok{ =}\StringTok{ "Code_UC"}\NormalTok{)) }\OperatorTok{%>%}
\StringTok{  }\KeywordTok{select}\NormalTok{(Country, cases) }\OperatorTok{%>%}
\StringTok{  }\KeywordTok{arrange}\NormalTok{(}\KeywordTok{desc}\NormalTok{(cases))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 213 x 2
##    Country        cases
##    <chr>          <dbl>
##  1 China        4065174
##  2 India        3966169
##  3 Indonesia    1129015
##  4 South Africa  900349
##  5 Bangladesh    758008
##  6 Vietnam       709695
##  7 <NA>          603095
##  8 Philippines   490040
##  9 Brazil        440609
## 10 Kenya         431523
## # … with 203 more rows
\end{verbatim}

\end{frame}

\begin{frame}[fragile]{Comments}
\protect\hypertarget{comments-11}{}

\begin{itemize}
\tightlist
\item
  This is probably not quite right because of:

  \begin{itemize}
  \tightlist
  \item
    the 1994-1995 thing
  \item
    there is at least one country in \texttt{tb3} that was not in
    \texttt{country\_names} (the NA above). Which?
  \end{itemize}
\end{itemize}

\footnotesize

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{tb3 }\OperatorTok{%>%}
\StringTok{  }\KeywordTok{anti_join}\NormalTok{(country_names, }\DataTypeTok{by =} \KeywordTok{c}\NormalTok{(}\StringTok{"iso2"}\NormalTok{ =}\StringTok{ "Code_UC"}\NormalTok{)) }\OperatorTok{%>%}
\StringTok{  }\KeywordTok{distinct}\NormalTok{(iso2)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 6 x 1
##   iso2 
##   <chr>
## 1 CD   
## 2 ME   
## 3 <NA> 
## 4 PS   
## 5 RS   
## 6 TL
\end{verbatim}

\normalsize

\end{frame}

\hypertarget{case-study-1-the-windmill-data}{%
\section{Case study 1: the windmill
data}\label{case-study-1-the-windmill-data}}

\begin{frame}{The windmill data}
\protect\hypertarget{the-windmill-data}{}

\begin{itemize}
\tightlist
\item
  Engineer: does amount of electricity generated by windmill depend on
  how strongly wind blowing?
\item
  Measurements of wind speed and DC current generated at various times.
\item
  Assume the ``various times'' to be randomly selected --- aim to
  generalize to ``this windmill at all times''.
\item
  Research questions:

  \begin{itemize}
  \tightlist
  \item
    Relationship between wind speed and current generated?
  \item
    If so, what kind of relationship?
  \item
    Can we model relationship to do predictions?
  \end{itemize}
\end{itemize}

\end{frame}

\begin{frame}[fragile]{Packages for this section}
\protect\hypertarget{packages-for-this-section-5}{}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{library}\NormalTok{(tidyverse)}
\KeywordTok{library}\NormalTok{(broom)}
\end{Highlighting}
\end{Shaded}

\end{frame}

\begin{frame}[fragile]{Reading in the data}
\protect\hypertarget{reading-in-the-data}{}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{my_url <-}\StringTok{ "http://www.utsc.utoronto.ca/~butler/c32/windmill.csv"}
\NormalTok{windmill <-}\StringTok{ }\KeywordTok{read_csv}\NormalTok{(my_url)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Parsed with column specification:
## cols(
##   wind_velocity = col_double(),
##   DC_output = col_double()
## )
\end{verbatim}

\end{frame}

\begin{frame}[fragile]{The data}
\protect\hypertarget{the-data-5}{}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{windmill}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 25 x 2
##    wind_velocity DC_output
##            <dbl>     <dbl>
##  1          5        1.58 
##  2          6        1.82 
##  3          3.4      1.06 
##  4          2.7      0.5  
##  5         10        2.24 
##  6          9.7      2.39 
##  7          9.55     2.29 
##  8          3.05     0.558
##  9          8.15     2.17 
## 10          6.2      1.87 
## # … with 15 more rows
\end{verbatim}

\end{frame}

\begin{frame}[fragile]{Strategy}
\protect\hypertarget{strategy}{}

\begin{itemize}
\tightlist
\item
  Two quantitative variables, looking for relationship: regression
  methods.
\item
  Start with picture (scatterplot).
\item
  Fit models and do model checking, fixing up things as necessary.
\item
  Scatterplot:

  \begin{itemize}
  \tightlist
  \item
    2 variables, \texttt{DC\_output} and \texttt{wind\_velocity}.
  \item
    First is output/response, other is input/explanatory.
  \item
    Put \texttt{DC\_output} on vertical scale.
  \end{itemize}
\item
  Add trend, but don't want to assume linear.
\end{itemize}

\end{frame}

\begin{frame}[fragile]{Scatterplot}
\protect\hypertarget{scatterplot}{}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{ggplot}\NormalTok{(windmill, }\KeywordTok{aes}\NormalTok{(}\DataTypeTok{y =}\NormalTok{ DC_output, }\DataTypeTok{x =}\NormalTok{ wind_velocity)) }\OperatorTok{+}
\StringTok{  }\KeywordTok{geom_point}\NormalTok{() }\OperatorTok{+}\StringTok{ }\KeywordTok{geom_smooth}\NormalTok{(}\DataTypeTok{method=}\StringTok{"lm"}\NormalTok{, }\DataTypeTok{se=}\OtherTok{FALSE}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{figure}
\centering
\includegraphics{figure/unnamed-chunk-240-1.pdf}
\caption{plot of chunk unnamed-chunk-240}
\end{figure}

\end{frame}

\begin{frame}[fragile]{Comments}
\protect\hypertarget{comments-12}{}

\begin{itemize}
\tightlist
\item
  Definitely a relationship: as wind velocity increases, so does DC
  output. (As you'd expect.)
\item
  Is relationship linear? To help judge, \texttt{geom\_smooth} smooths
  scatterplot trend. (Trend called ``loess'', ``Locally weighted least
  squares'' which downweights outliers. Not constrained to be straight.)
\item
  Trend more or less linear for while, then curves downwards (levelling
  off?). Straight line not so good here.
\end{itemize}

\end{frame}

\begin{frame}[fragile]{Fit a straight line (and see what happens)}
\protect\hypertarget{fit-a-straight-line-and-see-what-happens}{}

\footnotesize

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{DC}\FloatTok{.1}\NormalTok{ <-}\StringTok{ }\KeywordTok{lm}\NormalTok{(DC_output }\OperatorTok{~}\StringTok{ }\NormalTok{wind_velocity, }\DataTypeTok{data =}\NormalTok{ windmill)}
\KeywordTok{summary}\NormalTok{(DC}\FloatTok{.1}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## 
## Call:
## lm(formula = DC_output ~ wind_velocity, data = windmill)
## 
## Residuals:
##      Min       1Q   Median       3Q      Max 
## -0.59869 -0.14099  0.06059  0.17262  0.32184 
## 
## Coefficients:
##               Estimate Std. Error t value Pr(>|t|)    
## (Intercept)    0.13088    0.12599   1.039     0.31    
## wind_velocity  0.24115    0.01905  12.659 7.55e-12 ***
## ---
## Signif. codes:  
## 0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
## 
## Residual standard error: 0.2361 on 23 degrees of freedom
## Multiple R-squared:  0.8745, Adjusted R-squared:  0.869 
## F-statistic: 160.3 on 1 and 23 DF,  p-value: 7.546e-12
\end{verbatim}

\normalsize

\end{frame}

\begin{frame}[fragile]{Another way of looking at the output}
\protect\hypertarget{another-way-of-looking-at-the-output}{}

\begin{itemize}
\tightlist
\item
  The standard output tends to go off the bottom of the page rather
  easily. Package \texttt{broom} has these:
\end{itemize}

\footnotesize

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{glance}\NormalTok{(DC}\FloatTok{.1}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 1 x 11
##   r.squared adj.r.squared sigma statistic  p.value
##       <dbl>         <dbl> <dbl>     <dbl>    <dbl>
## 1     0.874         0.869 0.236      160. 7.55e-12
## # … with 6 more variables: df <int>, logLik <dbl>,
## #   AIC <dbl>, BIC <dbl>, deviance <dbl>,
## #   df.residual <int>
\end{verbatim}

\normalsize

showing that the R-squared is 87\%, and

\footnotesize

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{tidy}\NormalTok{(DC}\FloatTok{.1}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 2 x 5
##   term         estimate std.error statistic  p.value
##   <chr>           <dbl>     <dbl>     <dbl>    <dbl>
## 1 (Intercept)     0.131    0.126       1.04 3.10e- 1
## 2 wind_veloci…    0.241    0.0190     12.7  7.55e-12
\end{verbatim}

\normalsize

showing the intercept and slope and their significance.

\end{frame}

\begin{frame}[fragile]{Comments}
\protect\hypertarget{comments-14}{}

\begin{itemize}
\tightlist
\item
  Strategy: \texttt{lm} actually fits the regression. Store results in a
  variable. Then look at the results, eg. via \texttt{summary} or
  \texttt{glance}/\texttt{tidy}.
\item
  My strategy for model names: base on response variable and a number.
  Allows me to fit several models to same data and keep track of which
  is which.
\item
  Results actually pretty good: \texttt{wind.velocity} strongly
  significant, R-squared (87\%) high.
\item
  How to check whether regression is appropriate? Look at the residuals,
  observed minus predicted, plotted against fitted (predicted).
\item
  Plot using the regression object as ``data frame'' (see over).
\end{itemize}

\end{frame}

\begin{frame}[fragile]{Plot of residuals against fitted values}
\protect\hypertarget{plot-of-residuals-against-fitted-values}{}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{ggplot}\NormalTok{(DC}\FloatTok{.1}\NormalTok{, }\KeywordTok{aes}\NormalTok{(}\DataTypeTok{y =}\NormalTok{ .resid, }\DataTypeTok{x =}\NormalTok{ .fitted)) }\OperatorTok{+}\StringTok{ }\KeywordTok{geom_point}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{figure}
\centering
\includegraphics{figure/unnamed-chunk-246-1.pdf}
\caption{plot of chunk unnamed-chunk-246}
\end{figure}

\end{frame}

\begin{frame}{Comments on residual plot}
\protect\hypertarget{comments-on-residual-plot}{}

\begin{itemize}
\tightlist
\item
  Residual plot should be a random scatter of points.
\item
  Should be no pattern ``left over'' after fitting the regression.
\item
  Smooth trend should be more or less straight across at 0.
\item
  Here, have a curved trend on residual plot.
\item
  This means original relationship must have been a curve (as we saw on
  original scatterplot).
\item
  Possible ways to fit a curve:

  \begin{itemize}
  \tightlist
  \item
    Add a squared term in explanatory variable.
  \item
    Transform response variable (doesn't work well here).
  \item
    See what science tells you about mathematical form of relationship,
    and try to apply.
  \end{itemize}
\end{itemize}

\end{frame}

\begin{frame}[fragile]{Parabolas and fitting parabola model}
\protect\hypertarget{parabolas-and-fitting-parabola-model}{}

\begin{itemize}
\tightlist
\item
  A parabola has equation \[y = ax^2 + bx + c\] with coefficients
  \(a, b, c\). About the simplest function that is not a straight line.
\item
  Fit one using \texttt{lm} by adding \(x^2\) to right side of model
  formula with +:
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{DC}\FloatTok{.2}\NormalTok{ <-}\StringTok{ }\KeywordTok{lm}\NormalTok{(DC_output }\OperatorTok{~}\StringTok{ }\NormalTok{wind_velocity }\OperatorTok{+}\StringTok{ }\KeywordTok{I}\NormalTok{(wind_velocity}\OperatorTok{^}\DecValTok{2}\NormalTok{),}
  \DataTypeTok{data =}\NormalTok{ windmill}
\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{summary}\NormalTok{(DC}\FloatTok{.2}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## 
## Call:
## lm(formula = DC_output ~ wind_velocity + I(wind_velocity^2), 
##     data = windmill)
## 
## Residuals:
##      Min       1Q   Median       3Q      Max 
## -0.26347 -0.02537  0.01264  0.03908  0.19903 
## 
## Coefficients:
##                     Estimate Std. Error t value
## (Intercept)        -1.155898   0.174650  -6.618
## wind_velocity       0.722936   0.061425  11.769
## I(wind_velocity^2) -0.038121   0.004797  -7.947
##                    Pr(>|t|)    
## (Intercept)        1.18e-06 ***
## wind_velocity      5.77e-11 ***
## I(wind_velocity^2) 6.59e-08 ***
## ---
## Signif. codes:  
## 0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
## 
## Residual standard error: 0.1227 on 22 degrees of freedom
## Multiple R-squared:  0.9676, Adjusted R-squared:  0.9646 
## F-statistic: 328.3 on 2 and 22 DF,  p-value: < 2.2e-16
\end{verbatim}

\begin{itemize}
\tightlist
\item
  The \texttt{I()} necessary because \texttt{\^{}} in model formula
  otherwise means something different (to do with interactions in
  ANOVA).
\item
  This actually \emph{multiple regression}.
\item
  Call it \emph{parabola model}.
\end{itemize}

\end{frame}

\begin{frame}[fragile]{Parabola model output}
\protect\hypertarget{parabola-model-output}{}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{tidy}\NormalTok{(DC}\FloatTok{.2}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 3 x 5
##   term         estimate std.error statistic  p.value
##   <chr>           <dbl>     <dbl>     <dbl>    <dbl>
## 1 (Intercept)   -1.16     0.175       -6.62 1.18e- 6
## 2 wind_veloci…   0.723    0.0614      11.8  5.77e-11
## 3 I(wind_velo…  -0.0381   0.00480     -7.95 6.59e- 8
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{glance}\NormalTok{(DC}\FloatTok{.2}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 1 x 11
##   r.squared adj.r.squared sigma statistic  p.value
##       <dbl>         <dbl> <dbl>     <dbl>    <dbl>
## 1     0.968         0.965 0.123      328. 4.16e-17
## # … with 6 more variables: df <int>, logLik <dbl>,
## #   AIC <dbl>, BIC <dbl>, deviance <dbl>,
## #   df.residual <int>
\end{verbatim}

\end{frame}

\begin{frame}{Comments on output}
\protect\hypertarget{comments-on-output}{}

\begin{itemize}
\tightlist
\item
  R-squared has gone up a lot, from 87\% (line) to 97\% (parabola).
\item
  Coefficient of squared term strongly significant (P-value
  \(6.59 \times 10^{−8}\)).
\item
  Adding squared term has definitely improved fit of model.
\item
  Parabola model better than linear one.
\item
  But\ldots need to check residuals again.
\end{itemize}

\end{frame}

\begin{frame}[fragile]{Residual plot from parabola model}
\protect\hypertarget{residual-plot-from-parabola-model}{}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{ggplot}\NormalTok{(DC}\FloatTok{.2}\NormalTok{, }\KeywordTok{aes}\NormalTok{(}\DataTypeTok{y =}\NormalTok{ .resid, }\DataTypeTok{x =}\NormalTok{ .fitted)) }\OperatorTok{+}
\StringTok{  }\KeywordTok{geom_point}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{figure}
\centering
\includegraphics{figure/unnamed-chunk-251-1.pdf}
\caption{plot of chunk unnamed-chunk-251}
\end{figure}

\end{frame}

\begin{frame}[fragile]{Scatterplot with fitted line and curve}
\protect\hypertarget{scatterplot-with-fitted-line-and-curve}{}

\begin{itemize}
\tightlist
\item
  Residual plot basically random. Good.
\item
  Scatterplot with fitted line and curve like this:
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{ggplot}\NormalTok{(windmill, }\KeywordTok{aes}\NormalTok{(}\DataTypeTok{y =}\NormalTok{ DC_output, }\DataTypeTok{x =}\NormalTok{ wind_velocity)) }\OperatorTok{+}
\StringTok{  }\KeywordTok{geom_point}\NormalTok{() }\OperatorTok{+}\StringTok{ }\KeywordTok{geom_smooth}\NormalTok{(}\DataTypeTok{method =} \StringTok{"lm"}\NormalTok{, }\DataTypeTok{se =}\NormalTok{ F) }\OperatorTok{+}
\StringTok{  }\KeywordTok{geom_line}\NormalTok{(}\DataTypeTok{data =}\NormalTok{ DC}\FloatTok{.2}\NormalTok{, }\KeywordTok{aes}\NormalTok{(}\DataTypeTok{y =}\NormalTok{ .fitted))}
\end{Highlighting}
\end{Shaded}

\end{frame}

\begin{frame}[fragile]{Comments}
\protect\hypertarget{comments-15}{}

\begin{itemize}
\tightlist
\item
  This plots:

  \begin{itemize}
  \tightlist
  \item
    scatterplot (\texttt{geom\_point});
  \item
    straight line (via tweak to \texttt{geom\_smooth}, which draws
    best-fitting line);
  \item
    fitted curve, using the predicted \texttt{DC\_output} values, joined
    by lines (with points not shown).
  \end{itemize}
\item
  Trick in the \texttt{geom\_line} is use the predictions as the
  \texttt{y}-points to join by lines (from \texttt{DC.2}), instead of
  the original data points. Without the \texttt{data} and \texttt{aes}
  in the \texttt{geom\_line}, original data points would be joined by
  lines.
\end{itemize}

\end{frame}

\begin{frame}{Scatterplot with fitted line and curve}
\protect\hypertarget{scatterplot-with-fitted-line-and-curve-1}{}

\begin{figure}
\centering
\includegraphics{figure/unnamed-chunk-252-1.pdf}
\caption{plot of chunk unnamed-chunk-252}
\end{figure}

Curve clearly fits better than line.

\end{frame}

\begin{frame}{Another approach to a curve}
\protect\hypertarget{another-approach-to-a-curve}{}

\begin{itemize}
\tightlist
\item
  There is a problem with parabolas, which we'll see later.
\item
  Go back to engineer with findings so far. Ask, ``what should happen as
  wind velocity increases?'':
\end{itemize}

\begin{quote}
Upper limit on electricity generated, but otherwise, the larger the wind
velocity, the more electricity generated.
\end{quote}

\begin{itemize}
\tightlist
\item
  Mathematically, sounds like asymptote. Straight lines and parabolas
  don't have them, but eg. \(y = 1/x\) does: as \(x\) gets bigger, \(y\)
  approaches zero without reaching it.
\item
  What happens to \(y = a + b(1/x)\) as \(x\) gets large?

  \begin{itemize}
  \tightlist
  \item
    \(y\) gets closer and closer to \(a\): that is, \(a\) is asymptote.
  \end{itemize}
\item
  Fit this, call it asymptote model.
\item
  Fitting the model here because we have math to justify it.
\item
  Alternative, \(y = a + be^{−x}\) , approaches asymptote faster.
\end{itemize}

\end{frame}

\begin{frame}[fragile]{How to fit asymptote model?}
\protect\hypertarget{how-to-fit-asymptote-model}{}

\begin{itemize}
\tightlist
\item
  Define new explanatory variable to be \(1/x\), and predict \(y\) from
  it.
\item
  \(x\) is velocity, distance over time.
\item
  So \(1/x\) is time over distance. In walking world, if you walk 5
  km/h, take 12 minutes to walk 1 km, called your pace. So 1 over
  \texttt{wind\_velocity} we call \texttt{wind\_pace}.
\item
  Make a scatterplot first to check for straightness (next page).
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{windmill }\OperatorTok{%>%}\StringTok{ }\KeywordTok{mutate}\NormalTok{(}\DataTypeTok{wind_pace =} \DecValTok{1} \OperatorTok{/}\StringTok{ }\NormalTok{wind_velocity) ->}\StringTok{ }\NormalTok{windmill}
\KeywordTok{ggplot}\NormalTok{(windmill, }\KeywordTok{aes}\NormalTok{(}\DataTypeTok{y =}\NormalTok{ DC_output, }\DataTypeTok{x =}\NormalTok{ wind_pace)) }\OperatorTok{+}
\StringTok{  }\KeywordTok{geom_point}\NormalTok{() }\OperatorTok{+}\StringTok{ }\KeywordTok{geom_smooth}\NormalTok{(}\DataTypeTok{se =}\NormalTok{ F)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## `geom_smooth()` using method = 'loess' and formula 'y ~ x'
\end{verbatim}

\begin{itemize}
\tightlist
\item
  and run regression like this (output page after):
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{DC}\FloatTok{.3}\NormalTok{ <-}\StringTok{ }\KeywordTok{lm}\NormalTok{(DC_output }\OperatorTok{~}\StringTok{ }\NormalTok{wind_pace, }\DataTypeTok{data =}\NormalTok{ windmill)}
\end{Highlighting}
\end{Shaded}

\end{frame}

\begin{frame}[fragile]{Scatterplot for wind\_pace}
\protect\hypertarget{scatterplot-for-wind_pace}{}

Pretty straight. Blue actually smooth curve not line:

\begin{verbatim}
## `geom_smooth()` using method = 'loess' and formula 'y ~ x'
\end{verbatim}

\begin{figure}
\centering
\includegraphics{figure/unnamed-chunk-253-1.pdf}
\caption{plot of chunk unnamed-chunk-253}
\end{figure}

\end{frame}

\begin{frame}[fragile]{Regression output}
\protect\hypertarget{regression-output}{}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{glance}\NormalTok{(DC}\FloatTok{.3}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 1 x 11
##   r.squared adj.r.squared  sigma statistic  p.value
##       <dbl>         <dbl>  <dbl>     <dbl>    <dbl>
## 1     0.980         0.979 0.0942     1128. 4.74e-21
## # … with 6 more variables: df <int>, logLik <dbl>,
## #   AIC <dbl>, BIC <dbl>, deviance <dbl>,
## #   df.residual <int>
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{tidy}\NormalTok{(DC}\FloatTok{.3}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 2 x 5
##   term        estimate std.error statistic  p.value
##   <chr>          <dbl>     <dbl>     <dbl>    <dbl>
## 1 (Intercept)     2.98    0.0449      66.3 8.92e-28
## 2 wind_pace      -6.93    0.206      -33.6 4.74e-21
\end{verbatim}

\end{frame}

\begin{frame}[fragile]{Comments}
\protect\hypertarget{comments-16}{}

\begin{itemize}
\tightlist
\item
  R-squared, 98\%, even higher than for parabola model (97\%).
\item
  Simpler model, only one explanatory variable (\texttt{wind.pace})
  vs.~2 for parabola model (\texttt{wind.velocity} and its square).
\item
  \texttt{wind.pace} (unsurprisingly) strongly significant.
\item
  Looks good, but check residual plot (over).
\end{itemize}

\end{frame}

\begin{frame}[fragile]{Residual plot for asymptote model}
\protect\hypertarget{residual-plot-for-asymptote-model}{}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{ggplot}\NormalTok{(DC}\FloatTok{.3}\NormalTok{, }\KeywordTok{aes}\NormalTok{(}\DataTypeTok{y =}\NormalTok{ .resid, }\DataTypeTok{x =}\NormalTok{ .fitted)) }\OperatorTok{+}\StringTok{ }\KeywordTok{geom_point}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{figure}
\centering
\includegraphics{figure/resida-1.pdf}
\caption{plot of chunk resida}
\end{figure}

\end{frame}

\begin{frame}[fragile]{Plotting trends on scatterplot}
\protect\hypertarget{plotting-trends-on-scatterplot}{}

\begin{itemize}
\tightlist
\item
  Residual plot not bad. But residuals go up to 0.10 and down to −0.20,
  suggesting possible skewness (not normal). I think it's not perfect,
  but OK overall.
\item
  Next: plot scatterplot with all three fitted lines/curves on it (for
  comparison), with legend saying which is which.
\item
  First make data frame containing what we need, taken from the right
  places:
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{w2 <-}\StringTok{ }\KeywordTok{tibble}\NormalTok{(}
  \DataTypeTok{wind_velocity =}\NormalTok{ windmill}\OperatorTok{$}\NormalTok{wind_velocity,}
  \DataTypeTok{DC_output =}\NormalTok{ windmill}\OperatorTok{$}\NormalTok{DC_output,}
  \DataTypeTok{linear =} \KeywordTok{fitted}\NormalTok{(DC}\FloatTok{.1}\NormalTok{),}
  \DataTypeTok{parabola =} \KeywordTok{fitted}\NormalTok{(DC}\FloatTok{.2}\NormalTok{),}
  \DataTypeTok{asymptote =} \KeywordTok{fitted}\NormalTok{(DC}\FloatTok{.3}\NormalTok{)}
\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\end{frame}

\begin{frame}[fragile]{What's in \texttt{w2}}
\protect\hypertarget{whats-in-w2}{}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{w2}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 25 x 5
##    wind_velocity DC_output linear parabola asymptote
##            <dbl>     <dbl>  <dbl>    <dbl>     <dbl>
##  1          5        1.58   1.34     1.51      1.59 
##  2          6        1.82   1.58     1.81      1.82 
##  3          3.4      1.06   0.951    0.861     0.939
##  4          2.7      0.5    0.782    0.518     0.411
##  5         10        2.24   2.54     2.26      2.29 
##  6          9.7      2.39   2.47     2.27      2.26 
##  7          9.55     2.29   2.43     2.27      2.25 
##  8          3.05     0.558  0.866    0.694     0.705
##  9          8.15     2.17   2.10     2.20      2.13 
## 10          6.2      1.87   1.63     1.86      1.86 
## # … with 15 more rows
\end{verbatim}

\end{frame}

\begin{frame}[fragile]{Making the plot}
\protect\hypertarget{making-the-plot}{}

\begin{itemize}
\tightlist
\item
  \texttt{ggplot} likes to have one column of \(x\)'s to plot, and one
  column of \(y\)'s, with another column for distinguishing things.
\item
  But we have three columns of fitted values, that need to be combined
  into one.
\item
  \texttt{pivot\_longer}, then plot:
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{w2 }\OperatorTok{%>%}
\StringTok{  }\KeywordTok{pivot_longer}\NormalTok{(linear}\OperatorTok{:}\NormalTok{asymptote, }\DataTypeTok{names_to=}\StringTok{"model"}\NormalTok{, }\DataTypeTok{values_to=}\StringTok{"fit"}\NormalTok{) }\OperatorTok{%>%}
\StringTok{  }\KeywordTok{ggplot}\NormalTok{(}\KeywordTok{aes}\NormalTok{(}\DataTypeTok{x =}\NormalTok{ wind_velocity, }\DataTypeTok{y =}\NormalTok{ DC_output)) }\OperatorTok{+}
\StringTok{  }\KeywordTok{geom_point}\NormalTok{() }\OperatorTok{+}
\StringTok{  }\KeywordTok{geom_line}\NormalTok{(}\KeywordTok{aes}\NormalTok{(}\DataTypeTok{y =}\NormalTok{ fit, }\DataTypeTok{colour =}\NormalTok{ model))}
\end{Highlighting}
\end{Shaded}

\end{frame}

\begin{frame}{Scatterplot with fitted curves}
\protect\hypertarget{scatterplot-with-fitted-curves}{}

\begin{figure}
\centering
\includegraphics{figure/unnamed-chunk-257-1.pdf}
\caption{plot of chunk unnamed-chunk-257}
\end{figure}

\end{frame}

\begin{frame}{Comments}
\protect\hypertarget{comments-17}{}

\begin{itemize}
\tightlist
\item
  Predictions from curves are very similar.
\item
  Predictions from asymptote model as good, and from simpler model (one
  \(x\) not two), so prefer those.
\item
  Go back to asymptote model summary.
\end{itemize}

\end{frame}

\begin{frame}[fragile]{Asymptote model summary}
\protect\hypertarget{asymptote-model-summary}{}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{tidy}\NormalTok{(DC}\FloatTok{.3}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 2 x 5
##   term        estimate std.error statistic  p.value
##   <chr>          <dbl>     <dbl>     <dbl>    <dbl>
## 1 (Intercept)     2.98    0.0449      66.3 8.92e-28
## 2 wind_pace      -6.93    0.206      -33.6 4.74e-21
\end{verbatim}

\end{frame}

\begin{frame}[fragile]{Comments}
\protect\hypertarget{comments-18}{}

\begin{itemize}
\tightlist
\item
  Intercept in this model about 3.
\item
  Intercept of asymptote model is the asymptote (upper limit of
  \texttt{DC.output}).
\item
  Not close to asymptote yet.
\item
  Therefore, from this model, wind could get stronger and would generate
  appreciably more electricity.
\item
  This is extrapolation! Would like more data from times when
  \texttt{wind.velocity} higher.
\item
  Slope −7. Why negative?

  \begin{itemize}
  \tightlist
  \item
    As wind.velocity increases,
  \item
    wind.pace goes down,
  \item
    and DC.output goes up. Check.
  \end{itemize}
\item
  Actual slope number hard to interpret.
\end{itemize}

\end{frame}

\begin{frame}{Checking back in with research questions}
\protect\hypertarget{checking-back-in-with-research-questions}{}

\begin{itemize}
\tightlist
\item
  Is there a relationship between wind speed and current generated?

  \begin{itemize}
  \tightlist
  \item
    Yes.
  \end{itemize}
\item
  If so, what kind of relationship is it?

  \begin{itemize}
  \tightlist
  \item
    One with an asymptote.
  \end{itemize}
\item
  Can we model the relationship, in such a way that we can do
  predictions?

  \begin{itemize}
  \tightlist
  \item
    Yes, see model DC.3 and plot of fitted curve.
  \end{itemize}
\item
  Good. Job done.
\end{itemize}

\end{frame}

\begin{frame}[fragile]{Job done, kinda}
\protect\hypertarget{job-done-kinda}{}

\begin{itemize}
\tightlist
\item
  Just because the parabola model and asymptote model agree over the
  range of the data, doesn't necessarily mean they agree everywhere.
\item
  Extend range of wind.velocity to 1 to 16 (steps of 0.5), and predict
  DC.output according to the two models:
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{wv <-}\StringTok{ }\KeywordTok{seq}\NormalTok{(}\DecValTok{1}\NormalTok{, }\DecValTok{16}\NormalTok{, }\FloatTok{0.5}\NormalTok{)}
\NormalTok{wv}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##  [1]  1.0  1.5  2.0  2.5  3.0  3.5  4.0  4.5  5.0
## [10]  5.5  6.0  6.5  7.0  7.5  8.0  8.5  9.0  9.5
## [19] 10.0 10.5 11.0 11.5 12.0 12.5 13.0 13.5 14.0
## [28] 14.5 15.0 15.5 16.0
\end{verbatim}

\begin{itemize}
\tightlist
\item
  R has \texttt{predict}, which requires what to predict for, as data
  frame. The data frame has to contain values, with matching names, for
  all explanatory variables in regression(s).
\end{itemize}

\end{frame}

\begin{frame}[fragile]{Setting up data frame to predict from}
\protect\hypertarget{setting-up-data-frame-to-predict-from}{}

\begin{itemize}
\tightlist
\item
  Linear model had just \texttt{wind\_velocity}.
\item
  Parabola model had that as well (squared one will be calculated)
\item
  Asymptote model had just \texttt{wind\_pace} (reciprocal of velocity).
\item
  So create data frame called \texttt{wv\_new} with those in:
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{wv_new <-}\StringTok{ }\KeywordTok{tibble}\NormalTok{(}\DataTypeTok{wind_velocity =}\NormalTok{ wv, }\DataTypeTok{wind_pace =} \DecValTok{1} \OperatorTok{/}\StringTok{ }\NormalTok{wv)}
\end{Highlighting}
\end{Shaded}

\end{frame}

\begin{frame}[fragile]{\texttt{wv\_new}}
\protect\hypertarget{wv_new}{}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{wv_new}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 31 x 2
##    wind_velocity wind_pace
##            <dbl>     <dbl>
##  1           1       1    
##  2           1.5     0.667
##  3           2       0.5  
##  4           2.5     0.4  
##  5           3       0.333
##  6           3.5     0.286
##  7           4       0.25 
##  8           4.5     0.222
##  9           5       0.2  
## 10           5.5     0.182
## # … with 21 more rows
\end{verbatim}

\end{frame}

\begin{frame}[fragile]{Doing predictions, one for each model}
\protect\hypertarget{doing-predictions-one-for-each-model}{}

\begin{itemize}
\tightlist
\item
  Use same names as before:
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{linear <-}\StringTok{ }\KeywordTok{predict}\NormalTok{(DC}\FloatTok{.1}\NormalTok{, wv_new)}
\NormalTok{parabola <-}\StringTok{ }\KeywordTok{predict}\NormalTok{(DC}\FloatTok{.2}\NormalTok{, wv_new)}
\NormalTok{asymptote <-}\StringTok{ }\KeywordTok{predict}\NormalTok{(DC}\FloatTok{.3}\NormalTok{, wv_new)}
\end{Highlighting}
\end{Shaded}

\begin{itemize}
\tightlist
\item
  Put it all into a data frame for plotting, along with original data:
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{my_fits <-}\StringTok{ }\KeywordTok{tibble}\NormalTok{(}
  \DataTypeTok{wind_velocity =}\NormalTok{ wv_new}\OperatorTok{$}\NormalTok{wind_velocity,}
\NormalTok{  linear, parabola, asymptote}
\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\end{frame}

\begin{frame}[fragile]{\texttt{my\_fits}}
\protect\hypertarget{my_fits}{}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{my_fits}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 31 x 4
##    wind_velocity linear parabola asymptote
##            <dbl>  <dbl>    <dbl>     <dbl>
##  1           1    0.372   -0.471    -3.96 
##  2           1.5  0.493   -0.157    -1.64 
##  3           2    0.613    0.137    -0.488
##  4           2.5  0.734    0.413     0.205
##  5           3    0.854    0.670     0.667
##  6           3.5  0.975    0.907     0.998
##  7           4    1.10     1.13      1.25 
##  8           4.5  1.22     1.33      1.44 
##  9           5    1.34     1.51      1.59 
## 10           5.5  1.46     1.67      1.72 
## # … with 21 more rows
\end{verbatim}

\end{frame}

\begin{frame}[fragile]{Making a plot 1/2}
\protect\hypertarget{making-a-plot-12}{}

\begin{itemize}
\tightlist
\item
  To make a plot, we use the same trick as last time to get all three
  predictions on a plot with a legend (saving result to add to later):
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{my_fits }\OperatorTok{%>%}
\StringTok{    }\KeywordTok{pivot_longer}\NormalTok{(}
\NormalTok{    linear}\OperatorTok{:}\NormalTok{asymptote,}
    \DataTypeTok{names_to=}\StringTok{"model"}\NormalTok{, }
    \DataTypeTok{values_to=}\StringTok{"fit"}
\NormalTok{  ) }\OperatorTok{%>%}
\StringTok{  }\KeywordTok{ggplot}\NormalTok{(}\KeywordTok{aes}\NormalTok{(}
    \DataTypeTok{y =}\NormalTok{ fit, }\DataTypeTok{x =}\NormalTok{ wind_velocity,}
    \DataTypeTok{colour =}\NormalTok{ model}
\NormalTok{  )) }\OperatorTok{+}\StringTok{ }\KeywordTok{geom_line}\NormalTok{() ->}\StringTok{ }\NormalTok{g}
\end{Highlighting}
\end{Shaded}

\end{frame}

\begin{frame}[fragile]{Making a plot 2/2}
\protect\hypertarget{making-a-plot-22}{}

\begin{itemize}
\tightlist
\item
  The observed wind velocities were in this range:
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(vels <-}\StringTok{ }\KeywordTok{range}\NormalTok{(windmill}\OperatorTok{$}\NormalTok{wind_velocity))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1]  2.45 10.20
\end{verbatim}

\begin{itemize}
\tightlist
\item
  \texttt{DC.output} between 0 and 3 from asymptote model. Add rectangle
  to graph around where the data were:
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{g }\OperatorTok{+}\StringTok{ }\KeywordTok{geom_rect}\NormalTok{(}
  \DataTypeTok{xmin =}\NormalTok{ vels[}\DecValTok{1}\NormalTok{], }\DataTypeTok{xmax =}\NormalTok{ vels[}\DecValTok{2}\NormalTok{], }\DataTypeTok{ymin =} \DecValTok{0}\NormalTok{, }\DataTypeTok{ymax =} \DecValTok{3}\NormalTok{,}
  \DataTypeTok{alpha =} \DecValTok{0}\NormalTok{, }\DataTypeTok{colour =} \StringTok{"black"}
\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\end{frame}

\begin{frame}{The plot}
\protect\hypertarget{the-plot-1}{}

\begin{figure}
\centering
\includegraphics{figure/unnamed-chunk-267-1.pdf}
\caption{plot of chunk unnamed-chunk-267}
\end{figure}

\end{frame}

\begin{frame}[fragile]{Comments (1)}
\protect\hypertarget{comments-1-1}{}

\begin{itemize}
\tightlist
\item
  Over range of data, two models agree with each other well.
\item
  Outside range of data, they disagree violently!
\item
  For larger \texttt{wind.velocity}, asymptote model behaves reasonably,
  parabola model does not.
\item
  What happens as \texttt{wind.velocity} goes to zero? Should find
  \texttt{DC.output} goes to zero as well. Does it?
\end{itemize}

\end{frame}

\begin{frame}[fragile]{Comments (2)}
\protect\hypertarget{comments-2-1}{}

\begin{itemize}
\tightlist
\item
  For parabola model:
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{tidy}\NormalTok{(DC}\FloatTok{.2}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 3 x 5
##   term         estimate std.error statistic  p.value
##   <chr>           <dbl>     <dbl>     <dbl>    <dbl>
## 1 (Intercept)   -1.16     0.175       -6.62 1.18e- 6
## 2 wind_veloci…   0.723    0.0614      11.8  5.77e-11
## 3 I(wind_velo…  -0.0381   0.00480     -7.95 6.59e- 8
\end{verbatim}

\begin{itemize}
\tightlist
\item
  Nope, goes to −1.16 (intercept), actually significantly different from
  zero.
\end{itemize}

\end{frame}

\begin{frame}[fragile]{Comments (3): asymptote model}
\protect\hypertarget{comments-3-asymptote-model}{}

\small

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{tidy}\NormalTok{(DC}\FloatTok{.3}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 2 x 5
##   term        estimate std.error statistic  p.value
##   <chr>          <dbl>     <dbl>     <dbl>    <dbl>
## 1 (Intercept)     2.98    0.0449      66.3 8.92e-28
## 2 wind_pace      -6.93    0.206      -33.6 4.74e-21
\end{verbatim}

\normalsize

\begin{itemize}
\tightlist
\item
  As \texttt{wind.velocity} heads to 0, wind.pace heads to \(+\infty\),
  so DC.output heads to \(−\infty\)!
\item
  Also need more data for small \texttt{wind.velocity} to understand
  relationship. (Is there a lower asymptote?)
\item
  Best we can do now is to predict \texttt{DC.output} to be zero for
  small \texttt{wind.velocity}.
\item
  Assumes a ``threshold'' wind velocity below which no electricity
  generated at all.
\end{itemize}

\end{frame}

\begin{frame}{Summary}
\protect\hypertarget{summary}{}

\begin{itemize}
\tightlist
\item
  Often, in data analysis, there is no completely satisfactory
  conclusion, as here.
\item
  Have to settle for model that works OK, with restrictions.
\item
  Always something else you can try.
\item
  At some point you have to say ``I stop.''
\end{itemize}

\end{frame}

\hypertarget{case-study-3-asphalt}{%
\section{Case study 3: Asphalt}\label{case-study-3-asphalt}}

\begin{frame}[fragile]{The asphalt data}
\protect\hypertarget{the-asphalt-data}{}

\begin{itemize}
\tightlist
\item
  31 asphalt pavements prepared under different conditions. How does
  quality of pavement depend on these?
\item
  Variables:

  \begin{itemize}
  \tightlist
  \item
    \texttt{pct.a.surf} The percentage of asphalt in the surface layer
  \item
    \texttt{pct.a.base} The percentage of asphalt in the base layer
  \item
    \texttt{fines} The percentage of fines in the surface layer
  \item
    \texttt{voids} The percentage of voids in the surface layer
  \item
    \texttt{rut.depth} The change in rut depth per million vehicle
    passes
  \item
    \texttt{viscosity} The viscosity of the asphalt
  \item
    \texttt{run} 2 data collection periods: run 1 for run 1, 0 for run
    2.
  \end{itemize}
\item
  \texttt{rut.depth} response. Depends on other variables, how?
\end{itemize}

\end{frame}

\begin{frame}[fragile]{Packages for this section}
\protect\hypertarget{packages-for-this-section-6}{}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{library}\NormalTok{(MASS)}
\KeywordTok{library}\NormalTok{(tidyverse)}
\KeywordTok{library}\NormalTok{(broom)}
\KeywordTok{library}\NormalTok{(leaps)}
\end{Highlighting}
\end{Shaded}

\end{frame}

\begin{frame}[fragile]{Getting set up}
\protect\hypertarget{getting-set-up}{}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{my_url <-}\StringTok{ "http://www.utsc.utoronto.ca/~butler/c32/asphalt.txt"}
\NormalTok{asphalt <-}\StringTok{ }\KeywordTok{read_delim}\NormalTok{(my_url, }\StringTok{" "}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Parsed with column specification:
## cols(
##   pct.a.surf = col_double(),
##   pct.a.base = col_double(),
##   fines = col_double(),
##   voids = col_double(),
##   rut.depth = col_double(),
##   viscosity = col_double(),
##   run = col_double()
## )
\end{verbatim}

\begin{itemize}
\tightlist
\item
  Quantitative variables with one response: multiple regression.
\item
  Some issues here that don't come up in ``simple'' regression; handle
  as we go. (STAB27/STAC67 ideas.)
\end{itemize}

\end{frame}

\begin{frame}[fragile]{The data (some)}
\protect\hypertarget{the-data-some-3}{}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{asphalt}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 31 x 7
##    pct.a.surf pct.a.base fines voids rut.depth
##         <dbl>      <dbl> <dbl> <dbl>     <dbl>
##  1       4.68       4.87   8.4  4.92      6.75
##  2       5.19       4.5    6.5  4.56     13   
##  3       4.82       4.73   7.9  5.32     14.8 
##  4       4.85       4.76   8.3  4.86     12.6 
##  5       4.86       4.95   8.4  3.78      8.25
##  6       5.16       4.45   7.4  4.40     10.7 
##  7       4.82       5.05   6.8  4.87      7.28
##  8       4.86       4.7    8.6  4.83     12.7 
##  9       4.78       4.84   6.7  4.86     12.6 
## 10       5.16       4.76   7.7  4.03     20.6 
## # … with 21 more rows, and 2 more variables:
## #   viscosity <dbl>, run <dbl>
\end{verbatim}

\end{frame}

\begin{frame}[fragile]{Plotting response ``rut depth'' against
everything else}
\protect\hypertarget{plotting-response-rut-depth-against-everything-else}{}

Same idea as for plotting separate predictions on one plot:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{asphalt }\OperatorTok{%>%}
\StringTok{  }\KeywordTok{pivot_longer}\NormalTok{(}
    \KeywordTok{c}\NormalTok{(pct.a.surf}\OperatorTok{:}\NormalTok{voids, viscosity}\OperatorTok{:}\NormalTok{run),}
    \DataTypeTok{names_to=}\StringTok{"xname"}\NormalTok{, }\DataTypeTok{values_to=}\StringTok{"x"}
\NormalTok{  ) }\OperatorTok{%>%}
\StringTok{  }\KeywordTok{ggplot}\NormalTok{(}\KeywordTok{aes}\NormalTok{(}\DataTypeTok{x =}\NormalTok{ x, }\DataTypeTok{y =}\NormalTok{ rut.depth)) }\OperatorTok{+}\StringTok{ }\KeywordTok{geom_point}\NormalTok{() }\OperatorTok{+}
\StringTok{  }\KeywordTok{facet_wrap}\NormalTok{(}\OperatorTok{~}\NormalTok{xname, }\DataTypeTok{scales =} \StringTok{"free"}\NormalTok{) ->}\StringTok{ }\NormalTok{g}
\end{Highlighting}
\end{Shaded}

``collect all the x-variables together into one column called x, with
another column xname saying which x they were, then plot these x's
against rut.depth, a separate facet for each x-variable.''

I saved this graph to plot later (on the next page).

\end{frame}

\begin{frame}[fragile]{The plot}
\protect\hypertarget{the-plot-2}{}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{g}
\end{Highlighting}
\end{Shaded}

\begin{figure}
\centering
\includegraphics{figure/unnamed-chunk-274-1.pdf}
\caption{plot of chunk unnamed-chunk-274}
\end{figure}

\end{frame}

\begin{frame}[fragile]{Interpreting the plots}
\protect\hypertarget{interpreting-the-plots}{}

\begin{itemize}
\tightlist
\item
  One plot of rut depth against each of the six other variables.
\item
  Get rough idea of what's going on.
\item
  Trends mostly weak.
\item
  \texttt{viscosity} has strong but non-linear trend.
\item
  \texttt{run} has effect but variability bigger when run is 1.
\item
  Weak but downward trend for \texttt{voids}.
\item
  Non-linearity of \texttt{rut.depth}-\texttt{viscosity} relationship
  should concern us.
\item
  Take this back to asphalt engineer: suggests log of
  \texttt{viscosity}.
\end{itemize}

\end{frame}

\begin{frame}[fragile]{Log of \texttt{viscosity}: more nearly linear?}
\protect\hypertarget{log-of-viscosity-more-nearly-linear}{}

\begin{itemize}
\tightlist
\item
  Create new variable in data frame to hold log of \texttt{viscosity}:
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{asphalt }\OperatorTok{%>%}\StringTok{ }\KeywordTok{mutate}\NormalTok{(}\DataTypeTok{log.viscosity =} \KeywordTok{log}\NormalTok{(viscosity)) ->}\StringTok{ }\NormalTok{asphalt_lv}
\end{Highlighting}
\end{Shaded}

Now we have to remember to use \texttt{asphalt\_lv} as our data frame
from here on, eg.:

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{ggplot}\NormalTok{(asphalt_lv, }\KeywordTok{aes}\NormalTok{(}\DataTypeTok{y =}\NormalTok{ rut.depth, }\DataTypeTok{x =}\NormalTok{ log.viscosity)) }\OperatorTok{+}
\StringTok{  }\KeywordTok{geom_point}\NormalTok{() }\OperatorTok{+}\StringTok{ }\KeywordTok{geom_smooth}\NormalTok{(}\DataTypeTok{se =}\NormalTok{ F)}
\end{Highlighting}
\end{Shaded}

(plot overleaf)

\end{frame}

\begin{frame}[fragile]{Rut depth against log-viscosity}
\protect\hypertarget{rut-depth-against-log-viscosity}{}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{ggplot}\NormalTok{(asphalt_lv, }\KeywordTok{aes}\NormalTok{(}\DataTypeTok{y =}\NormalTok{ rut.depth, }\DataTypeTok{x =}\NormalTok{ log.viscosity)) }\OperatorTok{+}
\StringTok{  }\KeywordTok{geom_point}\NormalTok{() }\OperatorTok{+}\StringTok{ }\KeywordTok{geom_smooth}\NormalTok{(}\DataTypeTok{se =}\NormalTok{ F)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## `geom_smooth()` using method = 'loess' and formula 'y ~ x'
\end{verbatim}

\begin{figure}
\centering
\includegraphics{figure/unnamed-chunk-276-1.pdf}
\caption{plot of chunk unnamed-chunk-276}
\end{figure}

\end{frame}

\begin{frame}[fragile]{Comments and next steps}
\protect\hypertarget{comments-and-next-steps}{}

\begin{itemize}
\tightlist
\item
  Not very linear, but better than before.
\item
  In multiple regression, hard to guess which x's affect response. So
  typically start by predicting from everything else.
\item
  Model formula has response on left, squiggle, explanatories on right
  joined by plusses:
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{rut}\FloatTok{.1}\NormalTok{ <-}\StringTok{ }\KeywordTok{lm}\NormalTok{(rut.depth }\OperatorTok{~}\StringTok{ }\NormalTok{pct.a.surf }\OperatorTok{+}\StringTok{ }\NormalTok{pct.a.base }\OperatorTok{+}\StringTok{ }\NormalTok{fines }\OperatorTok{+}
\StringTok{  }\NormalTok{voids }\OperatorTok{+}\StringTok{ }\NormalTok{log.viscosity }\OperatorTok{+}\StringTok{ }\NormalTok{run, }\DataTypeTok{data =}\NormalTok{ asphalt_lv)}
\end{Highlighting}
\end{Shaded}

\end{frame}

\begin{frame}[fragile]{Regression output: \texttt{summary(rut.1)} or:}
\protect\hypertarget{regression-output-summaryrut.1-or}{}

\footnotesize

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{glance}\NormalTok{(rut}\FloatTok{.1}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 1 x 11
##   r.squared adj.r.squared sigma statistic p.value
##       <dbl>         <dbl> <dbl>     <dbl>   <dbl>
## 1     0.806         0.758  3.32      16.6 1.74e-7
## # … with 6 more variables: df <int>, logLik <dbl>,
## #   AIC <dbl>, BIC <dbl>, deviance <dbl>,
## #   df.residual <int>
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{tidy}\NormalTok{(rut}\FloatTok{.1}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 7 x 5
##   term          estimate std.error statistic p.value
##   <chr>            <dbl>     <dbl>     <dbl>   <dbl>
## 1 (Intercept)    -13.0      26.2      -0.496 0.625  
## 2 pct.a.surf       3.97      2.50      1.59  0.125  
## 3 pct.a.base       1.26      3.97      0.318 0.753  
## 4 fines            0.116     1.01      0.115 0.909  
## 5 voids            0.589     1.32      0.445 0.660  
## 6 log.viscosity   -3.15      0.919    -3.43  0.00220
## 7 run             -1.97      3.65     -0.539 0.595
\end{verbatim}

\normalsize

\end{frame}

\begin{frame}[fragile]{Comments}
\protect\hypertarget{comments-19}{}

\begin{itemize}
\tightlist
\item
  R-squared 81\%, not so bad.
\item
  P-value in \texttt{glance} asserts that something helping to predict
  rut.depth.
\item
  Table of coefficients says \texttt{log.viscosity}.
\item
  But confused by clearly non-significant variables: remove those to get
  clearer picture of what is helpful.
\item
  Before we do anything, look at residual plots:

  \begin{itemize}
  \item
    \begin{enumerate}
    [(a)]
    \tightlist
    \item
      of residuals against fitted values (as usual)
    \end{enumerate}
  \item
    \begin{enumerate}
    [(a)]
    \setcounter{enumi}{1}
    \tightlist
    \item
      of residuals against each explanatory.
    \end{enumerate}
  \end{itemize}
\item
  Problem with (a): fix response variable; problem with some plots in
  (b): fix those explanatory variables.
\end{itemize}

\end{frame}

\begin{frame}[fragile]{Plot fitted values against residuals}
\protect\hypertarget{plot-fitted-values-against-residuals}{}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{ggplot}\NormalTok{(rut}\FloatTok{.1}\NormalTok{, }\KeywordTok{aes}\NormalTok{(}\DataTypeTok{x =}\NormalTok{ .fitted, }\DataTypeTok{y =}\NormalTok{ .resid)) }\OperatorTok{+}\StringTok{ }\KeywordTok{geom_point}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{figure}
\centering
\includegraphics{figure/unnamed-chunk-279-1.pdf}
\caption{plot of chunk unnamed-chunk-279}
\end{figure}

\end{frame}

\begin{frame}[fragile]{Plotting residuals against \(x\) variables}
\protect\hypertarget{plotting-residuals-against-x-variables}{}

\begin{itemize}
\tightlist
\item
  Problem here is that residuals are in the fitted model, and the
  observed \(x\)-values are in the original data frame
  \texttt{asphalt\_lv}.
\item
  Package broom contains a function \texttt{augment} that combines these
  two together so that they can later be plotted: start with a model
  first, and then augment with a data frame:
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{rut}\FloatTok{.1} \OperatorTok{%>%}\StringTok{ }\KeywordTok{augment}\NormalTok{(asphalt_lv) ->}\StringTok{ }\NormalTok{rut}\FloatTok{.1}\NormalTok{a}
\end{Highlighting}
\end{Shaded}

\end{frame}

\begin{frame}[fragile]{What does rut.1a contain?}
\protect\hypertarget{what-does-rut.1a-contain}{}

\footnotesize

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{glimpse}\NormalTok{(rut}\FloatTok{.1}\NormalTok{a)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Observations: 31
## Variables: 15
## $ pct.a.surf    <dbl> 4.68, 5.19, 4.82, 4.85, 4.8…
## $ pct.a.base    <dbl> 4.87, 4.50, 4.73, 4.76, 4.9…
## $ fines         <dbl> 8.4, 6.5, 7.9, 8.3, 8.4, 7.…
## $ voids         <dbl> 4.916, 4.563, 5.321, 4.865,…
## $ rut.depth     <dbl> 6.75, 13.00, 14.75, 12.60, …
## $ viscosity     <dbl> 2.80, 1.40, 1.40, 3.30, 1.7…
## $ run           <dbl> 1, 1, 1, 1, 1, 1, 1, 1, 1, …
## $ log.viscosity <dbl> 1.02961942, 0.33647224, 0.3…
## $ .fitted       <dbl> 10.404663, 13.717501, 13.14…
## $ .se.fit       <dbl> 1.262454, 1.617838, 1.34207…
## $ .resid        <dbl> -3.6546631, -0.7175010, 1.6…
## $ .hat          <dbl> 0.1442888, 0.2369584, 0.163…
## $ .sigma        <dbl> 3.293545, 3.390685, 3.37533…
## $ .cooksd       <dbl> 0.0340389900, 0.0027097205,…
## $ .std.resid    <dbl> -1.18873388, -0.24714358, 0…
\end{verbatim}

\normalsize

\end{frame}

\begin{frame}[fragile]{Plotting residuals against \(x\)-variables}
\protect\hypertarget{plotting-residuals-against-x-variables-1}{}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{rut}\FloatTok{.1}\NormalTok{a }\OperatorTok{%>%}
\StringTok{  }\KeywordTok{pivot_longer}\NormalTok{(}
    \KeywordTok{c}\NormalTok{(pct.a.surf}\OperatorTok{:}\NormalTok{voids, run, log.viscosity),}
    \DataTypeTok{names_to=}\StringTok{"xname"}\NormalTok{, }\DataTypeTok{values_to=}\StringTok{"x"}
\NormalTok{  ) }\OperatorTok{%>%}
\StringTok{  }\KeywordTok{ggplot}\NormalTok{(}\KeywordTok{aes}\NormalTok{(}\DataTypeTok{x =}\NormalTok{ x, }\DataTypeTok{y =}\NormalTok{ .resid)) }\OperatorTok{+}
\StringTok{  }\KeywordTok{geom_point}\NormalTok{() }\OperatorTok{+}\StringTok{ }\KeywordTok{facet_wrap}\NormalTok{(}\OperatorTok{~}\NormalTok{xname, }\DataTypeTok{scales =} \StringTok{"free"}\NormalTok{) ->}\StringTok{ }\NormalTok{g}
\end{Highlighting}
\end{Shaded}

\end{frame}

\begin{frame}[fragile]{The plot}
\protect\hypertarget{the-plot-3}{}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{g}
\end{Highlighting}
\end{Shaded}

\begin{figure}
\centering
\includegraphics{figure/unnamed-chunk-283-1.pdf}
\caption{plot of chunk unnamed-chunk-283}
\end{figure}

\end{frame}

\begin{frame}{Comments}
\protect\hypertarget{comments-20}{}

\begin{itemize}
\tightlist
\item
  There is serious curve in plot of residuals vs.~fitted values.
  Suggests a transformation of \(y\).
\item
  The residuals-vs-\(x\)'s plots don't show any serious trends. Worst
  probably that potential curve against log-viscosity.
\item
  Also, large positive residual, 10, that shows up on all plots. Perhaps
  transformation of \(y\) will help with this too.
\item
  If residual-fitted plot OK, but some residual-\(x\) plots not, try
  transforming those \(x\)'s, eg. by adding \(x^2\) to help with curve.
\end{itemize}

\end{frame}

\begin{frame}{Which transformation?}
\protect\hypertarget{which-transformation}{}

\begin{itemize}
\tightlist
\item
  Best way: consult with person who brought you the data.
\item
  Can't do that here!
\item
  No idea what transformation would be good.
\item
  Let data choose: ``Box-Cox transformation''.
\item
  Scale is that of ``ladder of powers'': power transformation, but 0 is
  log.
\end{itemize}

\end{frame}

\begin{frame}[fragile]{Running Box-Cox}
\protect\hypertarget{running-box-cox}{}

From package \texttt{MASS}:

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{boxcox}\NormalTok{(rut.depth }\OperatorTok{~}\StringTok{ }\NormalTok{pct.a.surf }\OperatorTok{+}\StringTok{ }\NormalTok{pct.a.base }\OperatorTok{+}\StringTok{ }\NormalTok{fines }\OperatorTok{+}\StringTok{ }\NormalTok{voids }\OperatorTok{+}
\StringTok{  }\NormalTok{log.viscosity }\OperatorTok{+}\StringTok{ }\NormalTok{run, }\DataTypeTok{data =}\NormalTok{ asphalt_lv)}
\end{Highlighting}
\end{Shaded}

\begin{figure}
\centering
\includegraphics{figure/unnamed-chunk-284-1.pdf}
\caption{plot of chunk unnamed-chunk-284}
\end{figure}

\end{frame}

\begin{frame}[fragile]{Comments on Box-Cox plot}
\protect\hypertarget{comments-on-box-cox-plot}{}

\begin{itemize}
\tightlist
\item
  \(\lambda\) represents power to transform \(y\) with.
\item
  Best single choice of transformation parameter \(\lambda\) is peak of
  curve, close to 0.
\item
  Vertical dotted lines give CI for \(\lambda\), about (−0.05, 0.2).
\item
  \(\lambda = 0\) means ``log''.
\item
  Narrowness of confidence interval mean that these not supported by
  data:

  \begin{itemize}
  \tightlist
  \item
    No transformation (\(\lambda = 1\))
  \item
    Square root (\(\lambda = 0.5\))
  \item
    Reciprocal (\(\lambda = −1\)).
  \end{itemize}
\item
  So make new data frame with new response variable:
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{asphalt_lv }\OperatorTok{%>%}
\StringTok{  }\KeywordTok{mutate}\NormalTok{(}\DataTypeTok{log.rut.depth =} \KeywordTok{log}\NormalTok{(rut.depth)) ->}\StringTok{ }\NormalTok{asphalt_}\DecValTok{2}
\end{Highlighting}
\end{Shaded}

\end{frame}

\begin{frame}[fragile]{Relationships with explanatories}
\protect\hypertarget{relationships-with-explanatories}{}

\begin{itemize}
\tightlist
\item
  As before: plot response (now \texttt{log.rut.depth}) against other
  explanatory variables, all in one shot:
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{asphalt_}\DecValTok{2} \OperatorTok{%>%}
\StringTok{  }\KeywordTok{pivot_longer}\NormalTok{(}
    \KeywordTok{c}\NormalTok{(pct.a.surf}\OperatorTok{:}\NormalTok{voids, run}\OperatorTok{:}\NormalTok{log.viscosity),}
    \DataTypeTok{names_to=}\StringTok{"xname"}\NormalTok{, }\DataTypeTok{values_to=}\StringTok{"x"}
\NormalTok{  ) }\OperatorTok{%>%}
\StringTok{  }\KeywordTok{ggplot}\NormalTok{(}\KeywordTok{aes}\NormalTok{(}\DataTypeTok{y =}\NormalTok{ log.rut.depth, }\DataTypeTok{x =}\NormalTok{ x)) }\OperatorTok{+}\StringTok{ }\KeywordTok{geom_point}\NormalTok{() }\OperatorTok{+}
\StringTok{  }\KeywordTok{facet_wrap}\NormalTok{(}\OperatorTok{~}\NormalTok{xname, }\DataTypeTok{scales =} \StringTok{"free"}\NormalTok{) ->}\StringTok{ }\NormalTok{g3}
\end{Highlighting}
\end{Shaded}

\end{frame}

\begin{frame}[fragile]{The new plots}
\protect\hypertarget{the-new-plots}{}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{g3}
\end{Highlighting}
\end{Shaded}

\begin{figure}
\centering
\includegraphics{figure/unnamed-chunk-287-1.pdf}
\caption{plot of chunk unnamed-chunk-287}
\end{figure}

\end{frame}

\begin{frame}[fragile]{Modelling with transformed response}
\protect\hypertarget{modelling-with-transformed-response}{}

\begin{itemize}
\tightlist
\item
  These trends look pretty straight, especially with
  \texttt{log.viscosity}.
\item
  Values of \texttt{log.rut.depth} for each \texttt{run} have same
  spread.
\item
  Other trends weak, but are straight if they exist.
\item
  Start modelling from the beginning again.
\item
  Model \texttt{log.rut.depth} in terms of everything else, see what can
  be removed:
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{rut}\FloatTok{.2}\NormalTok{ <-}\StringTok{ }\KeywordTok{lm}\NormalTok{(log.rut.depth }\OperatorTok{~}\StringTok{ }\NormalTok{pct.a.surf }\OperatorTok{+}\StringTok{ }\NormalTok{pct.a.base }\OperatorTok{+}
\StringTok{  }\NormalTok{fines }\OperatorTok{+}\StringTok{ }\NormalTok{voids }\OperatorTok{+}\StringTok{ }\NormalTok{log.viscosity }\OperatorTok{+}\StringTok{ }\NormalTok{run, }\DataTypeTok{data =}\NormalTok{ asphalt_}\DecValTok{2}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{itemize}
\tightlist
\item
  use \texttt{tidy} from \texttt{broom} to display just the
  coefficients.
\end{itemize}

\end{frame}

\begin{frame}[fragile]{Output}
\protect\hypertarget{output}{}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{tidy}\NormalTok{(rut}\FloatTok{.2}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 7 x 5
##   term        estimate std.error statistic   p.value
##   <chr>          <dbl>     <dbl>     <dbl>     <dbl>
## 1 (Intercept)  -1.57      2.44      -0.646   5.25e-1
## 2 pct.a.surf    0.584     0.232      2.52    1.90e-2
## 3 pct.a.base   -0.103     0.369     -0.280   7.82e-1
## 4 fines         0.0978    0.0941     1.04    3.09e-1
## 5 voids         0.199     0.123      1.62    1.19e-1
## 6 log.viscos…  -0.558     0.0854    -6.53    9.45e-7
## 7 run           0.340     0.339      1.00    3.26e-1
\end{verbatim}

\end{frame}

\begin{frame}[fragile]{Taking out everything non-significant}
\protect\hypertarget{taking-out-everything-non-significant}{}

\begin{itemize}
\tightlist
\item
  Try: remove everything but pct.a.surf and log.viscosity:
\end{itemize}

\footnotesize

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{rut}\FloatTok{.3}\NormalTok{ <-}\StringTok{ }\KeywordTok{lm}\NormalTok{(log.rut.depth }\OperatorTok{~}\StringTok{ }\NormalTok{pct.a.surf }\OperatorTok{+}\StringTok{ }\NormalTok{log.viscosity, }\DataTypeTok{data =}\NormalTok{ asphalt_}\DecValTok{2}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\normalsize

\footnotesize

\begin{itemize}
\tightlist
\item
  Check that removing all those variables wasn't too much:
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{anova}\NormalTok{(rut}\FloatTok{.3}\NormalTok{, rut}\FloatTok{.2}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Analysis of Variance Table
## 
## Model 1: log.rut.depth ~ pct.a.surf + log.viscosity
## Model 2: log.rut.depth ~ pct.a.surf + pct.a.base + fines + voids + log.viscosity + 
##     run
##   Res.Df    RSS Df Sum of Sq      F Pr(>F)
## 1     28 2.8809                           
## 2     24 2.2888  4   0.59216 1.5523 0.2191
\end{verbatim}

\normalsize

\begin{itemize}
\tightlist
\item
  \(H_0\) : two models equally good; \(H_a\) : bigger model better.
\item
  Null not rejected here; small model as good as the big one, so prefer
  simpler smaller model \texttt{rut.3}.
\end{itemize}

\end{frame}

\begin{frame}[fragile]{Find the largest P-value by eye:}
\protect\hypertarget{find-the-largest-p-value-by-eye}{}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{tidy}\NormalTok{(rut}\FloatTok{.2}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 7 x 5
##   term        estimate std.error statistic   p.value
##   <chr>          <dbl>     <dbl>     <dbl>     <dbl>
## 1 (Intercept)  -1.57      2.44      -0.646   5.25e-1
## 2 pct.a.surf    0.584     0.232      2.52    1.90e-2
## 3 pct.a.base   -0.103     0.369     -0.280   7.82e-1
## 4 fines         0.0978    0.0941     1.04    3.09e-1
## 5 voids         0.199     0.123      1.62    1.19e-1
## 6 log.viscos…  -0.558     0.0854    -6.53    9.45e-7
## 7 run           0.340     0.339      1.00    3.26e-1
\end{verbatim}

\begin{itemize}
\tightlist
\item
  Largest P-value is 0.78 for \texttt{pct.a.base}, not significant.
\item
  So remove this first, re-fit and re-assess.
\item
  Or, as over.
\end{itemize}

\end{frame}

\begin{frame}[fragile]{Get the computer to find the largest P-value for
you}
\protect\hypertarget{get-the-computer-to-find-the-largest-p-value-for-you}{}

\begin{itemize}
\tightlist
\item
  Output from \texttt{tidy} is itself a data frame, thus:
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{tidy}\NormalTok{(rut}\FloatTok{.2}\NormalTok{) }\OperatorTok{%>%}\StringTok{ }\KeywordTok{arrange}\NormalTok{(p.value)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 7 x 5
##   term        estimate std.error statistic   p.value
##   <chr>          <dbl>     <dbl>     <dbl>     <dbl>
## 1 log.viscos…  -0.558     0.0854    -6.53    9.45e-7
## 2 pct.a.surf    0.584     0.232      2.52    1.90e-2
## 3 voids         0.199     0.123      1.62    1.19e-1
## 4 fines         0.0978    0.0941     1.04    3.09e-1
## 5 run           0.340     0.339      1.00    3.26e-1
## 6 (Intercept)  -1.57      2.44      -0.646   5.25e-1
## 7 pct.a.base   -0.103     0.369     -0.280   7.82e-1
\end{verbatim}

\begin{itemize}
\tightlist
\item
  Largest P-value at the bottom.
\end{itemize}

\end{frame}

\begin{frame}[fragile]{Take out \texttt{pct.a.base}}
\protect\hypertarget{take-out-pct.a.base}{}

\begin{itemize}
\tightlist
\item
  Copy and paste the \texttt{lm} code and remove what you're removing:
\end{itemize}

\small

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{rut}\FloatTok{.4}\NormalTok{ <-}\StringTok{ }\KeywordTok{lm}\NormalTok{(log.rut.depth }\OperatorTok{~}\StringTok{ }\NormalTok{pct.a.surf }\OperatorTok{+}\StringTok{ }\NormalTok{fines }\OperatorTok{+}\StringTok{ }\NormalTok{voids }\OperatorTok{+}\StringTok{ }\NormalTok{log.viscosity }\OperatorTok{+}\StringTok{ }\NormalTok{run,}
  \DataTypeTok{data =}\NormalTok{ asphalt_}\DecValTok{2}
\NormalTok{)}
\KeywordTok{tidy}\NormalTok{(rut}\FloatTok{.4}\NormalTok{) }\OperatorTok{%>%}\StringTok{ }\KeywordTok{arrange}\NormalTok{(p.value)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 6 x 5
##   term        estimate std.error statistic   p.value
##   <chr>          <dbl>     <dbl>     <dbl>     <dbl>
## 1 log.viscos…  -0.552     0.0818     -6.75   4.48e-7
## 2 pct.a.surf    0.593     0.225       2.63   1.43e-2
## 3 voids         0.200     0.121       1.66   1.09e-1
## 4 (Intercept)  -2.08      1.61       -1.29   2.08e-1
## 5 run           0.360     0.325       1.11   2.79e-1
## 6 fines         0.0889    0.0870      1.02   3.16e-1
\end{verbatim}

\normalsize

\begin{itemize}
\tightlist
\item
  \texttt{fines} is next to go, P-value 0.32.
\end{itemize}

\end{frame}

\begin{frame}[fragile]{``Update''}
\protect\hypertarget{update}{}

Another way to do the same thing:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{rut}\FloatTok{.4}\NormalTok{ <-}\StringTok{ }\KeywordTok{update}\NormalTok{(rut}\FloatTok{.2}\NormalTok{, . }\OperatorTok{~}\StringTok{ }\NormalTok{. }\OperatorTok{-}\StringTok{ }\NormalTok{pct.a.base)}
\KeywordTok{tidy}\NormalTok{(rut}\FloatTok{.4}\NormalTok{) }\OperatorTok{%>%}\StringTok{ }\KeywordTok{arrange}\NormalTok{(p.value)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 6 x 5
##   term        estimate std.error statistic   p.value
##   <chr>          <dbl>     <dbl>     <dbl>     <dbl>
## 1 log.viscos…  -0.552     0.0818     -6.75   4.48e-7
## 2 pct.a.surf    0.593     0.225       2.63   1.43e-2
## 3 voids         0.200     0.121       1.66   1.09e-1
## 4 (Intercept)  -2.08      1.61       -1.29   2.08e-1
## 5 run           0.360     0.325       1.11   2.79e-1
## 6 fines         0.0889    0.0870      1.02   3.16e-1
\end{verbatim}

\begin{itemize}
\tightlist
\item
  Again, fines is the one to go. (Output identical as it should be.)
\end{itemize}

\end{frame}

\begin{frame}[fragile]{Take out fines:}
\protect\hypertarget{take-out-fines}{}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{rut}\FloatTok{.5}\NormalTok{ <-}\StringTok{ }\KeywordTok{update}\NormalTok{(rut}\FloatTok{.4}\NormalTok{, . }\OperatorTok{~}\StringTok{ }\NormalTok{. }\OperatorTok{-}\StringTok{ }\NormalTok{fines)}
\KeywordTok{tidy}\NormalTok{(rut}\FloatTok{.5}\NormalTok{) }\OperatorTok{%>%}\StringTok{ }\KeywordTok{arrange}\NormalTok{(p.value)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 5 x 5
##   term       estimate std.error statistic    p.value
##   <chr>         <dbl>     <dbl>     <dbl>      <dbl>
## 1 log.visco…   -0.580    0.0772    -7.52     5.59e-8
## 2 pct.a.surf    0.548    0.221      2.48     2.00e-2
## 3 voids         0.232    0.117      1.99     5.77e-2
## 4 run           0.295    0.319      0.923    3.65e-1
## 5 (Intercep…   -1.26     1.39      -0.902    3.75e-1
\end{verbatim}

Can't take out intercept, so \texttt{run}, with P-value 0.36, goes next.

\end{frame}

\begin{frame}[fragile]{Take out run:}
\protect\hypertarget{take-out-run}{}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{rut}\FloatTok{.6}\NormalTok{ <-}\StringTok{ }\KeywordTok{update}\NormalTok{(rut}\FloatTok{.5}\NormalTok{, . }\OperatorTok{~}\StringTok{ }\NormalTok{. }\OperatorTok{-}\StringTok{ }\NormalTok{run)}
\KeywordTok{tidy}\NormalTok{(rut}\FloatTok{.6}\NormalTok{) }\OperatorTok{%>%}\StringTok{ }\KeywordTok{arrange}\NormalTok{(p.value)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 4 x 5
##   term         estimate std.error statistic  p.value
##   <chr>           <dbl>     <dbl>     <dbl>    <dbl>
## 1 log.viscosi…   -0.646    0.0288   -22.5   5.29e-19
## 2 pct.a.surf      0.555    0.220      2.52  1.80e- 2
## 3 voids           0.245    0.116      2.12  4.36e- 2
## 4 (Intercept)    -1.02     1.36      -0.748 4.61e- 1
\end{verbatim}

Again, can't take out intercept, so largest P-value is for
\texttt{voids}, 0.044. But this is significant, so we shouldn't remove
\texttt{voids}.

\end{frame}

\begin{frame}[fragile]{Comments}
\protect\hypertarget{comments-21}{}

\begin{itemize}
\tightlist
\item
  Here we stop: \texttt{pct.a.surf}, \texttt{voids} and
  \texttt{log.viscosity} would all make fit significantly worse if
  removed. So they stay.
\item
  Different final result from taking things out one at a time (top),
  than by taking out 4 at once (bottom):
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{coef}\NormalTok{(rut}\FloatTok{.6}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##   (Intercept)    pct.a.surf         voids 
##    -1.0207945     0.5554686     0.2447934 
## log.viscosity 
##    -0.6464911
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{coef}\NormalTok{(rut}\FloatTok{.3}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##   (Intercept)    pct.a.surf log.viscosity 
##     0.9001389     0.3911481    -0.6185628
\end{verbatim}

\begin{itemize}
\tightlist
\item
  Point: Can make difference which way we go.
\end{itemize}

\end{frame}

\begin{frame}[fragile]{Comments on variable selection}
\protect\hypertarget{comments-on-variable-selection}{}

\begin{itemize}
\tightlist
\item
  Best way to decide which \(x\)'s belong: expert knowledge: which of
  them should be important.
\item
  Best automatic method: what we did, ``backward selection''.
\item
  Do not learn about ``stepwise regression''!
  \href{https://towardsdatascience.com/stopping-stepwise-why-stepwise-selection-is-bad-and-what-you-should-use-instead-90818b3f52df}{\textbf{eg.
  here}}
\item
  R has function \texttt{step} that does backward selection, like this:
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{step}\NormalTok{(rut}\FloatTok{.2}\NormalTok{, }\DataTypeTok{direction =} \StringTok{"backward"}\NormalTok{, }\DataTypeTok{test =} \StringTok{"F"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

Gets same answer as we did (by removing least significant x).

\begin{itemize}
\tightlist
\item
  Removing non-significant \(x\)'s may remove interesting ones whose
  P-values happened not to reach 0.05. Consider using less stringent
  cutoff like 0.20 or even bigger.
\item
  Can also fit all possible regressions, as over (may need to do
  \texttt{install.packages("leaps")} first).
\end{itemize}

\end{frame}

\begin{frame}[fragile]{All possible regressions (output over)}
\protect\hypertarget{all-possible-regressions-output-over}{}

Uses package \texttt{leaps}:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{leaps <-}\StringTok{ }\KeywordTok{regsubsets}\NormalTok{(log.rut.depth }\OperatorTok{~}\StringTok{ }\NormalTok{pct.a.surf }\OperatorTok{+}\StringTok{ }\NormalTok{pct.a.base }\OperatorTok{+}\StringTok{ }\NormalTok{fines }\OperatorTok{+}\StringTok{ }\NormalTok{voids }\OperatorTok{+}
\StringTok{  }\NormalTok{log.viscosity }\OperatorTok{+}\StringTok{ }\NormalTok{run, }\DataTypeTok{data =}\NormalTok{ asphalt_}\DecValTok{2}\NormalTok{, }\DataTypeTok{nbest =} \DecValTok{2}\NormalTok{)}
\NormalTok{s <-}\StringTok{ }\KeywordTok{summary}\NormalTok{(leaps)}
\KeywordTok{with}\NormalTok{(s, }\KeywordTok{data.frame}\NormalTok{(rsq, outmat)) ->}\StringTok{ }\NormalTok{d}
\end{Highlighting}
\end{Shaded}

\end{frame}

\begin{frame}[fragile]{The output}
\protect\hypertarget{the-output}{}

\scriptsize

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{d }\OperatorTok{%>%}\StringTok{ }\KeywordTok{rownames_to_column}\NormalTok{(}\StringTok{"model"}\NormalTok{) }\OperatorTok{%>%}\StringTok{ }\KeywordTok{arrange}\NormalTok{(}\KeywordTok{desc}\NormalTok{(rsq))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##       model       rsq pct.a.surf pct.a.base fines voids log.viscosity run
## 1  6  ( 1 ) 0.9609642          *          *     *     *             *   *
## 2  5  ( 1 ) 0.9608365          *                *     *             *   *
## 3  5  ( 2 ) 0.9593265          *          *     *     *             *    
## 4  4  ( 1 ) 0.9591996          *                      *             *   *
## 5  4  ( 2 ) 0.9589206          *                *     *             *    
## 6  3  ( 1 ) 0.9578631          *                      *             *    
## 7  3  ( 2 ) 0.9534561          *                *                   *    
## 8  2  ( 1 ) 0.9508647          *                                    *    
## 9  2  ( 2 ) 0.9479541                                 *             *    
## 10 1  ( 1 ) 0.9452562                                               *    
## 11 1  ( 2 ) 0.8624107                                                   *
\end{verbatim}

\normalsize

\end{frame}

\begin{frame}[fragile]{Comments}
\protect\hypertarget{comments-22}{}

\begin{itemize}
\tightlist
\item
  Problem: even adding a worthless x increases R-squared. So try for
  line where R-squared stops increasing ``too much'', eg. top line (just
  log.viscosity), first 3-variable line (backwards-elimination model).
  Hard to judge.
\item
  One solution (STAC67): adjusted R-squared, where adding worthless
  variable makes it go down.
\item
  \texttt{data.frame} rather than \texttt{tibble} because there are
  several columns in \texttt{outmat}.
\end{itemize}

\end{frame}

\begin{frame}[fragile]{All possible regressions, adjusted R-squared}
\protect\hypertarget{all-possible-regressions-adjusted-r-squared}{}

\scriptsize

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{with}\NormalTok{(s, }\KeywordTok{data.frame}\NormalTok{(adjr2, outmat))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##              adjr2 pct.a.surf pct.a.base fines voids log.viscosity run
## 1  ( 1 ) 0.9433685                                               *    
## 1  ( 2 ) 0.8576662                                                   *
## 2  ( 1 ) 0.9473550          *                                    *    
## 2  ( 2 ) 0.9442365                                 *             *    
## 3  ( 1 ) 0.9531812          *                      *             *    
## 3  ( 2 ) 0.9482845          *                *                   *    
## 4  ( 1 ) 0.9529226          *                      *             *   *
## 4  ( 2 ) 0.9526007          *                *     *             *    
## 5  ( 1 ) 0.9530038          *                *     *             *   *
## 5  ( 2 ) 0.9511918          *          *     *     *             *    
## 6  ( 1 ) 0.9512052          *          *     *     *             *   *
\end{verbatim}

\normalsize

\end{frame}

\begin{frame}[fragile]{Revisiting the best model}
\protect\hypertarget{revisiting-the-best-model}{}

\begin{itemize}
\tightlist
\item
  Best model was our rut.6:
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{tidy}\NormalTok{(rut}\FloatTok{.6}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 4 x 5
##   term         estimate std.error statistic  p.value
##   <chr>           <dbl>     <dbl>     <dbl>    <dbl>
## 1 (Intercept)    -1.02     1.36      -0.748 4.61e- 1
## 2 pct.a.surf      0.555    0.220      2.52  1.80e- 2
## 3 voids           0.245    0.116      2.12  4.36e- 2
## 4 log.viscosi…   -0.646    0.0288   -22.5   5.29e-19
\end{verbatim}

\end{frame}

\begin{frame}[fragile]{Revisiting (2)}
\protect\hypertarget{revisiting-2}{}

\begin{itemize}
\tightlist
\item
  Regression slopes say that rut depth increases as log-viscosity
  decreases, \texttt{pct.a.surf} increases and \texttt{voids} increases.
  This more or less checks out with out scatterplots against
  \texttt{log.viscosity}.
\item
  We should check residual plots again, though previous scatterplots say
  it's unlikely that there will be a problem:
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{g <-}\StringTok{ }\KeywordTok{ggplot}\NormalTok{(rut}\FloatTok{.6}\NormalTok{, }\KeywordTok{aes}\NormalTok{(}\DataTypeTok{y =}\NormalTok{ .resid, }\DataTypeTok{x =}\NormalTok{ .fitted)) }\OperatorTok{+}\StringTok{ }
\KeywordTok{geom_point}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\end{frame}

\begin{frame}[fragile]{Residuals against fitted values}
\protect\hypertarget{residuals-against-fitted-values}{}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{g}
\end{Highlighting}
\end{Shaded}

\begin{figure}
\centering
\includegraphics{figure/unnamed-chunk-309-1.pdf}
\caption{plot of chunk unnamed-chunk-309}
\end{figure}

\end{frame}

\begin{frame}[fragile]{Plotting residuals against x's}
\protect\hypertarget{plotting-residuals-against-xs}{}

\begin{itemize}
\tightlist
\item
  Do our trick again to put them all on one plot:
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{augment}\NormalTok{(rut}\FloatTok{.6}\NormalTok{, asphalt_}\DecValTok{2}\NormalTok{) }\OperatorTok{%>%}
\StringTok{  }\KeywordTok{pivot_longer}\NormalTok{(}
    \KeywordTok{c}\NormalTok{(pct.a.surf}\OperatorTok{:}\NormalTok{voids, run}\OperatorTok{:}\NormalTok{log.viscosity),}
    \DataTypeTok{names_to=}\StringTok{"xname"}\NormalTok{, }\DataTypeTok{values_to=}\StringTok{"x"}\NormalTok{,}
\NormalTok{  ) }\OperatorTok{%>%}
\StringTok{  }\KeywordTok{ggplot}\NormalTok{(}\KeywordTok{aes}\NormalTok{(}\DataTypeTok{y =}\NormalTok{ .resid, }\DataTypeTok{x =}\NormalTok{ x)) }\OperatorTok{+}\StringTok{ }\KeywordTok{geom_point}\NormalTok{() }\OperatorTok{+}
\StringTok{  }\KeywordTok{facet_wrap}\NormalTok{(}\OperatorTok{~}\NormalTok{xname, }\DataTypeTok{scales =} \StringTok{"free"}\NormalTok{) ->}\StringTok{ }\NormalTok{g2}
\end{Highlighting}
\end{Shaded}

\end{frame}

\begin{frame}[fragile]{Residuals against the x's}
\protect\hypertarget{residuals-against-the-xs}{}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{g2}
\end{Highlighting}
\end{Shaded}

\begin{figure}
\centering
\includegraphics{figure/unnamed-chunk-311-1.pdf}
\caption{plot of chunk unnamed-chunk-311}
\end{figure}

\end{frame}

\begin{frame}{Comments}
\protect\hypertarget{comments-24}{}

\begin{itemize}
\tightlist
\item
  None of the plots show any sort of pattern. The points all look random
  on each plot.
\item
  On the plot of fitted values (and on the one of log.viscosity), the
  points seem to form a ``left half'' and a ``right half'' with a gap in
  the middle. This is not a concern.
\item
  One of the pct.a.surf values is low outlier (4), shows up top left of
  that plot.
\item
  Only two possible values of run; the points in each group look
  randomly scattered around 0, with equal spreads.
\item
  Residuals seem to go above zero further than below, suggesting a mild
  non-normality, but not enough to be a problem.
\end{itemize}

\end{frame}

\begin{frame}{Variable-selection strategies}
\protect\hypertarget{variable-selection-strategies}{}

\begin{itemize}
\tightlist
\item
  Expert knowledge.
\item
  Backward elimination.
\item
  All possible regressions.
\item
  Taking a variety of models to experts and asking their opinion.
\item
  Use a looser cutoff to eliminate variables in backward elimination
  (eg. only if P-value greater than 0.20).
\item
  If goal is prediction, eliminating worthless variables less important.
\item
  If goal is understanding, want to eliminate worthless variables where
  possible.
\item
  Results of variable selection not always reproducible, so caution
  advised.
\end{itemize}

\end{frame}

\hypertarget{regression-with-categorical-variables}{%
\section{Regression with categorical
variables}\label{regression-with-categorical-variables}}

\begin{frame}[fragile]{Packages for this section}
\protect\hypertarget{packages-for-this-section-7}{}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{library}\NormalTok{(tidyverse)}
\KeywordTok{library}\NormalTok{(broom)}
\end{Highlighting}
\end{Shaded}

\end{frame}

\begin{frame}[fragile]{The pigs revisited}
\protect\hypertarget{the-pigs-revisited}{}

\begin{itemize}
\tightlist
\item
  Recall pig feed data, after we tidied it:
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{my_url <-}\StringTok{ "http://www.utsc.utoronto.ca/~butler/c32/pigs2.txt"}
\NormalTok{pigs <-}\StringTok{ }\KeywordTok{read_delim}\NormalTok{(my_url, }\StringTok{" "}\NormalTok{)}
\NormalTok{pigs }
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 20 x 3
##      pig feed  weight
##    <dbl> <chr>  <dbl>
##  1     1 feed1   60.8
##  2     2 feed1   57  
##  3     3 feed1   65  
##  4     4 feed1   58.6
##  5     5 feed1   61.7
##  6     1 feed2   68.7
##  7     2 feed2   67.7
##  8     3 feed2   74  
##  9     4 feed2   66.3
## 10     5 feed2   69.8
## 11     1 feed3   92.6
## 12     2 feed3   92.1
## 13     3 feed3   90.2
## 14     4 feed3   96.5
## 15     5 feed3   99.1
## 16     1 feed4   87.9
## 17     2 feed4   84.2
## 18     3 feed4   83.1
## 19     4 feed4   85.7
## 20     5 feed4   90.3
\end{verbatim}

\end{frame}

\begin{frame}[fragile]{Summaries}
\protect\hypertarget{summaries}{}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{pigs }\OperatorTok{%>%}
\StringTok{  }\KeywordTok{group_by}\NormalTok{(feed) }\OperatorTok{%>%}
\StringTok{  }\KeywordTok{summarize}\NormalTok{(}\DataTypeTok{m =} \KeywordTok{mean}\NormalTok{(weight))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 4 x 2
##   feed      m
##   <chr> <dbl>
## 1 feed1  60.6
## 2 feed2  69.3
## 3 feed3  94.1
## 4 feed4  86.2
\end{verbatim}

\end{frame}

\begin{frame}[fragile]{Running through \texttt{aov} and \texttt{lm}}
\protect\hypertarget{running-through-aov-and-lm}{}

\begin{itemize}
\tightlist
\item
  What happens if we run this through \texttt{lm} rather than
  \texttt{aov}?
\item
  Recall \texttt{aov} first:
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{pigs}\FloatTok{.1}\NormalTok{ <-}\StringTok{ }\KeywordTok{aov}\NormalTok{(weight }\OperatorTok{~}\StringTok{ }\NormalTok{feed, }\DataTypeTok{data =}\NormalTok{ pigs)}
\KeywordTok{summary}\NormalTok{(pigs}\FloatTok{.1}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##             Df Sum Sq Mean Sq F value   Pr(>F)    
## feed         3   3521  1173.5   119.1 3.72e-11 ***
## Residuals   16    158     9.8                     
## ---
## Signif. codes:  
## 0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
\end{verbatim}

\end{frame}

\begin{frame}[fragile]{and now \texttt{lm}}
\protect\hypertarget{and-now-lm}{}

\footnotesize

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{pigs}\FloatTok{.2}\NormalTok{ <-}\StringTok{ }\KeywordTok{lm}\NormalTok{(weight }\OperatorTok{~}\StringTok{ }\NormalTok{feed, }\DataTypeTok{data =}\NormalTok{ pigs)}
\KeywordTok{tidy}\NormalTok{(pigs}\FloatTok{.2}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 4 x 5
##   term        estimate std.error statistic  p.value
##   <chr>          <dbl>     <dbl>     <dbl>    <dbl>
## 1 (Intercept)    60.6       1.40     43.2  5.39e-18
## 2 feedfeed2       8.68      1.98      4.37 4.73e- 4
## 3 feedfeed3      33.5       1.98     16.9  1.30e-11
## 4 feedfeed4      25.6       1.98     12.9  7.11e-10
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{glance}\NormalTok{(pigs}\FloatTok{.2}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 1 x 11
##   r.squared adj.r.squared sigma statistic  p.value
##       <dbl>         <dbl> <dbl>     <dbl>    <dbl>
## 1     0.957         0.949  3.14      119. 3.72e-11
## # … with 6 more variables: df <int>, logLik <dbl>,
## #   AIC <dbl>, BIC <dbl>, deviance <dbl>,
## #   df.residual <int>
\end{verbatim}

\normalsize

\end{frame}

\begin{frame}{Understanding those slopes}
\protect\hypertarget{understanding-those-slopes}{}

\begin{itemize}
\tightlist
\item
  Get one slope for each category of categorical variable feed, except
  for first.
\item
  feed1 treated as ``baseline'', others measured relative to that.
\item
  Thus prediction for feed 1 is intercept, 60.62 (mean weight for feed
  1).
\item
  Prediction for feed 2 is 60.62 + 8.68 = 69.30 (mean weight for feed
  2).
\item
  Or, mean weight for feed 2 is 8.68 bigger than for feed 1.
\item
  Mean weight for feed 3 is 33.48 bigger than for feed 1.
\item
  Slopes can be negative, if mean for a feed had been smaller than for
  feed 1.
\end{itemize}

\end{frame}

\begin{frame}[fragile]{Reproducing the ANOVA}
\protect\hypertarget{reproducing-the-anova}{}

\begin{itemize}
\tightlist
\item
  Pass the fitted model object into \texttt{anova}:
\end{itemize}

\footnotesize

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{anova}\NormalTok{(pigs}\FloatTok{.2}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Analysis of Variance Table
## 
## Response: weight
##           Df Sum Sq Mean Sq F value   Pr(>F)    
## feed       3 3520.5 1173.51  119.14 3.72e-11 ***
## Residuals 16  157.6    9.85                     
## ---
## Signif. codes:  
## 0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
\end{verbatim}

\normalsize

\begin{itemize}
\tightlist
\item
  Same as before.
\item
  But no Tukey this way:
\end{itemize}

\footnotesize

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{TukeyHSD}\NormalTok{(pigs}\FloatTok{.2}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Error in UseMethod("TukeyHSD"): no applicable method for 'TukeyHSD' applied to an object of class "lm"
\end{verbatim}

\normalsize

\end{frame}

\begin{frame}{The crickets}
\protect\hypertarget{the-crickets}{}

\begin{itemize}
\tightlist
\item
  Male crickets rub their wings together to produce a chirping sound.
\item
  Rate of chirping, called ``pulse rate'', depends on species and
  possibly on temperature.
\item
  Sample of crickets of two species' pulse rates measured; temperature
  also recorded.
\item
  Does pulse rate differ for species, especially when temperature
  accounted for?
\end{itemize}

\end{frame}

\begin{frame}[fragile]{The crickets data}
\protect\hypertarget{the-crickets-data}{}

Read the data:

\small

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{my_url=}\StringTok{"http://www.utsc.utoronto.ca/~butler/c32/crickets2.csv"}
\NormalTok{crickets <-}\StringTok{ }\KeywordTok{read_csv}\NormalTok{(my_url)}
\NormalTok{crickets }\OperatorTok{%>%}\StringTok{ }\KeywordTok{sample_n}\NormalTok{(}\DecValTok{10}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 10 x 3
##    species       temperature pulse_rate
##    <chr>               <dbl>      <dbl>
##  1 niveus               18.9       51.8
##  2 exclamationis        30.4      102. 
##  3 exclamationis        26.2       85.8
##  4 exclamationis        20.8       67.9
##  5 exclamationis        26.2       86.6
##  6 exclamationis        26.2       89.1
##  7 exclamationis        30.4       99.3
##  8 niveus               23.5       69.8
##  9 exclamationis        24         80.4
## 10 niveus               18.9       50.3
\end{verbatim}

\normalsize

\end{frame}

\begin{frame}[fragile]{Fit model with \texttt{lm}}
\protect\hypertarget{fit-model-with-lm}{}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{crickets}\FloatTok{.1}\NormalTok{ <-}\StringTok{ }\KeywordTok{lm}\NormalTok{(pulse_rate }\OperatorTok{~}\StringTok{ }\NormalTok{temperature }\OperatorTok{+}\StringTok{ }\NormalTok{species, }
                 \DataTypeTok{data =}\NormalTok{ crickets)}
\KeywordTok{drop1}\NormalTok{(crickets}\FloatTok{.1}\NormalTok{, }\DataTypeTok{test =} \StringTok{"F"}\NormalTok{) }\OperatorTok{%>%}\StringTok{  }\KeywordTok{select}\NormalTok{(}\OperatorTok{-}\NormalTok{Df, }\OperatorTok{-}\StringTok{`}\DataTypeTok{Sum of Sq}\StringTok{`}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Single term deletions
## 
## Model:
## pulse_rate ~ temperature + species
##                RSS     AIC F value    Pr(>F)    
## <none>        89.3  38.816                      
## temperature 4465.4 158.074  1371.4 < 2.2e-16 ***
## species      687.4 100.065   187.4 6.272e-14 ***
## ---
## Signif. codes:  
## 0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
\end{verbatim}

\end{frame}

\begin{frame}[fragile]{The summary}
\protect\hypertarget{the-summary}{}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{glance}\NormalTok{(crickets}\FloatTok{.1}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 1 x 11
##   r.squared adj.r.squared sigma statistic  p.value
##       <dbl>         <dbl> <dbl>     <dbl>    <dbl>
## 1     0.990         0.989  1.79     1331. 1.76e-28
## # … with 6 more variables: df <int>, logLik <dbl>,
## #   AIC <dbl>, BIC <dbl>, deviance <dbl>,
## #   df.residual <int>
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{tidy}\NormalTok{(crickets}\FloatTok{.1}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 3 x 5
##   term         estimate std.error statistic  p.value
##   <chr>           <dbl>     <dbl>     <dbl>    <dbl>
## 1 (Intercept)     -7.21    2.55       -2.83 8.58e- 3
## 2 temperature      3.60    0.0973     37.0  2.49e-25
## 3 speciesnive…   -10.1     0.735     -13.7  6.27e-14
\end{verbatim}

\end{frame}

\begin{frame}[fragile]{Conclusions}
\protect\hypertarget{conclusions}{}

\begin{itemize}
\tightlist
\item
  Slope for temperature says that increasing temperature by 1 degree
  increases pulse rate by 3.6 (same for both species)
\item
  Slope for \texttt{speciesniveus} says that pulse rate for niveus about
  10 lower than that for exclamationis at same temperature (latter
  species is baseline).
\item
  R-squared of almost 0.99 is very high, so that the prediction of pulse
  rate from species and temperature is very good.
\end{itemize}

\end{frame}

\begin{frame}[fragile]{To end with a graph}
\protect\hypertarget{to-end-with-a-graph}{}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{ggplot}\NormalTok{(crickets, }\KeywordTok{aes}\NormalTok{(}\DataTypeTok{x =}\NormalTok{ temperature, }\DataTypeTok{y =}\NormalTok{ pulse_rate,}
  \DataTypeTok{colour =}\NormalTok{ species)) }\OperatorTok{+}
\StringTok{  }\KeywordTok{geom_point}\NormalTok{() }\OperatorTok{+}\StringTok{ }\KeywordTok{geom_smooth}\NormalTok{(}\DataTypeTok{method =} \StringTok{"lm"}\NormalTok{, }\DataTypeTok{se =}\NormalTok{ F)}
\end{Highlighting}
\end{Shaded}

\begin{figure}
\centering
\includegraphics{figure/unnamed-chunk-322-1.pdf}
\caption{plot of chunk unnamed-chunk-322}
\end{figure}

\end{frame}

\hypertarget{functions}{%
\section{Functions}\label{functions}}

\begin{frame}[fragile]{Packages for this section}
\protect\hypertarget{packages-for-this-section-8}{}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{library}\NormalTok{(tidyverse)}
\KeywordTok{library}\NormalTok{(broom)}
\end{Highlighting}
\end{Shaded}

\end{frame}

\begin{frame}[fragile]{Don't repeat yourself}
\protect\hypertarget{dont-repeat-yourself}{}

\begin{itemize}
\tightlist
\item
  See this:
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{a <-}\StringTok{ }\DecValTok{50}
\NormalTok{b <-}\StringTok{ }\DecValTok{11}
\NormalTok{d <-}\StringTok{ }\DecValTok{3}
\NormalTok{as <-}\StringTok{ }\KeywordTok{sqrt}\NormalTok{(a }\OperatorTok{-}\StringTok{ }\DecValTok{1}\NormalTok{)}
\NormalTok{as}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 7
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{bs <-}\StringTok{ }\KeywordTok{sqrt}\NormalTok{(b }\OperatorTok{-}\StringTok{ }\DecValTok{1}\NormalTok{)}
\NormalTok{bs}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 3.162278
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{ds <-}\StringTok{ }\KeywordTok{sqrt}\NormalTok{(d }\OperatorTok{-}\StringTok{ }\DecValTok{1}\NormalTok{)}
\NormalTok{ds}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 1.414214
\end{verbatim}

\end{frame}

\begin{frame}{What's the problem?}
\protect\hypertarget{whats-the-problem}{}

\begin{itemize}
\item
  Same calculation done three different times, by copying, pasting and
  editing.
\item
  Dangerous: what if you forget to change something after you pasted?
\item
  Programming principle: ``don't repeat yourself''.
\item
  Hadley Wickham: don't copy-paste more than twice.
\item
  Instead: \emph{write a function}.
\end{itemize}

\end{frame}

\begin{frame}[fragile]{Anatomy of function}
\protect\hypertarget{anatomy-of-function}{}

\begin{itemize}
\tightlist
\item
  Header line with function name and input value(s).
\item
  Body with calculation of values to output/return.
\item
  Return value: the output from function. In our case:
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{sqrt_minus_}\DecValTok{1}\NormalTok{ <-}\StringTok{ }\ControlFlowTok{function}\NormalTok{(x) \{}
\NormalTok{  ans <-}\StringTok{ }\KeywordTok{sqrt}\NormalTok{(x }\OperatorTok{-}\StringTok{ }\DecValTok{1}\NormalTok{)}
  \KeywordTok{return}\NormalTok{(ans)}
\NormalTok{\}}
\end{Highlighting}
\end{Shaded}

or more simply

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{sqrt_minus_}\DecValTok{1}\NormalTok{ <-}\StringTok{ }\ControlFlowTok{function}\NormalTok{(x) \{}
  \KeywordTok{sqrt}\NormalTok{(x }\OperatorTok{-}\StringTok{ }\DecValTok{1}\NormalTok{)}
\NormalTok{\}}
\end{Highlighting}
\end{Shaded}

If last line of function calculates value without saving it, that value
is returned.

\end{frame}

\begin{frame}[fragile]{About the input; testing}
\protect\hypertarget{about-the-input-testing}{}

\begin{itemize}
\tightlist
\item
  The input to a function can be called anything. Here we called it
  \texttt{x}. This is the name used inside the function.
\item
  The function is a ``machine'' for calculating square-root-minus-1. It
  doesn't do anything until you call it:
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{sqrt_minus_1}\NormalTok{(}\DecValTok{50}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 7
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{sqrt_minus_1}\NormalTok{(}\DecValTok{11}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 3.162278
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{sqrt_minus_1}\NormalTok{(}\DecValTok{3}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 1.414214
\end{verbatim}

\begin{itemize}
\tightlist
\item
  It works!
\end{itemize}

\end{frame}

\begin{frame}[fragile]{Vectorization 1/2}
\protect\hypertarget{vectorization-12}{}

\begin{itemize}
\tightlist
\item
  We conceived our function to work on numbers:
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{sqrt_minus_1}\NormalTok{(}\FloatTok{3.25}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 1.5
\end{verbatim}

\begin{itemize}
\tightlist
\item
  but it actually works on vectors too, as a free bonus of R:
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{sqrt_minus_1}\NormalTok{(}\KeywordTok{c}\NormalTok{(}\DecValTok{50}\NormalTok{, }\DecValTok{11}\NormalTok{, }\DecValTok{3}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 7.000000 3.162278 1.414214
\end{verbatim}

\begin{itemize}
\tightlist
\item
  or\ldots{} (over)
\end{itemize}

\end{frame}

\begin{frame}[fragile]{Vectorization 2/2}
\protect\hypertarget{vectorization-22}{}

\begin{itemize}
\tightlist
\item
  or even data frames:
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{d <-}\StringTok{ }\KeywordTok{tibble}\NormalTok{(}\DataTypeTok{x =} \DecValTok{1}\OperatorTok{:}\DecValTok{2}\NormalTok{, }\DataTypeTok{y =} \DecValTok{3}\OperatorTok{:}\DecValTok{4}\NormalTok{)}
\KeywordTok{sqrt_minus_1}\NormalTok{(d)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##   x        y
## 1 0 1.414214
## 2 1 1.732051
\end{verbatim}

\end{frame}

\begin{frame}[fragile]{More than one input}
\protect\hypertarget{more-than-one-input}{}

\begin{itemize}
\tightlist
\item
  Allow the value to be subtracted, before taking square root, to be
  input to function as well, thus:
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{sqrt_minus_value <-}\StringTok{ }\ControlFlowTok{function}\NormalTok{(x, d) \{}
  \KeywordTok{sqrt}\NormalTok{(x }\OperatorTok{-}\StringTok{ }\NormalTok{d)}
\NormalTok{\}}
\end{Highlighting}
\end{Shaded}

\begin{itemize}
\tightlist
\item
  Call the function with the x and d inputs in the right order:
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{sqrt_minus_value}\NormalTok{(}\DecValTok{51}\NormalTok{, }\DecValTok{2}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 7
\end{verbatim}

\begin{itemize}
\tightlist
\item
  or give the inputs names, in which case they can be in any order:
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{sqrt_minus_value}\NormalTok{(}\DataTypeTok{d =} \DecValTok{2}\NormalTok{, }\DataTypeTok{x =} \DecValTok{51}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 7
\end{verbatim}

\end{frame}

\begin{frame}[fragile]{Defaults 1/2}
\protect\hypertarget{defaults-12}{}

\begin{itemize}
\tightlist
\item
  Many R functions have values that you can change if you want to, but
  usually you don't want to, for example:
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{x <-}\StringTok{ }\KeywordTok{c}\NormalTok{(}\DecValTok{3}\NormalTok{, }\DecValTok{4}\NormalTok{, }\DecValTok{5}\NormalTok{, }\OtherTok{NA}\NormalTok{, }\DecValTok{6}\NormalTok{, }\DecValTok{7}\NormalTok{)}
\KeywordTok{mean}\NormalTok{(x)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] NA
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{mean}\NormalTok{(x, }\DataTypeTok{na.rm =}\NormalTok{ T)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 5
\end{verbatim}

\begin{itemize}
\item
  By default, the mean of data with a missing value is missing, but if
  you specify \texttt{na.rm=T}, the missing values are removed before
  the mean is calculated.
\item
  That is, \texttt{na.rm} has a default value of \texttt{F}: that's what
  it will be unless you change it.
\end{itemize}

\end{frame}

\begin{frame}[fragile]{Defaults 2/2}
\protect\hypertarget{defaults-22}{}

\begin{itemize}
\tightlist
\item
  In our function, set a default value for d like this:
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{sqrt_minus_value <-}\StringTok{ }\ControlFlowTok{function}\NormalTok{(x, }\DataTypeTok{d =} \DecValTok{1}\NormalTok{) \{}
  \KeywordTok{sqrt}\NormalTok{(x }\OperatorTok{-}\StringTok{ }\NormalTok{d)}
\NormalTok{\}}
\end{Highlighting}
\end{Shaded}

\begin{itemize}
\tightlist
\item
  If you specify a value for d, it will be used. If you don't, 1 will be
  used instead:
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{sqrt_minus_value}\NormalTok{(}\DecValTok{51}\NormalTok{, }\DecValTok{2}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 7
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{sqrt_minus_value}\NormalTok{(}\DecValTok{51}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 7.071068
\end{verbatim}

\end{frame}

\begin{frame}[fragile]{Catching errors before they happen}
\protect\hypertarget{catching-errors-before-they-happen}{}

\begin{itemize}
\tightlist
\item
  What happened here?
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{sqrt_minus_value}\NormalTok{(}\DecValTok{6}\NormalTok{, }\DecValTok{8}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Warning in sqrt(x - d): NaNs produced
\end{verbatim}

\begin{verbatim}
## [1] NaN
\end{verbatim}

\begin{itemize}
\tightlist
\item
  Message not helpful. Actually, function tried to take square root of
  negative number.
\item
  In fact, not even error, just warning.
\item
  Check that the square root will be OK first. Here's how:
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{sqrt_minus_value <-}\StringTok{ }\ControlFlowTok{function}\NormalTok{(x, }\DataTypeTok{d =} \DecValTok{1}\NormalTok{) \{}
  \KeywordTok{stopifnot}\NormalTok{(x }\OperatorTok{-}\StringTok{ }\NormalTok{d }\OperatorTok{>=}\StringTok{ }\DecValTok{0}\NormalTok{)}
  \KeywordTok{sqrt}\NormalTok{(x }\OperatorTok{-}\StringTok{ }\NormalTok{d)}
\NormalTok{\}}
\end{Highlighting}
\end{Shaded}

\end{frame}

\begin{frame}[fragile]{What happens with \texttt{stopifnot}}
\protect\hypertarget{what-happens-with-stopifnot}{}

\begin{itemize}
\tightlist
\item
  This should be good, and is:
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{sqrt_minus_value}\NormalTok{(}\DecValTok{8}\NormalTok{, }\DecValTok{6}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 1.414214
\end{verbatim}

\begin{itemize}
\tightlist
\item
  This should fail, and see how it does:
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{sqrt_minus_value}\NormalTok{(}\DecValTok{6}\NormalTok{, }\DecValTok{8}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Error in sqrt_minus_value(6, 8): x - d >= 0 is not TRUE
\end{verbatim}

\begin{itemize}
\tightlist
\item
  Where the function fails, we get informative error, but if everything
  good, the \texttt{stopifnot} does nothing.
\item
  \texttt{stopifnot} contains one or more logical conditions, and all of
  them have to be true for function to work. So put in everything that
  you want to be true.
\end{itemize}

\end{frame}

\begin{frame}[fragile]{Using R's built-ins}
\protect\hypertarget{using-rs-built-ins}{}

\begin{itemize}
\tightlist
\item
  When you write a function, you can use anything built-in to R, or even
  any functions that you defined before.
\item
  For example, if you will be calculating a lot of regression-line
  slopes, you don't have to do this from scratch: you can use R's
  regression calculations, like this:
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{xx <-}\StringTok{ }\DecValTok{1}\OperatorTok{:}\DecValTok{4}
\NormalTok{yy <-}\StringTok{ }\KeywordTok{c}\NormalTok{(}\DecValTok{10}\NormalTok{, }\DecValTok{11}\NormalTok{, }\DecValTok{10}\NormalTok{, }\DecValTok{14}\NormalTok{)}
\NormalTok{yy}\FloatTok{.1}\NormalTok{ <-}\StringTok{ }\KeywordTok{lm}\NormalTok{(yy }\OperatorTok{~}\StringTok{ }\NormalTok{xx)}
\KeywordTok{coef}\NormalTok{(yy}\FloatTok{.1}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## (Intercept)          xx 
##         8.5         1.1
\end{verbatim}

\begin{itemize}
\tightlist
\item
  These are the intercept and the slope, in that order.
\end{itemize}

\end{frame}

\begin{frame}[fragile]{Is this the right thing?}
\protect\hypertarget{is-this-the-right-thing}{}

Check by looking at the summary output from the regression:

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{tidy}\NormalTok{(yy}\FloatTok{.1}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 2 x 5
##   term        estimate std.error statistic p.value
##   <chr>          <dbl>     <dbl>     <dbl>   <dbl>
## 1 (Intercept)     8.5      1.88       4.53  0.0455
## 2 xx              1.10     0.686      1.60  0.250
\end{verbatim}

\end{frame}

\begin{frame}[fragile]{Making this into a function}
\protect\hypertarget{making-this-into-a-function}{}

\begin{itemize}
\tightlist
\item
  First step: make sure you have it working without a function.
\item
  We do: fit an \texttt{lm} and take the second thing out of
  \texttt{coef}.
\item
  Two inputs, the \texttt{x} and the \texttt{y}, which I take in that
  order.
\item
  Output: just the slope (we throw away intercept). Thus:
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{slope <-}\StringTok{ }\ControlFlowTok{function}\NormalTok{(x, y) \{}
\NormalTok{  y}\FloatTok{.1}\NormalTok{ <-}\StringTok{ }\KeywordTok{lm}\NormalTok{(y }\OperatorTok{~}\StringTok{ }\NormalTok{x)}
\NormalTok{  ans <-}\StringTok{ }\KeywordTok{coef}\NormalTok{(y}\FloatTok{.1}\NormalTok{)}
\NormalTok{  ans[}\DecValTok{2}\NormalTok{]}
\NormalTok{\}}
\end{Highlighting}
\end{Shaded}

\begin{itemize}
\tightlist
\item
  Check using our data from before: correct:
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{slope}\NormalTok{(xx, yy)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##   x 
## 1.1
\end{verbatim}

\end{frame}

\begin{frame}[fragile]{Passing things on}
\protect\hypertarget{passing-things-on}{}

\begin{itemize}
\tightlist
\item
  \texttt{lm} has a lot of options, with defaults, that we might want to
  change. Instead of intercepting all the possibilities and passing them
  on, we can do this:
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{slope <-}\StringTok{ }\ControlFlowTok{function}\NormalTok{(x, y, ...) \{}
\NormalTok{  y}\FloatTok{.1}\NormalTok{ <-}\StringTok{ }\KeywordTok{lm}\NormalTok{(y }\OperatorTok{~}\StringTok{ }\NormalTok{x, ...)}
\NormalTok{  ans <-}\StringTok{ }\KeywordTok{coef}\NormalTok{(y}\FloatTok{.1}\NormalTok{)}
\NormalTok{  ans[}\DecValTok{2}\NormalTok{]}
\NormalTok{\}}
\end{Highlighting}
\end{Shaded}

\begin{itemize}
\tightlist
\item
  The \texttt{...} in the header line means ``accept any other input'',
  and the \texttt{...} in the lm line means ``pass anything other than
  \texttt{x} and \texttt{y} straight on to \texttt{lm}''.
\end{itemize}

\end{frame}

\begin{frame}[fragile]{Using \texttt{...}}
\protect\hypertarget{using-...}{}

\begin{itemize}
\tightlist
\item
  One of the things \texttt{lm} will accept is a vector called
  \texttt{subset} containing the list of observations to include in the
  regression.
\item
  So we should be able to do this:
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{xx}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 1 2 3 4
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{yy}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 10 11 10 14
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{slope}\NormalTok{(xx, yy, }\DataTypeTok{subset =} \DecValTok{1}\OperatorTok{:}\DecValTok{2}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## x 
## 1
\end{verbatim}

\begin{itemize}
\tightlist
\item
  Just uses the first two observations in xx and yy, so the slope should
  be \((11 − 10)/(2 − 1) = 1\) and is.
\end{itemize}

\end{frame}

\begin{frame}[fragile]{Running a function for each of several inputs}
\protect\hypertarget{running-a-function-for-each-of-several-inputs}{}

\begin{itemize}
\tightlist
\item
  Suppose we have a data frame containing several different \texttt{x}'s
  to use in regressions:
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(d <-}\StringTok{ }\KeywordTok{tibble}\NormalTok{(}\DataTypeTok{x1 =} \DecValTok{1}\OperatorTok{:}\DecValTok{4}\NormalTok{, }\DataTypeTok{x2 =} \KeywordTok{c}\NormalTok{(}\DecValTok{8}\NormalTok{, }\DecValTok{7}\NormalTok{, }\DecValTok{6}\NormalTok{, }\DecValTok{5}\NormalTok{), }\DataTypeTok{x3 =} \KeywordTok{c}\NormalTok{(}\DecValTok{2}\NormalTok{, }\DecValTok{4}\NormalTok{, }\DecValTok{6}\NormalTok{, }\DecValTok{9}\NormalTok{)))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 4 x 3
##      x1    x2    x3
##   <int> <dbl> <dbl>
## 1     1     8     2
## 2     2     7     4
## 3     3     6     6
## 4     4     5     9
\end{verbatim}

\begin{itemize}
\tightlist
\item
  Want to use these as different x's for a regression with our yy as the
  response, and collect together the three different slopes.
\item
  Python-like way: a \texttt{for} loop.
\item
  R-like way: \texttt{map\_dbl}: less coding, but more thinking.
\end{itemize}

\end{frame}

\begin{frame}[fragile]{The loop way}
\protect\hypertarget{the-loop-way}{}

\begin{itemize}
\tightlist
\item
  ``Pull out'' column \texttt{i} of data frame \texttt{d} as
  \texttt{d\ \%\textgreater{}\%\ pull(i)}.
\item
  Create empty vector slopes to store the slopes.
\item
  Looping variable \texttt{i} goes from 1 to 3 (3 columns, thus 3
  slopes):
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{slopes <-}\StringTok{ }\KeywordTok{numeric}\NormalTok{(}\DecValTok{3}\NormalTok{)}
\ControlFlowTok{for}\NormalTok{ (i }\ControlFlowTok{in} \DecValTok{1}\OperatorTok{:}\DecValTok{3}\NormalTok{) \{}
\NormalTok{  xx <-}\StringTok{ }\NormalTok{d }\OperatorTok{%>%}\StringTok{ }\KeywordTok{pull}\NormalTok{(i)}
\NormalTok{  slopes[i] <-}\StringTok{ }\KeywordTok{slope}\NormalTok{(xx, yy)}
\NormalTok{\}}
\NormalTok{slopes}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1]  1.1000000 -1.1000000  0.5140187
\end{verbatim}

\begin{itemize}
\tightlist
\item
  Check this by doing the three lm's, one at a time.
\end{itemize}

\end{frame}

\begin{frame}[fragile]{The \texttt{map\_dbl} way}
\protect\hypertarget{the-map_dbl-way}{}

\begin{itemize}
\tightlist
\item
  ``for each of these (columns of \texttt{d}), run function
  (\texttt{slope}) with inputs it and \texttt{yy}), and collect together
  the answers''.
\item
  Since slope returns a decimal number (a \texttt{dbl}), appropriate
  function-running function is \texttt{map\_dbl}:
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{map_dbl}\NormalTok{(d, }\OperatorTok{~}\StringTok{ }\KeywordTok{slope}\NormalTok{(., yy))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##         x1         x2         x3 
##  1.1000000 -1.1000000  0.5140187
\end{verbatim}

\begin{itemize}
\tightlist
\item
  Same as loop, with a lot less coding.
\item
  ``Find the square roots of each of the numbers 1 through 10'':
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{map_dbl}\NormalTok{(}\DecValTok{1}\OperatorTok{:}\DecValTok{10}\NormalTok{, }\OperatorTok{~}\StringTok{ }\KeywordTok{sqrt}\NormalTok{(.))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##  [1] 1.000000 1.414214 1.732051 2.000000 2.236068
##  [6] 2.449490 2.645751 2.828427 3.000000 3.162278
\end{verbatim}

\end{frame}

\begin{frame}[fragile]{Summarizing all columns of a data frame, two
ways}
\protect\hypertarget{summarizing-all-columns-of-a-data-frame-two-ways}{}

\begin{itemize}
\tightlist
\item
  use my \texttt{d} from above:
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{map_dbl}\NormalTok{(d, }\OperatorTok{~}\StringTok{ }\KeywordTok{mean}\NormalTok{(.))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##   x1   x2   x3 
## 2.50 6.50 5.25
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{d }\OperatorTok{%>%}\StringTok{ }\KeywordTok{summarize_all}\NormalTok{(}\OperatorTok{~}\StringTok{ }\KeywordTok{mean}\NormalTok{(.))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 1 x 3
##      x1    x2    x3
##   <dbl> <dbl> <dbl>
## 1   2.5   6.5  5.25
\end{verbatim}

The mean of each column, with the columns labelled.

\end{frame}

\begin{frame}[fragile]{What if summary returns more than one thing?}
\protect\hypertarget{what-if-summary-returns-more-than-one-thing}{}

\begin{itemize}
\tightlist
\item
  For example, finding quartiles:
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{quartiles <-}\StringTok{ }\ControlFlowTok{function}\NormalTok{(x) \{}
  \KeywordTok{quantile}\NormalTok{(x, }\KeywordTok{c}\NormalTok{(}\FloatTok{0.25}\NormalTok{, }\FloatTok{0.75}\NormalTok{))}
\NormalTok{\}}
\KeywordTok{quartiles}\NormalTok{(}\DecValTok{1}\OperatorTok{:}\DecValTok{5}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## 25% 75% 
##   2   4
\end{verbatim}

\begin{itemize}
\tightlist
\item
  When function returns more than one thing, \texttt{map} (or
  \texttt{map\_df}) instead of \texttt{map\_dbl}.
\end{itemize}

\end{frame}

\begin{frame}[fragile]{map results}
\protect\hypertarget{map-results}{}

\begin{itemize}
\tightlist
\item
  Try:
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{map}\NormalTok{(d, }\OperatorTok{~}\StringTok{ }\KeywordTok{quartiles}\NormalTok{(.))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## $x1
##  25%  75% 
## 1.75 3.25 
## 
## $x2
##  25%  75% 
## 5.75 7.25 
## 
## $x3
##  25%  75% 
## 3.50 6.75
\end{verbatim}

\begin{itemize}
\tightlist
\item
  A list.
\end{itemize}

\end{frame}

\begin{frame}[fragile]{Or}
\protect\hypertarget{or}{}

\begin{itemize}
\tightlist
\item
  Better: pretend output from quartiles is one-column data frame:
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{map_df}\NormalTok{(d, }\OperatorTok{~}\StringTok{ }\KeywordTok{quartiles}\NormalTok{(.))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 2 x 3
##      x1    x2    x3
##   <dbl> <dbl> <dbl>
## 1  1.75  5.75  3.5 
## 2  3.25  7.25  6.75
\end{verbatim}

\end{frame}

\begin{frame}[fragile]{Or even}
\protect\hypertarget{or-even}{}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{d }\OperatorTok{%>%}\StringTok{ }\KeywordTok{map_df}\NormalTok{(}\OperatorTok{~}\StringTok{ }\KeywordTok{quartiles}\NormalTok{(.))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 2 x 3
##      x1    x2    x3
##   <dbl> <dbl> <dbl>
## 1  1.75  5.75  3.5 
## 2  3.25  7.25  6.75
\end{verbatim}

\end{frame}

\begin{frame}[fragile]{Comments}
\protect\hypertarget{comments-25}{}

\begin{itemize}
\tightlist
\item
  This works because the implicit first thing in map is (the columns of)
  the data frame that came out of the previous step.
\item
  These are 1st and 3rd quartiles of each column of \texttt{d},
  according to R's default definition (see help for \texttt{quantile}).
\end{itemize}

\end{frame}

\begin{frame}[fragile]{\texttt{Map} in data frames with \texttt{mutate}}
\protect\hypertarget{map-in-data-frames-with-mutate}{}

\begin{itemize}
\tightlist
\item
  \texttt{map} can also be used within data frames to calculate new
  columns. Let's do the square roots of 1 through 10 again:
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{d <-}\StringTok{ }\KeywordTok{tibble}\NormalTok{(}\DataTypeTok{x =} \DecValTok{1}\OperatorTok{:}\DecValTok{10}\NormalTok{)}
\NormalTok{d }\OperatorTok{%>%}\StringTok{ }\KeywordTok{mutate}\NormalTok{(}\DataTypeTok{root =} \KeywordTok{map_dbl}\NormalTok{(x, }\OperatorTok{~}\StringTok{ }\KeywordTok{sqrt}\NormalTok{(.)))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 10 x 2
##        x  root
##    <int> <dbl>
##  1     1  1   
##  2     2  1.41
##  3     3  1.73
##  4     4  2   
##  5     5  2.24
##  6     6  2.45
##  7     7  2.65
##  8     8  2.83
##  9     9  3   
## 10    10  3.16
\end{verbatim}

\end{frame}

\begin{frame}[fragile]{Write a function first and then map it}
\protect\hypertarget{write-a-function-first-and-then-map-it}{}

\begin{itemize}
\tightlist
\item
  If the ``for each'' part is simple, go ahead and use
  \texttt{map\_}-whatever.
\item
  If not, write a function to do the complicated thing first.
\item
  Example: ``half or triple plus one'': if the input is an even number,
  halve it; if it is an odd number, multiply it by three and add one.
\item
  This is hard to do as a one-liner: first we have to figure out whether
  the input is odd or even, and then we have to do the right thing with
  it.
\item
  Odd or even? Work out the remainder when dividing by 2:
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\DecValTok{6} \OperatorTok{%%}\StringTok{ }\DecValTok{2}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 0
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\DecValTok{5} \OperatorTok{%%}\StringTok{ }\DecValTok{2}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 1
\end{verbatim}

\begin{itemize}
\tightlist
\item
  5 has remainder 1 so it is odd.
\end{itemize}

\end{frame}

\begin{frame}[fragile]{Write the function}
\protect\hypertarget{write-the-function}{}

\begin{itemize}
\tightlist
\item
  First test for odd or even, and then do the appropriate calculation:
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{hotpo <-}\StringTok{ }\ControlFlowTok{function}\NormalTok{(x) \{}
  \KeywordTok{stopifnot}\NormalTok{(}\KeywordTok{round}\NormalTok{(x) }\OperatorTok{==}\StringTok{ }\NormalTok{x)}
\NormalTok{  remainder <-}\StringTok{ }\NormalTok{x }\OperatorTok{%%}\StringTok{ }\DecValTok{2}
  \ControlFlowTok{if}\NormalTok{ (remainder }\OperatorTok{==}\StringTok{ }\DecValTok{1}\NormalTok{) \{}
\NormalTok{    ans <-}\StringTok{ }\DecValTok{3} \OperatorTok{*}\StringTok{ }\NormalTok{x }\OperatorTok{+}\StringTok{ }\DecValTok{1}
\NormalTok{  \}}
  \ControlFlowTok{else}\NormalTok{ \{}
\NormalTok{    ans <-}\StringTok{ }\NormalTok{x }\OperatorTok{/}\StringTok{ }\DecValTok{2}
\NormalTok{  \}}
  \KeywordTok{as.integer}\NormalTok{(ans)}
\NormalTok{\}}
\end{Highlighting}
\end{Shaded}

\end{frame}

\begin{frame}[fragile]{Test it}
\protect\hypertarget{test-it}{}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{hotpo}\NormalTok{(}\DecValTok{3}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 10
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{hotpo}\NormalTok{(}\DecValTok{12}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 6
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{hotpo}\NormalTok{(}\FloatTok{4.5}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Error in hotpo(4.5): round(x) == x is not TRUE
\end{verbatim}

\end{frame}

\begin{frame}[fragile]{One through ten}
\protect\hypertarget{one-through-ten}{}

\begin{itemize}
\tightlist
\item
  Use a data frame of numbers 1 through 10 again:
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{tibble}\NormalTok{(}\DataTypeTok{x =} \DecValTok{1}\OperatorTok{:}\DecValTok{10}\NormalTok{) }\OperatorTok{%>%}\StringTok{ }\KeywordTok{mutate}\NormalTok{(}\DataTypeTok{y =} \KeywordTok{map_int}\NormalTok{(x, }\OperatorTok{~}\KeywordTok{hotpo}\NormalTok{(.)))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 10 x 2
##        x     y
##    <int> <int>
##  1     1     4
##  2     2     1
##  3     3    10
##  4     4     2
##  5     5    16
##  6     6     3
##  7     7    22
##  8     8     4
##  9     9    28
## 10    10     5
\end{verbatim}

\end{frame}

\begin{frame}[fragile]{Until I get to 1 (if I ever do)}
\protect\hypertarget{until-i-get-to-1-if-i-ever-do}{}

\begin{itemize}
\tightlist
\item
  If I start from a number, find \texttt{hotpo} of it, then find
  \texttt{hotpo} of that, and keep going, what happens?
\item
  If I get to 4, 2, 1, 4, 2, 1 I'll repeat for ever, so let's stop when
  we get to 1:
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{hotpo_seq <-}\StringTok{ }\ControlFlowTok{function}\NormalTok{(x) \{}
\NormalTok{  ans <-}\StringTok{ }\NormalTok{x}
  \ControlFlowTok{while}\NormalTok{ (x }\OperatorTok{!=}\StringTok{ }\DecValTok{1}\NormalTok{) \{}
\NormalTok{    x <-}\StringTok{ }\KeywordTok{hotpo}\NormalTok{(x)}
\NormalTok{    ans <-}\StringTok{ }\KeywordTok{c}\NormalTok{(ans, x)}
\NormalTok{  \}}
\NormalTok{  ans}
\NormalTok{\}}
\end{Highlighting}
\end{Shaded}

\begin{itemize}
\tightlist
\item
  Strategy: keep looping ``while \texttt{x} is not 1''.
\item
  Each new \texttt{x}: add to the end of \texttt{ans}. When I hit 1, I
  break out of the \texttt{while} and return the whole \texttt{ans}.
\end{itemize}

\end{frame}

\begin{frame}[fragile]{Trying it 1/2}
\protect\hypertarget{trying-it-12}{}

\begin{itemize}
\tightlist
\item
  Start at 6:
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{hotpo_seq}\NormalTok{(}\DecValTok{6}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1]  6  3 10  5 16  8  4  2  1
\end{verbatim}

\end{frame}

\begin{frame}[fragile]{Trying it 2/2}
\protect\hypertarget{trying-it-22}{}

\begin{itemize}
\tightlist
\item
  Start at 27:
\end{itemize}

\footnotesize

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{hotpo_seq}\NormalTok{(}\DecValTok{27}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##   [1]   27   82   41  124   62   31   94   47  142
##  [10]   71  214  107  322  161  484  242  121  364
##  [19]  182   91  274  137  412  206  103  310  155
##  [28]  466  233  700  350  175  526  263  790  395
##  [37] 1186  593 1780  890  445 1336  668  334  167
##  [46]  502  251  754  377 1132  566  283  850  425
##  [55] 1276  638  319  958  479 1438  719 2158 1079
##  [64] 3238 1619 4858 2429 7288 3644 1822  911 2734
##  [73] 1367 4102 2051 6154 3077 9232 4616 2308 1154
##  [82]  577 1732  866  433 1300  650  325  976  488
##  [91]  244  122   61  184   92   46   23   70   35
## [100]  106   53  160   80   40   20   10    5   16
## [109]    8    4    2    1
\end{verbatim}

\normalsize

\end{frame}

\begin{frame}[fragile]{Which starting points have the longest
sequences?}
\protect\hypertarget{which-starting-points-have-the-longest-sequences}{}

\begin{itemize}
\tightlist
\item
  The \texttt{length} of the vector returned from \texttt{hotpo\_seq}
  says how long it took to get to 1.
\item
  Out of the starting points 1 to 100, which one has the longest
  sequence?
\end{itemize}

\small

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{tibble}\NormalTok{(}\DataTypeTok{start =} \DecValTok{1}\OperatorTok{:}\DecValTok{100}\NormalTok{) }\OperatorTok{%>%}
\StringTok{  }\KeywordTok{mutate}\NormalTok{(}\DataTypeTok{seq_length =} \KeywordTok{map_int}\NormalTok{(start, }\OperatorTok{~}\StringTok{ }\KeywordTok{length}\NormalTok{(}\KeywordTok{hotpo_seq}\NormalTok{(.)))) }\OperatorTok{%>%}
\StringTok{  }\KeywordTok{arrange}\NormalTok{(}\KeywordTok{desc}\NormalTok{(seq_length)) }\OperatorTok{%>%}
\StringTok{  }\KeywordTok{slice}\NormalTok{(}\DecValTok{1}\OperatorTok{:}\DecValTok{5}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 5 x 2
##   start seq_length
##   <int>      <int>
## 1    97        119
## 2    73        116
## 3    54        113
## 4    55        113
## 5    27        112
\end{verbatim}

\normalsize

\end{frame}

\begin{frame}[fragile]{What happens if we save the entire sequence?}
\protect\hypertarget{what-happens-if-we-save-the-entire-sequence}{}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{tibble}\NormalTok{(}\DataTypeTok{start =} \DecValTok{1}\OperatorTok{:}\DecValTok{7}\NormalTok{) }\OperatorTok{%>%}
\StringTok{  }\KeywordTok{mutate}\NormalTok{(}\DataTypeTok{sequence =} \KeywordTok{map}\NormalTok{(start, }\OperatorTok{~}\StringTok{ }\KeywordTok{hotpo_seq}\NormalTok{(.)))}
\end{Highlighting}
\end{Shaded}

\includegraphics[width=\textwidth,height=2.08333in]{Screenshot_2019-05-07_13-45-12.png}

\begin{itemize}
\tightlist
\item
  Each entry in sequence is itself a vector. sequence is called a
  ``list-column''.
\end{itemize}

\end{frame}

\begin{frame}[fragile]{Using the whole sequence to find its length and
its max}
\protect\hypertarget{using-the-whole-sequence-to-find-its-length-and-its-max}{}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{tibble}\NormalTok{(}\DataTypeTok{start =} \DecValTok{1}\OperatorTok{:}\DecValTok{7}\NormalTok{) }\OperatorTok{%>%}
\StringTok{  }\KeywordTok{mutate}\NormalTok{(}\DataTypeTok{sequence =} \KeywordTok{map}\NormalTok{(start, }\OperatorTok{~}\StringTok{ }\KeywordTok{hotpo_seq}\NormalTok{(.))) }\OperatorTok{%>%}
\StringTok{  }\KeywordTok{mutate}\NormalTok{(}
    \DataTypeTok{seq_length =} \KeywordTok{map_int}\NormalTok{(sequence, }\OperatorTok{~}\StringTok{ }\KeywordTok{length}\NormalTok{(.)),}
    \DataTypeTok{seq_max =} \KeywordTok{map_int}\NormalTok{(sequence, }\OperatorTok{~}\StringTok{ }\KeywordTok{max}\NormalTok{(.))}
\NormalTok{  )}
\end{Highlighting}
\end{Shaded}

\includegraphics{Screenshot_2019-05-07_13-47-08.png}

\end{frame}

\begin{frame}{Final thoughts on this}
\protect\hypertarget{final-thoughts-on-this}{}

\begin{itemize}
\tightlist
\item
  Called the \textbf{Collatz conjecture}.
\item
  Nobody knows whether the sequence always gets to 1.
\item
  Nobody has found an n for which it doesn't.
\item
  \href{https://en.wikipedia.org/wiki/Collatz_conjecture\#/media/File:Collatz-graph-all-30-no27.svg}{A
  pretty tree (click):}
\end{itemize}

\end{frame}

\hypertarget{dates-and-times}{%
\section{Dates and times}\label{dates-and-times}}

\begin{frame}[fragile]{Packages for this section}
\protect\hypertarget{packages-for-this-section-9}{}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{library}\NormalTok{(tidyverse)}
\KeywordTok{library}\NormalTok{(lubridate)}
\end{Highlighting}
\end{Shaded}

\end{frame}

\begin{frame}[fragile]{Dates}
\protect\hypertarget{dates}{}

\begin{itemize}
\tightlist
\item
  Dates represented on computers as ``days since an origin'', typically
  Jan 1, 1970, with a negative date being before the origin:
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{mydates <-}\StringTok{ }\KeywordTok{c}\NormalTok{(}\StringTok{"1970-01-01"}\NormalTok{, }\StringTok{"2007-09-04"}\NormalTok{, }\StringTok{"1931-08-05"}\NormalTok{)}
\NormalTok{(somedates <-}\StringTok{ }\KeywordTok{tibble}\NormalTok{(}\DataTypeTok{text =}\NormalTok{ mydates) }\OperatorTok{%>%}
\StringTok{  }\KeywordTok{mutate}\NormalTok{(}
    \DataTypeTok{d =} \KeywordTok{as.Date}\NormalTok{(text),}
    \DataTypeTok{numbers =} \KeywordTok{as.numeric}\NormalTok{(d)}
\NormalTok{  ))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 3 x 3
##   text       d          numbers
##   <chr>      <date>       <dbl>
## 1 1970-01-01 1970-01-01       0
## 2 2007-09-04 2007-09-04   13760
## 3 1931-08-05 1931-08-05  -14029
\end{verbatim}

\end{frame}

\begin{frame}[fragile]{Doing arithmetic with dates}
\protect\hypertarget{doing-arithmetic-with-dates}{}

\begin{itemize}
\tightlist
\item
  Dates are ``actually'' numbers, so can add and subtract:
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{somedates }\OperatorTok{%>%}\StringTok{ }\KeywordTok{mutate}\NormalTok{(}\DataTypeTok{plus30 =}\NormalTok{ d }\OperatorTok{+}\StringTok{ }\DecValTok{30}\NormalTok{, }\DataTypeTok{diffs =}\NormalTok{ d[}\DecValTok{2}\NormalTok{] }\OperatorTok{-}\StringTok{ }\NormalTok{d)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 3 x 5
##   text       d          numbers plus30     diffs    
##   <chr>      <date>       <dbl> <date>     <drtn>   
## 1 1970-01-01 1970-01-01       0 1970-01-31 13760 da…
## 2 2007-09-04 2007-09-04   13760 2007-10-04     0 da…
## 3 1931-08-05 1931-08-05  -14029 1931-09-04 27789 da…
\end{verbatim}

\end{frame}

\begin{frame}[fragile]{Reading in dates from a file}
\protect\hypertarget{reading-in-dates-from-a-file}{}

\begin{itemize}
\tightlist
\item
  \texttt{read\_csv} and the others can guess that you have dates, if
  you format them as year-month-day, like column 1 of this
  \texttt{.csv}:
\end{itemize}

\begin{verbatim}
date,status,dunno
2011-08-03,hello,August 3 2011
2011-11-15,still here,November 15 2011
2012-02-01,goodbye,February 1 2012
\end{verbatim}

\begin{itemize}
\tightlist
\item
  Then read them in:
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{my_url <-}\StringTok{ "http://www.utsc.utoronto.ca/~butler/c32/mydates.csv"}
\NormalTok{ddd <-}\StringTok{ }\KeywordTok{read_csv}\NormalTok{(my_url)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Parsed with column specification:
## cols(
##   date = col_date(format = ""),
##   status = col_character(),
##   dunno = col_character()
## )
\end{verbatim}

\begin{itemize}
\tightlist
\item
  read\_csv guessed that the 1st column is dates, but not 3rd.
\end{itemize}

\end{frame}

\begin{frame}[fragile]{The data as read in}
\protect\hypertarget{the-data-as-read-in}{}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{ddd}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 3 x 3
##   date       status     dunno           
##   <date>     <chr>      <chr>           
## 1 2011-08-03 hello      August 3 2011   
## 2 2011-11-15 still here November 15 2011
## 3 2012-02-01 goodbye    February 1 2012
\end{verbatim}

\end{frame}

\begin{frame}[fragile]{Dates in other formats}
\protect\hypertarget{dates-in-other-formats}{}

\begin{itemize}
\tightlist
\item
  Preceding shows that dates should be stored as text in format
  yyyy-mm-dd (ISO standard).
\item
  To deal with dates in other formats, use package \texttt{lubridate}
  and convert. For example, dates in US format with month first:
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{tibble}\NormalTok{(}\DataTypeTok{usdates =} \KeywordTok{c}\NormalTok{(}\StringTok{"05/27/2012"}\NormalTok{, }\StringTok{"01/03/2016"}\NormalTok{, }\StringTok{"12/31/2015"}\NormalTok{)) }\OperatorTok{%>%}
\StringTok{  }\KeywordTok{mutate}\NormalTok{(}\DataTypeTok{iso =} \KeywordTok{mdy}\NormalTok{(usdates))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 3 x 2
##   usdates    iso       
##   <chr>      <date>    
## 1 05/27/2012 2012-05-27
## 2 01/03/2016 2016-01-03
## 3 12/31/2015 2015-12-31
\end{verbatim}

\end{frame}

\begin{frame}[fragile]{Trying to read these as UK dates}
\protect\hypertarget{trying-to-read-these-as-uk-dates}{}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{tibble}\NormalTok{(}\DataTypeTok{usdates =} \KeywordTok{c}\NormalTok{(}\StringTok{"05/27/2012"}\NormalTok{, }\StringTok{"01/03/2016"}\NormalTok{, }\StringTok{"12/31/2015"}\NormalTok{)) }\OperatorTok{%>%}
\StringTok{  }\KeywordTok{mutate}\NormalTok{(}\DataTypeTok{uk =} \KeywordTok{dmy}\NormalTok{(usdates))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Warning: 2 failed to parse.
\end{verbatim}

\begin{verbatim}
## # A tibble: 3 x 2
##   usdates    uk        
##   <chr>      <date>    
## 1 05/27/2012 NA        
## 2 01/03/2016 2016-03-01
## 3 12/31/2015 NA
\end{verbatim}

\begin{itemize}
\tightlist
\item
  For UK-format dates with month second, one of these dates is legit,
  but the other two make no sense.
\end{itemize}

\end{frame}

\begin{frame}[fragile]{Our data frame's last column:}
\protect\hypertarget{our-data-frames-last-column}{}

\begin{itemize}
\tightlist
\item
  Back to this:
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{ddd}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 3 x 3
##   date       status     dunno           
##   <date>     <chr>      <chr>           
## 1 2011-08-03 hello      August 3 2011   
## 2 2011-11-15 still here November 15 2011
## 3 2012-02-01 goodbye    February 1 2012
\end{verbatim}

\begin{itemize}
\tightlist
\item
  Month, day, year in that order.
\end{itemize}

\end{frame}

\begin{frame}[fragile]{so interpret as such}
\protect\hypertarget{so-interpret-as-such}{}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(ddd }\OperatorTok{%>%}\StringTok{ }\KeywordTok{mutate}\NormalTok{(}\DataTypeTok{date2 =} \KeywordTok{mdy}\NormalTok{(dunno)) ->}\StringTok{ }\NormalTok{d4)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 3 x 4
##   date       status     dunno            date2     
##   <date>     <chr>      <chr>            <date>    
## 1 2011-08-03 hello      August 3 2011    2011-08-03
## 2 2011-11-15 still here November 15 2011 2011-11-15
## 3 2012-02-01 goodbye    February 1 2012  2012-02-01
\end{verbatim}

\end{frame}

\begin{frame}[fragile]{Are they really the same?}
\protect\hypertarget{are-they-really-the-same}{}

\begin{itemize}
\tightlist
\item
  Column \texttt{date2} was correctly converted from column
  \texttt{dunno}:
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{d4 }\OperatorTok{%>%}\StringTok{ }\KeywordTok{mutate}\NormalTok{(}\DataTypeTok{equal =} \KeywordTok{identical}\NormalTok{(date, date2))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 3 x 5
##   date       status    dunno        date2      equal
##   <date>     <chr>     <chr>        <date>     <lgl>
## 1 2011-08-03 hello     August 3 20… 2011-08-03 TRUE 
## 2 2011-11-15 still he… November 15… 2011-11-15 TRUE 
## 3 2012-02-01 goodbye   February 1 … 2012-02-01 TRUE
\end{verbatim}

\begin{itemize}
\tightlist
\item
  The two columns of dates are all the same.
\end{itemize}

\end{frame}

\begin{frame}[fragile]{Making dates from pieces}
\protect\hypertarget{making-dates-from-pieces}{}

Starting from this file:

\begin{verbatim}
year month day
1970 1 1
2007 9 4
1940 4 15
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{my_url <-}\StringTok{ "http://www.utsc.utoronto.ca/~butler/c32/pieces.txt"}
\NormalTok{dates0 <-}\StringTok{ }\KeywordTok{read_delim}\NormalTok{(my_url, }\StringTok{" "}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Parsed with column specification:
## cols(
##   year = col_double(),
##   month = col_double(),
##   day = col_double()
## )
\end{verbatim}

\end{frame}

\begin{frame}[fragile]{Making some dates}
\protect\hypertarget{making-some-dates}{}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{dates0}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 3 x 3
##    year month   day
##   <dbl> <dbl> <dbl>
## 1  1970     1     1
## 2  2007     9     4
## 3  1940     4    15
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{dates0 }\OperatorTok{%>%}
\StringTok{  }\KeywordTok{unite}\NormalTok{(dates, day, month, year) }\OperatorTok{%>%}
\StringTok{  }\KeywordTok{mutate}\NormalTok{(}\DataTypeTok{d =} \KeywordTok{dmy}\NormalTok{(dates)) ->}\StringTok{ }\NormalTok{newdates}
\end{Highlighting}
\end{Shaded}

\end{frame}

\begin{frame}[fragile]{The results}
\protect\hypertarget{the-results}{}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{newdates}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 3 x 2
##   dates     d         
##   <chr>     <date>    
## 1 1_1_1970  1970-01-01
## 2 4_9_2007  2007-09-04
## 3 15_4_1940 1940-04-15
\end{verbatim}

\begin{itemize}
\tightlist
\item
  \texttt{unite} glues things together with an underscore between them
  (if you don't specify anything else). Syntax: first thing is new
  column to be created, other columns are what to make it out of.
\item
  \texttt{unite} makes the original variable columns year, month, day
  \emph{disappear}.
\item
  The column \texttt{dates} is text, while \texttt{d} is a real date.
\end{itemize}

\end{frame}

\begin{frame}[fragile]{Extracting information from dates}
\protect\hypertarget{extracting-information-from-dates}{}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{newdates }\OperatorTok{%>%}
\StringTok{  }\KeywordTok{mutate}\NormalTok{(}
    \DataTypeTok{mon =} \KeywordTok{month}\NormalTok{(d),}
    \DataTypeTok{day =} \KeywordTok{day}\NormalTok{(d),}
    \DataTypeTok{weekday =} \KeywordTok{wday}\NormalTok{(d, }\DataTypeTok{label =}\NormalTok{ T)}
\NormalTok{  )}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 3 x 5
##   dates     d            mon   day weekday
##   <chr>     <date>     <dbl> <int> <ord>  
## 1 1_1_1970  1970-01-01     1     1 Thu    
## 2 4_9_2007  2007-09-04     9     4 Tue    
## 3 15_4_1940 1940-04-15     4    15 Mon
\end{verbatim}

\end{frame}

\begin{frame}[fragile]{Dates and times}
\protect\hypertarget{dates-and-times-1}{}

\begin{itemize}
\tightlist
\item
  Standard format for times is to put the time after the date, hours,
  minutes, seconds:
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(dd <-}\StringTok{ }\KeywordTok{tibble}\NormalTok{(}\DataTypeTok{text =} \KeywordTok{c}\NormalTok{(}
  \StringTok{"1970-01-01 07:50:01"}\NormalTok{, }\StringTok{"2007-09-04 15:30:00"}\NormalTok{,}
  \StringTok{"1940-04-15 06:45:10"}\NormalTok{, }\StringTok{"2016-02-10 12:26:40"}
\NormalTok{)))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 4 x 1
##   text               
##   <chr>              
## 1 1970-01-01 07:50:01
## 2 2007-09-04 15:30:00
## 3 1940-04-15 06:45:10
## 4 2016-02-10 12:26:40
\end{verbatim}

\end{frame}

\begin{frame}[fragile]{Converting text to date-times:}
\protect\hypertarget{converting-text-to-date-times}{}

\begin{itemize}
\tightlist
\item
  Then get from this text using \texttt{ymd\_hms}:
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{dd }\OperatorTok{%>%}\StringTok{ }\KeywordTok{mutate}\NormalTok{(}\DataTypeTok{dt =} \KeywordTok{ymd_hms}\NormalTok{(text))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 4 x 2
##   text                dt                 
##   <chr>               <dttm>             
## 1 1970-01-01 07:50:01 1970-01-01 07:50:01
## 2 2007-09-04 15:30:00 2007-09-04 15:30:00
## 3 1940-04-15 06:45:10 1940-04-15 06:45:10
## 4 2016-02-10 12:26:40 2016-02-10 12:26:40
\end{verbatim}

\end{frame}

\begin{frame}[fragile]{Timezones}
\protect\hypertarget{timezones}{}

\begin{itemize}
\tightlist
\item
  Default timezone is ``Universal Coordinated Time''. Change it via
  \texttt{tz=} and the name of a timezone:
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{dd }\OperatorTok{%>%}\StringTok{ }
\StringTok{  }\KeywordTok{mutate}\NormalTok{(}\DataTypeTok{dt =} \KeywordTok{ymd_hms}\NormalTok{(text, }\DataTypeTok{tz =} \StringTok{"America/Toronto"}\NormalTok{)) ->}\StringTok{ }\NormalTok{dd}
\NormalTok{dd }\OperatorTok{%>%}\StringTok{ }\KeywordTok{mutate}\NormalTok{(}\DataTypeTok{zone =} \KeywordTok{tz}\NormalTok{(dt))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 4 x 3
##   text              dt                  zone        
##   <chr>             <dttm>              <chr>       
## 1 1970-01-01 07:50… 1970-01-01 07:50:01 America/Tor…
## 2 2007-09-04 15:30… 2007-09-04 15:30:00 America/Tor…
## 3 1940-04-15 06:45… 1940-04-15 06:45:10 America/Tor…
## 4 2016-02-10 12:26… 2016-02-10 12:26:40 America/Tor…
\end{verbatim}

\end{frame}

\begin{frame}[fragile]{Extracting time parts}
\protect\hypertarget{extracting-time-parts}{}

\begin{itemize}
\tightlist
\item
  As you would expect:
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{dd }\OperatorTok{%>%}
\StringTok{  }\KeywordTok{select}\NormalTok{(}\OperatorTok{-}\NormalTok{text) }\OperatorTok{%>%}
\StringTok{  }\KeywordTok{mutate}\NormalTok{(}
    \DataTypeTok{h =} \KeywordTok{hour}\NormalTok{(dt),}
    \DataTypeTok{sec =} \KeywordTok{second}\NormalTok{(dt),}
    \DataTypeTok{min =} \KeywordTok{minute}\NormalTok{(dt),}
    \DataTypeTok{zone =} \KeywordTok{tz}\NormalTok{(dt)}
\NormalTok{  )}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 4 x 5
##   dt                      h   sec   min zone        
##   <dttm>              <int> <dbl> <int> <chr>       
## 1 1970-01-01 07:50:01     7     1    50 America/Tor…
## 2 2007-09-04 15:30:00    15     0    30 America/Tor…
## 3 1940-04-15 06:45:10     6    10    45 America/Tor…
## 4 2016-02-10 12:26:40    12    40    26 America/Tor…
\end{verbatim}

\end{frame}

\begin{frame}[fragile]{Same times, but different time zone:}
\protect\hypertarget{same-times-but-different-time-zone}{}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{dd }\OperatorTok{%>%}
\StringTok{  }\KeywordTok{select}\NormalTok{(dt) }\OperatorTok{%>%}
\StringTok{  }\KeywordTok{mutate}\NormalTok{(}\DataTypeTok{oz =} \KeywordTok{with_tz}\NormalTok{(dt, }\StringTok{"Australia/Sydney"}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 4 x 2
##   dt                  oz                 
##   <dttm>              <dttm>             
## 1 1970-01-01 07:50:01 1970-01-01 22:50:01
## 2 2007-09-04 15:30:00 2007-09-05 05:30:00
## 3 1940-04-15 06:45:10 1940-04-15 21:45:10
## 4 2016-02-10 12:26:40 2016-02-11 04:26:40
\end{verbatim}

In more detail:

\begin{verbatim}
## [1] "1970-01-01 22:50:01 AEST"
## [2] "2007-09-05 05:30:00 AEST"
## [3] "1940-04-15 21:45:10 AEST"
## [4] "2016-02-11 04:26:40 AEDT"
\end{verbatim}

\end{frame}

\begin{frame}[fragile]{How long between date-times?}
\protect\hypertarget{how-long-between-date-times}{}

\begin{itemize}
\tightlist
\item
  We may need to calculate the time between two events. For example,
  these are the dates and times that some patients were admitted to and
  discharged from a hospital:
\end{itemize}

\begin{verbatim}
admit,discharge
1981-12-10 22:00:00,1982-01-03 14:00:00
2014-03-07 14:00:00,2014-03-08 09:30:00
2016-08-31 21:00:00,2016-09-02 17:00:00
\end{verbatim}

\end{frame}

\begin{frame}[fragile]{Do they get read in as date-times?}
\protect\hypertarget{do-they-get-read-in-as-date-times}{}

\begin{itemize}
\tightlist
\item
  These ought to get read in and converted to date-times:
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{my_url <-}\StringTok{ "http://www.utsc.utoronto.ca/~butler/c32/hospital.csv"}
\NormalTok{stays <-}\StringTok{ }\KeywordTok{read_csv}\NormalTok{(my_url)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Parsed with column specification:
## cols(
##   admit = col_datetime(format = ""),
##   discharge = col_datetime(format = "")
## )
\end{verbatim}

\begin{itemize}
\tightlist
\item
  and so it proves.
\end{itemize}

\end{frame}

\begin{frame}[fragile]{Subtracting the date-times}
\protect\hypertarget{subtracting-the-date-times}{}

\begin{itemize}
\tightlist
\item
  In the obvious way, this gets us an answer:
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{stays }\OperatorTok{%>%}\StringTok{ }\KeywordTok{mutate}\NormalTok{(}\DataTypeTok{stay =}\NormalTok{ discharge }\OperatorTok{-}\StringTok{ }\NormalTok{admit)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 3 x 3
##   admit               discharge           stay      
##   <dttm>              <dttm>              <drtn>    
## 1 1981-12-10 22:00:00 1982-01-03 14:00:00 568.0 hou…
## 2 2014-03-07 14:00:00 2014-03-08 09:30:00  19.5 hou…
## 3 2016-08-31 21:00:00 2016-09-02 17:00:00  44.0 hou…
\end{verbatim}

\begin{itemize}
\tightlist
\item
  Number of hours; hard to interpret.
\end{itemize}

\end{frame}

\begin{frame}[fragile]{Days}
\protect\hypertarget{days}{}

\begin{itemize}
\tightlist
\item
  Fractional number of days would be better:
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{stays }\OperatorTok{%>%}\StringTok{ }\KeywordTok{mutate}\NormalTok{(}\DataTypeTok{stay_days =}\NormalTok{ (discharge }\OperatorTok{-}\StringTok{ }\NormalTok{admit) }\OperatorTok{/}\StringTok{ }\KeywordTok{ddays}\NormalTok{(}\DecValTok{1}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 3 x 3
##   admit               discharge           stay_days
##   <dttm>              <dttm>                  <dbl>
## 1 1981-12-10 22:00:00 1982-01-03 14:00:00    23.7  
## 2 2014-03-07 14:00:00 2014-03-08 09:30:00     0.812
## 3 2016-08-31 21:00:00 2016-09-02 17:00:00     1.83
\end{verbatim}

\end{frame}

\begin{frame}[fragile]{Comments}
\protect\hypertarget{comments-26}{}

\begin{itemize}
\tightlist
\item
  Date-times are stored internally as seconds-since-something, so that
  subtracting two of them will give, internally, a number of seconds.
\item
  Just subtracting the date-times is displayed as a time (in units that
  R chooses for us).
\item
  Functions \texttt{ddays(1)}, \texttt{dminutes(1)} etc. will give
  number of seconds in a day or a minute, thus dividing by them will
  give (fractional) days, minutes etc.
\item
  This idea useful for calculating time from a start point until an
  event happens (in this case, a patient being discharged from
  hospital).
\end{itemize}

\end{frame}

\hypertarget{miscellanea}{%
\section{Miscellanea}\label{miscellanea}}

\begin{frame}[fragile]{Packages needed for this section}
\protect\hypertarget{packages-needed-for-this-section}{}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{library}\NormalTok{(tidyverse)}
\KeywordTok{library}\NormalTok{(ggrepel)}
\end{Highlighting}
\end{Shaded}

\end{frame}

\begin{frame}[fragile]{How do you read a file like this?}
\protect\hypertarget{how-do-you-read-a-file-like-this}{}

\begin{verbatim}
rat1T 8
rat2T11
rat3C 7
rat4C 4
rat5T12
\end{verbatim}

\begin{itemize}
\tightlist
\item
  Columns:

  \begin{itemize}
  \tightlist
  \item
    1st 4 columns are ID of rat
  \item
    next 1 column is T (treatment) or C (control)
  \item
    next 2 columns are value of response variable \texttt{y}.
  \end{itemize}
\item
  No delimiters!
\item
  Each data value \emph{same width}.
\item
  \texttt{read\_fwf}.
\end{itemize}

\end{frame}

\begin{frame}[fragile]{Reading in delimiterless data}
\protect\hypertarget{reading-in-delimiterless-data}{}

\begin{itemize}
\tightlist
\item
  \texttt{read\_fwf}, vector of widths and names for columns:
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{my_url <-}\StringTok{ "http://www.utsc.utoronto.ca/~butler/c32/rats7.txt"}
\NormalTok{rat7 <-}\StringTok{ }\KeywordTok{read_fwf}\NormalTok{(my_url, }\KeywordTok{fwf_widths}\NormalTok{(}
  \KeywordTok{c}\NormalTok{(}\DecValTok{4}\NormalTok{, }\DecValTok{1}\NormalTok{, }\DecValTok{2}\NormalTok{),}
  \KeywordTok{c}\NormalTok{(}\StringTok{"id"}\NormalTok{, }\StringTok{"group"}\NormalTok{, }\StringTok{"y"}\NormalTok{)}
\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Parsed with column specification:
## cols(
##   id = col_character(),
##   group = col_character(),
##   y = col_double()
## )
\end{verbatim}

\end{frame}

\begin{frame}[fragile]{The ``rat7'' data}
\protect\hypertarget{the-rat7-data}{}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{rat7}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 5 x 3
##   id    group     y
##   <chr> <chr> <dbl>
## 1 rat1  T         8
## 2 rat2  T        11
## 3 rat3  C         7
## 4 rat4  C         4
## 5 rat5  T        12
\end{verbatim}

\begin{itemize}
\tightlist
\item
  Note that \texttt{read\_fwf} determined that \texttt{y} was a number
  and the other things were text.
\item
  You need to have a separate document telling you how many characters
  each column is.
\end{itemize}

\end{frame}

\begin{frame}[fragile]{Plotting series: The oranges data}
\protect\hypertarget{plotting-series-the-oranges-data}{}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{my_url <-}\StringTok{ "http://www.utsc.utoronto.ca/~butler/c32/oranges.txt"}
\NormalTok{oranges <-}\StringTok{ }\KeywordTok{read_delim}\NormalTok{(my_url, }\StringTok{" "}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Parsed with column specification:
## cols(
##   age = col_double(),
##   A = col_double(),
##   B = col_double(),
##   C = col_double(),
##   D = col_double(),
##   E = col_double()
## )
\end{verbatim}

\end{frame}

\begin{frame}[fragile]{The data}
\protect\hypertarget{the-data-6}{}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{oranges}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 7 x 6
##     age     A     B     C     D     E
##   <dbl> <dbl> <dbl> <dbl> <dbl> <dbl>
## 1   118    30    30    30    33    32
## 2   484    51    58    49    69    62
## 3   664    75    87    81   111   112
## 4  1004   108   115   125   156   167
## 5  1231   115   120   142   172   179
## 6  1372   139   142   174   203   209
## 7  1582   140   145   177   203   214
\end{verbatim}

\begin{itemize}
\tightlist
\item
  These are circumferences of five different trees at seven different
  ages (days).
\end{itemize}

\end{frame}

\begin{frame}[fragile]{Plotting series}
\protect\hypertarget{plotting-series}{}

\begin{itemize}
\item
  Want to plot orange tree circumferences against age for each orange
  tree.
\item
  Recall ggplot wants one column of x values and one column of y values,
  which we do not have.
\item
  Gather up columns A through E, which are different trees but all
  circumferences.
\item
  Then construct a plot (shown over):
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{g <-}\StringTok{ }\NormalTok{oranges }\OperatorTok{%>%}
\StringTok{  }\KeywordTok{gather}\NormalTok{(tree, circumf, A}\OperatorTok{:}\NormalTok{E) }\OperatorTok{%>%}
\StringTok{  }\KeywordTok{ggplot}\NormalTok{(}\KeywordTok{aes}\NormalTok{(}\DataTypeTok{x =}\NormalTok{ age, }\DataTypeTok{y =}\NormalTok{ circumf, }\DataTypeTok{colour =}\NormalTok{ tree)) }\OperatorTok{+}
\StringTok{  }\KeywordTok{geom_point}\NormalTok{() }\OperatorTok{+}\StringTok{ }\KeywordTok{geom_line}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\end{frame}

\begin{frame}[fragile]{The plot}
\protect\hypertarget{the-plot-4}{}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{g}
\end{Highlighting}
\end{Shaded}

\begin{figure}
\centering
\includegraphics{figure/unnamed-chunk-396-1.pdf}
\caption{plot of chunk unnamed-chunk-396}
\end{figure}

\end{frame}

\begin{frame}[fragile]{Labelling points on a plot}
\protect\hypertarget{labelling-points-on-a-plot}{}

\begin{itemize}
\tightlist
\item
  My car data
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{my_url <-}\StringTok{ "http://www.utsc.utoronto.ca/~butler/c32/cars.csv"}
\NormalTok{cars <-}\StringTok{ }\KeywordTok{read_csv}\NormalTok{(my_url)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Parsed with column specification:
## cols(
##   car = col_character(),
##   MPG = col_double(),
##   weight = col_double(),
##   cylinders = col_double(),
##   hp = col_double(),
##   country = col_character()
## )
\end{verbatim}

\begin{itemize}
\tightlist
\item
  Names of and information about 38 models of car (from a US car
  magazine).
\end{itemize}

\end{frame}

\begin{frame}[fragile]{Plot gas mileage against weight}
\protect\hypertarget{plot-gas-mileage-against-weight}{}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{ggplot}\NormalTok{(cars, }\KeywordTok{aes}\NormalTok{(}\DataTypeTok{x =}\NormalTok{ weight, }\DataTypeTok{y =}\NormalTok{ MPG)) }\OperatorTok{+}
\StringTok{  }\KeywordTok{geom_point}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{figure}
\centering
\includegraphics{figure/unnamed-chunk-398-1.pdf}
\caption{plot of chunk unnamed-chunk-398}
\end{figure}

\end{frame}

\begin{frame}[fragile]{Label points with name of car they belong to}
\protect\hypertarget{label-points-with-name-of-car-they-belong-to}{}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{ggplot}\NormalTok{(cars, }\KeywordTok{aes}\NormalTok{(}\DataTypeTok{x =}\NormalTok{ weight, }\DataTypeTok{y =}\NormalTok{ MPG, }\DataTypeTok{label =}\NormalTok{ car)) }\OperatorTok{+}
\StringTok{  }\KeywordTok{geom_point}\NormalTok{() }\OperatorTok{+}\StringTok{ }\KeywordTok{geom_text_repel}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{figure}
\centering
\includegraphics{figure/unnamed-chunk-399-1.pdf}
\caption{plot of chunk unnamed-chunk-399}
\end{figure}

\end{frame}

\begin{frame}[fragile]{Make labels smaller}
\protect\hypertarget{make-labels-smaller}{}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{ggplot}\NormalTok{(cars, }\KeywordTok{aes}\NormalTok{(}\DataTypeTok{x =}\NormalTok{ weight, }\DataTypeTok{y =}\NormalTok{ MPG, }\DataTypeTok{label =}\NormalTok{ car)) }\OperatorTok{+}
\StringTok{  }\KeywordTok{geom_point}\NormalTok{() }\OperatorTok{+}\StringTok{ }\KeywordTok{geom_text_repel}\NormalTok{(}\DataTypeTok{size =} \DecValTok{2}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{figure}
\centering
\includegraphics{figure/unnamed-chunk-400-1.pdf}
\caption{plot of chunk unnamed-chunk-400}
\end{figure}

\end{frame}

\begin{frame}[fragile]{Labelling some of the cars}
\protect\hypertarget{labelling-some-of-the-cars}{}

\begin{itemize}
\tightlist
\item
  Maybe you want to draw attention only to some of the individuals

  \begin{itemize}
  \tightlist
  \item
    for example labelling only certain cars or ones that satisfy a
    condition
  \end{itemize}
\item
  Mechanism: define a new label variable that contains:

  \begin{itemize}
  \tightlist
  \item
    the label, for the individual you want to label
  \item
    blank text for those you don't
  \end{itemize}
\item
  Handy function ifelse, like Excel \texttt{=IF}.
\item
  Label cars with MPG over 34:
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{cars }\OperatorTok{%>%}
\StringTok{  }\KeywordTok{mutate}\NormalTok{(}\DataTypeTok{newlabel =} \KeywordTok{ifelse}\NormalTok{(MPG }\OperatorTok{>}\StringTok{ }\DecValTok{34}\NormalTok{, car, }\StringTok{""}\NormalTok{)) }\OperatorTok{%>%}
\StringTok{  }\KeywordTok{ggplot}\NormalTok{(}\KeywordTok{aes}\NormalTok{(}\DataTypeTok{x =}\NormalTok{ weight, }\DataTypeTok{y =}\NormalTok{ MPG, }\DataTypeTok{label =}\NormalTok{ newlabel)) }\OperatorTok{+}
\StringTok{  }\KeywordTok{geom_point}\NormalTok{() }\OperatorTok{+}
\StringTok{  }\KeywordTok{geom_text_repel}\NormalTok{() ->}\StringTok{ }\NormalTok{g}
\end{Highlighting}
\end{Shaded}

\end{frame}

\begin{frame}[fragile]{The plot}
\protect\hypertarget{the-plot-5}{}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{g}
\end{Highlighting}
\end{Shaded}

\begin{figure}
\centering
\includegraphics{figure/unnamed-chunk-402-1.pdf}
\caption{plot of chunk unnamed-chunk-402}
\end{figure}

\end{frame}

\begin{frame}[fragile]{Labelling cars by row number}
\protect\hypertarget{labelling-cars-by-row-number}{}

\begin{itemize}
\tightlist
\item
  Suppose we knew that the cars we wanted to label were in rows 4 and 9
  of data frame.
\item
  How to use \texttt{ifelse} with row numbers? Define new column of row
  numbers, and then use it in \texttt{ifelse}, thus:
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{g <-}\StringTok{ }\NormalTok{cars }\OperatorTok{%>%}
\StringTok{  }\KeywordTok{mutate}\NormalTok{(}\DataTypeTok{row =} \KeywordTok{row_number}\NormalTok{()) }\OperatorTok{%>%}
\StringTok{  }\KeywordTok{mutate}\NormalTok{(}\DataTypeTok{newlabel =} \KeywordTok{ifelse}\NormalTok{(row }\OperatorTok{==}\StringTok{ }\DecValTok{4} \OperatorTok{|}\StringTok{ }\NormalTok{row }\OperatorTok{==}\StringTok{ }\DecValTok{9}\NormalTok{, car, }\StringTok{""}\NormalTok{)) }\OperatorTok{%>%}
\StringTok{  }\KeywordTok{ggplot}\NormalTok{(}\KeywordTok{aes}\NormalTok{(}\DataTypeTok{x =}\NormalTok{ weight, }\DataTypeTok{y =}\NormalTok{ MPG, }\DataTypeTok{label =}\NormalTok{ newlabel)) }\OperatorTok{+}
\StringTok{  }\KeywordTok{geom_point}\NormalTok{() }\OperatorTok{+}
\StringTok{  }\KeywordTok{geom_text_repel}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\end{frame}

\begin{frame}[fragile]{The plot}
\protect\hypertarget{the-plot-6}{}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{g}
\end{Highlighting}
\end{Shaded}

\begin{figure}
\centering
\includegraphics{figure/unnamed-chunk-404-1.pdf}
\caption{plot of chunk unnamed-chunk-404}
\end{figure}

\end{frame}

\begin{frame}[fragile]{Lightest weight and worst gas-mileage cars}
\protect\hypertarget{lightest-weight-and-worst-gas-mileage-cars}{}

\begin{itemize}
\tightlist
\item
  Suppose you didn't know which cars were the ones you wanted. Then you
  have to find them first.
\item
  Now try for lightest weight and worst gas-mileage cars:
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{cars }\OperatorTok{%>%}
\StringTok{  }\KeywordTok{mutate}\NormalTok{(}\DataTypeTok{tolabel =}\NormalTok{ (weight }\OperatorTok{==}\StringTok{ }\KeywordTok{min}\NormalTok{(weight) }\OperatorTok{|}
\StringTok{    }\NormalTok{MPG }\OperatorTok{==}\StringTok{ }\KeywordTok{min}\NormalTok{(MPG))) }\OperatorTok{%>%}
\StringTok{  }\KeywordTok{mutate}\NormalTok{(}\DataTypeTok{newlabel =} \KeywordTok{ifelse}\NormalTok{(tolabel, car, }\StringTok{""}\NormalTok{)) }\OperatorTok{%>%}
\StringTok{  }\KeywordTok{ggplot}\NormalTok{(}\KeywordTok{aes}\NormalTok{(}\DataTypeTok{x =}\NormalTok{ weight, }\DataTypeTok{y =}\NormalTok{ MPG, }\DataTypeTok{label =}\NormalTok{ newlabel)) }\OperatorTok{+}
\StringTok{  }\KeywordTok{geom_point}\NormalTok{() }\OperatorTok{+}
\StringTok{  }\KeywordTok{geom_text_repel}\NormalTok{() ->}\StringTok{ }\NormalTok{g}
\end{Highlighting}
\end{Shaded}

\end{frame}

\begin{frame}[fragile]{The plot}
\protect\hypertarget{the-plot-7}{}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{g}
\end{Highlighting}
\end{Shaded}

\begin{figure}
\centering
\includegraphics{figure/unnamed-chunk-406-1.pdf}
\caption{plot of chunk unnamed-chunk-406}
\end{figure}

\end{frame}

\begin{frame}{Miscellaneous graph things}
\protect\hypertarget{miscellaneous-graph-things}{}

\begin{itemize}
\tightlist
\item
  Title for graph
\item
  Axis labels
\item
  We use previous graph as base (to save drawing again).
\end{itemize}

\end{frame}

\begin{frame}[fragile]{With title}
\protect\hypertarget{with-title}{}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{g }\OperatorTok{+}\StringTok{ }\KeywordTok{ggtitle}\NormalTok{(}\StringTok{"Gas mileage against weight"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{figure}
\centering
\includegraphics{figure/unnamed-chunk-407-1.pdf}
\caption{plot of chunk unnamed-chunk-407}
\end{figure}

\end{frame}

\begin{frame}[fragile]{Axis labels}
\protect\hypertarget{axis-labels}{}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{g }\OperatorTok{+}\StringTok{ }\KeywordTok{xlab}\NormalTok{(}\StringTok{"Weight (tons)"}\NormalTok{) }\OperatorTok{+}\StringTok{ }\KeywordTok{ylab}\NormalTok{(}\StringTok{"MPG (miles per US gallon)"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{figure}
\centering
\includegraphics{figure/unnamed-chunk-408-1.pdf}
\caption{plot of chunk unnamed-chunk-408}
\end{figure}

\end{frame}

\begin{frame}{Permanence}
\protect\hypertarget{permanence}{}

\begin{itemize}
\tightlist
\item
  When you close R Studio, you are offered the option to ``save your
  workspace''. If you choose ``yes'', all of the data frames and other
  things you have created are saved, so that when you open R Studio in
  the same project later, you will be able to access all of these
  things. (``Everything is permanent'' in that sense.)
\item
  If you choose not to save your workspace, you will have to recreate
  all your objects next time (eg. re-read data from files). But you have
  a script to do that, don't you?
\item
  There is a school of thought that says you should not save your
  workspace, but keep scripts to re-create everything.

  \begin{itemize}
  \tightlist
  \item
    Pro: keeps your workspace ``clean'' of old objects that you created
    but don't need any more, and you know exactly why everything is
    there.
  \item
    Con: some objects take time and effort to re-create, and you won't
    want to do that every time.
  \end{itemize}
\end{itemize}

\end{frame}

\begin{frame}[fragile]{Saving and restoring objects}
\protect\hypertarget{saving-and-restoring-objects}{}

\begin{itemize}
\tightlist
\item
  It is possible to save and re-load large/complicated objects so that
  they don't have to be re-created. Uses \texttt{saveRDS} and
  \texttt{readRDS}:
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{xx <-}\StringTok{ }\KeywordTok{sample}\NormalTok{(}\DecValTok{1}\OperatorTok{:}\DecValTok{10}\NormalTok{, }\DecValTok{5}\NormalTok{)}
\NormalTok{xx}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1]  2  3 10  9  1
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{saveRDS}\NormalTok{(xx, }\StringTok{"xx.rds"}\NormalTok{)}
\KeywordTok{rm}\NormalTok{(xx)}
\NormalTok{xx }\CommentTok{# gone}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Error in eval(expr, envir, enclos): object 'xx' not found
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{xx <-}\StringTok{ }\KeywordTok{readRDS}\NormalTok{(}\StringTok{"xx.rds"}\NormalTok{)}
\NormalTok{xx }\CommentTok{# back}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1]  2  3 10  9  1
\end{verbatim}

\end{frame}

\hypertarget{vector-and-matrix-algebra-for-c33}{%
\section{Vector and matrix algebra (for
C33)}\label{vector-and-matrix-algebra-for-c33}}

\begin{frame}[fragile]{Packages for this section}
\protect\hypertarget{packages-for-this-section-10}{}

\begin{itemize}
\tightlist
\item
  This is (almost) all base R! We only need this for one thing later:
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{library}\NormalTok{(tidyverse)}
\end{Highlighting}
\end{Shaded}

\end{frame}

\begin{frame}[fragile]{Vector addition}
\protect\hypertarget{vector-addition}{}

Adds 2 to each element.

\begin{itemize}
\tightlist
\item
  Adding vectors:
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{u <-}\StringTok{ }\KeywordTok{c}\NormalTok{(}\DecValTok{2}\NormalTok{, }\DecValTok{3}\NormalTok{, }\DecValTok{6}\NormalTok{, }\DecValTok{5}\NormalTok{, }\DecValTok{7}\NormalTok{)}
\NormalTok{v <-}\StringTok{ }\KeywordTok{c}\NormalTok{(}\DecValTok{1}\NormalTok{, }\DecValTok{8}\NormalTok{, }\DecValTok{3}\NormalTok{, }\DecValTok{2}\NormalTok{, }\DecValTok{0}\NormalTok{)}
\NormalTok{u }\OperatorTok{+}\StringTok{ }\NormalTok{v}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1]  3 11  9  7  7
\end{verbatim}

\begin{itemize}
\tightlist
\item
  Elementwise addition. (Linear algebra: vector addition.)
\end{itemize}

\end{frame}

\begin{frame}[fragile]{Adding a number to a vector}
\protect\hypertarget{adding-a-number-to-a-vector}{}

\begin{itemize}
\tightlist
\item
  Define a vector, then ``add 2'' to it:
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{u}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 2 3 6 5 7
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{k <-}\StringTok{ }\DecValTok{2}
\NormalTok{u }\OperatorTok{+}\StringTok{ }\NormalTok{k}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 4 5 8 7 9
\end{verbatim}

\begin{itemize}
\tightlist
\item
  adds 2 to \emph{each} element of \texttt{u}.
\end{itemize}

\end{frame}

\begin{frame}[fragile]{Scalar multiplication}
\protect\hypertarget{scalar-multiplication}{}

As per linear algebra:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{k}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 2
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{u}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 2 3 6 5 7
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{k }\OperatorTok{*}\StringTok{ }\NormalTok{u}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1]  4  6 12 10 14
\end{verbatim}

\begin{itemize}
\tightlist
\item
  Each element of vector multiplied by 2.
\end{itemize}

\end{frame}

\begin{frame}[fragile]{``Vector multiplication''}
\protect\hypertarget{vector-multiplication}{}

What about this?

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{u}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 2 3 6 5 7
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{v}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 1 8 3 2 0
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{u }\OperatorTok{*}\StringTok{ }\NormalTok{v}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1]  2 24 18 10  0
\end{verbatim}

Each element of \texttt{u} multiplied by \emph{corresponding} element of
\texttt{v}. Could be called elementwise multiplication.

(Don't confuse with ``outer'' or ``vector'' product from linear algebra,
or indeed ``inner'' or ``scalar'' multiplication, for which the answer
is a number.)

\end{frame}

\begin{frame}[fragile]{Combining different-length vectors}
\protect\hypertarget{combining-different-length-vectors}{}

\begin{itemize}
\tightlist
\item
  No error here (you get a warning). What happens?
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{u}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 2 3 6 5 7
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{w <-}\StringTok{ }\KeywordTok{c}\NormalTok{(}\DecValTok{1}\NormalTok{, }\DecValTok{2}\NormalTok{)}
\NormalTok{u }\OperatorTok{+}\StringTok{ }\NormalTok{w}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Warning in u + w: longer object length is not a
## multiple of shorter object length
\end{verbatim}

\begin{verbatim}
## [1] 3 5 7 7 8
\end{verbatim}

\begin{itemize}
\tightlist
\item
  Add 1 to first element of \texttt{u}, add 2 to second.
\item
  Go back to beginning of \texttt{w} to find something to add: add 1 to
  3rd element of \texttt{u}, 2 to 4th element, 1 to 5th.
\end{itemize}

\end{frame}

\begin{frame}{How R does this}
\protect\hypertarget{how-r-does-this}{}

\begin{itemize}
\tightlist
\item
  Keep re-using shorter vector until reach length of longer one.
\item
  ``Recycling''.
\item
  If the longer vector's length not a multiple of the shorter vector's
  length, get a warning (probably not what you want).
\item
  Same idea is used when multiplying a vector by a number: the number
  keeps getting recycled.
\end{itemize}

\end{frame}

\begin{frame}[fragile]{Matrices}
\protect\hypertarget{matrices}{}

\begin{itemize}
\tightlist
\item
  Create matrix like this:
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(A <-}\StringTok{ }\KeywordTok{matrix}\NormalTok{(}\DecValTok{1}\OperatorTok{:}\DecValTok{4}\NormalTok{, }\DataTypeTok{nrow =} \DecValTok{2}\NormalTok{, }\DataTypeTok{ncol =} \DecValTok{2}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##      [,1] [,2]
## [1,]    1    3
## [2,]    2    4
\end{verbatim}

\begin{itemize}
\tightlist
\item
  First: stuff to make matrix from, then how many rows and columns.
\item
  R goes down columns by default. To go along rows instead:
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(B <-}\StringTok{ }\KeywordTok{matrix}\NormalTok{(}\DecValTok{5}\OperatorTok{:}\DecValTok{8}\NormalTok{, }\DataTypeTok{nrow =} \DecValTok{2}\NormalTok{, }\DataTypeTok{ncol =} \DecValTok{2}\NormalTok{, }\DataTypeTok{byrow =}\NormalTok{ T))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##      [,1] [,2]
## [1,]    5    6
## [2,]    7    8
\end{verbatim}

\begin{itemize}
\tightlist
\item
  One of \texttt{nrow} and \texttt{ncol} enough, since R knows how many
  things in the matrix.
\end{itemize}

\end{frame}

\begin{frame}[fragile]{Adding matrices}
\protect\hypertarget{adding-matrices}{}

What happens if you add two matrices?

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{A}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##      [,1] [,2]
## [1,]    1    3
## [2,]    2    4
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{B}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##      [,1] [,2]
## [1,]    5    6
## [2,]    7    8
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{A }\OperatorTok{+}\StringTok{ }\NormalTok{B}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##      [,1] [,2]
## [1,]    6    9
## [2,]    9   12
\end{verbatim}

\end{frame}

\begin{frame}{Adding matrices}
\protect\hypertarget{adding-matrices-1}{}

\begin{itemize}
\tightlist
\item
  Nothing surprising here. This is matrix addition as we and linear
  algebra know it.
\end{itemize}

\end{frame}

\begin{frame}[fragile]{Multiplying matrices}
\protect\hypertarget{multiplying-matrices}{}

\begin{itemize}
\tightlist
\item
  Now, what happens here?
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{A}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##      [,1] [,2]
## [1,]    1    3
## [2,]    2    4
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{B}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##      [,1] [,2]
## [1,]    5    6
## [2,]    7    8
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{A }\OperatorTok{*}\StringTok{ }\NormalTok{B}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##      [,1] [,2]
## [1,]    5   18
## [2,]   14   32
\end{verbatim}

\end{frame}

\begin{frame}[fragile]{Multiplying matrices?}
\protect\hypertarget{multiplying-matrices-1}{}

\begin{itemize}
\tightlist
\item
  \emph{Not} matrix multiplication (as per linear algebra).
\item
  Elementwise multiplication. Also called \emph{Hadamard product} of
  \texttt{A} and \texttt{B}.
\end{itemize}

\end{frame}

\begin{frame}[fragile]{Legit matrix multiplication}
\protect\hypertarget{legit-matrix-multiplication}{}

Like this:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{A}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##      [,1] [,2]
## [1,]    1    3
## [2,]    2    4
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{B}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##      [,1] [,2]
## [1,]    5    6
## [2,]    7    8
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{A }\OperatorTok{%*%}\StringTok{ }\NormalTok{B}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##      [,1] [,2]
## [1,]   26   30
## [2,]   38   44
\end{verbatim}

\end{frame}

\begin{frame}[fragile]{Reading matrix from file}
\protect\hypertarget{reading-matrix-from-file}{}

\begin{itemize}
\tightlist
\item
  The usual:
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{my_url <-}\StringTok{ "http://www.utsc.utoronto.ca/~butler/c32/m.txt"}
\NormalTok{M <-}\StringTok{ }\KeywordTok{read_delim}\NormalTok{(my_url, }\StringTok{" "}\NormalTok{, }\DataTypeTok{col_names =}\NormalTok{ F)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Parsed with column specification:
## cols(
##   X1 = col_double(),
##   X2 = col_double()
## )
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{class}\NormalTok{(M)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] "spec_tbl_df" "tbl_df"      "tbl"        
## [4] "data.frame"
\end{verbatim}

\end{frame}

\begin{frame}[fragile]{but\ldots{}}
\protect\hypertarget{but-1}{}

\begin{itemize}
\tightlist
\item
  except that M is not an R matrix, and thus this doesn't work:
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{v <-}\StringTok{ }\KeywordTok{c}\NormalTok{(}\DecValTok{1}\NormalTok{, }\DecValTok{3}\NormalTok{)}
\NormalTok{M }\OperatorTok{%*%}\StringTok{ }\NormalTok{v}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Error in M %*% v: requires numeric/complex matrix/vector arguments
\end{verbatim}

\end{frame}

\begin{frame}[fragile]{Making a genuine matrix}
\protect\hypertarget{making-a-genuine-matrix}{}

Do this first:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{M <-}\StringTok{ }\KeywordTok{as.matrix}\NormalTok{(M)}
\end{Highlighting}
\end{Shaded}

and then all is good:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{M }\OperatorTok{%*%}\StringTok{ }\NormalTok{v}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##      [,1]
## [1,]   37
## [2,]   29
## [3,]   21
\end{verbatim}

\end{frame}

\begin{frame}[fragile]{Linear algebra stuff}
\protect\hypertarget{linear-algebra-stuff}{}

\begin{itemize}
\tightlist
\item
  To solve system of equations \(Ax = w\) for \(x\):
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{A}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##      [,1] [,2]
## [1,]    1    3
## [2,]    2    4
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{w}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 1 2
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{solve}\NormalTok{(A, w)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 1 0
\end{verbatim}

\end{frame}

\begin{frame}[fragile]{Matrix inverse}
\protect\hypertarget{matrix-inverse}{}

\begin{itemize}
\tightlist
\item
  To find the inverse of A:
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{A}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##      [,1] [,2]
## [1,]    1    3
## [2,]    2    4
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{solve}\NormalTok{(A)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##      [,1] [,2]
## [1,]   -2  1.5
## [2,]    1 -0.5
\end{verbatim}

\begin{itemize}
\tightlist
\item
  You can check that the matrix inverse and equation solution are
  correct.
\end{itemize}

\end{frame}

\begin{frame}[fragile]{Inner product}
\protect\hypertarget{inner-product}{}

\begin{itemize}
\tightlist
\item
  Vectors in R are column vectors, so just do the matrix multiplication
  (\texttt{t()} is transpose):
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{a <-}\StringTok{ }\KeywordTok{c}\NormalTok{(}\DecValTok{1}\NormalTok{, }\DecValTok{2}\NormalTok{, }\DecValTok{3}\NormalTok{)}
\NormalTok{b <-}\StringTok{ }\KeywordTok{c}\NormalTok{(}\DecValTok{4}\NormalTok{, }\DecValTok{5}\NormalTok{, }\DecValTok{6}\NormalTok{)}
\KeywordTok{t}\NormalTok{(a) }\OperatorTok{%*%}\StringTok{ }\NormalTok{b}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##      [,1]
## [1,]   32
\end{verbatim}

\begin{itemize}
\tightlist
\item
  Note that the answer is actually a 1 × 1 matrix.
\item
  Or as the sum of the elementwise multiplication:
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{sum}\NormalTok{(a }\OperatorTok{*}\StringTok{ }\NormalTok{b)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 32
\end{verbatim}

\end{frame}

\hypertarget{the-bootstrap}{%
\section{The bootstrap}\label{the-bootstrap}}

\begin{frame}[fragile]{Packages for this section}
\protect\hypertarget{packages-for-this-section-11}{}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{library}\NormalTok{(tidyverse)}
\KeywordTok{library}\NormalTok{(bootstrap)}
\end{Highlighting}
\end{Shaded}

\href{https://www.researchgate.net/publication/265399426_Bootstrap_Methods_and_Permutation_Tests}{ref}

\end{frame}

\begin{frame}[fragile]{Is my sampling distribution normal enough?}
\protect\hypertarget{is-my-sampling-distribution-normal-enough}{}

\begin{itemize}
\tightlist
\item
  Recall the IRS data that we used as a motivation for the sign test:
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{ggplot}\NormalTok{(irs, }\KeywordTok{aes}\NormalTok{(}\DataTypeTok{x=}\NormalTok{Time))}\OperatorTok{+}\KeywordTok{geom_histogram}\NormalTok{(}\DataTypeTok{bins=}\DecValTok{10}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{figure}
\centering
\includegraphics{figure/unnamed-chunk-431-1.pdf}
\caption{plot of chunk unnamed-chunk-431}
\end{figure}

\begin{itemize}
\tightlist
\item
  We said that a \(t\) procedure for the mean would not be a good idea
  because the distribution is skewed.
\end{itemize}

\end{frame}

\begin{frame}{What \emph{actually} matters}
\protect\hypertarget{what-actually-matters}{}

\begin{itemize}
\tightlist
\item
  It's not the distribution of the \emph{data} that has to be approx
  normal (for a \(t\) procedure).
\item
  What matters is the \emph{sampling distribution of the sample mean}.
\item
  If the sample size is large enough, the sampling distribution will be
  normal enough even if the data distribution is not.

  \begin{itemize}
  \tightlist
  \item
    This is why we had to consider the sample size as well as the shape.
  \end{itemize}
\item
  But how do we know whether this is the case or not? We only have
  \emph{one} sample.
\end{itemize}

\end{frame}

\begin{frame}{The (nonparametric) bootstrap}
\protect\hypertarget{the-nonparametric-bootstrap}{}

\begin{itemize}
\tightlist
\item
  Typically, our sample will be reasonably representative of the
  population.
\item
  Idea: pretend the sample \emph{is} the population, and sample from it
  \emph{with replacement}.
\item
  Calculate test statistic, and repeat many times.
\item
  This gives an idea of how our statistic might vary in repeated
  samples: that is, its sampling distribution.
\item
  Called the \textbf{bootstrap distribution} of the test statistic.
\item
  If the bootstrap distribution is approx normal, infer that the true
  sampling distribution also approx normal, therefore inference about
  the mean such as \(t\) is good enough.
\item
  If not, we should be more careful.
\end{itemize}

\end{frame}

\begin{frame}{Why it works}
\protect\hypertarget{why-it-works}{}

\begin{itemize}
\tightlist
\item
  We typically estimate population parameters by using the corresponding
  sample thing: eg. estimate population mean using sample mean.
\item
  This called \textbf{plug-in principle}.
\item
  The fraction of sample values less than a value \(x\) called the
  \textbf{empirical distribution function} (as a function of \(x\)).
\item
  By plug-in principle, the empirical distribution function is an
  estimate of the population CDF.
\item
  In this sense, the sample \emph{is} an estimate of the population, and
  so sampling from it is an estimate of sampling from the population.
\end{itemize}

\end{frame}

\begin{frame}[fragile]{Bootstrapping the IRS data}
\protect\hypertarget{bootstrapping-the-irs-data}{}

\begin{itemize}
\tightlist
\item
  Sampling with replacement is done like this (the default sample size
  is as long as the original data):
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{boot=}\KeywordTok{sample}\NormalTok{(irs}\OperatorTok{$}\NormalTok{Time, }\DataTypeTok{replace=}\NormalTok{T)}
\KeywordTok{mean}\NormalTok{(boot)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 205.1333
\end{verbatim}

\begin{itemize}
\tightlist
\item
  That's one bootstrapped mean. We need a whole bunch.
\item
  Use the same idea as for simulating power:
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{rerun}\NormalTok{(}\DecValTok{1000}\NormalTok{, }\KeywordTok{sample}\NormalTok{(irs}\OperatorTok{$}\NormalTok{Time, }\DataTypeTok{replace=}\NormalTok{T)) }\OperatorTok{%>%}\StringTok{ }
\StringTok{  }\KeywordTok{map_dbl}\NormalTok{(}\OperatorTok{~}\KeywordTok{mean}\NormalTok{(.)) ->}\StringTok{ }\NormalTok{means}
\end{Highlighting}
\end{Shaded}

\end{frame}

\begin{frame}[fragile]{Sampling distribution of sample mean}
\protect\hypertarget{sampling-distribution-of-sample-mean}{}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{ggplot}\NormalTok{(}\KeywordTok{tibble}\NormalTok{(means), }\KeywordTok{aes}\NormalTok{(}\DataTypeTok{x=}\NormalTok{means))}\OperatorTok{+}\KeywordTok{geom_histogram}\NormalTok{(}\DataTypeTok{bins=}\DecValTok{20}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{figure}
\centering
\includegraphics{figure/unnamed-chunk-435-1.pdf}
\caption{plot of chunk unnamed-chunk-435}
\end{figure}

\end{frame}

\begin{frame}[fragile]{Comments}
\protect\hypertarget{comments-27}{}

This is not so bad: a long right tail, maybe:

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{ggplot}\NormalTok{(}\KeywordTok{tibble}\NormalTok{(means), }\KeywordTok{aes}\NormalTok{(}\DataTypeTok{sample=}\NormalTok{means))}\OperatorTok{+}
\StringTok{  }\KeywordTok{stat_qq}\NormalTok{()}\OperatorTok{+}\KeywordTok{stat_qq_line}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{figure}
\centering
\includegraphics{figure/unnamed-chunk-436-1.pdf}
\caption{plot of chunk unnamed-chunk-436}
\end{figure}

\end{frame}

\begin{frame}[fragile]{Confidence interval from the bootstrap
distribution}
\protect\hypertarget{confidence-interval-from-the-bootstrap-distribution}{}

There are two ways (at least):

\begin{itemize}
\tightlist
\item
  percentile bootstrap interval: take the 2.5 and 97.5 percentiles (to
  get the middle 95\%). This is easy, but not always the best:
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(}\DataTypeTok{b_p=}\KeywordTok{quantile}\NormalTok{(means, }\KeywordTok{c}\NormalTok{(}\FloatTok{0.025}\NormalTok{, }\FloatTok{0.975}\NormalTok{)))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##     2.5%    97.5% 
## 159.5292 244.1075
\end{verbatim}

\begin{itemize}
\tightlist
\item
  bootstrap \(t\): use the SD of the bootstrapped sampling distribution
  as the SE of the estimator of the mean and make a \(t\) interval:
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{n=}\KeywordTok{length}\NormalTok{(irs}\OperatorTok{$}\NormalTok{Time)}
\NormalTok{t_star=}\KeywordTok{qt}\NormalTok{(}\FloatTok{0.975}\NormalTok{, n}\DecValTok{-1}\NormalTok{)}
\NormalTok{(}\DataTypeTok{b_t=}\KeywordTok{mean}\NormalTok{(means)}\OperatorTok{+}\KeywordTok{c}\NormalTok{(}\OperatorTok{-}\DecValTok{1}\NormalTok{, }\DecValTok{1}\NormalTok{)}\OperatorTok{*}\NormalTok{t_star}\OperatorTok{*}\KeywordTok{sd}\NormalTok{(means))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 157.9020 245.4334
\end{verbatim}

\end{frame}

\begin{frame}[fragile]{Comparing}
\protect\hypertarget{comparing}{}

\begin{itemize}
\tightlist
\item
  get ordinary \(t\) interval:
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{my_names=}\KeywordTok{c}\NormalTok{(}\StringTok{"LCL"}\NormalTok{, }\StringTok{"UCL"}\NormalTok{)}
\NormalTok{o_t=}\KeywordTok{t.test}\NormalTok{(irs}\OperatorTok{$}\NormalTok{Time)}\OperatorTok{$}\NormalTok{conf.int}
\end{Highlighting}
\end{Shaded}

\begin{itemize}
\tightlist
\item
  Compare the 2 bootstrap intervals with the ordinary \(t\)-interval:
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{tibble}\NormalTok{(}\DataTypeTok{limit=}\NormalTok{my_names, o_t, b_t, b_p)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 2 x 4
##   limit   o_t   b_t   b_p
##   <chr> <dbl> <dbl> <dbl>
## 1 LCL    155.  158.  160.
## 2 UCL    247.  245.  244.
\end{verbatim}

\begin{itemize}
\tightlist
\item
  The bootstrap \(t\) and the ordinary \(t\) are very close
\item
  The percentile bootstrap interval is noticeably shorter (common) and
  higher (skewness).
\end{itemize}

\end{frame}

\begin{frame}{Which to prefer?}
\protect\hypertarget{which-to-prefer}{}

\begin{itemize}
\tightlist
\item
  If the intervals agree, then they are all good.
\item
  If they disagree, they are all bad!
\item
  In that case, use BCA interval (over).
\end{itemize}

\end{frame}

\begin{frame}[fragile]{Bias correction and acceleration}
\protect\hypertarget{bias-correction-and-acceleration}{}

\begin{itemize}
\tightlist
\item
  this from ``An introduction to the bootstrap'', by Brad Efron and
  Robert J. Tibshirani.
\item
  there is way of correcting the CI for skewness in the bootstrap
  distribution, called the BCa method
\item
  complicated (see the Efron and Tibshirani book), but implemented in
  \texttt{bootstrap} package.
\end{itemize}

\end{frame}

\begin{frame}[fragile]{Run this on the IRS data:}
\protect\hypertarget{run-this-on-the-irs-data}{}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{bca=}\KeywordTok{bcanon}\NormalTok{(irs}\OperatorTok{$}\NormalTok{Time, }\DecValTok{1000}\NormalTok{, mean)}
\NormalTok{bca}\OperatorTok{$}\NormalTok{confpoints}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##      alpha bca point
## [1,] 0.025  162.8000
## [2,] 0.050  166.8000
## [3,] 0.100  174.4667
## [4,] 0.160  179.5667
## [5,] 0.840  224.6000
## [6,] 0.900  234.3000
## [7,] 0.950  247.4333
## [8,] 0.975  256.3000
\end{verbatim}

\end{frame}

\begin{frame}[fragile]{use 2.5\% and 97.5\% points for CI}
\protect\hypertarget{use-2.5-and-97.5-points-for-ci}{}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{bca}\OperatorTok{$}\NormalTok{confpoints }\OperatorTok{%>%}\StringTok{ }\KeywordTok{as_tibble}\NormalTok{() }\OperatorTok{%>%}\StringTok{ }
\StringTok{  }\KeywordTok{filter}\NormalTok{(alpha }\OperatorTok{%in%}\StringTok{ }\KeywordTok{c}\NormalTok{(}\FloatTok{0.025}\NormalTok{, }\FloatTok{0.975}\NormalTok{)) }\OperatorTok{%>%}\StringTok{ }
\StringTok{  }\KeywordTok{pull}\NormalTok{(}\StringTok{`}\DataTypeTok{bca point}\StringTok{`}\NormalTok{) ->}\StringTok{ }\NormalTok{b_bca}
\NormalTok{b_bca}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 162.8 256.3
\end{verbatim}

\end{frame}

\begin{frame}[fragile]{Comparing}
\protect\hypertarget{comparing-1}{}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{tibble}\NormalTok{(}\DataTypeTok{limit=}\NormalTok{my_names, o_t, b_t, b_p, b_bca)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 2 x 5
##   limit   o_t   b_t   b_p b_bca
##   <chr> <dbl> <dbl> <dbl> <dbl>
## 1 LCL    155.  158.  160.  163.
## 2 UCL    247.  245.  244.  256.
\end{verbatim}

\begin{itemize}
\tightlist
\item
  The BCA interval says that the mean should be estimated even higher
  than the bootstrap percentile interval does.
\item
  The BCA interval is the one to trust.
\end{itemize}

\end{frame}

\begin{frame}[fragile]{Bootstrapping the correlation}
\protect\hypertarget{bootstrapping-the-correlation}{}

Recall the soap data:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{url=}\StringTok{"http://www.utsc.utoronto.ca/~butler/c32/soap.txt"}
\NormalTok{soap=}\KeywordTok{read_delim}\NormalTok{(url,}\StringTok{" "}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Parsed with column specification:
## cols(
##   case = col_double(),
##   scrap = col_double(),
##   speed = col_double(),
##   line = col_character()
## )
\end{verbatim}

\end{frame}

\begin{frame}[fragile]{The data}
\protect\hypertarget{the-data-7}{}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{ggplot}\NormalTok{(soap, }\KeywordTok{aes}\NormalTok{(}\DataTypeTok{x=}\NormalTok{speed, }\DataTypeTok{y=}\NormalTok{scrap, }\DataTypeTok{colour=}\NormalTok{line))}\OperatorTok{+}
\StringTok{  }\KeywordTok{geom_point}\NormalTok{()}\OperatorTok{+}\KeywordTok{geom_smooth}\NormalTok{(}\DataTypeTok{method=}\StringTok{"lm"}\NormalTok{, }\DataTypeTok{se=}\NormalTok{F)}
\end{Highlighting}
\end{Shaded}

\begin{figure}
\centering
\includegraphics{figure/unnamed-chunk-445-1.pdf}
\caption{plot of chunk unnamed-chunk-445}
\end{figure}

\end{frame}

\begin{frame}{Comments}
\protect\hypertarget{comments-28}{}

\begin{itemize}
\tightlist
\item
  Line B produces less scrap for any given speed.
\item
  For line B, estimate the correlation between speed and scrap (with a
  confidence interval.)
\end{itemize}

\end{frame}

\begin{frame}[fragile]{Extract the line B data; standard correlation
test}
\protect\hypertarget{extract-the-line-b-data-standard-correlation-test}{}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{soap }\OperatorTok{%>%}\StringTok{ }\KeywordTok{filter}\NormalTok{(line}\OperatorTok{==}\StringTok{"b"}\NormalTok{) ->}\StringTok{ }\NormalTok{line_b}
\KeywordTok{with}\NormalTok{(line_b, }\KeywordTok{cor.test}\NormalTok{(speed, scrap))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## 
##  Pearson's product-moment correlation
## 
## data:  speed and scrap
## t = 15.829, df = 10, p-value = 2.083e-08
## alternative hypothesis: true correlation is not equal to 0
## 95 percent confidence interval:
##  0.9302445 0.9947166
## sample estimates:
##       cor 
## 0.9806224
\end{verbatim}

\end{frame}

\begin{frame}[fragile]{Bootstrapping a correlation 1/2}
\protect\hypertarget{bootstrapping-a-correlation-12}{}

\begin{itemize}
\tightlist
\item
  This illustrates a different technique: we need to keep the \(x\) and
  \(y\) values \emph{together}.
\item
  Sample \emph{rows} of the data frame rather than individual values of
  \texttt{speed} and \texttt{scrap}:
\end{itemize}

\scriptsize

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{line_b }\OperatorTok{%>%}\StringTok{ }\KeywordTok{sample_frac}\NormalTok{(}\DataTypeTok{replace=}\NormalTok{T)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 12 x 4
##     case scrap speed line 
##    <dbl> <dbl> <dbl> <chr>
##  1    16   140   105 b    
##  2    16   140   105 b    
##  3    21   180   135 b    
##  4    20   215   175 b    
##  5    16   140   105 b    
##  6    24   252   155 b    
##  7    25   422   320 b    
##  8    25   422   320 b    
##  9    25   422   320 b    
## 10    20   215   175 b    
## 11    24   252   155 b    
## 12    20   215   175 b
\end{verbatim}

\normalsize

\end{frame}

\begin{frame}[fragile]{Bootstrapping a correlation 2/2}
\protect\hypertarget{bootstrapping-a-correlation-22}{}

1000 times:

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{rerun}\NormalTok{(}\DecValTok{1000}\NormalTok{, }\KeywordTok{sample_frac}\NormalTok{(line_b, }\DataTypeTok{replace=}\NormalTok{T)) }\OperatorTok{%>%}
\StringTok{  }\KeywordTok{map_dbl}\NormalTok{(}\OperatorTok{~}\KeywordTok{with}\NormalTok{(.,}\KeywordTok{cor}\NormalTok{(speed, scrap))) ->}\StringTok{ }\NormalTok{cors}
\end{Highlighting}
\end{Shaded}

\end{frame}

\begin{frame}[fragile]{A picture of this}
\protect\hypertarget{a-picture-of-this}{}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{ggplot}\NormalTok{(}\KeywordTok{tibble}\NormalTok{(cors), }\KeywordTok{aes}\NormalTok{(}\DataTypeTok{x=}\NormalTok{cors))}\OperatorTok{+}\KeywordTok{geom_histogram}\NormalTok{(}\DataTypeTok{bins=}\DecValTok{15}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{figure}
\centering
\includegraphics{figure/unnamed-chunk-450-1.pdf}
\caption{plot of chunk unnamed-chunk-450}
\end{figure}

\end{frame}

\begin{frame}[fragile]{Comments and next steps}
\protect\hypertarget{comments-and-next-steps-1}{}

\begin{itemize}
\tightlist
\item
  This is very left-skewed.
\item
  Bootstrap percentile interval is:
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(}\DataTypeTok{b_p=}\KeywordTok{quantile}\NormalTok{(cors, }\KeywordTok{c}\NormalTok{(}\FloatTok{0.025}\NormalTok{, }\FloatTok{0.975}\NormalTok{)))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##      2.5%     97.5% 
## 0.9443861 0.9961813
\end{verbatim}

\begin{itemize}
\tightlist
\item
  We probably need the BCA interval instead.
\end{itemize}

\end{frame}

\begin{frame}[fragile]{Getting the BCA interval 1/2}
\protect\hypertarget{getting-the-bca-interval-12}{}

\begin{itemize}
\tightlist
\item
  To use \texttt{bcanon}, write a function that takes a vector of row
  numbers and returns the correlation between \texttt{speed} and
  \texttt{scrap} for those rows:
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{theta=}\ControlFlowTok{function}\NormalTok{(rows, d) \{}
\NormalTok{  d }\OperatorTok{%>%}\StringTok{ }\KeywordTok{slice}\NormalTok{(rows) }\OperatorTok{%>%}\StringTok{ }\KeywordTok{with}\NormalTok{(., }\KeywordTok{cor}\NormalTok{(speed, scrap))}
\NormalTok{\}}
\KeywordTok{theta}\NormalTok{(}\DecValTok{1}\OperatorTok{:}\DecValTok{3}\NormalTok{, line_b)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 0.9928971
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{line_b }\OperatorTok{%>%}\StringTok{ }\KeywordTok{slice}\NormalTok{(}\DecValTok{1}\OperatorTok{:}\DecValTok{3}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 3 x 4
##    case scrap speed line 
##   <dbl> <dbl> <dbl> <chr>
## 1    16   140   105 b    
## 2    17   277   215 b    
## 3    18   384   270 b
\end{verbatim}

\begin{itemize}
\tightlist
\item
  That looks about right.
\end{itemize}

\end{frame}

\begin{frame}[fragile]{Getting the BCA interval 2/2}
\protect\hypertarget{getting-the-bca-interval-22}{}

\begin{itemize}
\tightlist
\item
  Inputs to \texttt{bcanon} are now:

  \begin{itemize}
  \tightlist
  \item
    row numbers (1 through 12 in our case: 12 rows in \texttt{line\_b})
  \item
    number of bootstrap samples
  \item
    the function we just wrote
  \item
    the data frame:
  \end{itemize}
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{points=}\KeywordTok{bcanon}\NormalTok{(}\DecValTok{1}\OperatorTok{:}\DecValTok{12}\NormalTok{, }\DecValTok{1000}\NormalTok{, theta, line_b)}\OperatorTok{$}\NormalTok{confpoints}
\NormalTok{points }\OperatorTok{%>%}\StringTok{ }\KeywordTok{as_tibble}\NormalTok{() }\OperatorTok{%>%}\StringTok{ }
\StringTok{  }\KeywordTok{filter}\NormalTok{(alpha }\OperatorTok{%in%}\StringTok{ }\KeywordTok{c}\NormalTok{(}\FloatTok{0.025}\NormalTok{, }\FloatTok{0.975}\NormalTok{)) }\OperatorTok{%>%}\StringTok{ }
\StringTok{  }\KeywordTok{pull}\NormalTok{(}\StringTok{`}\DataTypeTok{bca point}\StringTok{`}\NormalTok{) ->}\StringTok{ }\NormalTok{b_bca}
\NormalTok{b_bca}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 0.9281762 0.9945955
\end{verbatim}

\end{frame}

\begin{frame}[fragile]{Comparing the results}
\protect\hypertarget{comparing-the-results}{}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{tibble}\NormalTok{(}\DataTypeTok{limit=}\NormalTok{my_names, o_c, b_p, b_bca)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 2 x 4
##   limit   o_c   b_p b_bca
##   <chr> <dbl> <dbl> <dbl>
## 1 LCL   0.930 0.944 0.928
## 2 UCL   0.995 0.996 0.995
\end{verbatim}

\begin{itemize}
\tightlist
\item
  The bootstrap percentile interval doesn't go down far enough.
\item
  The BCA interval seems to do a better job than the ordinary
  \texttt{cor.test} interval in capturing the skewness of the
  distribution.
\end{itemize}

\end{frame}

\hypertarget{bayesian-statistics-with-rstan}{%
\section{\texorpdfstring{Bayesian statistics with
\texttt{rstan}}{Bayesian statistics with rstan}}\label{bayesian-statistics-with-rstan}}

\begin{frame}[fragile]{Packages for this section}
\protect\hypertarget{packages-for-this-section-12}{}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{library}\NormalTok{(tidyverse)}
\KeywordTok{library}\NormalTok{(rstan)}
\end{Highlighting}
\end{Shaded}

\end{frame}

\begin{frame}{Bayesian and frequentist inference}
\protect\hypertarget{bayesian-and-frequentist-inference}{}

\begin{itemize}
\tightlist
\item
  The inference philosophy that we have learned so far says that:

  \begin{itemize}
  \tightlist
  \item
    parameters to be estimated are \emph{fixed} but \emph{unknown}
  \item
    Data random; if we took another sample we'd get different data.
  \end{itemize}
\item
  This is called ``frequentist'' or ``repeated-sampling'' inference.
\item
  Bayesian inference says:

  \begin{itemize}
  \tightlist
  \item
    \emph{parameters} are random, \emph{data} is \emph{given}
  \end{itemize}
\item
  Ingredients:

  \begin{itemize}
  \tightlist
  \item
    \textbf{prior distribution}: distribution of parameters before
    seeing data.
  \item
    \textbf{likelihood}: model for data if the parameters are known
  \item
    \textbf{posterior distribution}: distribution of parameters
    \emph{after} seeing data.
  \end{itemize}
\end{itemize}

\end{frame}

\begin{frame}{Distribution of parameters}
\protect\hypertarget{distribution-of-parameters}{}

\begin{itemize}
\tightlist
\item
  Instead of having a point or interval estimate of a parameter, we have
  an entire distribution
\item
  so in Bayesian statistics we can talk about eg.

  \begin{itemize}
  \tightlist
  \item
    probability that a parameter is bigger than some value
  \item
    probability that a parameter is close to some value
  \item
    probability that one parameter is bigger than another
  \end{itemize}
\item
  Name comes from Bayes' Theorem, which here says
\end{itemize}

\begin{quote}
posterior is proportional to likelihood times prior
\end{quote}

\begin{itemize}
\tightlist
\item
  more discussion about this is in
  \href{http://ritsokiguess.site/docs/2018/02/28/working-my-way-back-to-you-a-re-investigation-of-rstan/}{\textbf{a
  blog post}}.
\end{itemize}

\end{frame}

\begin{frame}[fragile]{An example}
\protect\hypertarget{an-example}{}

\begin{itemize}
\tightlist
\item
  Suppose we have these (integer) observations:
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(x <-}\StringTok{ }\KeywordTok{c}\NormalTok{(}\DecValTok{0}\NormalTok{, }\DecValTok{4}\NormalTok{, }\DecValTok{3}\NormalTok{, }\DecValTok{6}\NormalTok{, }\DecValTok{3}\NormalTok{, }\DecValTok{3}\NormalTok{, }\DecValTok{2}\NormalTok{, }\DecValTok{4}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 0 4 3 6 3 3 2 4
\end{verbatim}

\begin{itemize}
\tightlist
\item
  Suppose we believe that these come from a Poisson distribution with a
  mean \(\lambda\) that we want to estimate.
\item
  We need a prior distribution for \(\lambda\). I will (for some reason)
  take a \(Weibull\) distribution with parameters 1.1 and 6, that has
  quartiles 2 and 6. Normally this would come from your knowledge of the
  data-generating \emph{process}.
\item
  The Poisson likelihood can be written down (see over).
\end{itemize}

\end{frame}

\begin{frame}{Some algebra}
\protect\hypertarget{some-algebra}{}

\begin{itemize}
\tightlist
\item
  We have \(n=8\) observations \(x_i\), so the Poisson likelihood is
  proportional to
\end{itemize}

\[ \prod_{i=1}^n e^{-\lambda} \lambda^{x_i} = e^{-n\lambda} \lambda^S, \]
where \(S=\sum_{i=1}^n x_i\).

\begin{itemize}
\tightlist
\item
  then you write the Weibull prior density (as a function of
  \(\lambda\)):
\end{itemize}

\[ C (\lambda/6)^{0.1} e^{-(\lambda/6)^{1.1}}  \] where \(C\) is a
constant.

\begin{itemize}
\tightlist
\item
  and then you multiply these together and try to recognize the
  distributional form. Only, here you can't. The powers 0.1 and 1.1 get
  in the way.
\end{itemize}

\end{frame}

\begin{frame}[fragile]{Sampling from the posterior distribution}
\protect\hypertarget{sampling-from-the-posterior-distribution}{}

\begin{itemize}
\item
  Wouldn't it be nice if we could just \emph{sample} from the posterior
  distribution? Then we would be able to compute it as accurately as we
  want.
\item
  Metropolis and Hastings: devise a Markov chain (C62) whose limiting
  distribution is the posterior you want, and then sample from that
  Markov chain (easy), allowing enough time to get close enough to the
  limiting distribution.
\item
  Stan: uses a modern variant that is more efficient (called Hamiltonian
  Monte Carlo), implemented in R package \texttt{rstan}.
\item
  Write Stan code in a file, compile it and sample from it.
\end{itemize}

\end{frame}

\begin{frame}[fragile]{Components of Stan code: the model}
\protect\hypertarget{components-of-stan-code-the-model}{}

\begin{verbatim}
model {
// likelihood
x ~ poisson(lambda);
}
\end{verbatim}

This is how you say ``\(X\) has a Poisson distribution with mean
\(\lambda\)''. \textbf{Note that lines of Stan code have semicolons on
the end.}

\end{frame}

\begin{frame}[fragile]{Components of Stan code: the prior distribution}
\protect\hypertarget{components-of-stan-code-the-prior-distribution}{}

\begin{verbatim}
model {
// prior
lambda ~ weibull(1.1, 6);
// likelihood
x ~ poisson(lambda);
}
\end{verbatim}

\end{frame}

\begin{frame}[fragile]{Components of Stan code: data and parameters
(first in the Stan code)}
\protect\hypertarget{components-of-stan-code-data-and-parameters-first-in-the-stan-code}{}

\begin{verbatim}
data {
int x[8];
}

parameters {
real<lower=0> lambda;
}
\end{verbatim}

\end{frame}

\begin{frame}[fragile]{Compile and sample from the model}
\protect\hypertarget{compile-and-sample-from-the-model}{}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{poisson1_code <-}\StringTok{ }\KeywordTok{stan_model}\NormalTok{(}\DataTypeTok{file =} \StringTok{"poisson1.stan"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{itemize}
\tightlist
\item
  set up data
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{poisson1_data <-}\StringTok{ }\KeywordTok{list}\NormalTok{(}\DataTypeTok{x =}\NormalTok{ x)}
\end{Highlighting}
\end{Shaded}

\begin{itemize}
\tightlist
\item
  sample
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{poisson1_fit <-}\StringTok{ }\KeywordTok{sampling}\NormalTok{(poisson1_code, }\DataTypeTok{data =}\NormalTok{ poisson1_data)}
\end{Highlighting}
\end{Shaded}

\end{frame}

\begin{frame}[fragile]{The output}
\protect\hypertarget{the-output-1}{}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{poisson1_fit}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Inference for Stan model: poisson1.
## 4 chains, each with iter=2000; warmup=1000; thin=1; 
## post-warmup draws per chain=1000, total post-warmup draws=4000.
## 
##        mean se_mean   sd 2.5%  25%  50%  75% 97.5%
## lambda 3.18    0.02 0.63 2.06 2.74 3.13 3.57  4.51
## lp__   3.74    0.02 0.74 1.61 3.57 4.02 4.20  4.26
##        n_eff Rhat
## lambda  1381    1
## lp__    1723    1
## 
## Samples were drawn using NUTS(diag_e) at Mon Mar 16 19:15:06 2020.
## For each parameter, n_eff is a crude measure of effective sample size,
## and Rhat is the potential scale reduction factor on split chains (at 
## convergence, Rhat=1).
\end{verbatim}

\end{frame}

\begin{frame}{Comments}
\protect\hypertarget{comments-29}{}

\begin{itemize}
\tightlist
\item
  This summarizes the posterior distribution of \(\lambda\)
\item
  the posterior mean is 3.20
\item
  with a 95\% posterior interval of 2.10 to 4.56.
\item
  The probability that \(\lambda\) is between these two values really is
  95\%.
\end{itemize}

\end{frame}

\begin{frame}[fragile]{Making the code more general}
\protect\hypertarget{making-the-code-more-general}{}

\begin{itemize}
\tightlist
\item
  The coder in you is probably offended by hard-coding the sample size
  and the parameters of the prior distribution. More generally:
\end{itemize}

\begin{verbatim}
data {
  int<lower=1> n;
  real<lower=0> a;
  real<lower=0> b;
  int x[n];
}
...
model {
// prior
lambda ~ weibull(a, b);
// likelihood
x ~ poisson(lambda);
}
\end{verbatim}

\end{frame}

\begin{frame}[fragile]{Set up again and sample:}
\protect\hypertarget{set-up-again-and-sample}{}

\begin{itemize}
\tightlist
\item
  Compile again:
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{poisson2_code <-}\StringTok{ }\KeywordTok{stan_model}\NormalTok{(}\DataTypeTok{file =} \StringTok{"poisson2.stan"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{itemize}
\tightlist
\item
  set up the data again including the new things we need:
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{poisson2_data <-}\StringTok{ }\KeywordTok{list}\NormalTok{(}\DataTypeTok{x =}\NormalTok{ x, }\DataTypeTok{n =} \KeywordTok{length}\NormalTok{(x), }\DataTypeTok{a =} \FloatTok{1.1}\NormalTok{, }\DataTypeTok{b =} \DecValTok{6}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{itemize}
\tightlist
\item
  sample again
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{poisson2_fit <-}\StringTok{ }\KeywordTok{sampling}\NormalTok{(poisson1_code, }\DataTypeTok{data =}\NormalTok{ poisson2_data)}
\end{Highlighting}
\end{Shaded}

\end{frame}

\begin{frame}[fragile]{output should be the same (to within randomness)}
\protect\hypertarget{output-should-be-the-same-to-within-randomness}{}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{poisson2_fit}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Inference for Stan model: poisson1.
## 4 chains, each with iter=2000; warmup=1000; thin=1; 
## post-warmup draws per chain=1000, total post-warmup draws=4000.
## 
##        mean se_mean   sd 2.5%  25%  50%  75% 97.5%
## lambda 3.18    0.02 0.62 2.07 2.74 3.15 3.58  4.55
## lp__   3.75    0.02 0.72 1.77 3.60 4.03 4.21  4.26
##        n_eff Rhat
## lambda  1550    1
## lp__    1609    1
## 
## Samples were drawn using NUTS(diag_e) at Mon Mar 16 19:15:11 2020.
## For each parameter, n_eff is a crude measure of effective sample size,
## and Rhat is the potential scale reduction factor on split chains (at 
## convergence, Rhat=1).
\end{verbatim}

\end{frame}

\begin{frame}[fragile]{Extracting actual sampled values}
\protect\hypertarget{extracting-actual-sampled-values}{}

\begin{itemize}
\tightlist
\item
  \texttt{rstan} has \texttt{extract} for this. There is also an
  \texttt{extract} in \texttt{dplyr}: make sure you have the right one.
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{poisson2_out <-}\StringTok{ }\KeywordTok{extract}\NormalTok{(poisson2_fit)}
\KeywordTok{ggplot}\NormalTok{(}\KeywordTok{tibble}\NormalTok{(}\DataTypeTok{lambda =}\NormalTok{ poisson2_out}\OperatorTok{$}\NormalTok{lambda), }\KeywordTok{aes}\NormalTok{(}\DataTypeTok{x =}\NormalTok{ lambda)) }\OperatorTok{+}
\StringTok{  }\KeywordTok{geom_histogram}\NormalTok{(}\DataTypeTok{bins =} \DecValTok{20}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{figure}
\centering
\includegraphics{figure/unnamed-chunk-470-1.pdf}
\caption{plot of chunk unnamed-chunk-470}
\end{figure}

\end{frame}

\begin{frame}[fragile]{Posterior predictive distribution}
\protect\hypertarget{posterior-predictive-distribution}{}

\begin{itemize}
\tightlist
\item
  Another use for the actual sampled values is to see what kind of
  \emph{response} values we might get in the future. This should look
  something like our data. For a Poisson distribution, the response
  values are integers:
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{tibble}\NormalTok{(}\DataTypeTok{lambda =}\NormalTok{ poisson2_out}\OperatorTok{$}\NormalTok{lambda) }\OperatorTok{%>%}
\StringTok{  }\KeywordTok{mutate}\NormalTok{(}\DataTypeTok{x_sim =} \KeywordTok{map_int}\NormalTok{(lambda, }\OperatorTok{~}\StringTok{ }\KeywordTok{rpois}\NormalTok{(}\DecValTok{1}\NormalTok{, .))) ->}\StringTok{ }\NormalTok{d}
\end{Highlighting}
\end{Shaded}

\end{frame}

\begin{frame}[fragile]{A bar chart:}
\protect\hypertarget{a-bar-chart}{}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{ggplot}\NormalTok{(d, }\KeywordTok{aes}\NormalTok{(}\DataTypeTok{x =}\NormalTok{ x_sim)) }\OperatorTok{+}\StringTok{ }\KeywordTok{geom_bar}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{figure}
\centering
\includegraphics{figure/unnamed-chunk-472-1.pdf}
\caption{plot of chunk unnamed-chunk-472}
\end{figure}

\end{frame}

\begin{frame}[fragile]{Comparison}
\protect\hypertarget{comparison}{}

Our actual data values were these:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{x}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 0 4 3 6 3 3 2 4
\end{verbatim}

\begin{itemize}
\tightlist
\item
  None of these are very unlikely according to our posterior predictive
  distribution, so our model is believable.
\item
  Or make a plot: a bar chart with the data on it as well (over):
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{ggplot}\NormalTok{(d, }\KeywordTok{aes}\NormalTok{(}\DataTypeTok{x =}\NormalTok{ x_sim)) }\OperatorTok{+}\StringTok{ }\KeywordTok{geom_bar}\NormalTok{() }\OperatorTok{+}
\StringTok{  }\KeywordTok{geom_dotplot}\NormalTok{(}\DataTypeTok{data =} \KeywordTok{tibble}\NormalTok{(x), }\KeywordTok{aes}\NormalTok{(}\DataTypeTok{x =}\NormalTok{ x), }\DataTypeTok{binwidth =} \DecValTok{1}\NormalTok{) }\OperatorTok{+}
\StringTok{  }\KeywordTok{scale_y_continuous}\NormalTok{(}\OtherTok{NULL}\NormalTok{, }\DataTypeTok{breaks =} \OtherTok{NULL}\NormalTok{) ->}\StringTok{ }\NormalTok{g}
\end{Highlighting}
\end{Shaded}

\begin{itemize}
\tightlist
\item
  This also shows that the distribution of the data conforms well enough
  to the posterior predictive distribution (over).
\end{itemize}

\end{frame}

\begin{frame}[fragile]{The plot}
\protect\hypertarget{the-plot-8}{}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{g}
\end{Highlighting}
\end{Shaded}

\begin{figure}
\centering
\includegraphics{figure/unnamed-chunk-475-1.pdf}
\caption{plot of chunk unnamed-chunk-475}
\end{figure}

\end{frame}

\begin{frame}[fragile]{Analysis of variance, the Bayesian way}
\protect\hypertarget{analysis-of-variance-the-bayesian-way}{}

Recall the jumping rats data:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{my_url <-}\StringTok{ "http://www.utsc.utoronto.ca/~butler/c32/jumping.txt"}
\NormalTok{rats0 <-}\StringTok{ }\KeywordTok{read_delim}\NormalTok{(my_url, }\StringTok{" "}\NormalTok{)}
\NormalTok{rats0 }\OperatorTok{%>%}\StringTok{ }\KeywordTok{sample_n}\NormalTok{(}\DecValTok{6}\NormalTok{) }\CommentTok{# random sample of rows}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 6 x 2
##   group    density
##   <chr>      <dbl>
## 1 Lowjump      632
## 2 Control      614
## 3 Lowjump      594
## 4 Highjump     626
## 5 Highjump     631
## 6 Highjump     650
\end{verbatim}

\end{frame}

\begin{frame}{Our aims here}
\protect\hypertarget{our-aims-here}{}

\begin{itemize}
\tightlist
\item
  Estimate the mean bone density of all rats under each of the
  experimental conditions
\item
  Model: given the group means, each observation normally distributed
  with common variance \(\sigma^2\)
\item
  Three parameters to estimate, plus the common variance.
\item
  Obtain posterior distributions for the group means.
\item
  Ask whether the posterior distributions of these means are
  sufficiently different.
\end{itemize}

\end{frame}

\begin{frame}[fragile]{Numbering the groups}
\protect\hypertarget{numbering-the-groups}{}

\begin{itemize}
\tightlist
\item
  Stan doesn't handle categorical variables (everything is \texttt{real}
  or \texttt{int}).
\item
  Turn the groups into group \emph{numbers} first.
\item
  Take opportunity to put groups in logical order:
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{rats0 }\OperatorTok{%>%}\StringTok{ }\KeywordTok{mutate}\NormalTok{(}
  \DataTypeTok{group_fct =} \KeywordTok{fct_inorder}\NormalTok{(group),}
  \DataTypeTok{group_no =} \KeywordTok{as.integer}\NormalTok{(group_fct)}
\NormalTok{) ->}\StringTok{ }\NormalTok{rats}
\NormalTok{rats }\OperatorTok{%>%}\StringTok{ }\KeywordTok{sample_n}\NormalTok{(}\DecValTok{4}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 4 x 4
##   group    density group_fct group_no
##   <chr>      <dbl> <fct>        <int>
## 1 Lowjump      607 Lowjump          2
## 2 Control      600 Control          1
## 3 Highjump     626 Highjump         3
## 4 Lowjump      596 Lowjump          2
\end{verbatim}

\end{frame}

\begin{frame}[fragile]{Plotting the data 1/2}
\protect\hypertarget{plotting-the-data-12}{}

Most obviously, boxplots:

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{ggplot}\NormalTok{(rats, }\KeywordTok{aes}\NormalTok{(}\DataTypeTok{x =}\NormalTok{ group_fct, }\DataTypeTok{y =}\NormalTok{ density)) }\OperatorTok{+}\StringTok{ }\KeywordTok{geom_boxplot}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{figure}
\centering
\includegraphics{figure/unnamed-chunk-478-1.pdf}
\caption{plot of chunk unnamed-chunk-478}
\end{figure}

\end{frame}

\begin{frame}[fragile]{Plotting the data 2/2}
\protect\hypertarget{plotting-the-data-22}{}

Another way: density plot (smoothed out histogram); can distinguish
groups by colours:

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{ggplot}\NormalTok{(rats, }\KeywordTok{aes}\NormalTok{(}\DataTypeTok{x =}\NormalTok{ density, }\DataTypeTok{colour =}\NormalTok{ group_fct)) }\OperatorTok{+}
\StringTok{  }\KeywordTok{geom_density}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{figure}
\centering
\includegraphics{figure/unnamed-chunk-479-1.pdf}
\caption{plot of chunk unnamed-chunk-479}
\end{figure}

\end{frame}

\begin{frame}[fragile]{The procedure}
\protect\hypertarget{the-procedure}{}

\begin{itemize}
\tightlist
\item
  For each observation, find out which (numeric) group it belongs to,
\item
  then model it as having a normal distribution with that group's mean
  and the common variance.
\item
  Stan does \texttt{for} loops.
\end{itemize}

\end{frame}

\begin{frame}[fragile]{The model part}
\protect\hypertarget{the-model-part}{}

Suppose we have \texttt{n\_obs} observations:

\begin{verbatim}
model {
  // likelihood
  for (i in 1:n_obs) {
    g=group_no[i];
    density[i] ~ normal(mu[g], sigma);
  }
}
\end{verbatim}

\end{frame}

\begin{frame}[fragile]{The variables here}
\protect\hypertarget{the-variables-here}{}

\begin{itemize}
\tightlist
\item
  \texttt{n\_obs} is data.
\item
  \texttt{g} is a temporary integer variable only used here
\item
  \texttt{i} is only used in the loop (integer) and does not need to be
  declared
\item
  \texttt{density} is data, a real vector of length \texttt{n\_obs}
\item
  \texttt{mu} is a parameter, a real vector of length 3 (3 groups)
\item
  \texttt{sigma} is a real parameter
\end{itemize}

\texttt{mu} and \texttt{sigma} need prior distributions:

\begin{itemize}
\tightlist
\item
  for \texttt{mu}, each component independently normal with mean 600 and
  SD 50 (my guess at how big and variable they will be)
\item
  for \texttt{sigma}, chi-squared with 50 df (my guess at typical amount
  of variability from obs to obs)
\end{itemize}

\end{frame}

\begin{frame}[fragile]{Complete the \texttt{model} section:}
\protect\hypertarget{complete-the-model-section}{}

\begin{verbatim}
model {
  int g;
  // priors
  mu ~ normal(600, 50);
  sigma ~ chi_square(50);
  // likelihood
  for (i in 1:n_obs) {
    g=group_no[i];
    density[i] ~ normal(mu[g], sigma);
  }
}
\end{verbatim}

\end{frame}

\begin{frame}[fragile]{Parameters}
\protect\hypertarget{parameters}{}

The elements of \texttt{mu}, one per group, and also \texttt{sigma},
scalar:

\begin{verbatim}
parameters {
  real mu[n_group];
  real<lower=0> sigma;
}
\end{verbatim}

\begin{itemize}
\tightlist
\item
  \texttt{sigma} has to be positive. Declare it so here, so that the
  sampling runs smoothly.
\item
  declare \texttt{n\_group} in data section
\end{itemize}

\end{frame}

\begin{frame}[fragile]{Data}
\protect\hypertarget{data}{}

Everything else:

\begin{verbatim}
data {
  int n_obs;
  int n_group;
  real density[n_obs];
  int<lower=1, upper=n_group> group_no[n_obs];
}
\end{verbatim}

\end{frame}

\begin{frame}[fragile]{Compile}
\protect\hypertarget{compile}{}

Arrange these in order data, parameters, model in file
\texttt{anova.stan}, then:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{anova_compiled <-}\StringTok{ }\KeywordTok{stan_model}\NormalTok{(}\StringTok{"anova.stan"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\end{frame}

\begin{frame}[fragile]{Set up data and sample}
\protect\hypertarget{set-up-data-and-sample}{}

Supply values for \emph{everything} declared in \texttt{data}:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{anova_data <-}\StringTok{ }\KeywordTok{list}\NormalTok{(}
  \DataTypeTok{n_obs =} \DecValTok{30}\NormalTok{,}
  \DataTypeTok{n_group =} \DecValTok{3}\NormalTok{,}
  \DataTypeTok{density =}\NormalTok{ rats}\OperatorTok{$}\NormalTok{density,}
  \DataTypeTok{group_no =}\NormalTok{ rats}\OperatorTok{$}\NormalTok{group_no}
\NormalTok{)}
\NormalTok{anova_samples <-}\StringTok{ }\KeywordTok{sampling}\NormalTok{(anova_compiled, }\DataTypeTok{data =}\NormalTok{ anova_data)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## 
## SAMPLING FOR MODEL 'anova' NOW (CHAIN 1).
## Chain 1: 
## Chain 1: Gradient evaluation took 1e-05 seconds
## Chain 1: 1000 transitions using 10 leapfrog steps per transition would take 0.1 seconds.
## Chain 1: Adjust your expectations accordingly!
## Chain 1: 
## Chain 1: 
## Chain 1: Iteration:    1 / 2000 [  0%]  (Warmup)
## Chain 1: Iteration:  200 / 2000 [ 10%]  (Warmup)
## Chain 1: Iteration:  400 / 2000 [ 20%]  (Warmup)
## Chain 1: Iteration:  600 / 2000 [ 30%]  (Warmup)
## Chain 1: Iteration:  800 / 2000 [ 40%]  (Warmup)
## Chain 1: Iteration: 1000 / 2000 [ 50%]  (Warmup)
## Chain 1: Iteration: 1001 / 2000 [ 50%]  (Sampling)
## Chain 1: Iteration: 1200 / 2000 [ 60%]  (Sampling)
## Chain 1: Iteration: 1400 / 2000 [ 70%]  (Sampling)
## Chain 1: Iteration: 1600 / 2000 [ 80%]  (Sampling)
## Chain 1: Iteration: 1800 / 2000 [ 90%]  (Sampling)
## Chain 1: Iteration: 2000 / 2000 [100%]  (Sampling)
## Chain 1: 
## Chain 1:  Elapsed Time: 0.093307 seconds (Warm-up)
## Chain 1:                0.024983 seconds (Sampling)
## Chain 1:                0.11829 seconds (Total)
## Chain 1: 
## 
## SAMPLING FOR MODEL 'anova' NOW (CHAIN 2).
## Chain 2: 
## Chain 2: Gradient evaluation took 7e-06 seconds
## Chain 2: 1000 transitions using 10 leapfrog steps per transition would take 0.07 seconds.
## Chain 2: Adjust your expectations accordingly!
## Chain 2: 
## Chain 2: 
## Chain 2: Iteration:    1 / 2000 [  0%]  (Warmup)
## Chain 2: Iteration:  200 / 2000 [ 10%]  (Warmup)
## Chain 2: Iteration:  400 / 2000 [ 20%]  (Warmup)
## Chain 2: Iteration:  600 / 2000 [ 30%]  (Warmup)
## Chain 2: Iteration:  800 / 2000 [ 40%]  (Warmup)
## Chain 2: Iteration: 1000 / 2000 [ 50%]  (Warmup)
## Chain 2: Iteration: 1001 / 2000 [ 50%]  (Sampling)
## Chain 2: Iteration: 1200 / 2000 [ 60%]  (Sampling)
## Chain 2: Iteration: 1400 / 2000 [ 70%]  (Sampling)
## Chain 2: Iteration: 1600 / 2000 [ 80%]  (Sampling)
## Chain 2: Iteration: 1800 / 2000 [ 90%]  (Sampling)
## Chain 2: Iteration: 2000 / 2000 [100%]  (Sampling)
## Chain 2: 
## Chain 2:  Elapsed Time: 0.094445 seconds (Warm-up)
## Chain 2:                0.050271 seconds (Sampling)
## Chain 2:                0.144716 seconds (Total)
## Chain 2: 
## 
## SAMPLING FOR MODEL 'anova' NOW (CHAIN 3).
## Chain 3: 
## Chain 3: Gradient evaluation took 6e-06 seconds
## Chain 3: 1000 transitions using 10 leapfrog steps per transition would take 0.06 seconds.
## Chain 3: Adjust your expectations accordingly!
## Chain 3: 
## Chain 3: 
## Chain 3: Iteration:    1 / 2000 [  0%]  (Warmup)
## Chain 3: Iteration:  200 / 2000 [ 10%]  (Warmup)
## Chain 3: Iteration:  400 / 2000 [ 20%]  (Warmup)
## Chain 3: Iteration:  600 / 2000 [ 30%]  (Warmup)
## Chain 3: Iteration:  800 / 2000 [ 40%]  (Warmup)
## Chain 3: Iteration: 1000 / 2000 [ 50%]  (Warmup)
## Chain 3: Iteration: 1001 / 2000 [ 50%]  (Sampling)
## Chain 3: Iteration: 1200 / 2000 [ 60%]  (Sampling)
## Chain 3: Iteration: 1400 / 2000 [ 70%]  (Sampling)
## Chain 3: Iteration: 1600 / 2000 [ 80%]  (Sampling)
## Chain 3: Iteration: 1800 / 2000 [ 90%]  (Sampling)
## Chain 3: Iteration: 2000 / 2000 [100%]  (Sampling)
## Chain 3: 
## Chain 3:  Elapsed Time: 0.092212 seconds (Warm-up)
## Chain 3:                0.025309 seconds (Sampling)
## Chain 3:                0.117521 seconds (Total)
## Chain 3: 
## 
## SAMPLING FOR MODEL 'anova' NOW (CHAIN 4).
## Chain 4: 
## Chain 4: Gradient evaluation took 6e-06 seconds
## Chain 4: 1000 transitions using 10 leapfrog steps per transition would take 0.06 seconds.
## Chain 4: Adjust your expectations accordingly!
## Chain 4: 
## Chain 4: 
## Chain 4: Iteration:    1 / 2000 [  0%]  (Warmup)
## Chain 4: Iteration:  200 / 2000 [ 10%]  (Warmup)
## Chain 4: Iteration:  400 / 2000 [ 20%]  (Warmup)
## Chain 4: Iteration:  600 / 2000 [ 30%]  (Warmup)
## Chain 4: Iteration:  800 / 2000 [ 40%]  (Warmup)
## Chain 4: Iteration: 1000 / 2000 [ 50%]  (Warmup)
## Chain 4: Iteration: 1001 / 2000 [ 50%]  (Sampling)
## Chain 4: Iteration: 1200 / 2000 [ 60%]  (Sampling)
## Chain 4: Iteration: 1400 / 2000 [ 70%]  (Sampling)
## Chain 4: Iteration: 1600 / 2000 [ 80%]  (Sampling)
## Chain 4: Iteration: 1800 / 2000 [ 90%]  (Sampling)
## Chain 4: Iteration: 2000 / 2000 [100%]  (Sampling)
## Chain 4: 
## Chain 4:  Elapsed Time: 0.081605 seconds (Warm-up)
## Chain 4:                0.024813 seconds (Sampling)
## Chain 4:                0.106418 seconds (Total)
## Chain 4:
\end{verbatim}

\end{frame}

\begin{frame}[fragile]{Check that the sampling worked properly}
\protect\hypertarget{check-that-the-sampling-worked-properly}{}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{traceplot}\NormalTok{(anova_samples)}
\end{Highlighting}
\end{Shaded}

\begin{figure}
\centering
\includegraphics{figure/unnamed-chunk-483-1.pdf}
\caption{plot of chunk unnamed-chunk-483}
\end{figure}

\end{frame}

\begin{frame}{Comments}
\protect\hypertarget{comments-30}{}

\begin{itemize}
\tightlist
\item
  The sampled values for each of the parameters should move freely
  across their posterior distributions (and not get stuck anywhere).
\item
  This appears to have happened.
\end{itemize}

\end{frame}

\begin{frame}[fragile]{Look at the results}
\protect\hypertarget{look-at-the-results}{}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{anova_samples}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Inference for Stan model: anova.
## 4 chains, each with iter=2000; warmup=1000; thin=1; 
## post-warmup draws per chain=1000, total post-warmup draws=4000.
## 
##         mean se_mean   sd   2.5%    25%    50%
## mu[1] 601.21    0.13 8.78 583.78 595.43 601.22
## mu[2] 611.95    0.14 8.60 594.77 606.26 612.12
## mu[3] 637.35    0.14 8.91 619.06 631.56 637.40
## sigma  28.42    0.07 4.20  21.44  25.34  28.07
## lp__  -40.96    0.03 1.40 -44.40 -41.64 -40.68
##          75%  97.5% n_eff Rhat
## mu[1] 606.87 618.78  4395    1
## mu[2] 617.40 628.73  3855    1
## mu[3] 643.47 654.29  4059    1
## sigma  31.01  37.54  3824    1
## lp__  -39.93 -39.16  1985    1
## 
## Samples were drawn using NUTS(diag_e) at Mon Mar 16 19:15:14 2020.
## For each parameter, n_eff is a crude measure of effective sample size,
## and Rhat is the potential scale reduction factor on split chains (at 
## convergence, Rhat=1).
\end{verbatim}

\end{frame}

\begin{frame}{Comments}
\protect\hypertarget{comments-31}{}

\begin{itemize}
\tightlist
\item
  The posterior 95\% intervals for control (group 1) and highjump (group
  3) do not quite overlap, suggesting that these exercise groups really
  are different.
\item
  Bayesian approach does not normally do tests: look at posterior
  distributions and decide whether they are different enough to be worth
  treating as different.
\end{itemize}

\end{frame}

\begin{frame}[fragile]{Plotting the posterior distributions for the
\texttt{mu}}
\protect\hypertarget{plotting-the-posterior-distributions-for-the-mu}{}

\begin{itemize}
\tightlist
\item
  Extract the sampled \texttt{mu} values (matrix):
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{anova_ext <-}\StringTok{ }\KeywordTok{extract}\NormalTok{(anova_samples)}
\KeywordTok{head}\NormalTok{(anova_ext}\OperatorTok{$}\NormalTok{mu)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##           
## iterations     [,1]     [,2]     [,3]
##       [1,] 599.4065 614.7397 625.7129
##       [2,] 608.8610 612.9657 631.0857
##       [3,] 597.1930 614.8401 627.5928
##       [4,] 605.4433 606.1242 631.8701
##       [5,] 600.6274 609.9353 634.9262
##       [6,] 612.6777 611.3543 643.4910
\end{verbatim}

\end{frame}

\begin{frame}[fragile]{Turn into a data frame, arrange for plotting,
name groups}
\protect\hypertarget{turn-into-a-data-frame-arrange-for-plotting-name-groups}{}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{cbind}\NormalTok{(anova_ext}\OperatorTok{$}\NormalTok{mu, }\DataTypeTok{sigma =}\NormalTok{ anova_ext}\OperatorTok{$}\NormalTok{sigma) }\OperatorTok{%>%}
\StringTok{  }\KeywordTok{as_tibble}\NormalTok{() }\OperatorTok{%>%}
\StringTok{  }\KeywordTok{gather}\NormalTok{(group, density, V1}\OperatorTok{:}\NormalTok{V3) }\OperatorTok{%>%}
\StringTok{  }\KeywordTok{mutate}\NormalTok{(}\DataTypeTok{group =} \KeywordTok{fct_recode}\NormalTok{(}
\NormalTok{    group,}
    \DataTypeTok{Control =} \StringTok{"V1"}\NormalTok{,}
    \DataTypeTok{Lowjump =} \StringTok{"V2"}\NormalTok{,}
    \DataTypeTok{Highjump =} \StringTok{"V3"}
\NormalTok{  )) ->}\StringTok{ }\NormalTok{sims}
\end{Highlighting}
\end{Shaded}

\end{frame}

\begin{frame}[fragile]{What we have now:}
\protect\hypertarget{what-we-have-now}{}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{sims }\OperatorTok{%>%}\StringTok{ }\KeywordTok{sample_n}\NormalTok{(}\DecValTok{8}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 8 x 3
##   sigma group    density
##   <dbl> <fct>      <dbl>
## 1  23.6 Lowjump     621.
## 2  27.0 Control     611.
## 3  24.7 Highjump    631.
## 4  27.6 Highjump    630.
## 5  23.5 Lowjump     608.
## 6  29.5 Lowjump     617.
## 7  28.2 Highjump    626.
## 8  23.8 Control     605.
\end{verbatim}

\end{frame}

\begin{frame}[fragile]{Density plots of posterior mean distributions}
\protect\hypertarget{density-plots-of-posterior-mean-distributions}{}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{ggplot}\NormalTok{(sims, }\KeywordTok{aes}\NormalTok{(}\DataTypeTok{x =}\NormalTok{ density, }\DataTypeTok{colour =}\NormalTok{ group)) }\OperatorTok{+}\StringTok{ }\KeywordTok{geom_density}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{figure}
\centering
\includegraphics{figure/unnamed-chunk-488-1.pdf}
\caption{plot of chunk unnamed-chunk-488}
\end{figure}

\end{frame}

\begin{frame}[fragile]{Posterior predictive distributions}
\protect\hypertarget{posterior-predictive-distributions}{}

Randomly sample from posterior means and SDs in \texttt{sims}. There are
12000 rows in \texttt{sims}:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{sims }\OperatorTok{%>%}\StringTok{ }\KeywordTok{mutate}\NormalTok{(}\DataTypeTok{sim_data =} \KeywordTok{rnorm}\NormalTok{(}\DecValTok{12000}\NormalTok{, density, sigma)) ->}\StringTok{ }\NormalTok{ppd}
\NormalTok{ppd }\OperatorTok{%>%}\StringTok{ }\KeywordTok{sample_n}\NormalTok{(}\DecValTok{8}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 8 x 4
##   sigma group    density sim_data
##   <dbl> <fct>      <dbl>    <dbl>
## 1  35.1 Control     600.     556.
## 2  25.5 Highjump    634.     641.
## 3  24.2 Highjump    636.     680.
## 4  29.6 Highjump    639.     686.
## 5  28.3 Highjump    647.     670.
## 6  35.4 Control     601.     585.
## 7  32.2 Highjump    629.     654.
## 8  28.6 Control     596.     582.
\end{verbatim}

\end{frame}

\begin{frame}[fragile]{Compare posterior predictive distribution with
actual data}
\protect\hypertarget{compare-posterior-predictive-distribution-with-actual-data}{}

\begin{itemize}
\tightlist
\item
  Check that the model works: distributions of data similar to what we'd
  predict
\item
  Idea: make plots of posterior predictive distribution, and plot actual
  data as points on them
\item
  Use facets, one for each treatment group:
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{my_binwidth <-}\StringTok{ }\DecValTok{15}
\KeywordTok{ggplot}\NormalTok{(ppd, }\KeywordTok{aes}\NormalTok{(}\DataTypeTok{x =}\NormalTok{ sim_data)) }\OperatorTok{+}
\StringTok{  }\KeywordTok{geom_histogram}\NormalTok{(}\DataTypeTok{binwidth =}\NormalTok{ my_binwidth) }\OperatorTok{+}
\StringTok{  }\KeywordTok{geom_dotplot}\NormalTok{(}
    \DataTypeTok{data =}\NormalTok{ rats, }\KeywordTok{aes}\NormalTok{(}\DataTypeTok{x =}\NormalTok{ density),}
    \DataTypeTok{binwidth =}\NormalTok{ my_binwidth}
\NormalTok{  ) }\OperatorTok{+}
\StringTok{  }\KeywordTok{facet_wrap}\NormalTok{(}\OperatorTok{~}\NormalTok{group) }\OperatorTok{+}
\StringTok{  }\KeywordTok{scale_y_continuous}\NormalTok{(}\OtherTok{NULL}\NormalTok{, }\DataTypeTok{breaks =} \OtherTok{NULL}\NormalTok{) ->}\StringTok{ }\NormalTok{g}
\end{Highlighting}
\end{Shaded}

\begin{itemize}
\tightlist
\item
  See (over) that the data values are mainly in the middle of the
  predictive distributions.
\item
  Even the control group that had outliers.
\end{itemize}

\end{frame}

\begin{frame}[fragile]{The plot}
\protect\hypertarget{the-plot-9}{}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{g}
\end{Highlighting}
\end{Shaded}

\begin{figure}
\centering
\includegraphics{figure/unnamed-chunk-491-1.pdf}
\caption{plot of chunk unnamed-chunk-491}
\end{figure}

\end{frame}

\begin{frame}[fragile]{Extensions}
\protect\hypertarget{extensions}{}

\begin{itemize}
\tightlist
\item
  if you want a different model other than normal, change distribution
  in \texttt{model} section
\item
  if you want to allow unequal spreads, create
  \texttt{sigma{[}n\_group{]}} and in model
  \texttt{density{[}i{]}\ \textasciitilde{}\ normal(mu{[}g{]},\ sigma{[}g{]});}
\item
  Stan will work just fine after you recompile
\item
  very flexible.
\item
  Typical modelling strategy: start simple, add complexity as warranted
  by data.
\end{itemize}

\end{frame}

\begin{frame}[fragile]{Comparing models}
\protect\hypertarget{comparing-models}{}

\begin{itemize}
\tightlist
\item
  Typically in ANOVA situation, we want to see whether the group means
  are ``really'' different.
\item
  We are used to doing an \(F\)-test here.
\item
  In regression, have looked at AIC: measure of fit allowing for
  complexity.
\item
  Bayesian equivalent called \texttt{looic}, in package \texttt{loo}.
\end{itemize}

\end{frame}

\begin{frame}{Difficulty:}
\protect\hypertarget{difficulty}{}

\begin{itemize}
\tightlist
\item
  Posterior proportional to likelihood times prior:

  \begin{itemize}
  \tightlist
  \item
    Stan drops proportionality constant
  \item
    but for model comparison, it matters.
  \end{itemize}
\item
  Have to calculate log-likelihood again, not dropping constants this
  time.
\end{itemize}

\end{frame}

\begin{frame}[fragile]{The extra code}
\protect\hypertarget{the-extra-code}{}

\begin{verbatim}
generated quantities {
  vector[n_obs] log_lik;
  int g;
  for (i in 1:n_obs) {
    g=group_no[i];
    log_lik[i] = normal_lpdf(density[i] | mu[g], sigma);
  }
}
\end{verbatim}

\end{frame}

\begin{frame}[fragile]{Comments}
\protect\hypertarget{comments-32}{}

\begin{itemize}
\tightlist
\item
  This is repeat of \texttt{model} section, but note no ``squiggle'':
  this explicitly calculates the log of the normal density function for
  each observation and saves it in an array.
\item
  This section goes at the bottom.
\end{itemize}

\end{frame}

\begin{frame}[fragile]{Compile and sample}
\protect\hypertarget{compile-and-sample}{}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{anova_loo_compiled <-}\StringTok{ }\KeywordTok{stan_model}\NormalTok{(}\StringTok{"anova-loo.stan"}\NormalTok{)}
\NormalTok{anova_data <-}\StringTok{ }\KeywordTok{list}\NormalTok{(}
  \DataTypeTok{n_obs =} \DecValTok{30}\NormalTok{,}
  \DataTypeTok{n_group =} \DecValTok{3}\NormalTok{,}
  \DataTypeTok{density =}\NormalTok{ rats}\OperatorTok{$}\NormalTok{density,}
  \DataTypeTok{group_no =}\NormalTok{ rats}\OperatorTok{$}\NormalTok{group_no}
\NormalTok{)}
\NormalTok{anova_loo_samples <-}\StringTok{ }\KeywordTok{sampling}\NormalTok{(anova_loo_compiled, }\DataTypeTok{data =}\NormalTok{ anova_data)}
\end{Highlighting}
\end{Shaded}

\end{frame}

\begin{frame}[fragile]{Now we need a null model}
\protect\hypertarget{now-we-need-a-null-model}{}

\begin{itemize}
\tightlist
\item
  one value of \texttt{mu} for all groups
\item
  replace all the \texttt{mu{[}i{]}} with \texttt{mu}
\item
  omit any reference to group numbers (not needed any more)
\item
  leave the \texttt{data} section as is (so can use previous
  \texttt{anova\_data}).
\end{itemize}

\end{frame}

\begin{frame}[fragile]{The null Stan code 1/2}
\protect\hypertarget{the-null-stan-code-12}{}

\begin{verbatim}
data {
  int n_obs;
  int n_group;
  real density[n_obs];
  int<lower=1, upper=n_group> group_no[n_obs];
}

parameters {
  real mu;
  real<lower=0> sigma;
}
\end{verbatim}

\end{frame}

\begin{frame}[fragile]{The null Stan code 2/2}
\protect\hypertarget{the-null-stan-code-22}{}

\begin{verbatim}
model {
  // priors
  mu ~ normal(600, 50);
  sigma ~ chi_square(50);
  // likelihood
  for (i in 1:n_obs) {
    density[i] ~ normal(mu, sigma);
  }
}

generated quantities {
  vector[n_obs] log_lik;
  for (i in 1:n_obs) {
    log_lik[i] = normal_lpdf(density[i] | mu, sigma);
  }
}
\end{verbatim}

\end{frame}

\begin{frame}[fragile]{Compile and sample again}
\protect\hypertarget{compile-and-sample-again}{}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{anova_loo_null_compiled <-}\StringTok{ }\KeywordTok{stan_model}\NormalTok{(}\StringTok{"anova_loo_null.stan"}\NormalTok{)}
\NormalTok{anova_loo_null_samples <-}\StringTok{ }\KeywordTok{sampling}\NormalTok{(anova_loo_null_compiled, }\DataTypeTok{data =}\NormalTok{ anova_data)}
\end{Highlighting}
\end{Shaded}

\end{frame}

\begin{frame}[fragile]{Compare the fits of the two models}
\protect\hypertarget{compare-the-fits-of-the-two-models}{}

Setup

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{log_lik_a <-}\StringTok{ }\KeywordTok{extract_log_lik}\NormalTok{(anova_loo_samples,}
  \DataTypeTok{merge_chains =}\NormalTok{ F}
\NormalTok{)}
\NormalTok{log_lik_}\DecValTok{0}\NormalTok{ <-}\StringTok{ }\KeywordTok{extract_log_lik}\NormalTok{(anova_loo_null_samples,}
  \DataTypeTok{merge_chains =}\NormalTok{ F}
\NormalTok{)}
\NormalTok{r_eff_a <-}\StringTok{ }\KeywordTok{relative_eff}\NormalTok{(log_lik_a)}
\NormalTok{r_eff_}\DecValTok{0}\NormalTok{ <-}\StringTok{ }\KeywordTok{relative_eff}\NormalTok{(log_lik_}\DecValTok{0}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\end{frame}

\begin{frame}[fragile]{Results 1/2}
\protect\hypertarget{results-12}{}

\footnotesize

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{loo}\NormalTok{(log_lik_a, }\DataTypeTok{r_eff =}\NormalTok{ r_eff_a)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## 
## Computed from 4000 by 30 log-likelihood matrix
## 
##          Estimate  SE
## elpd_loo   -138.7 2.6
## p_loo         2.3 0.5
## looic       277.4 5.2
## ------
## Monte Carlo SE of elpd_loo is 0.0.
## 
## All Pareto k estimates are good (k < 0.5).
## See help('pareto-k-diagnostic') for details.
\end{verbatim}

\normalsize

\end{frame}

\begin{frame}[fragile]{Results 2/2}
\protect\hypertarget{results-22}{}

\small

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{loo}\NormalTok{(log_lik_}\DecValTok{0}\NormalTok{, }\DataTypeTok{r_eff =}\NormalTok{ r_eff_}\DecValTok{0}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## 
## Computed from 4000 by 30 log-likelihood matrix
## 
##          Estimate  SE
## elpd_loo   -142.8 2.8
## p_loo         1.2 0.3
## looic       285.6 5.6
## ------
## Monte Carlo SE of elpd_loo is 0.0.
## 
## All Pareto k estimates are good (k < 0.5).
## See help('pareto-k-diagnostic') for details.
\end{verbatim}

\normalsize

\end{frame}

\begin{frame}[fragile]{Comments}
\protect\hypertarget{comments-34}{}

\begin{itemize}
\tightlist
\item
  Look at \texttt{looic}: smaller value is better, allowing for
  complexity of model
\item
  For separate means, 277.7; for one single mean, 285.7.
\item
  Prefer the model with separate means, one for each group.
\end{itemize}

\end{frame}

\hypertarget{the-end-of-the-notes}{%
\section{the end of the notes}\label{the-end-of-the-notes}}

\end{document}
